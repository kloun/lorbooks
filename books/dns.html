
<html>

<head>
<meta name="allow-search" content="yes">
<meta name="robots"       content="index,follow">
<meta name="Author"       content="Artem Podstreshny">

<title>Domain Name System</title>

<body bgcolor=ffffff text=000000 link=0000ff vlink=7777ff>
<?php include("/home/maxcom/linux_html/books/head.php3") ?>
<center>
<h2><b>Имена Интернет</b></h2>
</center>
<p align=right>
<font size=2>
 Подстрешный Артем,<br>
 программист <br>Radio-MSU Network,<br>
<a href="mailto:art@radio-msu.net">art@radio-msu.net</a><br>
</font>
</p>
<center>  
                                      Введение
</center>
<p> &nbsp;Для человека, поработавшего даже небольшое время в сети, становится совершенно естественным,
что у каждого компьютера, подключенного к интернет, есть свое название, имя, которое
легко запомнить. Система, которая позволяет нам использовать эти привычные для человека
имена, избегая других неудобных способов "маркировки" компьютеров, называется <b>DNS</b><font color=119911> (Domain
Name System, доменная система имен)</font>.
<p> В интернете существует, вообще говоря, два основных способа адресации компьютеров. Первый -
численный (или IP-адрес; например, <font color=222288>193.124.134.101</font>), второй - символьный (<font color=222288>noc.radio-msu.net</font>).
DNS создана для того, чтобы поставить в соответствие один способ другому.
<p> Чтобы облегчить упорядочивание наименований, вся структура компьютерных имен устроена
таким образом:есть отдельные уровни (домены), которые могут включать в себя как другие 
поддомены, так и имена компьютеров. Все названия должны состоять только из латинских букв,
цифр и, может быть, знака "минус". Отдельные уровни доменов разделяются точкой.
<p> Типичное полное доменное имя компьютера может выглядеть так: <font
color=222288>computer3.otdel-5.firma.msk.ru</font>
 В этом примере такой адрес мы присвоили компьютеру номер три, который стоит в отделе (номер
сообразите сами) фирмы с изысканным английским названием "firma", которая находится
в Москве ("msk"), в России ("ru"). Локальным именем компьютера (hostname) здесь
является "computer3", а ".ru" обычно называется доменом верхнего уровня. Домен msk.ru,
соответственно, является доменом второго уровня; firma.msk.ru - третьего...
<p> В пределах домена каждого уровня есть группа людей, которые отвечают за этот домен. Они
могут добавлять имена вновь появившихся компьютеров, менять их или удалять. И по сути дела,
то, как будет называться та машина, на которой работаете вы в своей фирме, зависит от
того, что им подскажет фантазия написать в конфигурационном файле DNS.
<p> Тот, кто имеет право администрировать домен, может делать изменения только в пределах
этого домена. Например, системный администратор отдела N5 может, скажем, изменить имя
"computer3" на "computer4" или на что-то более человеческое, например, назвать этот
компьютер "julia" (Тогда полный его адрес станет <font color=222288>julia.otdel-5.firma.msk.ru)</font>. Но для того,
чтобы изменить имя домена 4-го уровня "otdel-5", администратору придется просить об этом
у сисадмина фирмы (если, конечно, это не одно и тоже лицо). Процедура получения имени,
например, в зоне .ru или .com называется регистрацией домена. Конечно, каждая компания,
подключающаяся к интернет, стремится зарегистрировать как можно более естественное и
легкое для запоминания имя. Так, для "Microsoft inc." логично зарезервировать домен
microsoft.com
<p> Доменов верхнего уровня очень немного - всего около 250.. Большая часть из них - так
называемые, географические домены. Например, .de (Deutschland, Германия), .ru (Russia, Россия),
.iq (Iraq, Ирак). Оставшиеся негеографические домены верхнего уровня  - <font color=222288>.com</font> (для
коммерческих компаний), <font color=222288>.net</font> (для сетевых ресурсов), <font color=222288>.edu</font> (образовательные
учреждения), <font color=222288>.mil</font> (военные организации), <font color=222288>.org</font> (некоммерческие организации),
<font color=222288>.gov</font> (правительственные ведомства), <font color=222288>.int</font> (интернациональные корпорации).
<p> Если вам бы захотелось зарегистрировать еще один домен верхнего уровня, то потребовалось
для этого предоставить такие серьезные обоснования, что гораздо проще было бы организовать
свое маленькое государство и для него уже получить географический домен.
<p> К началу 1998 года во всем интернете зарегистрировано около 30 миллионов хостов. Распределение
по доменам верхнего уровня приведено в таблице:
<pre><b>домен  число хостов  описание</b>
 com    8201511      Commercial
 net    5283568      Networks
 edu    3944967      Educational
 jp     1168956      Japan
 mil    1099186      US Military
 us     1076583      United States
 de      994926      Germany
 uk      987733      United Kingdom
 ca      839141      Canada
 au      665403      Australia
 org     519862      Organizations
 gov     497646      Government
</pre>
 <p>Россия в этом списке находится на 28-м месте. Под доменом .ru зарегистрировано около 100
тысяч компьютеров. А в Антарктике (.aq), как оказывается, нет ни одного компьютера,
подключенного к интернет..

<br><br>
<center>
                             DNS вашей компании
</center>
<br>
<p> При текущем уровне развития коммуникаций в России, все больше компаний встают перед
необходимостью подключения своих локальных сетей к интернет. Если опустить все
организационные и коммерческие вопросы подключения, то в техническом отношении
этот процесс сведется к следующей последовательности действий:

<p> - Подключение к провайдеру. Физическое подключение может быть выполнено очень
многими различными способами: от обычного модема до радиосетей и оптоволокна. Способ
подключения и, соответственно, оплата оговариваются непосредственно с провайдером.
<p> - Получение численных (IP) адресов. Для того, чтобы ваши компьютеры, подключенные
к интернет, стали доступны, необходимо выделить для них уникальные численные адреса.
Обычно в договоре на подключение к интернет указывается, сколько и каких адресов отдается
в пользование вашей компании. Формат IP-адресов такой: четыре числа от 1 до 255, отделенных
точками. Например, <font color=222288>193.124.134.101</font> - IP-адрес какого-то компьютера в сети.
<p> - Настройка DNS. Допустим, вы получили блок IP-адресов. Теперь следует правильно
сконфигурировать систему имен и корректно настроить работу серверов с этими именами.
<p> - Процедура регистрации доменного имени. Она сильно различается для различных доменов
верхнего уровня, и может быть как бесплатной, так и по оплате.
<p> - Дальнейшая установка программного обеспечения на компьютеры, требующего явного
указания доменного имени (например, web-сервера).

<p> Вообще говоря, большинство интернет-провайдеров предоставляют услуги по регистрации
доменов их силами, но вам может быть полезно представлять, каким образом эта процедура
происходит и что для этого требуется. Мы будем рассматривать в конкретных примерах
системы, работающие под управлением FreeBSD UNIX, хотя те же выкладки без
труда переносятся и на любую другую систему.
<p> Прежде всего, для полноценной работы DNS вам необходимо два или больше компьютеров, так
называемых, name-серверов, которые независимо друг от друга подключенны к интернет (лучше,
если они будут находиться в разных сетях или даже разных странах). Такая структура обеспечит
неизменную работу системы преобразования символьного адреса в числовой и обратно, даже если
какое-то время некоторые из этих компьютеров будут недоступны по сети. На таких компьютерах
запускается специальная программа-демон <font color=119911>named</font>, которая обрабатывает запросы на
преобразование адресов и отвечает на них. Настроить DNS - означает корректно написать
конфигурационные файлы named.

<p> Name-сервера бывают <font color=222288>primary</font> и <font color=222288>secondary</font>. Иногда их называют
первичными и
вторичными, а также master и slave. Primary name-сервер может быть только один. На
нем хранится вся информация о доменах, и если происходят изменения, то конфигурация
правится только на нем. Secondary name-серверов может быть несколько, но обычная
практика - один secondary nameserver. Дополнительные вторичные name-сервера служат
для повышения скорости расшифровывания вашего адреса и для повышения устойчивости такого
преобразования. Для небольших сетей три и больше вторичных name-сервера - это уже
излишество. Secondary name-сервера с заданной периодичностью в автоматическом режиме
считывают текущую конфигурацию с primary-сервера. Заметим, что один и тот же компьютер
может одновременно являться primary-сервером для одних доменов и secondary nameserver'ом
для нескольких других. Конкретную реализацию таких DNS-серверов мы рассмотрим в следующих
разделах.
<br><br><center>

                                 Выбор и регистрация домена
</center><br>
<p> Если вы имеете некоторый опыт работы в интернет, то вам, скорее всего, известны примеры
доменных имен различных организаций и фирм. В качестве примера приведем случайно взятые
адреса серверов:<br>
 &nbsp;<font color=222288>www.playboy.com</font>   - web-сервер журнала "Playboy"<br>
 &nbsp;<font color=222288>www.internic.net</font>  - основной web-сервер компании Network Solutions<br>
 &nbsp;<font color=222288>rs.internic.net</font>   - регистрационный сервер Network Solutions<br>
 &nbsp;<font color=222288>www.ripn.net</font>      - сервер организации RIPN<br>
<br><br><center>

                                   Как настроить DNS
</center><br>
<p> Сама программа named в большинстве случаев входит в стандартный набор средств
операционных систем UNIX. Если в вашем случае ее не оказалось, попробуйте сделать
поиск программы named для вашей системы в поисковых серверах интернета (AltaVista, Lycos
и т.д.). Обычно главный файл с настройками named называется <font color=119911>named.boot</font> и лежит в
директории <font color=119911>/etc</font>. Запускать демон named обязательно с привилегиями пользователя root.
<p> В данном случае рассматривается FreeBSD версии 2.2.2 со стандартной named. Сама
программа лежит в <font color=119911>/usr/sbin/named</font>, а заготовки для конфигурации в директории 
<font color=119911>/etc/namedb</font>.
<p> Прежде всего, перед любым изменением конфигурации сохраните предыдущие файлы
настроек, чтобы всегда можно было вернуться к исходному состоянию.
<p> Скопируем named.boot в нужную директорию:

<p><font size=1>%</font> cp /etc/namedb/named.boot /etc

<p> Комментарии в named.boot начинаются с ";" на первом месте в строке.
 <p>Рассмотрим различные директивы в named.boot:
<pre><font size=2>
directory       /etc/namedb
</font></pre>
<p> Это та директория, в которой будут храниться конфигурационные файлы для каждого из
доменов, которые этот name-сервер будет держать.
<pre><font size=2>
cache    .   named.root
</font></pre>
<p> Эта специальная опция задает имя файла <font color=222288>named.root</font> в директории /etc/namedb, в котором
содержатся IP-адреса компьютеров, которые "знают все" о доменных именах, то есть, содержат
домен "точка". В этих серверах хранится информация обо всех доменах верхнего уровня, и
если на DNS-запрос ответ не был дан на более раннем этапе, то, добежав до одного из
таких top-level серверов, запрос пойдет по необходимой ветке вниз.
Вот кусок этого файла:

<pre><font size=2>
; formerly NS.INTERNIC.NET
.                        3600000  IN  NS    A.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.      3600000      A     198.41.0.4

; formerly NS1.ISI.EDU<br>
.                        3600000      NS    B.ROOT-SERVERS.NET.
B.ROOT-SERVERS.NET.      3600000      A     128.9.0.107
</font>
</pre>
<p> Файл named.root впоследствие нужно периодически забирать с <font color=222288>FTP.RS.INTERNIC.NET</font>, так
как IP-адреса top-level серверов через несколько месяцев могут и поменяться.
<p> Следующая директива в конфигурационном файле говорит о том, что наш name-сервер является
primary name-сервером для какой-то зоны, то есть, содержит всю информацию о ней.
Синтаксис ее таков:
<p><font color=119911>primary [имя.домена] [имя_файла]</font>
<p>Пример:
<pre><font size=2>
primary radio-msu.net db.radio-msu.net
primary math.msu.su db.math.msu.su
</font>
</pre>
<p> Это означает, что мы установили primary nameserver для доменов <font color=222288>radio-msu.net</font> (домен
второго уровня) и <font color=222288>math.msu.su</font> (третьего уровня), но мы проделали только небольшую часть
работы. После этого нужно будет описать эти домены в текстовых файлах, называющихся
<font color=222288>db.radio-msu.net</font> и <font color=222288>db.msu.su</font> в директории /etc/namedb. Мы специально выбрали
имена файлов похожими на имена соответствующих им доменов из соображений удобства. Имена
конфигурационных файлов больше нигде роли не играют, и вы вправе их называть как угодно.
Создавать и редактировать их можно при помощи обычного текстового редактора, находясь в
директории /etc/namedb. Подробное описание db.* файлов будет дано чуть ниже.

<p> Для того, чтобы стать вторичным nameserver'ом для других доменов, в named.boot нужно
написать строчку такого плана:
<pre><font size=2>
secondary npi.msu.su    158.250.2.232 db.npi.msu.su
secondary rector.msu.su 193.232.112.1 db.rector.msu.su
</font>
</pre>
<p>Общий вид директивы таков:

<p><font color=119911>secondary [имя.домена] [IP-адрес primary nameserver'а] [имя_файла]</font>

<p> Первый параметр здесь - имя домена, для которого мы устанавливаем secondary. Для него
обязательно должен существовать первичный name-сервер, с которого демон будет периодически
считывать данные об этом домене. Вместо одного IP-адреса primary nameserver'а может идти и
список адресов, откуда еще можно узнать информацию о домене. Это используется в том случае,
если мы создаем многоуровневую систему nameserver'ов с различными приоритетами, и т.д. В
большинстве случаев в это поле заносится только адрес primary. Последний параметр -
имя временного файла, выбранное нами произвольным образом, в котором демон named будет
хранить информацию о домене, полученную от primary name-сервера. Как и в первом случае,
имена файлов лучше назначать созвучными с именем домена. Кстати, для того, чтобы установить
вторичный nameserver для домена, нужно только добавить одну такую строчку named.boot, и все.

<p> Чтобы правильно настроить primary name-сервер, нам осталось рассмотреть конфигурационные
файлы db.* (эти файлы также называются файлами зоны). Общий вид записи в этом файле:

<p><font color=119911>[domain] [opt_ttl] [opt_class] [type] [resource_record_data]</font>

<p> где domain есть "." для описания домена верхнего уровня, "@" для текущего домена или
обычное доменное имя (в частности, просто имя машины (hostname)).
<p> <font color=222288>opt_ttl</font> - необязательное поле, целое число, которое означает время жизни
(time-to-live)
этой записи в секундах. По истечении этого срока содержимое записи должно автоматически
обновиться.
<p> <font color=222288>opt_class</font> - тип адреса объекта. Такой тип существует только один, который,
собственно, и указывается ("IN").
<p> <font color=222288>type</font> - тип записи (рассмариваются ниже)
<p> <font color=222288>resource_record_data</font> - данные этого типа

<p> Рассмотрим пример primary nameserver'а и соответствующего ему файлу зоны для
домена radio-msu.net. В случае, если вы будете использовать эти примеры как руководство,
не забудьте, пожайлуста, поменять все записи соответственно структуре вашей сети.
<p> В <font color=119911>named.boot</font> мы должны прописать такую строчку:
<pre><font size=2>
primary  radio-msu.net  db.radio-msu.net
</font></pre>
<p> И в директории <font color=119911>/etc/namedb</font> создаем файл с названием db.radio-msu.net примерно такого
содержания:
<pre><font size=2>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;     BIND configuration for the primary nameserver
;             Radio-MSU.NET host table
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
@               IN      SOA  ns.radio-msu.net.  art.radio-msu.net. (
                        1998022300      ; Serial
                        28800           ; Refresh
                        7200            ; Retry
                        604800          ; Expire
                        86400 ) ; Minimum ttl
;----------------------------------------------------------------
                IN      NS              ns.radio-msu.net.
                        NS              mskws.desy.de.
localhost       IN      A               127.0.0.1
;----------------------------------------------------------------
@               IN      MX      20      mpr
                        MX      40      mskws.desy.de.
;----------------------------------------------------------------
ns              IN      A               193.124.134.1
                IN      MX      10      ns
                IN      MX      50      relay
;----------------------------------------------------------------
telion                  IN      A       193.124.134.2
                        MX      10      telion
                        MX      20      relay.radio-msu.net.
                        MX      50      mskws.desy.de.
www                     IN      CNAME   telion
;----------------------------------------------------------------
noc                     IN      A       193.124.134.101
                        IN      MX      10 noc
                        IN      MX      20 relay
;----------------------------------------------------------------
mpr                     IN      A       193.124.134.3
                        MX      10      mpr
                        MX      50      mskws.desy.de.
pop                     IN      A       193.124.134.3
uucp                    IN      A       193.124.134.3
relay                   IN      A       193.124.134.3
mail                    IN      A       193.124.134.3
vika                    IN      A       193.124.134.5
                        MX      10      vika
                        MX      50      relay
;----------------------------------------------------------------
brusun                  IN      A       193.124.134.20
diana                   IN      A       193.124.134.7
sftgames                IN      CNAME   telion
chat                    IN      CNAME   brusun
;------------------------  THE  END  ----------------------------
</font></pre>
<p> Заметим, что все строки, начинающиеся с ";", являются комментариями и используются
для улучшения читабельности текста.
<p> Теперь рассмотрим типы записей, встречающиеся в нашей конфигурации:
<p> Самая первая запись в любом таком файле выглядит следующим образом:
<pre><font size=2>
@               IN      SOA  ns.radio-msu.net.  art.radio-msu.net. (
</font></pre>
<p> Символ "@" означает, что дальнейшие директивы относятся к текущему домену (то есть,
к домену <font color=222288>radio-msu.net</font>). Поле "IN" можнно считать несущественым, а после него идет
описание типа записи:

<p> <font color=222288>SOA</font>  - (Start of authorizing) - зона ответственности. Дальнейшие параметры
определяют,
кто отвечает за этот домен, как часто обновлять информацию об этой зоне на secondary-серверах,
а также другую служебную информацию. Первое поле параметров этой записи - имя primary
name-сервера, содержащего зону. После него следует адрес технического контактного лица,
отвечающего за домен. Обратите особое внимание на точки в конце этих адресов! Точка в конце
означает, что этот адрес является обычным доменным именем, и его не нужно дополнять справа
доменом, которому соответствует наш конфигурационный файл. То есть, если вместо
ns.radio-msu.net. написать ns.serv, то будет иметься ввиду компьютер ns.serv.radio-msu.net
<p> Точку в конце символьных имен нужно не забывать ставить и в других полях зоны. Это одна из
самых распространенных ошибок. Написать "<font color=222288>ns.radio-msu.net</font>" - значит, иметь ввиду сервер
"<font color=222288>ns.radio-msu.net.radio-msu.net</font>", которого просто не существует.
<p> Оставшиеся в круглых скобках после контактного лица пять параметров записи SOA - целые числа,
определяющие временые интервалы обмена информацией об этом домене между primary и secondary.
<p> Первое число ("1998022300" у нас) - сериальный номер (<font color=222288>serial number</font>) записи. По
изменению
сериального номера secondary name-сервера определяют, было ли изменено содержимое домена или
нет, и соответственно, нужно ли считывать весь домен с primary-сервера. Сериальный номер
должен состоять из десяти цифр и обязательно должен быть заменен вручную на какой-либо
больший при любом измеении любой записи в файле домена. Для этих целей идеально подходит
такой вариант: первые четыре цифры serial'а - год, затем две на месяц и число. Последние
две - порядковый номер (начиная с 00) редакции в течение дня. Если мы меняем конфигурацию
домена, то заодно мы должны увеличить и сериальный номер. А при таком задании serial'а
увеличение происходит автоматом.
<p> После сериального номера идет поле <font color=222288>Refresh</font>, которое указывает время в секундах, по
истечении которого secondary name-сервер проверяет не изменилась ли данная зона на
primary-сервере, и если изменения были, то происходит передача файла с зоной.
<p> Если при этом у него не получилось по каким-либо причинам соединиться с сервером, то
следующую попытку secondary сделает по истечении <font color=222288>Retry</font> секунд (третий параметр).
<p> В том случае, если и последующие попытки подключиться к primary и узнать информацию
о зоне оканчиваются неудачей, вторичный name-сервер по прошествии <font color=222288>Expire</font> секунд забудет
всю информацию по этой зоне.
<p> Последнее поле (<font color=222288>'Minimum TTL'</font>) указывает на минимальное время жизни (Time To Live)
записей в файле зоны, если только в какой-то записи не будет указано другое значение в
необязательном поле opt_ttl.
<p> Рекомендуемые значения для этих величин таковы:
<pre><font size=2>
 28800  ; Refresh     8 hours
 7200   ; Retry       2 hours
 604800 ; Expire      7 days
 86400  ; Minimum TTL 1 day
</font></pre>
<p> Однако вам никто не вправе помешать поставить свои значения. Только не ставьте
слишком маленькие величины (меньше часа) - иначе вы просто забьете сеть бесполезной
информацией, непрерывно пересылаемой от primary к secondary.

<p> Теперь рассмотри записи следующего типа:
<p> <font color=222288>NS</font> - (Name Server) - перечисляет name-сервера (и primary, и secondary), которые
держат эту зону. Не забывайте про точку в конце имени!
<pre><font size=2>
                IN      NS              ns.radio-msu.net.
                        NS              mskws.desy.de.
</font></pre>
<p> Здесь мы для зоны <font color=222288>.radio-msu.net</font> указали два name-сервера (первый из них - primary,
второй - secondary), на которых содержится вся информация о домене.

<p> Далее идет одна из наиболее часто встречающихся записей DNS:
<p> <font color=222288>A</font>  -  (Address) - адрес хоста. На первом месте в такой строке будет стоять символьное
имя компьютера в текущем домене, после этого "IN  A", а затем - числовой IP-адрес,
соответствующий этой машине. Рекомендуется внести, например, такую строку в файл зоны:
<pre><font size=2> 
localhost       IN      A               127.0.0.1
</font></pre>
<p> Это позволит обращаться с любого компьютера в сети к самому себе, используя
зарезервированное имя localhost. Для того, чтобы как-нибудь назвать новый компьютер
в сети, вам нужно просто добавить такую строчку в файл зоны (не забудьте только после
этого подправить сериальный номер в записи SOA и после всех изменений перезапустить
демон named (сделать ему <font color=119911>kill -1</font>)).
<p> В рассмотренном примере мы видим такие строки:
<pre><font size=2>
ns              IN      A               193.124.134.1
telion          IN      A               193.124.134.2
diana           IN      A               193.124.134.7
</font></pre>
<p> Значит, мы назвали компьютеры с соответствующими IP-адресами именами <font color=222288>ns</font>,<font
color=222288>telion</font> и
<font color=222288>diana</font>. Очень часто используется имя www, которое позволяет обращаться к web-серверу
домена. Если бы мы изменили здесь слово 'telion' на 'www', то по адресу
http://www.radio-msu.net/ откликнулась машина с IP-адресом <font color=222288>193.124.134.2</font>. В
нашем случае, можно поступить более хитрым образом, используя запись типа <font color=119911>CNAME</font>.

<p> <font color=222288>CNAME</font> - (Canonical name) - в транслитерации с латинского, на компьютерном жаргоне
такая запись называется алиас (<font color=119911>alias</font>). Вы как бы добавляете компьютеру еще одно имя,
которое при разрешении превратится в тот же IP-адрес, что и основное имя.
<pre><font size=2>
www             IN      CNAME   telion
</font></pre>
<p> Теперь имя <font color=222288>www.radio-msu.net</font> будет аналогично <font
color=222288>telion.radio-msu.net</font>. Алиасов
для
одного IP-адреса может быть сколько угодно, но на них накладывается единственное
условие: то имя (каноническое), которое стоит после CNAME, должно также где-либо
быть описанным. Допускается использовать в качестве канонического имени и alias,
лишь бы такая цепочка алиасов не замыкалась. В качестве cname может выступать
любой именной адрес в сети, не обязательно из текущего домена, например:
<pre><font size=2>
other           IN      CNAME   www.sun.com.
</font></pre>
<p> И пойдя теперь по адресу <font color=222288>other.radio-msu.net</font>, мы попадем на сервер Sun Microsystems.
<p> Заметим еще один момент. Второе имя компьютеру можно дать и так:
<pre><font size=2>
mail                    IN      A       193.124.134.3
relay                   IN      A       193.124.134.3
</font></pre>
<p> При этом у нас будет несколько записей типа 'A', соответствующих одному IP-адресу. Это
ничему не противоречит, но так делать - плохой стиль.

<p> Следующий важный тип записей - записи типа MX.
<p> <font color=222288>MX</font> - (Mail eXchange) - пересылка почтовых сообщений. Они обычно следуют за записями
типа 'A' или 'SOA'. Используются они обычно так:

<p><font color=119911>[domain] IN MX [pref_value] [mail_server]</font>

<p> где domain - необязательное поле. Если оно есть, то запись онтосится к этому домену,
если нет - то к предыдущему с типом 'A'. В том случае, если на месте <font color=119911>[domain]</font> стоит
символ '@' или это поле отсутствует, но сама запись находится в самом начале файла
зоны (сразу же после SOA), то такое поле MX будет относиться к домену, которому
соответствует текущий db-файл.
<p> 'IN' также можно указывать, а можно опускать. <font color=119911>mail_server</font> - доменное имя почтового
сервера, которому достанется вся почта, приходящая на этот домен. На этом сервере
должны стоять программы, поддерживающие почтовый протокол SMTP. Для повышения надежности
пересылки почты, вы можете указать подряд несколько почтовых серверов. В том случае,
если один из них перестанет работать, вся почта на домен будет отправляться на эти
"запасные" mail-сервера, которые при первой же возможности отправят все накопившиеся
у них электронные письма на основной почтовый сервер. Чтобы регулировать такую систему,
и вводится параметр <font color=119911>pref_value</font> (приоритет соответствующего почтового сервера), который
может меняться от 0 (самый большой приоритет) до 32767 (почта на mail-сервер с таким
значением pref_value будет приходить в совсем крайнем случае). Если у вас запись MX
единственная для какого-то домена, то значение этого поля не играет роли. Но при
использовании только одного mail-сервера в те моменты, когда он по каким-либо причинам
недоступен, почта будет теряться. Поэтому обыкновенно ставят две-три MX-записи, а
приоритеты у них устанавливают круглыми числами от 10 до 100. Пример:
<pre><font size=2>
mpr                     IN      A       193.124.134.3
                        MX      10      mpr
                        MX      50      mskws.desy.de.
</font></pre>
<p> Итак, почта, идущая на <font color=222288>mpr</font> (например, на <font
color=222288>john@mpr.radio-msu.net</font>), прежде
всего
попытается лечь на сам mpr, а в том случае, если у нее это не получится, то
будет использован второй вариант (50 больше, чем 10) - <font color=222288>mskws.desy.de</font>, где
почта пролежит до того момента, пока mpr опять не заработает. Зачастую нужно
использовать более короткие почтовые адреса, вроде <font color=222288>alla@radio-msu.net</font>. Делается
это таким образом:
<pre><font size=2>
@               IN      MX      20      mpr
                        MX      40      mskws.desy.de.
</font></pre>
<p> Ситуация в точности та же. Почта на <font color=222288>somebody@radio-msu.net</font> перенаправляется
на <font color=222288>mpr</font> (или на <font color=222288>mskws</font>), а на этих компьютерах уже должны быть корректно
настроены
почтовые программы, понимающие, на какой домен приходит почта и что с ней
надо делать дальше. Для этого вам, к несчастью, придется ознакомиться с
соответствующей документацией к почтовому серверу.

<p> Следующие типы записей используются реже, тем не менее, приведем их тут:

<p> <font color=222288>NULL</font> - пустая запись. Скорее всего, должна использоваться для резервирования
доменного имени, но на практике применяется только в том случае, если необходимо
убрать на некоторое время из DNS'а запись о какой-то машине. Хотя проще такие
строчки просто закомментарить.

<p> <font color=222288>RP</font> - (Responsible Person) - ответственное за этот домен лицо:
<pre><font size=2>
xerox		IN	RP	Ivanov Ivan
</font></pre>
<p> <font color=222288>HINFO</font> - (Host Information) - информация о компьютере (тип процессора,
операционная система и т.д.). Используется крайне редко.

<p> Нам осталось рассмотреть последний особый тип записи '<font color=222288>PTR</font>' (<font color=119911>domain
name pointer</font>), эта запись используется в db.* файлах так называемой "обратной зоны" (<font
color=119911>reverse-dns</font>).
<br><br><center>

                             Настройка "обратной зоны"
</center>
<p> В рассматриваемых до этого примерах мы видели, как установить взаимосвязь между
символьными именами и числовыми IP-адресами, но только в одну сторону: от символьных
имен к числовым. Доменная система имен должна также обеспечивать обратное
преобразование: из числового адреса в строковый. Для этих целей, собственно и служат
файлы обратной зоны (Reverse-DNS), структура которых во многом напоминает файлы зон,
которые мы рассматривали выше. Для обратных зон также необходимы primary и secondary
сервера. В конфигурационном файле named.boot для установки primary name-сервера может
быть написана примерно такая строка:
<pre><font size=2>
primary  134.124.193.in-addr.arpa  db.193.124.134
</font></pre>
<p> Домен '<font color=119911>in-addr.arpa</font>' - служебный. Он используется для обозначения числовых
IP-адресов.
<p>Будьте внимательны: при таком способе записи от вашего полного IP адреса из 4-х чисел
остаются только первые три, общие для компьютеров внутри вашей локальной сети (или
какого-то ее участка). Причем, эти числа меняются местами: так домен 
<font color=222288>80.67.194.in-addr.arpa</font> будет соответствовать адресам сетки <font color=222288>194.67.80.*</font>.

<p> Secondary name-сервера обратных зон устанавливаются аналогично прямым зонам - в
named.boot пишется строка
<pre><font size=2>
secondary  100.250.158.in-addr.arpa  158.250.100.1 db.158.250.100
</font></pre>
<p> Этой строкой мы установили secondary name-сервер для reverse-зоны IP-адресов
сети <font color=222288>158.250.100</font>, а primary name-сервером будет компьютер этой сети с адресом
<font color=222288>158.250.100.1</font>.
 
<p> Обязательной строчкой в named.boot является обратная зона сетки 127.0.0,
так как в ней находится IP-адрес <font color=222288>127.0.0.1</font> (<font color=119911>localhost</font>,<font
color=119911>loopback</font>) - это
специальный адрес, при обращении на который с любого компьютера, мы попадаем
на него же. Итак, в named.boot должна быть строчка:
<pre><font size=2>
primary  0.0.127.IN-ADDR.ARPA  db.local
</font></pre>
<p> Большие и маленькие буквы здесь не различаются. А в директории <font color=119911>/etc/namedb</font>
создадим файл <font color=119911>db.local</font> примерно такого содержания (имена доменов вам, естественно,
придется поменять на свои):

<pre><font size=2>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;  db.local  -   Local domain configuration
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
@        IN      SOA     ns.radio-msu.net.  art.radio-msu.net. (
                 1995101500      ; Serial
                 14400           ; Refresh
                 3600            ; Retry
                 3600000         ; Expire
                 259200 )        ; Minimum ttl
 
         IN      NS      ns.radio-msu.net.
1        IN      PTR     localhost.
;-----------------------------------------------
</font></pre>

<p> Итак, вы установили Reverse-DNS для <font color=222288>127.0.0.1</font>. Рассмотрим теперь пример установки
обратной зоны для того же домена ('<font color=222288>radio-msu.net</font>'). В named.boot primary name-сервера
записывается строка:
<pre><font size=2>
primary  134.124.193.in-addr.arpa  db.193.124.134
</font></pre>
<p> В директории <font color=119911>/etc/namedb</font> создаем файл с именем <font
color=119911>db.193.124.134</font> для обратной
зоны. Здесь, как и в предыдущих ситуациях, само по себе имя большой роли не играет, поэтому
можно выбирать его легким для запоминания. Теперь посмотрим на то, что может
содержаться в этом файле:

<pre><font size=2>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;     BIND configuration for the primary nameserver  
;             Radio-MSU.NET reverse DNS
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
@               IN      SOA  ns.radio-msu.net. art.radio-msu.net. (
                        1998022300      ; Serial
                        14400           ; Refresh
                        3600            ; Retry
                        1209600         ; Expire
                        345600 )        ; Minimum ttl
 
                IN      NS      ns.radio-msu.net.
                        NS      mskws.desy.de.
 
0               IN      PTR     Radio-MSU-Ether.Radio-MSU.net.
                        A       255.255.255.0

1               IN      PTR     ns.radio-msu.net.
2               IN      PTR     telion.radio-msu.net.
3               IN      PTR     mpr.radio-msu.net.
5               IN      PTR     vika.radio-msu.net.
7               IN      PTR     diana.radio-msu.net.
20              IN      PTR     brusun.radio-msu.net.
101             IN      PTR     noc.radio-msu.net.
;----------------------------------------------------------------
</font></pre>
<p> Как мы видим, в обратной зоне в основном используются записи типа PTR.
Структура записи такова:

<p><font color=119911>[ip_address #4]  IN  PTR  [имя.домена]</font>

<p> где <font color=222288>ip_address #4</font> - последнее из 4-х чисел IP-адреса (его значения могут
быть от 0 до 255). Первые три компоненты задаются для данного файла обратной
зоны из named.boot. Запись PTR задает соответствие между IP-адресом и
именем домена. Важно отметить, что для правильной работы необходимо
соответствие числовых и символьных адресов в прямых и обратных зонах, иначе
результат будет непредсказуем.

<p> В файле обратной зоны первой записью стоит запись типа SOA, полностью
аналогичная SOA прямой зоны. После этого идет перечисление name-серверов
(записи типа NS). И особняком стоит строка для адреса <font color=222288>193.124.134.0</font>,
который обозначает весь Ethernet-участок сети. Прописывать нулевой
адрес необязательно, но это считается правилом хорошего тона.

<p> Наконец, после всех этих манипуляций ваш сервер готов к работе. Демон
<font color=119911>named</font> должен запускаться при старте машины. Все изменения в конфигурации
должен производить только пользователь root. После каждого изменения
не забывайте менять серийные номера в <font color=119911>db.*</font> файлах, согласовывать прямые
и обратные зоны, перезапускать (<font color=119911>kill -1</font>) named.
<br><br>
