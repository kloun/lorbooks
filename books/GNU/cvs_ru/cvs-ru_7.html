<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from cvs-ru.texi on 11 April 2001 -->

<TITLE>CVS -- Система Управления Параллельными Версиями - Добавление, удаление и переименование файлов и каталогов</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="cvs-ru_1.html">first</A>, <A HREF="cvs-ru_6.html">previous</A>, <A HREF="cvs-ru_8.html">next</A>, <A HREF="cvs-ru_24.html">last</A> section, <A HREF="cvs-ru_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC65" HREF="cvs-ru_toc.html#TOC65">Добавление, удаление и переименование файлов и каталогов</A></H1>

<P>
В процессе разработки проекта часто требуется добавлять, удалять
или переименовывать файлы и каталоги.  Исходя из общих принципов, 
требуется, чтобы CVS запоминала факт совершения такого
действия, вместо того, чтобы совершать необратимое изменение,
точно так же, как она обращается с изменениями файлов.  Точные
механизмы, действующие в этих случаях, зависят от конкретной
ситуации. 




<H2><A NAME="SEC66" HREF="cvs-ru_toc.html#TOC66">Добавление файлов в каталог</A></H2>
<P>
<A NAME="IDX315"></A>


<P>
Для того, чтобы добавить новый файл в каталог, совершите
следующие шаги:



<UL>
<LI>

Сначала у вас должна быть рабочая копия каталога.
See section <A HREF="cvs-ru_1.html#SEC5">Получение исходного кода</A>.

<LI>

Создайте новый файл в рабочей копии каталога.

<LI>

Используйте <SAMP>`cvs add <VAR>имя_файла</VAR>'</SAMP>, чтобы сообщить
CVS, что вы хотите хранить историю изменений этого файла.
Если в файле хранятся двоичные данные, добавьте ключ командной
строки <SAMP>`-kb'</SAMP> (see section <A HREF="cvs-ru_9.html#SEC79">Обработка двоичных файлов</A>).

<LI>

Используйте команду <SAMP>`cvs commit <VAR>имя_файла</VAR>'</SAMP>, чтобы
поместить файл в репозиторий.  Другие разработчики не увидят этот 
файл, пока вы не выполните эту команду. 
</UL>

<P>
Можно также использовать команду <CODE>add</CODE> для добавления нового 
каталога.


<P>
В отличие от большинства других команд, команда <CODE>add</CODE> не
является рекурсивной.  Вы даже не можете сказать <SAMP>`cvs add
foo/bar'</SAMP>.  Вместо этого, вам потребуется выполнить



<PRE>
$ cd foo
$ cvs add bar
</PRE>

<P>
<A NAME="IDX316"></A>
<DL>
<DT><U>Команда:</U> <B>cvs add</B> <I>[<CODE>-k</CODE> kflag] [<CODE>-m</CODE> сообщение] файлы ...</I>
<DD><A NAME="IDX317"></A>


<P>
Добавить <VAR>файлы</VAR> в список на помещение в репозиторий.  Файлы
или каталоги, указанные в команде <CODE>add</CODE>, должны существовать 
в текущем каталоге.  Для того, чтобы добавить в репозиторий целое дерево
каталогов, например, файлы, полученные от стороннего поставщика,
используйте команду <CODE>import</CODE>. See section <A HREF="cvs-ru_16.html#SEC135">Команда import: импортировать исходные тексты</A>.


<P>
Добавленные файлы не помещаются в репозиторий, пока вы не
выполните команду <CODE>commit</CODE>, зафиксировав тем самым
изменения.  Выполнение команды <CODE>add</CODE> для файла, который был
удален командой <CODE>remove</CODE>, отменит действие <CODE>remove</CODE>,
если после нее еще не была выполнена команда <CODE>commit</CODE>.
See section <A HREF="cvs-ru_7.html#SEC67">Удаление файлов</A>, там находится пример. 


<P>
Ключ командной строки <SAMP>`-k'</SAMP> задает способ по умолчанию,
которым будут извлекаться файлы, дальнейшая информация находится
в section <A HREF="cvs-ru_12.html#SEC97">Подстановка ключевых слов</A>.


<P>
Ключ командной строки <SAMP>`-m'</SAMP> задает описание файла.  Описание
появляется в журнале истории, если разрешено его использование,
see section <A HREF="cvs-ru_18.html#SEC172">Файл history</A>.  Также это описание будет сохранено в
репозитории, когда файл будет зафиксирован.  Команда <CODE>log</CODE>
показывает это описание.  Описание может быть изменено с помощью
команды <CODE>admin -t</CODE>.  See section <A HREF="cvs-ru_16.html#SEC118">Команда admin: администрирование</A>.  Если вы опустите
флаг <SAMP>`-m <VAR>описание</VAR>'</SAMP>, то у вас не спросят описания, а
будет использована пустая строка.
</DL>


<P>
Например, нижеследующие команды добавляют файл <TT>`backend.c'</TT> в 
репозиторий:



<PRE>
$ cvs add backend.c
$ cvs commit -m "Early version. Not yet compilable." backend.c
</PRE>

<P>
Когда вы добавляете файл, он добавляется только на ту ветку, над
которой вы работаете (see section <A HREF="cvs-ru_5.html#SEC54">Создание ветвей и слияние</A>).  Вы
можете позднее поместить добавления на другую ветку, если
захотите (see section <A HREF="cvs-ru_5.html#SEC63">При слиянии можно добавлять и удалять файлы</A>). 




<H2><A NAME="SEC67" HREF="cvs-ru_toc.html#TOC67">Удаление файлов</A></H2>
<P>
<A NAME="IDX318"></A>
<A NAME="IDX319"></A>


<P>
Содержимое каталогов меняется.  Добавляются новые файлы, исчезают 
старые.  Однако же, вам хотелось бы извлекать точные копии старых 
версий вашего проекта. 


<P>
Вот как можно удалить файл, сохранив доступ к его старым
ревизиям: 



<UL>
<LI>

Убедитесь, что у вас неизмененная версия этого файла.
See section <A HREF="cvs-ru_1.html#SEC8">Просмотр изменений</A>, там описан один из способов убедиться
в этом.  Можно также использовать команды <CODE>status</CODE> или
<CODE>update</CODE>.  Если вы удалите файл без предварительной фиксации 
изменений, вы, конечно же, не сможете извлечь этот файл в том
виде, в котором он находился перед удалением.

<LI>

Удалите файл из рабочей копии каталога.  Например, можно
использовать программу <CODE>rm</CODE>.

<LI>

Выполните <SAMP>`cvs remove <VAR>имя-файла</VAR>'</SAMP>, чтобы сообщить
CVS, что вы действительно хотите удалить этот файл.

<LI>

Выполните <SAMP>`cvs commit <VAR>имя-файла</VAR>'</SAMP>, чтобы зафиксировать
удаление файла в репозитории. 
</UL>

<P>
Когда вы фиксируете удаление файла, CVS запоминает, что
этого файла более не существует.  Впрочем, он может существовать
на одних ветках и не существовать на других, или же можно
впоследствии добавить другой файл с тем же самым именем.
CVS корректно создаст или не станет создавать файл,
основываясь на ключах командной строки <SAMP>`-r'</SAMP> или <SAMP>`-D'</SAMP>,
заданных в командах <CODE>checkout</CODE> или <CODE>update</CODE>. 


<P>
<A NAME="IDX320"></A>
<DL>
<DT><U>Команда:</U> <B>cvs remove</B> <I>[ключи] файлы ...</I>
<DD><A NAME="IDX321"></A>


<P>
Помещает файлы в список на удаление из репозитория (для того,
чтобы эта команда сработала, нужно, чтобы файлы были удалены из
рабочего каталога).  Эта команда не удаляет файлы из репозитория, 
пока вы не зафиксируете удаление.  Полный список ключей находится 
в section <A HREF="cvs-ru_17.html#SEC152">Краткий справочник по командам CVS</A>.
</DL>


<P>
Вот пример удаления нескольких файлов:



<PRE>
$ cd test
$ rm *.c
$ cvs remove
cvs remove: Removing .
cvs remove: scheduling a.c for removal
cvs remove: scheduling b.c for removal
cvs remove: use 'cvs commit' to remove these files permanently
$ cvs ci -m "Removed unneeded files"
cvs commit: Examining .
cvs commit: Committing .
</PRE>

<P>
Для удобства можно удалять файлы и одновременно делать <CODE>cvs
remove</CODE>, используя ключ командной строки <SAMP>`-f'</SAMP>.  Например,
вышеприведенный пример можно переписать так:



<PRE>
$ cd test
$ cvs remove -f *.c
cvs remove: scheduling a.c for removal
cvs remove: scheduling b.c for removal
cvs remove: use 'cvs commit' to remove these files permanently
$ cvs ci -m "Removed unneeded files"
cvs commit: Examining .
cvs commit: Committing .
</PRE>

<P>
Если вы выполните команду <CODE>remove</CODE>, а затем перемените свое
решение, еще не зафиксировав удаление, то команду <CODE>remove</CODE>
можно отменить с помощью команды <CODE>add</CODE>. 



<PRE>
$ ls
CVS   ja.h  oj.c
$ rm oj.c
$ cvs remove oj.c
cvs remove: scheduling oj.c for removal
cvs remove: use 'cvs commit' to remove this file permanently
$ cvs add oj.c
U oj.c
cvs add: oj.c, version 1.1.1.1, resurrected
</PRE>

<P>
Если вы осознаете свою ошибку перед выполнением команды
<CODE>remove</CODE>, можно использовать <CODE>update</CODE>, чтобы воскресить 
файлы:



<PRE>
$ rm oj.c
$ cvs update oj.c
cvs update: warning: oj.c was lost
U oj.c
</PRE>

<P>
Когда вы удаляете файл, он удаляется только с той ветки, на
которой вы работаете (see section <A HREF="cvs-ru_5.html#SEC54">Создание ветвей и слияние</A>).  Позже
можно слить удаления на другую ветку, если захотите
(see section <A HREF="cvs-ru_5.html#SEC63">При слиянии можно добавлять и удалять файлы</A>).




<H2><A NAME="SEC68" HREF="cvs-ru_toc.html#TOC68">Удаление каталогов</A></H2>
<P>
<A NAME="IDX322"></A>
<A NAME="IDX323"></A>


<P>
В принципе удаление каталогов в чем-то подобно удалению файлов
--- вы не хотите, чтобы каталог существовал в текущем рабочем
каталоге, но вы хотите также, чтобы можно было извлекать старые
версии проекта, в которых еще существовал каталог.


<P>
Можно удалить каталог, удалив все файлы в нем.  Нет способа
удалить сам каталог.  Вместо этого вы задаете командам <CODE>cvs
update</CODE>, <CODE>cvs checkout</CODE> или <CODE>cvs export</CODE> ключ командной
строки <SAMP>`-P'</SAMP>, который заставит CVS удалять пустые
каталоги в рабочем каталоге.  Вероятно, лучше всего будет всегда
указывать <SAMP>`-P'</SAMP>, если вы хотите, чтобы существовал пустой
каталог, поместите в него пустой файл, например, <TT>`.keepme'</TT>,
чтобы не дать CVS с ключом <SAMP>`-P'</SAMP> удалить этот каталог.


<P>
Заметьте, что при использовании ключей <SAMP>`-r'</SAMP> или <SAMP>`-D'</SAMP> с
командами <CODE>checkout</CODE> и <CODE>export</CODE> подразумевается также
использование <SAMP>`-P'</SAMP>.  При этом CVS сможет создать или не
создавать каталог, в зависимости от того, находились ли в этом
каталоге какие-либо файлы в конкретной версии проекта.




<H2><A NAME="SEC69" HREF="cvs-ru_toc.html#TOC69">Перемещение и переименование файлов</A></H2>
<P>
<A NAME="IDX324"></A>
<A NAME="IDX325"></A>
<A NAME="IDX326"></A>
<A NAME="IDX327"></A>


<P>
Перемещение файлов в другой каталог или переименование их
несложно, но некоторые аспекты могут быть неочевидными.
Перемещение и переименование каталогов еще
сложнее. See section <A HREF="cvs-ru_7.html#SEC73">Перемещение и переименование каталогов</A>.)


<P>
В нижеприведенных примерах предполагается, что файл <TT>`old'</TT>
переименовывается в <TT>`new'</TT>.




<H3><A NAME="SEC70" HREF="cvs-ru_toc.html#TOC70">Обычный способ переименования</A></H3>

<P>
Обычным способом перемещения файла является копирование <VAR>old</VAR> 
в <VAR>new</VAR>, а затем выполнение команд CVS для удаления
файла <VAR>old</VAR> из репозитория и добавления туда файла <VAR>new</VAR>.



<PRE>
$ mv <VAR>old</VAR> <VAR>new</VAR>
$ cvs remove <VAR>old</VAR>
$ cvs add <VAR>new</VAR>
$ cvs commit -m "<VAR>old</VAR> переименован в <VAR>new</VAR>" <VAR>old</VAR> <VAR>new</VAR>
</PRE>

<P>
Это самый простой способ переместить файл, он не подвержен
ошибкам, и сохраняет историю совершенных действий.  Заметьте, что 
для доступа к истории файла нужно указать старое или новое имя, в 
зависимости от периода истории, к которому вы обращаетесь.
Например, <CODE>cvs log <VAR>old</VAR></CODE> выдаст журнал вплоть до
момента переименования.


<P>
Когда <VAR>new</VAR> фиксируется, нумерация его ревизий начнется с
нуля, обычно с 1.1, поэтому если это вам не нравится, используйте 
ключ командной строки <SAMP>`-r <VAR>номер</VAR>'</SAMP> команды
<CODE>commit</CODE>.  Дальнейшую информацию смотри в section <A HREF="cvs-ru_4.html#SEC47">Назначение номеров ревизий</A>.




<H3><A NAME="SEC71" HREF="cvs-ru_toc.html#TOC71">Перемещение файла с ревизиями</A></H3>

<P>
Этот метод более опасен, потому что требует перемещения файлов в
репозитории.  Прочтите всю главу перед попытками применить этот
метод!



<PRE>
$ cd $CVSROOT/<VAR>dir</VAR>
$ mv <VAR>old</VAR>,v <VAR>new</VAR>,v
</PRE>

<P>
Преимущества:



<UL>
<LI>

Журнал изменений сохраняется.

<LI>

Номера ревизий не изменяются.
</UL>

<P>
Недостатки:



<UL>
<LI>

Нет простого способа извлечь старые версии проекта из
репозитория.  Файл будет извлекаться под именем <VAR>new</VAR> даже
для версий проекта, в которых он еще не был переименован.

<LI>

Не сохраняется информация о том, когда был переименован файл.

<LI>

Могут произойти неприятности, если кто-нибудь захочет поработать
с файлом ревизий, пока вы его перемещаете.  Убедитесь, что никто
более не обращается к репозиторию, пока вы выполняете операцию.
</UL>



<H3><A NAME="SEC72" HREF="cvs-ru_toc.html#TOC72">Копирование файла с ревизиями</A></H3>

<P>
Этот способ также требует прямых изменений репозитория.  Он
безопасен, но не без подводных камней.



<PRE>
#  Копировать RCS-файл в репозитории 
$ cd $CVSROOT/<VAR>dir</VAR>
$ cp <VAR>old</VAR>,v <VAR>new</VAR>,v
#  Удалить старый файл 
$ cd ~/<VAR>dir</VAR>
$ rm <VAR>old</VAR>
$ cvs remove <VAR>old</VAR>
$ cvs commit <VAR>old</VAR>
# Удалить все метки из <VAR>new</VAR>
$ cvs update <VAR>new</VAR>
$ cvs log <VAR>new</VAR>   # Запомнить все метки, не являющиеся именами веток
$ cvs tag -d <VAR>tag1</VAR> <VAR>new</VAR>
$ cvs tag -d <VAR>tag2</VAR> <VAR>new</VAR>
...
</PRE>

<P>
Удалив метки, вы сможете извлекать старые ревизии


<P>
Преимущества:



<UL>
<LI>

Извлечение старых ревизий работает корректно, если вы используете
для извлечения ревизий ключ командной строки
<SAMP>`-r<VAR>метка</VAR>'</SAMP>, а не <SAMP>`-D<VAR>дата</VAR>'</SAMP>.

<LI>

Журнал изменений остается в целости и сохранности.

<LI>

Номера ревизий не искажаются.
</UL>

<P>
Недостатки:



<UL>
<LI>

Нет способа легко увидеть историю файла до переименования. 

</UL>



<H2><A NAME="SEC73" HREF="cvs-ru_toc.html#TOC73">Перемещение и переименование каталогов</A></H2>
<P>
<A NAME="IDX328"></A>
<A NAME="IDX329"></A>
<A NAME="IDX330"></A>
<A NAME="IDX331"></A>


<P>
Обычный способ переименовать или переместить каталог ---
переименовать или переместить каждый файл в нем, как описано в
section <A HREF="cvs-ru_7.html#SEC70">Обычный способ переименования</A>.  Затем следует извлечь их заново, используя ключ
командной строки <SAMP>`-P'</SAMP>, как описано в section <A HREF="cvs-ru_7.html#SEC68">Удаление каталогов</A>.


<P>
Если вам действительно нужно возиться с репозиторием, чтобы
переименовать или удалить каталог в репозитории, вы можете
сделать это так:



<OL>
<LI>

Уведомить всех, у кого есть извлеченная копия каталога, что
каталог будет переименован.  Они должны зафиксировать свои
изменения и удалить рабочие копии, перед тем, как вы предпримете
дальнейшие шаги.

<LI>

Переименуйте каталог внутри репозитория.


<PRE>
$ cd $CVSROOT/<VAR>родительский-каталог</VAR>
$ mv <VAR>старый-каталог</VAR> <VAR>новый-каталог</VAR>
</PRE>

<LI>

Исправьте административные файлы CVS, если это требуется
(например, если вы переименовали целый модуль).

<LI>

Сообщите всем, что они могут извлечь свои рабочии копии опять и
продолжить работу.

</OL>

<P>
Если кто-то не удалил свою рабочую копию, команды CVS будут
отказываться работать, пока он не удалит каталог, которого больше 
не существует в репозитории.


<P>
Почти всегда гораздо лучшим способом будет переместить файлы в
каталоге, вместо того, чтобы перемещать каталог, потому что иначе
вы, скорее всего, не сможете корректно извлекать старые версии
вашего проекта, так как они, вероятно, зависят от имен каталогов.


<P><HR><P>
Go to the <A HREF="cvs-ru_1.html">first</A>, <A HREF="cvs-ru_6.html">previous</A>, <A HREF="cvs-ru_8.html">next</A>, <A HREF="cvs-ru_24.html">last</A> section, <A HREF="cvs-ru_toc.html">table of contents</A>.
</BODY>
</HTML>
