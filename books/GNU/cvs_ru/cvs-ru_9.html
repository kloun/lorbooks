<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from cvs-ru.texi on 11 April 2001 -->

<TITLE>CVS -- Система Управления Параллельными Версиями - Обработка двоичных файлов</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="cvs-ru_1.html">first</A>, <A HREF="cvs-ru_8.html">previous</A>, <A HREF="cvs-ru_10.html">next</A>, <A HREF="cvs-ru_24.html">last</A> section, <A HREF="cvs-ru_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC79" HREF="cvs-ru_toc.html#TOC79">Обработка двоичных файлов</A></H1>
<P>
<A NAME="IDX340"></A>
<A NAME="IDX341"></A>


<P>
Основное применение для CVS -- хранить текстовые файлы.  При 
работе с текстовыми файлами CVS может объединять ревизии,
показывать различия между ревизиями в доступном для человека
формате, и совершать прочие подобные операции.  Однако, если вы
согласитесь отказаться от некоторых возможностей, то CVS
может хранить двоичные файлы.  Например, можно хранить в CVS 
целый web-сайт, причем как страницы, так и двоичные картинки.




<H2><A NAME="SEC80" HREF="cvs-ru_toc.html#TOC80">Вопросы использования двоичных файлов</A></H2>

<P>
Если вы постоянно работаете с двоичными файлами, то необходимость 
их использования очевидна.  Если же вы хотите хранить историю
изменений таких файлов, возникают дополнительные вопросы.


<P>
Одной из основных функций контроля версий -- просмотр различий
между двумя ревизиями.  Например, если кто-то еще создает новую
ревизию файла, то вам хотелось бы взглянуть на то, что изменилось 
и выяснить, верно ли были сделаны изменения.  Для текстовых
файлов CVS обспечивает такую функциональность с помощью
команды <CODE>cvs diff</CODE>.  Для двоичных файлов можно извлечь две
ревизии и сравнить их с помощью внешнего инструмента (например, в 
текстовых процессорах обычно имеется такая возможность.  Если
такого инструмента не существует, нужно отслеживать изменения
посредством с помощью других механизмов, например, заставляя
людей писать хорошие журнальные сообщения, надеясь при этом, что
они действительно сделали то, что намеревались сделать.


<P>
Другая возможность системы контроля версий -- объединение двух
ревизий.  Для CVS это происходит в двух контекстах.
Во-первых, пользователи редактируют файлы в различных рабочих
каталогах (see section <A HREF="cvs-ru_10.html#SEC82">Несколько разработчиков</A>).  Во-вторых,
объединения совершаются явно, используя команду <SAMP>`update -j'</SAMP>
(see section <A HREF="cvs-ru_5.html#SEC54">Создание ветвей и слияние</A>).


<P>
В случае текстовых файлов CVS может объединить изменения,
совершенные независимо друг от друга, и сигнализировать о
конфликте, если нужно.  В случае двоичных файлов лучшее, что
может сделать CVS -- выдать две различных копии файла и
предоставить пользователю справиться с конфликтом.  Пользователь
может выбрать ту или иную копию, или использовать специальный
инструмент для слияния файлов этого конкретного формата, если
таковой инструмент существует.  Заметьте, что необходимость
слияния изменений вручную полностью зависит от аккуратности
пользователя, поэтому может привести к ошибкам.


<P>
Если вышеописанный процесс нежелателен, лучшим выходом было бы
отказаться от автоматического слияния.  Чтобы избежать слияний,
являющихся результатом работы в разных рабочих каталогах,
посмотрите обсуждение блокирующих извлечений (блокировок файлов)
в section <A HREF="cvs-ru_10.html#SEC82">Несколько разработчиков</A>.  Чтобы избежать слияний,
образующихся в результате использования ветвей, ограничьте
использование ветвей.




<H2><A NAME="SEC81" HREF="cvs-ru_toc.html#TOC81">Как хранить двоичные файлы</A></H2>

<P>
При хранении двоичных файлов встает два вопроса.  Первый:
CVS по умолчанию преобразует коды конца строк между
канонической формой, в которой они хранятся в репозитории (только 
символ новой строки) и формой, соответствующей операционной
системе клиента (например, возврат каретки, за которым следует
перевод строки под Windows NT).


<P>
Второй вопрос -- в двоичном файле могут оказаться данные,
похожие на ключевое слово (see section <A HREF="cvs-ru_12.html#SEC97">Подстановка ключевых слов</A>),
так что эта подстановка должна быть выключена.


<P>
Ключ командной строки <SAMP>`-kb'</SAMP>, доступный при использовании
некоторых команд CVS, позволяет убедиться, что ни
преобразование концов строки, ни подстановка ключевых слов не
производятся.


<P>
Вот пример создания нового файла с использование флага
<SAMP>`-kb'</SAMP>:



<PRE>
$ echo '$Id$' &#62; kotest
$ cvs add -kb -m"A test file" kotest
$ cvs ci -m"Первое фиксирование; файл содержит ключевое слово" kotest
</PRE>

<P>
Если файл случайно будет добавлен без <SAMP>`-kb'</SAMP>, можно
использовать команду <CODE>cvs admin</CODE> для восстановления.
Например,



<PRE>
$ echo '$Id$' &#62; kotest
$ cvs add -m"A test file" kotest
$ cvs commit -m"Первое фиксирование; содержит ключевое слово" kotest
$ cvs admin -kb kotest
$ cvs update -A kotest
# Для не-UNIX систем:
# Скопировать откуда-нибудь хорошую копию файла
$ cvs commit -m "Сделать файл двоичным" kotest
</PRE>

<P>
Когда вы извлечете файл <TT>`kotest'</TT>, он не станет двоичным,
потому что вы не зафиксировали его как двоичный.  Команда
<CODE>cvs admin -kb</CODE> устанавливает метод подстановки ключевых
слов по умолчанию для этого файла, но не изменяет рабочую копию
файла, которая у вас есть.  Если вам нужно справиться с символами
конца строки (при использовании CVS на не-UNIX
системах), вам требуется зафиксировать новую копию файла, как
показано выше в команде <CODE>cvs commit</CODE>.
Под UNIX достаточно выполнить <CODE>cvs update -A</CODE>.


<P>
Однако, используя <CODE>cvs admin -k</CODE> для изменения режима
подстановки ключевых слов, знайте, что этот режим не подчиняется
контролю версий.  Это означает, что если, скажем, в старых
версиях пакета какой-то файл был текстовым, а затем в новых
версиях появился двоичный файл с тем же именем, то CVS не
обеспечивает способа извлечь файл в двоичном или текстовом режиме
в зависимости от версии пакета, которую вы извлекаете.  Для
обхода этой проблемы хорошего решения не существует.


<P>
Вы можете установить значения по умолчанию, которые используют
команды <CODE>cvs add</CODE> и <CODE>cvs import</CODE>, для выяснения,
является ли файл текстовым или двоичным, основываясь на его
имени.  Например, можно гарантировать, что файлы, чьи имена
заканчиваются на <SAMP>`.exe'</SAMP> являются двоичными.
See section <A HREF="cvs-ru_18.html#SEC160">Файл <TT>`cvswrappers'</TT></A>.  В настоящий момент нет способа для определения,
является ли файл текстовым или двоичным, в зависимости от его
содержимого. Основная трудность при разработке такой возможности
--- неясно, как различить такие файлы, потому что способы сильно
различаются в разных операционных системах.


<P><HR><P>
Go to the <A HREF="cvs-ru_1.html">first</A>, <A HREF="cvs-ru_8.html">previous</A>, <A HREF="cvs-ru_10.html">next</A>, <A HREF="cvs-ru_24.html">last</A> section, <A HREF="cvs-ru_toc.html">table of contents</A>.
</BODY>
</HTML>
