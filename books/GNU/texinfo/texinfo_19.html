<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from texinfo.texi on 31 May 2000 -->

<TITLE>Texinfo 4.0 - Определение новых команд Texinfo</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="texinfo_1.html">first</A>, <A HREF="texinfo_18.html">previous</A>, <A HREF="texinfo_20.html">next</A>, <A HREF="texinfo_33.html">last</A> section, <A HREF="texinfo_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC207" HREF="texinfo_toc.html#TOC207">Определение новых команд Texinfo</A></H1>
<P>
<A NAME="IDX744"></A>
<A NAME="IDX745"></A>
<A NAME="IDX746"></A>


<P>
Texinfo предоставляет несколько способов определить новые команды:



<UL>
<LI>

Команда Texinfo <EM>macro</EM> позволяет вам определять новые команды в
виде виде произвольной последовательности текста и/или существующих
команд Texinfo (включая другие макросы).  Макрос может принимать любое
число <EM>параметров</EM> -- фрагментов текста, которые вы передаете при
каждом вызове макроса.  

Кстати, такие макросы не имеют никакого отношения к команде
<CODE>@defmac</CODE>, которая служит для документирования рассматриваемых в
руководстве макросов (see section <A HREF="texinfo_16.html#SEC184">Шаблон определения</A>.)

<LI>

<SAMP>`@alias'</SAMP> дает удобный способ определения нового имени для
существующей команды.

<LI>

<SAMP>`@definfoenclose'</SAMP> позволяет вам определять новые команды с
настраиваемым видом при выводе в Info.
</UL>



<H2><A NAME="SEC208" HREF="texinfo_toc.html#TOC208">Определение макросов</A></H2>
<P>
<A NAME="IDX747"></A>
<A NAME="IDX748"></A>
<A NAME="IDX749"></A>


<P>
<A NAME="IDX750"></A>
Используйте для определения макросов команду Texinfo <CODE>@macro</CODE>, как
показано:



<PRE>
@macro <VAR>имя-макроса</VAR>{<VAR>парам1</VAR>, <VAR>парам2</VAR>, ...}
<VAR>текст</VAR> ... \<VAR>парам1</VAR>\ ...
@end macro
</PRE>

<P>
<EM>Параметры</EM> <VAR>парам1</VAR>, <VAR>парам2</VAR>, ... соответствуют
аргументам, передаваемым макросу при последующих вызовах внутри
документа (описано в следующем разделе).


<P>
Чтобы макрос работал в TeX, <VAR>имя-макроса</VAR> должно состоять только
из букв и не включать цифр, подчерков, дефисов или других специальных
знаков.


<P>
Если макрос не нуждается в параметрах, вы можете определить его с пустым
списком параметров (<SAMP>`@macro foo {}'</SAMP>) или вообще без фигурных
скобок (<SAMP>`@macro foo'</SAMP>).


<P>
<A NAME="IDX751"></A>
<A NAME="IDX752"></A>
<A NAME="IDX753"></A>
В определении <EM>тела</EM> макроса может содержаться большинство команд
Texinfo, в том числе и определенные ранее макросы.  Вызовы еще не
определенных макросов запрещены; таким образом, невозможно создать
взаимно рекурсивные макросы Texinfo.  Кроме того, определение макроса,
определяющего другой макрос не работает в TeX из-за ограничений в
реализации <CODE>@macro</CODE>.


<P>
<A NAME="IDX754"></A>
В теле макроса, вхождения имен параметров, заключенных в символы
обратной косой черты, как например <SAMP>`\<VAR>парам1</VAR>\'</SAMP> в примере выше,
замещаются соответствующим аргументом при вызове.  Вы можете
использовать в теле имена параметров любое число раз, включая ноль.


<P>
<A NAME="IDX755"></A>
Чтобы получить в раскрытии макроса один знак <SAMP>`\'</SAMP>, используйте
<SAMP>`\\'</SAMP>.  Любое другое применение <SAMP>`\'</SAMP> в теле порождает
предупреждение.


<P>
<A NAME="IDX756"></A>
<A NAME="IDX757"></A>
Переводы строк после строки <CODE>@macro</CODE> и перед строкой <CODE>@end
macro</CODE> игнорируются, то есть не включаются в тело макроса.  Все
остальные пропуски интерпретируются в соответствии с обычными правилами
Texinfo.


<P>
<A NAME="IDX758"></A>
<A NAME="IDX759"></A>
Чтобы позволить макросу использоваться рекурсивно, то есть в аргументе
вызова самого себя, вы должны определить его с помощью <SAMP>`@rmacro'</SAMP>,
как показано:



<PRE>
@rmacro rmac
a\arg\b
@end rmacro
...
@rmac{1@rmac{text}2}
</PRE>

<P>
Это дает на выходе `a1atextb2b'.  При использовании <SAMP>`@macro'</SAMP>
вместо <SAMP>`@rmacro'</SAMP>, будет выдано сообщение об ошибке.


<P>
<A NAME="IDX760"></A>
<A NAME="IDX761"></A>
<A NAME="IDX762"></A>
Вы можете отменить определение макроса <VAR>foo</VAR> вызовом <CODE>@unmacro
<VAR>foo</VAR></CODE>.  Отмена еще не определенного макроса не является ошибкой.
Например:



<PRE>
@unmacro foo
</PRE>



<H2><A NAME="SEC209" HREF="texinfo_toc.html#TOC209">Вызов макросов</A></H2>
<P>
<A NAME="IDX763"></A>
<A NAME="IDX764"></A>
<A NAME="IDX765"></A>
<A NAME="IDX766"></A>


<P>
После того как макрос определен (смотрите предыдущий раздел), вы можете
использовать (<EM>вызывать</EM>) его в ваших документах следующим образом:



<PRE>
@<VAR>имя-макроса</VAR> {<VAR>арг1</VAR>, <VAR>арг2</VAR>, ...}
</PRE>

<P>
в результате получится так, как будто вы напечатали тело
макроса <VAR>имя-макроса</VAR> в этом месте.  Например:



<PRE>
@macro foo {p, q}
Вместе: \p\ и \q\.
@end macro
@foo{А, Б}
</PRE>

<P>
дает:



<PRE>
Вместе: А и Б.
</PRE>

<P>
<A NAME="IDX767"></A>
Итак, аргументы и параметры разделяются запятыми и заключаются в
фигурные скобки; любые пробельные символы после (но не перед) запятой
игнорируются.  При вызове (но не в определении) неоходимо писать
фигурные скобки, даже если макро не принимает аргументов, так же, как и
во всех остальных командах Texinfo.  Например:



<PRE>
@macro без-аргументов {}
Здесь нет аргументов.
@end macro
@без-аргументов{}
</PRE>

<P>
дает:



<PRE>
Здесь нет аргументов.
</PRE>

<P>
Чтобы вставить в аргумент запятую, фигурную скобку или обратную косую черту,
напишите перед ней символ обратной косой черты, например



<PRE>
@<VAR>имя-макроса</VAR> {\\\{\}\,}
</PRE>

<P>
передаст макросу <VAR>имя-макроса</VAR> аргумент <SAMP>`\{},'</SAMP>, (что почти
наверняка приведет к ошибке).


<P>
Если макрос определен с одним аргументом и вызван без фигурных скобок, в
качестве аргумента ему будет передан весь остаток строки после имени
макроса.  Например:



<PRE>
@macro bar {p}
Дважды: \p\ и \p\.
@end macro
@bar ах
</PRE>

<P>
дает:



<PRE>
Twice: ах и ах.
</PRE>

<P>
Если макрос определен с одним аргументом и вызван с фигурными скобками,
в качестве аргумента передается текст в скобках, независимо от запятых.
К примеру:



<PRE>
@macro bar {p}
Twice: \p\ и \p\.
@end macro
@bar{а,б}
</PRE>

<P>
дает:



<PRE>
Дважды: а,б и а,б.
</PRE>



<H2><A NAME="SEC210" HREF="texinfo_toc.html#TOC210">Подробно о макросах</A></H2>
<P>
<A NAME="IDX768"></A>
<A NAME="IDX769"></A>


<P>
В связи с неразрешимыми разногласиями в реализациях TeX и
@command{makeinfo} макросы Texinfo обладают следующими ограничениями.



<UL>
<LI>

Все макросы раскрываются внутри по меньшей мере одной группы TeX.
Это означает, что @set и другие команды не будет действовать внутри
макроса.

<LI>

Макросы, содержащие команду, которая должна находиться на отдельной
строке, например условие, нельзя вызывать в середине строки.

<LI>

Реализация для TeX не умеет конструировать макросы, которые
определяют другие макросы естественным способом.  Чтобы сделать сделать
это, вы обязаны использовать условные команды и непосредственно TeX.
Например:


<PRE>
@ifinfo
@macro ctor {name, arg}
@macro \name\
нечто подразумевающее \arg\
@end macro
@end macro
@end ifinfo
@tex
\gdef\ctor#1{\ctorx#1,}
\gdef\ctorx#1,#2,{\def#1{нечто подразумевающее #2}}
@end tex
</PRE>

<LI>

Лучше избегать комментариев в определениях макросов.
</UL>



<H2><A NAME="SEC211" HREF="texinfo_toc.html#TOC211"><SAMP>`@alias <VAR>новая</VAR>=<VAR>существующая</VAR>'</SAMP></A></H2>
<P>
<A NAME="IDX770"></A>
<A NAME="IDX771"></A>
<A NAME="IDX772"></A>


<P>
Команда <SAMP>`@alias'</SAMP> определяет новую команду, которая действует точно
так же, как существующая.  Это полезно для определения дополнительных
разметочных имен, которые сохранят семантическую информацию на входе,
хотя и, возможно, оставят результат таким же.


<P>
Пишите команду <SAMP>`@alias'</SAMP> на отдельной строке, а после пишите имя
новой команды, знак равенства и имя существующей команды.  Пропуски
вокруг знака равенства игнорируются.  Пример:

<PRE>
@alias <VAR>новая</VAR> = <VAR>существующая</VAR>
</PRE>

<P>
Например, если ваш документ содержит ссылки как на книги, так и на
другие произведения (скажем, фильмы), вы могли бы захотеть определить
макро <CODE>@moviecite{}</CODE>, которое делает то же самое, что и обычная
команда <CODE>@cite{}</CODE>, но также передает дополнительную
семантическую информацию.  Вы могли бы сделать это так:



<PRE>
@alias moviecite = cite
</PRE>

<P>
Макросы не всегда имеют тот же эффект из-за капризов разбора аргументов.
Кроме того, определять псевдонимы намного проще, чем макросы.  Так что
эта команда не избыточна.  (Она также интенсивно применялась в Jargon
File!)


<P>
Псевдонимы не должны быть рекурсивными, прямо или косвенно.




<H2><A NAME="SEC212" HREF="texinfo_toc.html#TOC212"><SAMP>`definfoenclose'</SAMP>: Настройка выделения</A></H2>
<P>
<A NAME="IDX773"></A>
<A NAME="IDX774"></A>
<A NAME="IDX775"></A>


<P>
Вы можете использовать обычные команды TeX внутри блока
<CODE>@iftex</CODE> ... <CODE>@end iftex</CODE> для создания ваших собственных
выделяющих команд для Texinfo.  Самый простой способ достичь этого ---
приравнять ваши команды уже существующим, например командам, выводящим
курсивом.  Такие новые команды работают только в TeX.

<P>
<A NAME="IDX776"></A>
<A NAME="IDX777"></A>
Вы можете использовать команду <CODE>@definfoenclose</CODE> внутри блока
<CODE>@ifinfo</CODE> ... <CODE>@end ifinfo</CODE> для определения новых команд
для Info с теми же именами, что и новые команды для TeX.
<CODE>@definfoenclose</CODE> создает новые команды для Info, которые помечают
текст, окружая его заданными строками.<A NAME="DOCF10" HREF="texinfo_foot.html#FOOT10">(10)</A>.}


<P>
Ниже показано, как создать новую @-команду, называемую <CODE>@phoo</CODE>,
которая заставляет TeX набирать свой аргумент курсивом, а Info ---
выводить аргумент между <SAMP>`//'</SAMP> и <SAMP>`\\'</SAMP>.

<P>
Для TeX напишите следующее, чтобы приравнять команду <CODE>@phoo</CODE>
существующей команде <CODE>@i</CODE> для курсива:


<PRE>
@iftex
@global@let@phoo=@i
@end iftex
</PRE>

<P>
Это определяет <CODE>@phoo</CODE> как команду, заставляющую TeX набирать
аргумент <CODE>@phoo</CODE> курсивом.  <CODE>@global@let</CODE> говорит TeX
приравнять следующий аргумент аргументу, идущему после знака равенства.


<P>
Для Info напишите следующее, чтобы программы форматирования Info
заключали аргумент между <SAMP>`//'</SAMP> и <SAMP>`\\'</SAMP>:



<PRE>
@ifinfo
@definfoenclose phoo,//,\\
@end ifinfo
</PRE>

<P>
Пишите команду <CODE>@definfoenclose</CODE> в начале строки, а после нее
пишите три аргумента, разделенные запятыми (запятые используются в
качестве разделителей в строке <CODE>@node</CODE> таким же образом).



<UL>
<LI>

Первым аргументом <CODE>@definfoenclose</CODE> является имя @-команды
<STRONG>без</STRONG> <SAMP>`@'</SAMP>;

<LI>

второй аргумент -- это начальная строка-разделитель для Info; и

<LI>

третий аргумент -- завершающая строка-разделитель.
</UL>

<P>
Два последних аргумента окружают выделяемый текст в Info-файле.
Строка-разделитель может содержать пробельные знаки, но они имеют
значение, поэтому не вставляйте пропуски, если не хотите, чтобы они
появились при выводе.  Ни начальный, ни завершающий разделитель не
обязателен.  Однако, если вы не задаете начальный разделитель, вы должны
написать после имени команды две запятые подряд; иначе команды
форматирования для Info неправильно воспримут завершающий разделитель
как начальный.


<P>
После того, как вы определили <CODE>@phoo</CODE> и для TeX, и для Info,
вы можете написать <CODE>@phoo{bar}</CODE> и получить <SAMP>`//bar\\'</SAMP>
в Info и курсивное
<I>bar</I> в печатном выводе.


<P>
Заметьте, что каждое определение применяется для своей форматирующей
программы: одно для TeX, другое для Info.


<P>
Вот другой пример:



<PRE>
@ifinfo
@definfoenclose headword,,:
@end ifinfo
@iftex
@global@let@headword=@b
@end iftex
</PRE>

<P>
Это определяет <CODE>@headword</CODE> как команду, которая в Info вставляет
двоеточие после аргумента и не вставляет ничего перед ним, а в TeX
набирает аргумент жирным шрифтом.


<P><HR><P>
Go to the <A HREF="texinfo_1.html">first</A>, <A HREF="texinfo_18.html">previous</A>, <A HREF="texinfo_20.html">next</A>, <A HREF="texinfo_33.html">last</A> section, <A HREF="texinfo_toc.html">table of contents</A>.
</BODY>
</HTML>
