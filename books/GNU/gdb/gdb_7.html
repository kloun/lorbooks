<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from gdb.texinfo on 1 November 2000 -->

<TITLE>Отладка с помощью GDB - Исследование стека</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="gdb_1.html">first</A>, <A HREF="gdb_6.html">previous</A>, <A HREF="gdb_8.html">next</A>, <A HREF="gdb_26.html">last</A> section, <A HREF="gdb_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC40" HREF="gdb_toc.html#TOC40">Исследование стека</A></H1>

<P>
Когда ваша программа остановилась, первое, что вам нужно
знать---где она остановилась и как она туда попала.


<P>
<A NAME="IDX229"></A>
Каждый раз, когда ваша программа производит вызов функции,
о нем создается определенная информация.  Она включает положение вызова
в вашей программе, параметры вызова и локальные переменные вызываемой
функции.  Информация сохраняется в блоке данных, называемом
<EM>кадром стека</EM>.  Кадры стека размещаются в области памяти, называемой
<EM>стеком вызовов</EM>.


<P>
Команды GDB для исследования стека позволяют вам увидеть всю эту
информацию при остановке вашей программы.


<P>
<A NAME="IDX230"></A>
Один из кадров стека является <EM>выбранным</EM> GDB, и многие
команды GDB неявно относятся к нему.  В частности, когда вы
запрашиваете у GDB значение переменной вашей программы, это
значение находится в выбранном кадре.  Для выбора интересующего вас
кадра существуют специальные команды GDB.  See section <A HREF="gdb_7.html#SEC43">Выбор кадра</A>.


<P>
Когда ваша программа останавливается, GDB автоматически
выбирает текущий выполняющийся кадр и выдает его краткое описание,
аналогично команде <CODE>frame</CODE> (see section <A HREF="gdb_7.html#SEC44">Информация о кадре стека</A>).




<H2><A NAME="SEC41" HREF="gdb_toc.html#TOC41">Кадры стека</A></H2>

<P>
<A NAME="IDX231"></A>
<A NAME="IDX232"></A>
Cтек вызовов разделен на непрерывные участки, называемые
<EM>кадрами стека</EM>, или <EM>кадрами</EM> для краткости;
каждый кадр является данными, связанными с одним вызовом одной
функции.  Кадр содержит аргументы, переданные функции, ее локальные
переменные и адрес, с которого она выполняется.


<P>
<A NAME="IDX233"></A>
<A NAME="IDX234"></A>
<A NAME="IDX235"></A>
Когда ваша программа стартует, стек содержит только один кадр---для
функции <CODE>main</CODE>.  Он называется <EM>начальным</EM> или <EM>внешним</EM>
кадром.  Каждый
раз при вызове функции создается новый кадр.  При каждом выходе
из функции, кадр этого вызова функции уничтожается.  Если функция
является рекурсивной, для нее может существовать множество кадров.  Кадр
для функции, исполняемой в данный момент, называется <EM>внутренним</EM>
кадром.  Это кадр, созданный самым последним из всех существующих кадров стека.


<P>
<A NAME="IDX236"></A>
Внутри вашей программы кадры стека идентифицируются своим адресом.
Кадр стека состоит из множества байт, каждый из которых имеет
свой собственный адрес; каждый тип компьютеров имеет свой способ для
выбора одного байта, чей адрес служит адресом кадра.  Обычно, пока
выполнение происходит в данном кадре, этот адрес содержится в
регистре, называемом <EM>регистром указателя кадра</EM>.


<P>
<A NAME="IDX237"></A>
GDB присваивает номера всем существующим кадрам стека, начиная
с нуля для внутреннего кадра, единицу---вызвавшему его кадру, и так далее.  В
действительности, эти номера не существуют в вашей программе; они
назначаются GDB, чтобы предоставить вам способ различать кадры
стека в командах GDB.


<P>
<A NAME="IDX238"></A>
Некоторые компиляторы позволяют компилировать функции так, чтобы
они выполнялись без создания кадров стека.  (Например, ключ gcc

<PRE>
<SAMP>`-fomit-frame-pointer'</SAMP>
</PRE>

<P>
создает функции без кадра.)  Это иногда делается
с часто используемыми библиотечными функциями, чтобы сохранить время,
требуемое для установки кадра.  GDB имеет ограниченные
возможности для обработки таких функциональных вызовов.  Если
вызов внутренней функции происходит без создания кадра стека,
GDB, тем не менее, описывает его так, как если бы он имел
отдельный кадр, который имеет, как обычно, номер 0, позволяя корректно
трассировать цепочку функциональных вызовов.  Однако, GDB не
имеет средств для работы с функциями без кадра в другом месте стека.


<DL COMPACT>

<DT><CODE>frame <VAR>арг</VAR></CODE>
<DD>
<A NAME="IDX239"></A>
 <A NAME="IDX240"></A>
 
Команда <CODE>frame</CODE> позволяет вам перемещаться от одного кадра стека
к другому, и распечатывать выбранный вами кадр.  <VAR>Арг</VAR> может быть либо
адресом кадра, либо его номером.  Без аргумента, <CODE>frame</CODE>
выводит текущий кадр стека.

<A NAME="IDX241"></A>
<A NAME="IDX242"></A>
<DT><CODE>select-frame</CODE>
<DD>
Команда <CODE>select-frame</CODE> позволяет вам перемещаться от одного кадра
стека к другому без его распечатки.  Это "тихая" версия <CODE>frame</CODE>.
</DL>



<H2><A NAME="SEC42" HREF="gdb_toc.html#TOC42">Цепочки вызовов</A></H2>

<P>
<A NAME="IDX243"></A>
<A NAME="IDX244"></A>
Цепочка вызовов предоставляет собой информацию о том, как ваша программа
оказалась там, где она есть.  Она отображает по одной строке для каждого кадра,
начиная с текущего выполняющегося кадра (кадра 0), за которым следует
кадр, из которого он был вызван (кадр 1), и далее вверх по стеку.


<DL COMPACT>

<DT><CODE>backtrace</CODE>
<DD>
<A NAME="IDX245"></A>
 <A NAME="IDX246"></A>
 
<DT><CODE>bt</CODE>
<DD>
Вывести цепочку вызовов всего стека: по одной строке на кадр,
для всех кадров в стеке.

Вы можете прервать цепочку вызовов в любое время, введя знак
системного прерывания, обычно <KBD>C-c</KBD>.

<DT><CODE>backtrace <VAR>n</VAR></CODE>
<DD>
<DT><CODE>bt <VAR>n</VAR></CODE>
<DD>
То же самое, но выводятся только <VAR>n</VAR> внутренних кадров.

<DT><CODE>backtrace -<VAR>n</VAR></CODE>
<DD>
<DT><CODE>bt -<VAR>n</VAR></CODE>
<DD>
То же самое, но выводятся только <VAR>n</VAR> внешних кадров.
</DL>

<P>
<A NAME="IDX247"></A>
<A NAME="IDX248"></A>
<A NAME="IDX249"></A>
<CODE>where</CODE> и <CODE>info stack</CODE> (сокращенно <CODE>info
s</CODE>)---дополнительные синонимы для <CODE>backtrace</CODE>.


<P>
Каждая строка в цепочке вызовов показывает номер кадра и имя функции.
Счетчик команд также показывается, если только вы не используете
<CODE>set print address off</CODE>.  Цепочка вызовов также показывает имя
исходного файла, номер строки и аргументы функции.  Значение счетчика
команд опускается, если он указывает на начало кода для данной строки.


<P>
Ниже приведен пример цепочки вызовов.  Она была получена командой
<SAMP>`bt 3'</SAMP>, так что она показывает три внутренних кадра.



<PRE>
#0  m4_traceon (obs=0x24eb0, argc=1, argv=0x2b8c8)
    at builtin.c:993
#1  0x6e38 in expand_macro (sym=0x2b600) at macro.c:242
#2  0x6840 in expand_token (obs=0x0, t=177664, td=0xf7fffb08)
    at macro.c:71
(More stack frames follow...)
</PRE>

<P>
Информация о нулевом кадре не начинается со значения счетчика команд,
что указывает на то, что ваша программа остановилась в начале кода для
строки <CODE>993</CODE> файла <CODE>builtin.c</CODE>.




<H2><A NAME="SEC43" HREF="gdb_toc.html#TOC43">Выбор кадра</A></H2>

<P>
Большинство команд для исследования стека и других данных в вашей
программе применяются выбранному в данный момент кадру.
Здесь приведены команды для выбора кадра стека; все они
завершаются выводом краткого описания выбранного кадра стека.


<DL COMPACT>

<DT><CODE>frame <VAR>n</VAR></CODE>
<DD>
<A NAME="IDX250"></A>
 <A NAME="IDX251"></A>
 
<DT><CODE>f <VAR>n</VAR></CODE>
<DD>
Выбрать кадр номер <VAR>n</VAR>.  Напоминаем, что нулевой кадр---это
внутренний (исполняемый в данный момент) кадр,  первый кадр---тот, из
которого вызван нулевой, и так далее.  Кадр с наибольшим номером---это кадр
для функции <CODE>main</CODE>.

<DT><CODE>frame <VAR>адрес</VAR></CODE>
<DD>
<DT><CODE>f <VAR>адрес</VAR></CODE>
<DD>
Выбрать кадр, расположенный по адресу <VAR>адрес</VAR>.  В основном это
полезно, если формирование цепочки кадров стека было нарушено из-за
ошибки, сделавшей невозможным для GDB правильное присвоение
номеров всем кадрам.  Кроме того, это может быть полезным,
когда у вашей программы есть несколько стеков и происходит
переключение от одного к другому.

В архитектуре SPARC, команде <CODE>frame</CODE> для выбора произвольного
кадра необходимо указать два адреса: указатель кадра и указатель вершины
стека.

В архитектурах MIPS и Alpha требуется два адреса: указатель
вершины стека и указатель команд.

В архитектуре 29k требуется три адреса: указатель вершины
стека регистров, указатель команд и указатель вершины стека памяти.

<A NAME="IDX252"></A>
<DT><CODE>up <VAR>n</VAR></CODE>
<DD>
Переместиться вверх по стеку на <VAR>n</VAR> кадров.  Для положительных
значений <VAR>n</VAR>, это перемещение происходит по направлению к внешнему
кадру, к кадрам с большими номерами, к кадрам, которые существуют
дольше.  По умолчанию <VAR>n</VAR> принимается равным единице.

<A NAME="IDX253"></A>
<A NAME="IDX254"></A>
<DT><CODE>down <VAR>n</VAR></CODE>
<DD>
Передвинуться вниз по стеку на <VAR>n</VAR> кадров.  Для положительных
значений <VAR>n</VAR>, это продвижение происходит по направлению к
внутреннему кадру, к кадру с меньшим номером, к кадрам, которые были
созданы позже.  По умолчанию, значение <VAR>n</VAR> принимается равным
единице.  Вы можете сокращать <CODE>down</CODE> как <CODE>do</CODE>.
</DL>

<P>
Все эти команды заканчиваются выводом двух строк, описывающих кадр.
Первая строка показывает номер кадра, имя функции, аргументы,
имя исходного файла и номер выполняемой строки в этом кадре.  Вторая
строка показывает содержимое этой строки исходного текста.


<P>
Например:



<PRE>
(gdb) up
#1  0x22f0 in main (argc=1, argv=0xf7fffbf4, env=0xf7fffbfc)
    at env.c:10
10              read_input_file (argv[i]);
</PRE>

<P>
После такого вывода, команда <CODE>list</CODE> без аргументов выводит десять
строк, расположенных вокруг точки выполнения в кадре.
See section <A HREF="gdb_8.html#SEC46">Вывод строк исходного текста</A>.


<DL COMPACT>

<DT><CODE>up-silently <VAR>n</VAR></CODE>
<DD>
<A NAME="IDX255"></A>
 <A NAME="IDX256"></A>
 
<DT><CODE>down-silently <VAR>n</VAR></CODE>
<DD>
Эти две команды являются вариантами <CODE>up</CODE> и <CODE>down</CODE> соответственно,
отличаясь от них тем, что делают свою работу "тихо", не отображая новый
кадр.  Они предназначены для использования в основном в
командных сценариях GDB, где вывод может быть ненужным и
отвлекающим.
</DL>



<H2><A NAME="SEC44" HREF="gdb_toc.html#TOC44">Информация о кадре стека</A></H2>

<P>
Существуют несколько других команд для вывода информации о выбранном
кадре стека.


<DL COMPACT>

<DT><CODE>frame</CODE>
<DD>
<DT><CODE>f</CODE>
<DD>
При использовании без аргументов, эта команда не выбирает новый
кадр, а выводит краткое описание текущего выбранного кадра стека.  Эту
команду можно сокращать как <CODE>f</CODE>.  С аргументом, эта команда
используется для выбора кадра стека.
See section <A HREF="gdb_7.html#SEC43">Выбор кадра</A>.

<A NAME="IDX257"></A>
<A NAME="IDX258"></A>
<DT><CODE>info frame</CODE>
<DD>
<DT><CODE>info f</CODE>
<DD>
Эта команда выводит подробное описание выбранного кадра стека,
включающее:


<UL>
<LI>

адрес кадра
<LI>

адрес следующего вниз по стеку кадра (вызываемого из данного)
<LI>

адрес следующего вверх по стеку кадра (того, из которого был вызван данный)
<LI>

язык, на котором написан исходный код, соответствующий этому кадру
<LI>

адрес аргументов кадра
<LI>

адрес локальных переменных кадра
<LI>

сохраненный в кадре счетчик команд (адрес выполнения в кадре, вызвавшем данный)
<LI>

регистры, которые были сохранены в кадре
</UL>

Подробное описание полезно, если из-за какой-либо ошибки формат
стека не соответствует обычным соглашениям.

<DT><CODE>info frame <VAR>адрес</VAR></CODE>
<DD>
<DT><CODE>info f <VAR>адрес</VAR></CODE>
<DD>
Вывести подробное описание кадра стека, расположенного по адресу
<VAR>адрес</VAR>, не выбирая этот кадр.  Выбранный кадр этой командой не
изменяется.  Она требует параметр
<VAR>адрес</VAR> того же типа, что и команда <CODE>frame</CODE> (для некоторых архитектур
не один, а несколько).
See section <A HREF="gdb_7.html#SEC43">Выбор кадра</A>.

<A NAME="IDX259"></A>
<DT><CODE>info args</CODE>
<DD>
Вывести аргументы выбранного кадра, каждый на отдельной строке.

<DT><CODE>info locals</CODE>
<DD>
<A NAME="IDX260"></A>
Вывести локальные переменные выбранного кадра, каждую на отдельной
строке.  Выводятся все переменные (объявленные как статические или как
автоматические), доступные в точке выполнения выбранного кадра стека.

<A NAME="IDX261"></A>
<A NAME="IDX262"></A>
<A NAME="IDX263"></A>
<DT><CODE>info catch</CODE>
<DD>
Выводит список всех обработчиков исключительных ситуаций, являющихся
активными в текущей точке выполнения текущего кадра стека.  Чтобы
увидеть другие обработчики исключительных ситуаций, перейдите в
соответствующую секцию (используя команды <CODE>up</CODE>, <CODE>down</CODE> или
<CODE>frame</CODE>); затем наберите <CODE>info catch</CODE>.
See section <A HREF="gdb_6.html#SEC30">Установка точек перехвата</A>.

</DL>

<P><HR><P>
Go to the <A HREF="gdb_1.html">first</A>, <A HREF="gdb_6.html">previous</A>, <A HREF="gdb_8.html">next</A>, <A HREF="gdb_26.html">last</A> section, <A HREF="gdb_toc.html">table of contents</A>.
</BODY>
</HTML>
