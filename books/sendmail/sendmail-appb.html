<HTML>
<HEAD>
   <TITLE> </TITLE>
</HEAD>
<BODY>

<CENTER>
<P><B>ПРИЛОЖЕНИЕ B</B></P>

<P><B>ФОРМАТЫ═ФАЙЛОВ═ОЧЕРЕДИ</B></P>
</CENTER>

<P>Это приложение описывает формат файлов очереди.
Эти файлы живут в каталоге, определенном опцией <B>Q</B> <U>sendmail.cf</U>,
обычно <U>/var/spool/mqueue</U> или <U>/usr/spool/mqueue</U>.</P>

<P>Все файлы очереди имеют имена <U>x</U><B>f</B><U>AAA99999</U>,
где <U>AAA99999</U> - идентификатор этого сообщения, а <U>x</U> - его тип.
Первая буква идентификатора кодирует время дня получения сообщения системой
(буква A означает часы между полуночью и 1:00AM). Все файлы с одним идентификатором
вместе определяют одно сообщение.</P>

<P>Типы сообщений:</P>

<TABLE ALIGN=ABSCENTER CELLSPACING=0 CELLPADDING=0 >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%">d</TD>

<TD>Файл данных. Тело сообщения (исключая заголовок)
хранится в этом файле.</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD ALIGN=LEFT VALIGN=TOP>q </TD>

<TD>Контрольный файл очереди. Этот файл содержит
информацию, необходимую для обработки.</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>t </TD>

<TD>Временный файл. Это имидж файла <B>qf</B>
во время его перестройки. Он должен очень быстро переименоваться в файл
<B>qf</B> .</TD>
</TR>

<TR VALIGN=TOP>
<TD>x </TD>

<TD>Файл переписи, существует во время сессии,
показывая все, что случается во время этой сессии.</TD>
</TR>
</TABLE>

<P>Файл <B>qf</B> структурируется как последовательность
строк, каждая из которых начинается с кодовой буквы. Существуют следующие
строки:</P>

<TABLE ALIGN=ABSCENTER CELLSPACING=0 CELLPADDING=0 >
<TR VALIGN=TOP>
<TD WIDTH="10%">V</TD>

<TD>Номер версии формата файла очереди, используется
для того, чтобы позволить новым бинарникам sendmail читать файлы очереди,
созданные более ранними версиями. По умолчанию ноль. Если есть, то должна
быть первой строкой в файле.</TD>
</TR>

<TR>
<TD VALIGN=TOP>H</TD>

<TD>Определение заголовка. Таких строк может быть
несколько. Порядок их очень важен: Он представляет собой порядок в конечном
сообщении. используется тот же синтаксис, как и для определений заголовков
в файле конфигурации.</TD>
</TR>

<TR>
<TD VALIGN=TOP>C</TD>

<TD>Контрольный адрес. Синтаксис &quot;localuser:aliasname&quot;.
Адрес получателя, следующий за этой строкой будет иметь такие флаги, что
доставка будет производиться от localuser (имя пользователя из файла /etc/passwd
file); aliasname - это имя псевдонима, расширяющегося на этот адрес (используеися
для печати сообщений).</TD>
</TR>

<TR>
<TD VALIGN=TOP>Q</TD>

<TD>&quot;Оригинальный получатель&quot;, определяемый
полем ORCPT= в транзакции ESMTP. Используется только для Уведомлений о
Статусе Доставки. Применяется только сразу после строки &quot;R&quot;.</TD>
</TR>

<TR>
<TD VALIGN=TOP>R </TD>

<TD>Адрес получателя. Будет по одной строке на
каждого получателя. Файлы qf Версии 1 также включают ведущий список флагов,
заканчивающийся двоеточием, которые могут быть &quot;S&quot; для возврата
сообщения при успешной заключительной доставке, &quot;F&quot; для возврата
сообщения при неудаче, &quot;D&quot; для возврата сообщения, если оно отложено,
&quot;B&quot; для указания того, что должно быть возвращено тело, &quot;N&quot;
для подавления возврата тела, и &quot;P&quot; для декларации этого адреса
как &quot;первичного&quot; (primary) (командная строка или сессия SMTP).</TD>
</TR>

<TR>
<TD VALIGN=TOP>S</TD>

<TD>Адрес отправителя. Такая строка может быть
только одна.</TD>
</TR>

<TR>
<TD VALIGN=TOP>T</TD>

<TD>Время создания работы. Используется для подсчета
истечения таймаута работы.</TD>
</TR>

<TR>
<TD VALIGN=TOP>P</TD>

<TD>Текущий приритет сообщения. Используется для
упорядочивания очереди. Более высокие числа означают более низкий приоритет.
Во время нахождения сообщения в очереди приоритет изменяется. Изначальный
приритет зависит от класса сообщения и его размера.</TD>
</TR>

<TR>
<TD VALIGN=TOP>M </TD>

<TD>Сообщение. Эта строка печатается командой
mailq, и обычно используется для хранения информации о статусе. Может содержать
любой текст.</TD>
</TR>

<TR>
<TD VALIGN=TOP>F</TD>

<TD>Флаговые биты, одна буква на флаг. Определенные
флаговые биты: r - показывает, что это ответное сообщение и w - показывает
что было послано сообщение с предупреждением о задержке почты.</TD>
</TR>

<TR>
<TD VALIGN=TOP>N</TD>

<TD>Общее количество попыток доставки.</TD>
</TR>

<TR>
<TD VALIGN=TOP>K </TD>

<TD>Время последней попытки доставки (в секундах
с 1 Января 1970г.).</TD>
</TR>

<TR>
<TD VALIGN=TOP>I </TD>

<TD>Идентификационный номер файла данных; может
быть использован для восстановления почтовой очереди после катастрофического
&quot;падения&quot; диска.</TD>
</TR>

<TR>
<TD VALIGN=TOP>$</TD>

<TD>Определение макроса. Значения конкретных макросов
(во время написания этого документа, только $r и $s) передаваемые во время
обработки очереди.</TD>
</TR>

<TR>
<TD VALIGN=TOP>B</TD>

<TD>Тип тела. Конец строки - текстовое описание
типа тела. Если это поле отсутствует, тип тела считается &quot;неопределенным&quot;
(&quot;undefined&quot;) и не производится никакой специальной обработки.
Легальные значения &quot;7BIT&quot; и &quot;8BITMIME&quot;.</TD>
</TR>

<TR>
<TD VALIGN=TOP>O</TD>

<TD>Оригинальное значение MTS (из транзакции ESMTP).
Только для Уведомлений о Статусе Доставки.</TD>
</TR>

<TR>
<TD VALIGN=TOP>Z</TD>

<TD>Оригинальный конвертный идентификатор (из
транзакции ESMTP). Только для Уведомлений о Статусе Доставки.</TD>
</TR>
</TABLE>

<P>Например, файл из очереди6 посланный к &quot;eric@mammoth.Berkeley.EDU&quot;
и &quot;bostic@okeeffe.CS.Berkeley.EDU&quot;:</P>

<P><FONT COLOR="#008000">
<pre>
P835771
T404261372
Seric
Ceric:sendmail@vangogh.CS.Berkeley.EDU
Reric@mammoth.Berkeley.EDU
Rbostic@okeeffe.CS.Berkeley.EDU
H?P?return-path: &lt;owner-sendmail@vangogh.CS.Berkeley.EDU&gt;
Hreceived: by vangogh.CS.Berkeley.EDU (5.108/2.7) id AAA06703;
      Fri, 17 Jul 92 00:28:55 -0700
Hreceived: from mail.CS.Berkeley.EDU by vangogh.CS.Berkeley.EDU (5.108/2.7)
      id AAA06698; Fri, 17 Jul 92 00:28:54 -0700
Hreceived: from [128.32.31.21] by mail.CS.Berkeley.EDU (5.96/2.5)
      id AA22777; Fri, 17 Jul 92 03:29:14 -0400
Hreceived: by foo.bar.baz.de (5.57/Ultrix3.0-C)
      id AA22757; Fri, 17 Jul 92 09:31:25 GMT
H?F?from: eric@foo.bar.baz.de (Eric Allman)
H?x?full-name: Eric Allman
Hmessage-id: &lt;9207170931.AA22757@foo.bar.baz.de&gt;
HTo: sendmail@vangogh.CS.Berkeley.EDU
Hsubject: this is an example message
</pre></font>

<P>Здесь видно от кого послано это сообщение,
время представления сообщения (в секундах с 1 Января1970г.), приоритет
сообщения, его класс, получателей, и заголовки для сообщения.</P>

</BODY>
</HTML>
