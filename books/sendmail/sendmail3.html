<html>

<head>
<title>Sendmail Installation and Operation Guide (Part 3)</title>
</head>

<body>

<p><a name="toc3"></a><b>3. АРГУМЕНТЫ</b></p>

<p>Полный список аргументов для sendmail
детально описан в Приложении A.
Некоторые важные аргументы описаны
здесь.</p>

<dir>
    <dir>
            <a name="toc31"></a><b>3.1.
                Интервал Очереди</b>
        </dir>
    
</dir>

<p>Количество времени между
разветвлением процесса для
обработки очереди определяется
флагом <b>-q</b>. Если вы работаете в
режиме приема, назначенного <b>i</b>
или <b>b</b>, то это значение может быть
относительно большим, как и в том
случае, если ваш хост долго был
отключен. Если вы запускаете sendmail в
режиме <b>q</b>, то это значение должно
быть относительно небольшим,
потому что оно определяет
максимальное время нахождения
сообщения в очереди. (Смотри также
опцию MinQueueAge.)</p>

<p>Секция 5.3.1.1 RFC 1123 говорит, что это
значение должно быть как минимум 30
минут (но, если вы работаете в
режиме &quot;queue-only&quot;, то это не
важно).</p>

<dir>
    <dir>
            <a name="toc32"></a><b>3.2. Режим
                Демона</b>
        </dir>
    
</dir>

<p>Если вы позволяете принимать
почту через соединение IPC, у вас
должен работать демон. Он должен
запускаться из файла /etc/rc с флагом <b>-bd</b>.
Флаги <b>-bd</b> и <b>-q</b> могут быть
скомбинированы в одном вызове:</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail -bd
                -q30m </font>
        </dir>
    
</dir>

<p>В качестве альтернативы можно
запускать sendmail из inetd(8) (используя
флаг <b>-bs</b>, чтобы сказать sendmail
использовать SMTP на его стандартном
вводе и выводе). Это будет работать
и позволит вам завернуть sendmail в
программу обработки TCP, но может
быть несколько медленнее из-за
того, что файл конфигурации будет
перечитываться при получении
любого входящего сообщения. Если вы
так сделаете, то вам все равно
понадобится работающий sendmail для
обработки очереди:</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail -q30m </font><p><a
                name="toc33"></a><b>3.3.
                Ускорение Очереди</b></p>
            
        </dir>
    
</dir>

<p>В некоторых случаях, вы можете
заметить, что по какой-либо причине
ваша очередь застряла. Вы можете
ускорить очередь, используя флаг <b>-q</b>
(без значения). При этом очень
интересно использовать флаг <b>-v</b>
(verbose), чтобы посмотреть, что будет
происходить:</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail -q -v </font>
        </dir>
    
</dir>

<p>Вы также можете ограничить
количество работ с определенным
идентификатором очереди,
отправителем или получателем,
используя один из модификаторов
очереди. Например, &quot;-qRberkeley&quot;
ограничит работу по обработке
очереди только сообщениями со
строчкой &quot;berkeley&quot; в любом из
адресов получателей. Точно также,
&quot;-qSstring&quot; ограничит обработку
сообщениями с определенными
отправителями, а &quot;-qIstring&quot;
ограничит ее конкретными
идентификаторами очереди.</p>

<dir>
    <dir>
            <a name="toc34"></a><b>3.4. Отладка</b>
        </dir>
    
</dir>

<p>Существует большое количество
втроенных в sendmail флагов отладки.
Каждый флаг отладки имеет номер и
уровень, где большие уровни
означают большее количество
выдаваемой информации. Существует
соглашение, что уровни выше
девятого &quot;абсурдны&quot;, то есть,
они выдают так много информации,
что обычно вы ее даже не захотите
увидеть, за исключение отладки
конкретного куска кода. Флаги
отладки выставляются опцией <b>-d</b>;
синтаксис таков:</p>

<table border="0" cellpadding="7" cellspacing="0" width="624">
    <tr>
        <td valign="top" width="30%">debug-flag: </td>
        <td valign="top" width="70%"><b>-d</b> debug-list </td>
    </tr>
    <tr>
        <td valign="top" width="30%">debug-list: </td>
        <td valign="top" width="70%">debug-option [ ,
        debug-option ]* </td>
    </tr>
    <tr>
        <td valign="top" width="30%">debug-option: </td>
        <td valign="top" width="70%">debug-range [ . debug-level
        ] </td>
    </tr>
    <tr>
        <td valign="top" width="30%">debug-range: </td>
        <td valign="top" width="70%">integer | integer - integer </td>
    </tr>
    <tr>
        <td valign="top" width="30%">debug-level: </td>
        <td valign="top" width="70%">integer </td>
    </tr>
</table>

<p>где пробелы используются только
для облегчения чтения. Например,</p>

<table border="0" cellpadding="7" cellspacing="0" width="624">
    <tr>
        <td valign="top" width="30%">-d12 </td>
        <td valign="top" width="70%">Выставляет
        флаг 12 на уровень 1 </td>
    </tr>
    <tr>
        <td valign="top" width="30%">-d12.3 </td>
        <td valign="top" width="70%">Выставляет
        флаг 12 на уровень 3 </td>
    </tr>
    <tr>
        <td valign="top" width="30%">-d3-17 </td>
        <td valign="top" width="70%">Выставляет
        флаги с 3 по 17 на уровень1 </td>
    </tr>
    <tr>
        <td valign="top" width="30%">-d3-17.4 </td>
        <td valign="top" width="70%">Выставляет
        флаги с 3 по 17 на уровень 4 </td>
    </tr>
</table>

<p>Для полного списка доступных
отладочных флагов, вы должны
посмотреть в исходный код (они
слишком динамичны, чтобы быть
отраженными в этой документации).</p>

<dir>
    <dir>
            <a name="toc35"></a><b>3.5.
                Изменение Значений Опций</b>
        </dir>
    
</dir>

<p>Опции могут быть преодолены
использованием в командной строке
флагов <b>-o</b> или <b>-O</b>. Например,</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail -oT2m </font>
        </dir>
    
</dir>

<p>выставляет опцию <b>T</b> (таймаут) на
две минуты только для этого
запуска; эквивалентная строка,
использующая длинное имя опции
такова:</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail
                -OTimeout.queuereturn=2m </font>
        </dir>
    
</dir>

<p>Некоторые опции имеют
ограничения по безопасности. Sendmail
позволяет вам выставить их, но с
этого момента убирает свои
пермиссии смены uid на root <a name="b1"></a><a
href="sendmail3.html#r1"><sup>1</sup></a>.</p>

<dir>
    <dir>
            <a name="toc36"></a><b>3.6.
                Использование Другого
                Файла Конфигурации</b>
        </dir>
    
</dir>

<p>Альтернативный файл конфинурации
может быть определен флагом <b>-C</b>;
например,</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail
                -Ctest.cf -oQ/tmp/mqueue </font>
        </dir>
    
</dir>

<p>использует файл конфигурации test.cf
вместо обычного /etc/sendmail.cf. Если флаг
<b>-C</b> не имеет значения, то по
умолчанию он использует файл sendmail.cf
в текущем каталоге.</p>

<p>Когда вы используете этот флаг,
sendmail не использует пермиссии смены
uid на root, поэтому обычно, во время
тестирования, для каталога
подкачки используют каталог,
который открыт всем на запись (типа
/tmp) (опция QueueDirectory или Q).</p>

<dir>
    <dir>
            <a name="toc37"></a><b>3.7.
                Протоколирование Траффика</b>
        </dir>
    
</dir>

<p>Многие реализации SMTP не полностью
реализуют протокол. Например,
некоторые SMTP для персональных
компьютеров не понимают
строк-продолжений в кодах возврата.
Это может быть очень трудно
отследить. Если вы подозреваете
такую проблему, вы можете включить
протоколирование траффика,
используя флаг <b>-X</b>. Например,</p>

<dir>
    <dir>
            <font color="#008000">/usr/sbin/sendmail -X
                /tmp/traffic -bd </font>
        </dir>
    
</dir>

<p>будет вести протокол всего
траффика в файле /tmp/traffic.</p>

<p>Это протоколирует большое
количество данных очень быстро, и
при нормальной работе вы <b>НИКОГДА</b>
не должны ее использовать. После
запуска такого демона, заставьте
странную реализацию послать
сообщение на ваш хост. Весь траффик
сообщений из и в sendmail, включая
входящий траффик SMTP, будет
запротоколирован в этом файле.</p>

<dir>
    <dir>
            <a name="toc38"></a><b>3.8.
                Тестирование Файлов
                Конфигурации</b>
        </dir>
    
</dir>

<p>При построениии таблицы
конфигурации, вы можете произвести
некоторое тестирование, используя
&quot;тестовый режим&quot; sendmail.
Например, вы можете запустить sendmail
так:</p>

<dir>
    <dir>
            <font color="#008000">sendmail -bt -Ctest.cf </font>
        </dir>
    
</dir>

<p>что заставит sendmail прочитать файл
конфигурации &quot;test.cf&quot; и войти в
тестовый режим. В этом режиме, вы
вводите строки типа:</p>

<dir>
    <dir>
            <font color="#008000">rwset address</font>
        </dir>
    
</dir>

<p>где rwset - набор правил перезаписи,
который вы хотите использовать, а
address - это адрес, к которому вы
хотите его применить. Тестовый
режим покажет вам шаги при
обработке, показав в конце
окончательно полученный адрес. Вы
можете использовать список правил
перезаписи, разделенный запятыми,
для последовательного применения
на входе. Например:</p>

<dir>
    <dir>
            <font color="#008000">3,1,21,4 monet:bollard </font>
        </dir>
    
</dir>

<p>сначала применит набор правил три
на адрес &quot;monet:bollard.&quot; Затем к
выходу набора правил три будет
применен набор правил один, затем
точно также наборы правил двадцать
один и четыре.</p>

<p>Если вам нужна большая
детализация, вы можете также
использовать флаг &quot;-d21&quot; для
включения режима отладки. Например,</p>

<dir>
    <dir>
            <font color="#008000">sendmail -bt -d21.99 </font>
        </dir>
    
</dir>

<p>включит невероятное количество
информации; адрес из одного слова
может выдать в результате
несколько страниц нужной
информации.</p>

<p>Необходимо предупредить, что
внутренне sendmail применяет набор
правил 3 ко всем адресам. В тестовом
режиме, вы должны делать это
вручную. Например, старые версии
позволяли вам использовать</p>

<dir>
    <dir>
            <font color="#008000">0 bruce@broadcast.sony.com </font>
        </dir>
    
</dir>

<p>Эта версия требует, чтобы вы
использовали:</p>

<dir>
    <dir>
            <font color="#008000">3,0
                bruce@broadcast.sony.com </font>
        </dir>
    
</dir>

<p>Начиная с версии 8.7, в тестовом
режиме стали доступны и некоторые
другие вещи:</p>

<table border="0" cellpadding="7" cellspacing="0" width="624">
    <tr>
        <td valign="top" width="40%">+<b>o</b>
        .Dxзначение </td>
        <td valign="top" width="60%">Указывает
        макросу x иметь указанное
        значение. Это полезно, когда
        отлаживаемые правила
        используют синтаксис <b>$&amp;</b>x. </td>
    </tr>
    <tr>
        <td valign="top" width="40%">+<b>o</b>
        .Ccзначение </td>
        <td valign="top" width="60%">Добавляет
        указанное значение к классу c. </td>
    </tr>
    <tr>
        <td valign="top" width="40%">+<b>o</b>
        .Sнабор_правил </td>
        <td valign="top" width="60%">Распечатывает
        содержимое указанного набора
        правил. </td>
    </tr>
    <tr>
        <td valign="top" width="40%">+<b>o</b> -ddebug-spec </td>
        <td valign="top" width="60%">Эквивалентно
        флагу командной строки. </td>
    </tr>
</table>

<dir>
    <dir>
            <a name="toc39"></a><b>3.9.
                Существующая Информация о
                Статусе Хоста</b>
        </dir>
    
</dir>

<p>При включенном <b>HostStatusDirectory</b>,
информация о статусе хостов
находится на диске, и поэтому может
быть использована одновременно
несколькими процессами sendmail.
Статус последнего соединения с
каждым удаленным хостом может быть
просмотрен командой:</p>

<dir>
    <dir>
            <font color="#008000">sendmail -bh </font>
        </dir>
    
</dir>

<p>Эта информация может быть
обнулена командой:</p>

<dir>
    <dir>
            <font color="#008000">sendmail -bH </font>
        </dir>
    
</dir>

<p>Опустошение информации
предотвращает ее загрузку новыми
процессами sendmail, но не обнуляет уже
имеющуюся у запущенных процессов
информацию о статусе.</p>

<hr>

<p><a name="r1"><font size="-1"></a>
1. То есть, он выставляет свой
эффективный uid соответственно
настоящему uid; таким образом, если
вы запускаете его как root, или из
root'овского файла crontab, или во время
запуска системы, пермиссии root будут
учтены. <a href="sendmail3.html#b1">[назад]</a></p>
</body>
</html>
