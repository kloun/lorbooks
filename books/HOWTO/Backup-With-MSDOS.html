<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Мини-HOWTO: Резервное копирование при помощи MS-DOS</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Мини-HOWTO: Резервное копирование при помощи MS-DOS</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Christopher Neufeld</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;     neufeld@physics.utoronto.ca
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
> Перевод: <A
HREF="mailto:denm@asp-linux.com"
TARGET="_top"
>Денис Дементьев</A
>,
 <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>5 августа 1997 года<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>В этом документе содержится информация о том, как использовать совместимый
с Linux ленточный накопитель, установленный на машине с MS-DOS, для
резервного копирования файловых систем Linux.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Backup-With-MSDOS.html#AEN17"
>Предыстория/вступление</A
></DT
><DT
>2. <A
HREF="Backup-With-MSDOS.html#AEN22"
>Процедура</A
></DT
><DT
>3. <A
HREF="Backup-With-MSDOS.html#AEN161"
>Замечания</A
></DT
><DT
>4. <A
HREF="Backup-With-MSDOS.html#AEN176"
>Copyright</A
></DT
><DT
>5. <A
HREF="Backup-With-MSDOS.html#AEN182"
>Авторские права</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN17"
>1. Предыстория/вступление</A
></H1
><P
>&#13;В свое время я спросил в сети, как можно копировать данные Linux на
ленточный накопитель Colorado Jumbo 250, установленный на машину с MS-DOS.
Судя по количеству полученной мной почты, этот вопрос возникал у многих.
Поэтому, справившись с этой проблемой, я посылаю ее решение. Если
кто-нибудь желает доработать этот документ до HOWTO,  дайте мне знать. Я
должен поблагодарить Jim Nance (<A
HREF="mailto:jlnance@isscad.com"
TARGET="_top"
>jlnance@isscad.com</A
>), указавшего мне, что машина, работающая под
MS-DOS, не обязана всегда работать под MS-DOS. Приведенная методика должна
также работать для любых ленточных накопителей, поддерживаемых модулем
ftape и для ленточных накопителей SCSI. В последнем случае нужно лишь
заменить /dev/ftape на, к примеру, /dev/st0.</P
><P
>Я руководствовался следующими критериями: конечная установка должна быть,
как можно более защищенной, но, в то же время, довольно простой; она должна
занимать как можно меньше места на жестком диске компьютера, работающего
под MS-DOS; должна существовать возможность восстановления данных, даже в
случае очень серьезных повреждений, вплоть до кражи жесткого диска, то есть,
возможность полного копирования данных на пустой раздел. Описанная здесь
методика позволяет вообще не использовать дисковое пространство машины,
работающей под MS-DOS, но для нее требуется выделить IP адрес. Также вам
понадобятся три чистых, отформатированных 1.44Мб дискеты.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN22"
>2. Процедура</A
></H1
><P
>В этом документе я использовал для машин имена "<TT
CLASS="LITERAL"
>msdos</TT
>" и "<TT
CLASS="LITERAL"
>linux</TT
>". "<TT
CLASS="LITERAL"
>msdos</TT
>" -
это имя машины с ленточным накопителем, обычно работающей под MS-DOS.
"<TT
CLASS="LITERAL"
>linux</TT
>" - имя машины, работающей под Linux, чьи диски нужно копировать на
ленточный накопитель или с него. Для простоты я всегда называл первую
машину "<TT
CLASS="LITERAL"
>msdos</TT
>", даже если она в данный момент работала под Linux. Более
того, все пути в этом документе указаны относительно Linux машины с
подключенными в систему SAR (Search-And-Rescue - Поиск-И-Спасение) дисками.
То есть, файл паролей с жесткого диска вашего Linux компьютера будет
<TT
CLASS="LITERAL"
>/etc/passwd</TT
>, а, к примеру, соответствующий файл на флоппи диске будет
<TT
CLASS="LITERAL"
>/tape144/etc/passwd</TT
>.</P
><P
>Я пользуюсь скриптами для резервного копирования Карела Кьюбата (Karel Kubat) версии 1.03, их можно найти на

<PRE
CLASS="SCREEN"
><A
HREF="ftp://sunsite.enc.edu:/pub/Linux/system/Backup/backup-1.03.tar.gz"
TARGET="_top"
>ftp://sunsite.enc.edu:/pub/Linux/system/Backup/backup-1.03.tar.gz</A
></PRE
>
В этом документе я буду называть их просто - "<TT
CLASS="LITERAL"
>скрипты копирования</TT
>". Вам не
обязательно использовать именно их. Лично я предпочитаю пользоваться ими,
потому что они используют afio для создания несжатого архива сжатых файлов,
вместо сжатого архива несжатых файлов. Первое намного безопасней, в случае
ошибки чтения с носителя во время восстановления. Я понимаю, что Карел
больше не сопровождает backup, а вместо этого написал "tob" (tape oriented
backup). Работа с новым пакетом не должна значительно отличаться от
описанной ниже, хотя я сам не пробовал его..</P
><P
>Прежде всего скачайте модуль ftape. Он входит в комплект всех современных
ядер, но если вы используете старое, то можете найти модуль по адресу
<PRE
CLASS="SCREEN"
><A
HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/tapes/ftape-2.05.tar.gz"
TARGET="_top"
>ftp://sunsite.unc.edu/pub/Linux/kernel/tapes/ftape-2.05.tar.gz</A
></PRE
>
Далее найдите образы загрузочного диска Slackware (я нашел сетевой диск,
что, впрочем, не столь важно) и корневого диска <TT
CLASS="LITERAL"
>tape144</TT
>, и запишите их на флоппи-диски.</P
><P
>Модуль <TT
CLASS="LITERAL"
>ftape</TT
> будет работать только с ядром,
под которым был собран. Я не смог заставить работать модуль <TT
CLASS="LITERAL"
>ftape.o</TT
> с корневого <TT
CLASS="LITERAL"
>tape144</TT
> диска. Я думаю, что это произошло потому, что
из него была вырезана символьная информация, из-за чего он не
устанавливался. Так что вам придется собрать новое ядро, с поддержкой сети и
<TT
CLASS="LITERAL"
>ftape</TT
>. Если вы используете старое ядро, то
придется собирать и новый <TT
CLASS="LITERAL"
>ftape.o</TT
>. Почитайте
указания, поставляемые вместе с архивом <TT
CLASS="LITERAL"
>ftape</TT
>. Не забывайте, что должны поддерживаться сетевые
карты как машины с Linux, так и машины с MS-DOS.</P
><P
>Скопируйте вновь созданное ядро поверх старого на сетевой загрузочный диск.
Для этого воспользуйтесь командой <TT
CLASS="LITERAL"
>/bin/cp</TT
>. Не используйте команду "<TT
CLASS="LITERAL"
>dd</TT
>", так
как в этом случае вы просто создадите загрузочный образ ядра. Защитите диск
от записи и пометьте его, как SAR#1.</P
><P
>Теперь подключите корневой <TT
CLASS="LITERAL"
>tape144</TT
> диск. Во
избежание неразберихи с именами файлов, я буду считать, что диск
подключается в каталог <TT
CLASS="LITERAL"
>/tape144</TT
>. На нем нам
понадобится дополнительное место, поэтому удаляем следующие файлы:

<PRE
CLASS="SCREEN"
>/tape144/bin/dialog
/tape144/bin/elvis
/tape144/bin/vi
/tape144/boot/ftape.o</PRE
>&#13;</P
><P
>Теперь создаем новый файл: 

<PRE
CLASS="SCREEN"
>/tape144/etc/exports</PRE
>

содержащий следующую строку: 

<PRE
CLASS="SCREEN"
>/mnt    msdos(ro)</PRE
>
где "<TT
CLASS="LITERAL"
>msdos</TT
>" нужно заменить на имя или IP адрес MS-DOS машины, к которой подключен ленточный накопитель.</P
><P
>Далее, чтобы не зависеть от DNS-сервера, добавьте в файл <TT
CLASS="LITERAL"
>/tape144/etc/hosts</TT
>
строки с именами и IP-адресами машин с Linux и MS-DOS. Мой, например,
выглядит так:
<PRE
CLASS="SCREEN"
>128.100.75.114  caliban.physics.utoronto.ca caliban caliban.physics
128.100.75.111  ariel.physics.utoronto.ca ariel ariel.physics</PRE
>&#13;</P
><P
>Теперь исправим небольшую проблему с конфигурацией inetd - для демона rsh
нужно прописать полный путь. Измените строку 19 файла
<TT
CLASS="LITERAL"
>/tape144/etc/inetd.conf</TT
> на:
<PRE
CLASS="SCREEN"
>shell   stream  tcp     nowait  root    /usr/etc/tcpd   /usr/etc/in.rshd</PRE
>&#13;</P
><P
>Добавьте информацию о локальной сети в файл <TT
CLASS="LITERAL"
>/tape144/etc/rc.d/rc.inet1</TT
>,
чтобы MS-DOS-машина могла с ней работать. Формат зависит от конфигурации
вашей сети, можете просто скопировать соответствующие строки из файла
<TT
CLASS="LITERAL"
>/etc/rc.d/rc.inet1</TT
> с вашей Linux машины. Для моей сети нужно было добавить
такие строки:
<PRE
CLASS="SCREEN"
>/etc/ifconfig eth0 128.100.75.111 broadcast 128.100.75.0 netmask 255.255.255.0
/etc/route add -net 128.100.75.0 netmask 255.255.255.0</PRE
>

IP адрес из строки с ifconfig - это адрес MS-DOS машины. </P
><P
>Теперь скопируйте этот файл в <TT
CLASS="LITERAL"
>/tape144/etc/rc.d/rc.inet1-l</TT
>
и измените в новом файле IP адрес на соответствующий Linux машине (а не MS-DOS).&#13;</P
><P
>Далее удалите строки с 3 по 11 из <TT
CLASS="LITERAL"
>/tape144/etc/rc.local</TT
>. Это оператор if,
запускающий файлы <TT
CLASS="LITERAL"
>rc.inet*</TT
>. Во время загрузки нам это не нужно.&#13;</P
><P
>Создайте новый файл: <TT
CLASS="LITERAL"
>/tape144/root/.rhosts</TT
>, содержащий строку:

<PRE
CLASS="SCREEN"
>linux root</PRE
>
где, опять таки, "<TT
CLASS="LITERAL"
>linux</TT
>" нужно заменить на полное имя (включая домен) или IP адрес Linux машины.</P
><P
>Заполните поле пароля в <TT
CLASS="LITERAL"
>/tape144/etc/passwd</TT
> для root, чтобы никто не мог
зайти в систему в то время, когда вы копируете информацию на ленточный
накопитель. Это можно сделать, скопировав соответствующее поле из файла
<TT
CLASS="LITERAL"
>/etc/passwd file</TT
> file c вашей Linux машины.</P
><P
>Скопируйте /usr/bin/rsh в /tape144/usr/bin.</P
><P
>Скопируйте следующие файлы из <TT
CLASS="LITERAL"
>/usr/etc</TT
> в <TT
CLASS="LITERAL"
>/tape144/usr/etc</TT
>:

<PRE
CLASS="SCREEN"
>in.rshd
rpc.mountd
rpc.nfsd
rpc.portmap
services
tcpd</PRE
>&#13;</P
><P
>Создайте новый скрипт <TT
CLASS="LITERAL"
>/tape144/bin/tapesetup</TT
>, состоящий из следующих строк
("<TT
CLASS="LITERAL"
>linux</TT
>" замените на имя вашей Linux машины).
<PRE
CLASS="SCREEN"
>#! /bin/sh

/bin/sh /etc/rc.d/rc.inet1
/bin/sh /etc/rc.d/rc.inet2

/bin/mount linux:/nfs /mnt
/bin/insmod /mnt/ftape.o</PRE
>

Обратите внимание на то, что ядра новых версий не требуют строки insmod. </P
><P
>Далее создайте другой скрипт, <TT
CLASS="LITERAL"
>/tape144/bin/msdosset</TT
> (сменив "<TT
CLASS="LITERAL"
>linux</TT
>" на имя вашей Linux машины):
<PRE
CLASS="SCREEN"
>#! /bin/sh 

/bin/sh /etc/rc.d/rc.inet1
/bin/sh /etc/rc.d/rc.inet2

mount linux:/mnt /mnt
/bin/insmod /mnt/ftape.o</PRE
>

Как и в предыдущем случае, ядра новых версий не требуют строки insmod. </P
><P
>Создайте файл <TT
CLASS="LITERAL"
>/tape144/root/notes</TT
>, доступный для чтения и содержащий
полезную информацию о восстановлении файлов:
<PRE
CLASS="SCREEN"
>Для полного восстановления жесткого диска загрузитесь
на Linux машине с дисков SAR #1 и #2, затем наберите
следующее:

== /bin/sh /etc/rc.d/rc.inet1-l
== /bin/sh /etc/rc.d/rc.inet2

== /usr/etc/rpc.portmap
== /usr/etc/rpc.mountd
== /usr/etc/rpc.nfsd

Затем вставьте диск SAR#3 и наберите:

== mount /dev/fd0 /mnt

Создайте новый каталог для подключения файловой системы:

== mkdir /mnt2

и подключите в него раздел вашего жесткого диска.
Возможно понадобится предварительно отформатировать раздел -
следуйте указазниям из Linux Installation HOWTO.
SAR диски содержат все необходимое для форматирования.

Воспользуйтесь дисками SAR#1 и SAR#2 для загрузки на MS-DOS машине
и запустите скрипт /bin/msdosset. Скрипт берет NFS файл с дискеты,
что займет какое-то время, потерпите.
Затем скопируйте файлы с ленты в /mnt2 на Linux машине.</PRE
>&#13;</P
><P
>Если вы используете для копирования скрипты, то скопируйте "afio" в
подкаталог <TT
CLASS="LITERAL"
>/tape144/local/bin</TT
>. Не обязательно держать остальные файлы,
используемые скриптами, на SAR дисках - архив может быть восстановлен, с
помощью лишь "afio" и "gzip".</P
><P
>Я не смог воспользоваться скриптами в том виде, в котором они поставлялись.
Архив на ленте вроде бы создавался нормально, но что-либо восстановить из
него не удавалось. Я обнаружил, что если убрать размер блока и
преобразующие операторы, то все работает нормально. Вот патч для скрипта
"<TT
CLASS="LITERAL"
>netbackup</TT
>". Используйте его как для копии на Linux машине, так и для копии SAR дисков.
<PRE
CLASS="SCREEN"
>*** netbackup.orig===== Mon Jan= 9 17:22:32 1995
--- netbackup== Mon Jan= 9 17:23:25 1995
***************
*** 35,41 ****
================= "'mknod", devname, "p'");
===== exec ("su -", USERNAME, "-c",
================= "'rsh ", REMOTE_HOST,=
!====================== "\"dd", "of=" REMOTE_DEVICE, "obs=20k", "conv=sync\"",
======================= "&#60;", devname,
=============== "'&amp;"
======== );
--- 35,41 ----
================= "'mknod", devname, "p'");
===== exec ("su -", USERNAME, "-c",
================= "'rsh ", REMOTE_HOST,=
!====================== "\"dd", "of=" REMOTE_DEVICE, "\"",
======================= "&#60;", devname,
=============== "'&amp;"
======== );
***************
*** 50,56 ****
================= "'mknod", devname, "p'");
===== exec ("su", USERNAME, "-c",=
================= "'rsh ", REMOTE_HOST,=
!====================== "\"dd", "if=" REMOTE_DEVICE, "ibs=20k", "conv=sync\"",
======================= "&#62;", devname,
=============== "'&amp;"
======== );
--- 50,56 ----
================= "'mknod", devname, "p'");
===== exec ("su", USERNAME, "-c",=
================= "'rsh ", REMOTE_HOST,=
!====================== "\"dd", "if=" REMOTE_DEVICE, "\"",
======================= "&#62;", devname,
=============== "'&amp;"
======== );
  
&#13;</PRE
>&#13;</P
><P
>Итак, вы закончили с диском SAR #2. Защитите его от записи. </P
><P
>Подключите чистый отформатированный диск (создайте его с помощью <TT
CLASS="LITERAL"
>fdformat</TT
> и <TT
CLASS="LITERAL"
>mkfs</TT
>).
Скопируйте на него <TT
CLASS="LITERAL"
>ftape.o</TT
> и пометьте его
SAR#3. Оставьте его открытым для записи, так как если его защитить от
записи, то по какой-то причине возникают ошибки.</P
><P
>На Linux машине создайте каталог для работы NFS. Я создал каталог

<PRE
CLASS="SCREEN"
>/nfs</PRE
>
Запишите в него <TT
CLASS="LITERAL"
>ftape.o</TT
> (необрезанный, около 500+ Кб). Добавьте строку в файл <TT
CLASS="LITERAL"
>/etc/exports</TT
>: 
<PRE
CLASS="SCREEN"
>/nfs    msdos(ro)</PRE
>
Обратите внимание на то, что файлы в вашем NFS каталоге и его подкаталогах
не защищены. Кто-нибудь может загрузить со своих собственных дисков Linux
на MS-DOS машине и подключить этот каталог, так что не храните в нем ничего
важного. Перезапустите NFS демоны rpc.mountd и rpc.nfsd. Так как они не
перезапускаются по SIGHUP, просто убейте их командой kill и запустите
снова. Если они не запускаются автоматически из /etc/rc.d/rc.inet2, можно
включить их туда сейчас.</P
><P
>OK, теперь у нас все настроено для резервного копирования и восстановления.
Загрузите MS-DOS машину с диска SAR#1. Затем, когда появится
соответствующее приглашение, загрузите диск SAR#2. Войдите в систему
root-ом и запустите <TT
CLASS="LITERAL"
>/bin/tapesetup</TT
>. Выйдите из системы. Если вы используете
скрипты для резервного копирования, то команда netbackup теперь должна
работать. Можно также воспользоваться ключом "<TT
CLASS="LITERAL"
>-f msdos:/dev/ftape</TT
>" команд
<TT
CLASS="LITERAL"
>tar</TT
>, <TT
CLASS="LITERAL"
>cpio</TT
>, или <TT
CLASS="LITERAL"
>mt</TT
>. Если у вас есть программа резервного копирования,
работающая только с локальными файлами, попробуйте следующее. Предположим,
программа называется "<TT
CLASS="LITERAL"
>localbackup</TT
>" и записывает в файл, указываемый в
командной строке в качестве аргумента:
<PRE
CLASS="SCREEN"
>&#13;mknod /tmp/tapepipe p
rsh msdos dd of=/dev/ftape &#60; /tmp/tapepipe &amp;
localbackup /tmp/tapepipe</PRE
>

После окончания копирования копирования удалите  <TT
CLASS="LITERAL"
>/tmp/tapepipe</TT
>.</P
><P
>Восстановление на работающий Linux: скрипт <TT
CLASS="LITERAL"
>netbackup</TT
>, <TT
CLASS="LITERAL"
>tar</TT
>, <TT
CLASS="LITERAL"
>cpio</TT
> и тому
подобные утилиты работают без каких-либо специальных действий со стороны
оператора. Если у вас программа восстановления из локального файла,
попробуйте следующее:
<PRE
CLASS="SCREEN"
>mknod /tmp/tapepipe p
rsh -n msdos dd if=/dev/ftape &#62;&#62; /tmp/tapepipe &amp;
localrecovery /tmp/tapepipe</PRE
>

После окончания копирования удалите <TT
CLASS="LITERAL"
>/tmp/tapepipe</TT
>.</P
><P
>Заметьте, что я использую "<TT
CLASS="LITERAL"
>rsh</TT
>" для входа
пользователем root на MS-DOS машину. Для этого требуется правильный
<TT
CLASS="LITERAL"
>.rhosts</TT
>. Конфигурация на диске "<TT
CLASS="LITERAL"
>tape144</TT
>" позволяет выполнять <TT
CLASS="LITERAL"
>rsh</TT
> root-ом, но не дает зайти root-ом, с помощью
<TT
CLASS="LITERAL"
>telnet</TT
> или <TT
CLASS="LITERAL"
>rlogin</TT
> - входы в систему разрешены только с консоли.
Это хорошо для безопасности.</P
><P
>Если вам не нравится root-овый файл <TT
CLASS="LITERAL"
>.rhost</TT
>,
то можно создать нового пользователя "tapeuser" на диске SAR#2, разрешив
ему работу с ленточным накопителем, но запретив работу с дисками (создайте
новую группу и включите в нее <TT
CLASS="LITERAL"
>tapeuser</TT
>, затем
выполните команды <TT
CLASS="LITERAL"
>chown</TT
> и <TT
CLASS="LITERAL"
>chmod</TT
> для файлов <TT
CLASS="LITERAL"
>/dev/rft*</TT
> и <TT
CLASS="LITERAL"
>/dev/nrft*</TT
>).
При этом ваша программа резервного копирования должна выполнять <TT
CLASS="LITERAL"
>rsh</TT
> на этого пользователя, а не на root. Само собой,
должен существовать файл <TT
CLASS="LITERAL"
>.rhost</TT
> в каталоге
<TT
CLASS="LITERAL"
>&tilde;tapeuser</TT
> на SAR#2. Я сделал именно
так.</P
><P
>Наконец, указания по полному восстановлению отказавшего жесткого диска.
Предполагается, что раздел Linux не подлежит восстановлению. Если
требуется, переформатируйте раздел, как описано в Linux Installation HOWTO.
Загрузите Linux с SAR disk #1. Когда потребуется, вставьте диск #2. Далее
следуйте указаниям из файла <TT
CLASS="LITERAL"
>/root/notes</TT
> (ранее я ссылался на него, как на
<TT
CLASS="LITERAL"
>/tape144/root/notes</TT
>). После загрузки обеих машин запустите используемую
вами команду восстановления. Если вы используете скрипты для резервного
копирования, то это можно сделать так:
<P
></P
><OL
TYPE="1"
><LI
><P
>перейдите в каталог, в который подключается восстанавливаемый раздел жесткого диска. </P
></LI
><LI
><P
>если на накопителе есть подключаемые разделы, и вы хотите восстановить их, то создайте на разделе жесткого диска точки подключения (mount points) и подключите их. </P
></LI
><LI
><P
>Введите команду: 

<PRE
CLASS="SCREEN"
>rsh -n msdos dd if=/dev/ftape | afio -i -v -Z -c 1024 -
        </PRE
>

или

<PRE
CLASS="SCREEN"
>rsh -n -l tapeuser msdos dd if=/dev/ftape | afio -i -v -Z -c 1024 -
        </PRE
>

или

<PRE
CLASS="SCREEN"
>mknod /tmp/backpipe p
rsh -n msdos dd if=/dev/ftape &#62;&#62; /tmp/backpipe &amp;
afio -i -v -Z -c 1024 /tmp/backpipe
        </PRE
>&#13;</P
></LI
></OL
>
При этом данные считываются с ленточного накопителя на удаленной машине и
выводятся на стандартный выход, где их берет <TT
CLASS="LITERAL"
>afio</TT
>. Ключ "'<TT
CLASS="LITERAL"
>-i</TT
>"'указывает, восстанавливать файлы относительно
текущего каталога (в данный момент корневой каталог восстанавливаемого
раздела), "<TT
CLASS="LITERAL"
>-v</TT
>" - подробный вывод (список
восстанавливаемых фалов), "'<TT
CLASS="LITERAL"
>-Z</TT
>" - указывает
afio, что архив состоит из отдельно сжатых файлов, "<TT
CLASS="LITERAL"
>-c
1024</TT
>" - указывает использовать 5 Мб потоковый буфер для избежания
излишней перемотки ленты.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN161"
>3. Замечания</A
></H1
><P
>Команды, перечисленные в <TT
CLASS="LITERAL"
>/tape144/root/notes</TT
>,
могут выполняться скриптом. Когда я пробовал написать его, то получал ошибки
rpc. Думаю, что это происходило из-за того, что команды запускались слишком
быстро, и portmapper не загружался тогда, когда было необходимо. Если я
вводил команды с клавиатуры, то все работало, поэтому я рекомендую, так и
делать.</P
><P
>Думаю, что, с точки зрения безопасности данных, все нормально. Заметьте, что
несмотря на это, можно получить доступ к вашим файлам, вытащив кассету до
того, как вы сделаете это, и прочитав ее в другом месте. Если ваши данные
важны, шифруйте их - архивируйте на стандартный вывод и перенаправляйте его
на вход программы шифрования, а вывод программы шифрования на канал
<TT
CLASS="LITERAL"
>/tmp/tapepipe</TT
>, как описано выше. При этом помните, что, в случае ошибок при
копировании, данные не подлежат восстановлению, так как весь архив
превращается в один поток, зашифрованный DES. С помощью ключей afio можно
указать, сперва упаковывать файл gzip-ом, а затем посылать его программе
шифрования, но при этом появляется довольно много чистого текста, с которым
могут поработать взломщики, так что лучше вообще не использовать gzip и
просто шифровать данные (цена - место на ленте). Думаю, не нужно
напоминать, что шифрованные DES файлы не сжимаются.</P
><P
>Указания, касающиеся <TT
CLASS="LITERAL"
>rc.inet1</TT
>, позволяют работать только с локальной сетью
(а не с остальным миром через шлюз).</P
><P
>Для полного восстановления на чистый жесткий диск MS-DOS машине понадобится
SAR disk #3 с <TT
CLASS="LITERAL"
>ftape.o</TT
>, подключаемый через NFS из-за того, что некоторые
старые модули <TT
CLASS="LITERAL"
>ftape</TT
> не могут управлять некоторыми ленточными накопителями
при подключенном флоппи-диске. С новыми ядрами можно не устанавливать NFS.</P
><P
><I
CLASS="EMPHASIS"
>Это очень важно. ***ПРОВЕРЬТЕ***</I
> процедуру восстановления с SAR дисков. Я,
конечно, проверял, но лучше убедиться, хотя бы на примере восстановления
одного файла с использованием только дисков SAR (то есть, без подключения
жесткого диска) . Если это невозможно сделать, по причине работы в системе
множества пользователей, то подправьте настройки на SAR дисках, временно
сменив "<TT
CLASS="LITERAL"
>linux</TT
>" на имя другой MS-DOS машины, загрузитесь на двух машинах с
MS-DOS и проверьте. Затем смените имя обратно на "<TT
CLASS="LITERAL"
>linux</TT
>".</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN176"
>4. Copyright</A
></H1
><P
>Copyright Jan 10, 1995 by Christopher Neufeld
(<A
HREF="mailto:neufeld@physics.utoronto.ca"
TARGET="_top"
>neufeld@physics.utoronto.ca</A
>)</P
><P
>Изменен 6 февраля, 1996.</P
><P
>Изменен 5 августа, 1997.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN182"
>5. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
></DIV
></BODY
></HTML
>