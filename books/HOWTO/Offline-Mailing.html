<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Работа с почтой в Linux в автономном режиме</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Работа с почтой в Linux в автономном режиме</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Gunther Voet</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;     freaker@tuc.ml.org
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
> Перевод: <A
HREF="mailto:ave@asp-linux.com"
TARGET="_top"
>Александр Ермолаев</A
>,
 <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>v1.3.3, 4 June 1998<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>Используйте вашу почтовую систему в автономном режиме, получите почту для
нескольких пользователей, имея только один почтовый ящик, без
круглосуточного подключения к сети. Если вы не можете платить за постоянное
круглосуточное подключение к сети, а пользователи хотят получать почту,
используя ваш почтовый ящик; и вы не хотите платить за несколько почтовых
ящиков вашему провайдеру, то  используйте  эту систему, имея только
один почтовый адрес для нескольких почтовых ящиков ваших пользователей. Он
будет круглосуточно доступен на сервере, где на вашу учетную запись будет
приходить почта.

<A
HREF="Offline-Mailing.html#COPYRIGHT"
>Разд. 1.2</A
></P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Offline-Mailing.html#AEN18"
>Примечания автора (предисловие)</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="Offline-Mailing.html#AEN25"
>Ответственность</A
></DT
><DT
>1.2. <A
HREF="Offline-Mailing.html#COPYRIGHT"
>Copyrights</A
></DT
><DT
>1.3. <A
HREF="Offline-Mailing.html#AEN32"
>Авторские права</A
></DT
><DT
>1.4. <A
HREF="Offline-Mailing.html#AEN41"
>Отзывы</A
></DT
><DT
>1.5. <A
HREF="Offline-Mailing.html#AEN45"
>Распространение</A
></DT
><DT
>1.6. <A
HREF="Offline-Mailing.html#AEN56"
>Изменения</A
></DT
><DT
>1.7. <A
HREF="Offline-Mailing.html#AEN59"
>Что я использовал?</A
></DT
><DT
>1.8. <A
HREF="Offline-Mailing.html#AEN63"
>Благодарности...</A
></DT
></DL
></DD
><DT
>2. <A
HREF="Offline-Mailing.html#AEN75"
>Предварительный выбор</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="Offline-Mailing.html#AEN78"
>Предисловие и описание</A
></DT
><DT
>2.2. <A
HREF="Offline-Mailing.html#AEN81"
>Пункты, представляющие интерес ...</A
></DT
><DT
>2.3. <A
HREF="Offline-Mailing.html#AEN99"
>Вещи, которые вы должны знать</A
></DT
><DT
>2.4. <A
HREF="Offline-Mailing.html#AEN119"
>Имеются два разных способа ...</A
></DT
></DL
></DD
><DT
>3. <A
HREF="Offline-Mailing.html#AEN127"
>Требования</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="Offline-Mailing.html#AEN130"
>Компьютер</A
></DT
><DT
>3.2. <A
HREF="Offline-Mailing.html#AEN133"
>Дополнительная учетная запись на вашем компьютере</A
></DT
><DT
>3.3. <A
HREF="Offline-Mailing.html#AEN138"
>Fetchmail</A
></DT
><DT
>3.4. <A
HREF="Offline-Mailing.html#AEN141"
>Procmail</A
></DT
><DT
>3.5. <A
HREF="Offline-Mailing.html#AEN144"
>Почтовая учетная запись</A
></DT
><DD
><DL
><DT
>3.5.1. <A
HREF="Offline-Mailing.html#AEN147"
>DNS запись (MX)</A
></DT
><DT
>3.5.2. <A
HREF="Offline-Mailing.html#AEN150"
>Перенаправление на вашу учетную запись</A
></DT
></DL
></DD
></DL
></DD
><DT
>4. <A
HREF="Offline-Mailing.html#AEN153"
>Я меня все есть, что теперь?</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="Offline-Mailing.html#AEN163"
>Создание файла .fetchmailrc</A
></DT
><DT
>4.2. <A
HREF="Offline-Mailing.html#AEN171"
>Создание файла .procmailrc</A
></DT
><DD
><DL
><DT
>4.2.1. <A
HREF="Offline-Mailing.html#AEN174"
>для способа A</A
></DT
><DT
>4.2.2. <A
HREF="Offline-Mailing.html#AEN181"
>для способа B</A
></DT
></DL
></DD
><DT
>4.3. <A
HREF="Offline-Mailing.html#AEN187"
>файл "nosuchuser"</A
></DT
><DT
>4.4. <A
HREF="Offline-Mailing.html#AEN193"
>файлы "crontab"</A
></DT
><DD
><DL
><DT
>4.4.1. <A
HREF="Offline-Mailing.html#AEN196"
>checkformail</A
></DT
><DT
>4.4.2. <A
HREF="Offline-Mailing.html#AEN203"
>crontab</A
></DT
></DL
></DD
><DT
>4.5. <A
HREF="Offline-Mailing.html#AEN210"
>На сайте администратора</A
></DT
><DD
><DL
><DT
>4.5.1. <A
HREF="Offline-Mailing.html#AEN214"
>(старый sendmail) Добавьте некоторые строки в файл sendmail.cf</A
></DT
><DT
>4.5.2. <A
HREF="Offline-Mailing.html#AEN221"
>(новый sendmail) Добавьте некоторые строки в файл sendmail.cf</A
></DT
><DT
>4.5.3. <A
HREF="Offline-Mailing.html#AEN228"
>(новый sendmail) отредактируйте файл /etc/sendmail.cw (или /ваш_каталог/sendmail.cw)</A
></DT
><DT
>4.5.4. <A
HREF="Offline-Mailing.html#AEN237"
>создание файла /etc/maildomains</A
></DT
><DT
>4.5.5. <A
HREF="Offline-Mailing.html#AEN250"
>пусть работает !</A
></DT
></DL
></DD
></DL
></DD
><DT
>5. <A
HREF="Offline-Mailing.html#AEN255"
>Автоматизация</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="Offline-Mailing.html#AEN258"
>"Каркас (скелет)"</A
></DT
><DD
><DL
><DT
>5.1.1. <A
HREF="Offline-Mailing.html#AEN261"
>Файл .procmailrc-header (заголовок)</A
></DT
><DT
>5.1.2. <A
HREF="Offline-Mailing.html#AEN268"
>Файл .procmailrc-footer (конец)</A
></DT
></DL
></DD
><DT
>5.2. <A
HREF="Offline-Mailing.html#AEN275"
>Скрипт addmail</A
></DT
></DL
></DD
><DT
>6. <A
HREF="Offline-Mailing.html#AEN284"
>Помогите!</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="Offline-Mailing.html#AEN287"
>Скрипт автоматизации не работает:</A
></DT
><DT
>6.2. <A
HREF="Offline-Mailing.html#AEN295"
>Что вы подразумеваете под "анонимным mailserver'ом"?</A
></DT
><DT
>6.3. <A
HREF="Offline-Mailing.html#AEN301"
>Моя кошка сдохла</A
></DT
><DT
>6.4. <A
HREF="Offline-Mailing.html#AEN307"
>Моя собака сдохла</A
></DT
><DT
>6.5. <A
HREF="Offline-Mailing.html#AEN313"
>Linux?</A
></DT
><DT
>6.6. <A
HREF="Offline-Mailing.html#AEN319"
>Вы можете мне помочь, обнаружить почтовую учетную запись?</A
></DT
><DT
>6.7. <A
HREF="Offline-Mailing.html#AEN325"
>Почему, когда я позже делаю некоторые добавления, они оказываются удаленными ?</A
></DT
><DT
>6.8. <A
HREF="Offline-Mailing.html#AEN331"
>Как я могу получить "домен" ?</A
></DT
><DT
>6.9. <A
HREF="Offline-Mailing.html#AEN337"
>Почему вы так "криво" используете это?</A
></DT
><DT
>6.10. <A
HREF="Offline-Mailing.html#AEN343"
>Файл "nosuchuser"?</A
></DT
><DT
>6.11. <A
HREF="Offline-Mailing.html#AEN349"
>Мои пользователи могут писать/посылать почту тоже?</A
></DT
><DT
>6.12. <A
HREF="Offline-Mailing.html#AEN355"
>Необходимо ли каждому пользователю иметь возможность входа в мою систему?</A
></DT
><DT
>6.13. <A
HREF="Offline-Mailing.html#AEN361"
>скелет?</A
></DT
><DT
>6.14. <A
HREF="Offline-Mailing.html#AEN367"
>Addmail?</A
></DT
><DT
>6.15. <A
HREF="Offline-Mailing.html#AEN373"
>Почему ты такой жестокий?</A
></DT
><DT
>6.16. <A
HREF="Offline-Mailing.html#AEN379"
>Разве вы не получали жалоб на свой чрезмерный язык?</A
></DT
><DT
>6.17. <A
HREF="Offline-Mailing.html#AEN385"
>Почему этот howto больше всех отличается от остальных?</A
></DT
><DT
>6.18. <A
HREF="Offline-Mailing.html#AEN391"
>Локально мои домены работают, но удаленно нет</A
></DT
></DL
></DD
><DT
>7. <A
HREF="Offline-Mailing.html#AEN397"
>Конец</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN18"
>1. Примечания автора (предисловие)</A
></H1
><P
>В этой главе я хочу только защитить себя от любых неприятностей и претензий
- так как даже я могу ошибаться ... Если у вас появятся любые вопросы или
предложения, которые вы хотели бы добавить в этот faq, или если вы найдете
какие-то ошибки, то взгляните в главу "Отзывы" этого HOWTO ...</P
><P
>Нужно знать, что все имена файлов здесь обозначены следующим образом:&#13;</P
><P
><SPAN
CLASS="QUOTE"
>"(*** &lt;file&gt;*** text ***) .procmailrc"</SPAN
> &#13;</P
><P
>Это означает, что  файл, называемый ".procmailrc", содержит текст.
Переменная text может быть кодом. Строка показывает вам, какое имя файла
используется. Имя файла без указания пути означает, что оно может быть
изменено/выбрано вами (в большинстве случаев эти файлы находятся в домашнем
каталоге пользователя для почты, напр. /home/mailer).</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN25"
>1.1. Ответственность</A
></H2
><P
>Ни автор, ни распространители этого HOWTO не отвечают за физический,
финансовый и моральный ущерб, понесенный вследствие использования
информации этого документа. Информация этого документа содержит лучшее из
моих знаний и опыта, но я мог сделать ошибки. Любые торговые марки принадлежат их владельцам (я не
использую здесь  коммерческие вещи, но ЕСЛИ я соберусь добавить сюда
какой-то текст, то не буду изменять эту оговорку).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="COPYRIGHT"
>1.2. Copyrights</A
></H2
><P
>This document and contents are Copyright (c)1997-98 by Gunther Voet.
Unauthorized (re)production in any form is explicitly allowed and even
strongly encouraged as long you don't change the contents of it without
contacting the author (Gunther Voet). If you quote the document as whole
or a part of it, there needs to be a Copyright "hint" or link to the
derived work. "The HOWTO documents are copyrighted by their respective
authors". The "HOWTO copyright" will discuss what can be done and what
cannot be done with this document. If it is used in a commercial way,
the author should been noticed for such distributions. Exceptions on this
copyright may be granted under certain conditions with a written letter or
e-mail to the author. For more info about the standard HOWTO disclaimer,
please contact linux-howto@sunsite.unc.edu.</P
><P
>*PLEASE* *IF* you are going to make a system based on this HOWTO, then
PLEASE give me the copyright :) heh ... - i am not that cruel :)). I mean
by a system "a package" - NOT the mailsystem itself - altough it is some
appreciative thingy i would be included :)) i can always use one email
address more for more flaming :)) (just kiddin').</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN32"
>1.3. Авторские права</A
></H2
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN41"
>1.4. Отзывы</A
></H2
><P
>Если у вас появятся вопросы, исправления, комментарии (кроме откровенного
ругательства :)) пишите на freaker@freestamp.com или на <A
HREF="http://www.linux.org.ru/books/HOWTO/freaker@tuc.ml.org"
TARGET="_top"
>freaker@tuc.ml.org</A
>,
и я внесу исправления, добавлю комментарии и предложения в следующую
версию. Если вы публикуете этот документ на коммерческой основе, то можете
послать мне копию. По поводу претензий: послайте их мне, но письма
попадут в /dev/null ...</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN45"
>1.5. Распространение</A
></H2
><P
>Последнюю версию этого документа можно взять по адресу: </P
><P
><A
HREF="http://sunsite.unc.edu/pub/Linux/docs/HOWTO/mini/Offline-Mailing"
TARGET="_top"
>http://sunsite.unc.edu/pub/Linux/docs/HOWTO/mini/Offline-Mailing</A
></P
><P
>-и-</P
><P
><A
HREF="http://tuc.ml.org/om/"
TARGET="_top"
>http://tuc.ml.org/om/</A
></P
><P
>(также проверьте  <A
HREF="http://tuc.ml.org/"
TARGET="_top"
>http://tuc.ml.org</A
>)</P
><P
>tuc.ml.org может быть отключен на момент написания! </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN56"
>1.6. Изменения</A
></H2
><P
>v1.0.0 
Предварительный выпуск, внутреннее тестирование, мы попробовали его прежде, чем передать вам :) 
v1.1.0 
Исправлены некоторые ошибки, 
исправлено несколько небольших ошибок ... 
v1.2.0 
Исправлены граматические ошибки, 
добавлен раздел "Что я использовал", 
добавлен адрес сервера Sunsite. 
v1.3.0 
Добавлен "virtual mail support" для администраторов, 
новый сайт и адрес электронной почты, 
благодарности... 
v1.3.1 
Текст конвертирован в SGML и уточнены некоторые незначительные подробности. 
v1.3.2 
Исправлены большие ошибки (имя файла .fetchmailrc на .procmailrc) и т.д. ... (спасибо Tetsu Isaji) 
Добавлена поддержка для "нового" sendmail, v8.8.0+ 
исправлено несколько незначительных ошибок, 
обновил свою систему (YAY!), 
скоро выйдет японская версия, местонахождение документа будет указано, когда станет известно ... (спасибо Tetsu Isaji). 
v1.3.3 
Добавлена поддержка CC, изменен e-mail на freaker@freestamp.com. </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN59"
>1.7. Что я использовал?</A
></H2
><P
>Я использовал Linux 2.0.30, Pentium-166, ATI pci-mach64 card, Accelerated-X
(Metro) и соединение с моим провайдером (в настоящее время ibmnet) через
ppp, используя модем ZyXEL 28k8, и иногда Bausch 28k8.&#13;</P
><P
>Сейчас я обновил ядро до Linux 2.0.33, установил модем USRobotics, система
все еще работает, поскольку должна работать :) (каждый должен обновить свой
linux, как только выйдет патч :) поверьте мне :) вы можете сэкономить много
времени и обнаружить ошибки :)</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN63"
>1.8. Благодарности...</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Fred'у, durban.hebel.net (за предоставление страниц) </P
></LI
><LI
><P
>Lifesaver'у, parkside.net (за предоставление новых страниц, за помощь 
по этому faq'у, с тех пор  это все работает и там и здесь ...
посетите его кибер-кафе ... слышал, что они готовят классный кофе :))</P
></LI
><LI
><P
>Администраторам сервера lodus.net за продолжение этого проекта </P
></LI
><LI
><P
>Сейчас мне нужен новый сервер, с тех пор,как lodus.net был продан :( </P
></LI
></UL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN75"
>2. Предварительный выбор</A
></H1
><P
>Хорошо, как эта система работает ? Что вы можете сделать с ней ? Так или
иначе, что это такое ? и ... - я имел обыкновение читать это ??? ... на все
вопросы - есть ответы ...&#13;</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN78"
>2.1. Предисловие и описание</A
></H2
><P
>Этот HOWTO предназначен для всех пользователей и серверов (linux), не
имеющих постоянного подключения к Интернет ... У вас есть группа
пользователей или организация, и вы желаете, чтобы все ваши пользователи
имели адрес, по которому можно с ними связаться (e-mail), но вы не хотите
платить за круглосуточное прямое подключение или за почтовые учетные
записи... Или у вас есть внутренняя сеть - с сервером, использующим
маскарадинг, и вы хотите, чтобы у всех ваших пользователей был e-mail, тогда можно
использовать этот способ, чтобы сделать это. Лично я использую
этот способ, чтобы у моих пользователей или членов группы была почта без
круглосуточного подключения; т.к. наша группа некоммерческая - и у нас нет
денег, чтобы платить за прямое подключение, с мгновенным доступом к
электронной почте, и за разные ip адреса. Каждый получает адрес электронной
почты, даже без доступа к интернету. Те, кто имеет доступ
к интернету, могут получать почту на свой персональный адрес - через
систему, описанную ниже. Ваши пользователи могут посылать почту, как они
делали до этого, т.к. ваша система поддерживает передачу почты
пользователей. Единственная вещь, которая должна быть изменена для
пользователей - это то, что они добавляют свой адрес электронной почты
(описывается ниже): 1 способ - в поле subject, 2 способ - в строке
заголовка - "to:".</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN81"
>2.2. Пункты, представляющие интерес ...</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Есть организация, для каждого в ней имеется адрес электронной почты, таким
образом с ними можно контактировать.</P
></LI
><LI
><P
>Служба анонимной почты. Никто не сможет прочитать ваш "файл конфигурации
почтовой системы" - никто не узнает, куда почта отсылается/пересылается.</P
></LI
><LI
><P
>Группа, которая не получает достаточно денег (не смейтесь), или работает
бесплатно, а также если вы не ХОТИТЕ тратить на интернет деньги (хе-хе), но
все же хотите дать каждому адрес электронной почты.</P
></LI
><LI
><P
>Сеть с маскарадингом - с сервером, соединенным с интернетом, необходимо
использовать такую сеть, чтобы дать возможность пользователям иметь почту.</P
></LI
><LI
><P
>Вы хотите поместить некоторые "автоматически отправляемые" документы - как
у меня сделано с моим HOWTO, статистикой и т.п. ... например,
"info@yourmail.dom" или "document1@yourmail.dom".</P
></LI
><LI
><P
>Вам нужна только одна учетная запись на "главном" сервере, чтобы забирать с
него почту, и около 200 учетных записей, которые вы можете создать на вашем
сервере ...</P
></LI
><LI
><P
>Я использовал способ "B", было около 300 почтовых учетных записей - с
сайтом; на 80486DX4-100 обработка занимала 1 минуту.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN99"
>2.3. Вещи, которые вы должны знать</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Не всякая организация, предоставляющая почтовый сервис (бесплатный) будет
рада, когда вы соберетесь закачивать почту другим пользователям, или
задумаете запустить анонимный почтовый сервер. Таким образом, пожалуйста,
свяжитесь с вашим администратором почтового сервера до того, как захотите
сделать это.</P
></LI
><LI
><P
>Это медленнее, чем прямой круглосуточный доступ, т.к. ваш сервер должен
сначала установить соединение, прежде чем будет обрабатывать почту.</P
></LI
><LI
><P
>Потребуются некоторые усилия, чтобы организовывать, обрабатывать сообщения,
и добавлять новых пользователей ... вам будет необходимо работать с этим! -
это не происходит автоматически. (хотя, я сделал это полуавтоматически на
моем сервере :), вы можете тоже попробовать).</P
></LI
><LI
><P
>Вам потребуется свободное место, когда  будет много пользователей - можно 
продолжать работать на сервере ... когда они посылают файлы - будьте
уверены, что у вас имеется достаточно свободного места.</P
></LI
><LI
><P
>Вся почта будет передаваться за раз, таким образом, последнее полученное
сообщение будет послано получателю последним. "Первым вошел - первым вышел
(FIFO)".</P
></LI
><LI
><P
>В первом способе (to:) нет проверки имени пользователя, но во втором (более
дешевом) способе - пользователи не могут использовать строку subject, т.к.
она будет задействована, чтобы послать почту получателю. Многие
пользователи забывают использовать "subject" ... - они должны это точно
знать.</P
></LI
><LI
><P
>Если вы получаете почту, (например 4 раза в день) - убедитесь, что она
будет забираться регулярно, каждые 6 часов. Тогда процесс будет
проходить более плавно.</P
></LI
><LI
><P
>Вы МОЖЕТЕ использовать эту систему и в онлайновом режиме :), так как
почта будет забираться каждые XX минут. Но если вы в онлайне - зачем
использовать другой сервер ?</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN119"
>2.4. Имеются два разных способа ...</A
></H2
><P
>&#13;<P
></P
><OL
TYPE="1"
><LI
><P
>Способ 'A' - назовем его "(m(A))".

Почтовая система будет обращаться к
заголовку письма и смотреть строку "to:" Это - лучший путь, так как это
"настоящий почтовый адрес". Вы будете нуждаться в другой учетной записи на
некотором сервере *И* вам будет нужен DNS (MX) вход (например, ваш
собственный домен). Если системный администратор согласится помочь вам с
этим, тогда не будет проблем! Системный администратор должен
перенаправлять ВСЮ посланную почту на ваш почтовый домен (MX) -&#62; на вашу
учетную запись. Ему понадобится некоторое время, чтобы сделать это :) так
будьте с ним любезны :)) Спасибо моему сисадмину (Fred), я получил свой
почтовый домен. DNS вход может кое-чего стоить, и вы должны решить, брать его
или нет.</P
></LI
><LI
><P
>Способ 'B' - назовем его "(m(B))". 
Почтовая система будет обращаться к
строке subject и  отправлять сообщения пользователю, обозначенному в
этой строке. Если пользователь не найден, система будет отсылать почту
назад. Вам будет нужен pop сервер с одной пользовательской учетной записью,
и  не будет нужен собственный DNS,  не надо быть любезным с вашим
сисадмином, который назначает  почтовый адрес :). Вы можете использовать
общедоступный почтовый сервер, а также ваш собственный или некий частный
почтовый сервер. Для этого  можно даже жертвовать  собственным
почтовым адресом :). Сначала я использовал первый способ, который работал
больше года ... Я знаю, что это плохо, но  не заставляю вас идти
этим путем, так что не ругайте МЕНЯ - т.к. я только предлагаю  некоторые
решения  проблем с почтой :) - вы можете использовать способ A.</P
></LI
></OL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN127"
>3. Требования</A
></H1
><P
>Хорошо, вам нужен компьютер с Linux'ом, с соединением с Интернет! - вам
вероятно нужен модем, правильно? Телефонная линия или любой другой способ
соединения  с сервером. Вы должны также иметь несколько программ типа
Fetchmail, Procmail, дополнительную учетную запись и  почтовую учетную
запись, или DNS с почтовой учетной записью.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN130"
>3.1. Компьютер</A
></H2
><P
>Может быть любой ... даже 8086 ... - но предпочтительней - 80386 :). Чем
быстрее машина, тем быстрее выполняются на ней программы.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN133"
>3.2. Дополнительная учетная запись на вашем компьютере</A
></H2
><P
>Вам нужно создать дополнительную учетную запись на  компьютере. Я
использовал в качестве примера (в этом HOWTO) "mailservice". Это может быть
также "mailserver" или "mailtousers" - это только несколько разных имен,
которые вы можете использовать.</P
><P
>! Создание не требует наличия прав root'а ! </P
><P
>Вся почта для  пользователей будет отправляться, при помощи этой
учетной записи, на ваш компьютер или к пользователям не вашей системы ;).
Только создайте ее как обычный пользователь. Вам нужно проверить все под
этой учетной записью, а почтовый "администратор" может использовать эту
учетную запись, чтобы управлять почтой, даже без прав root'а .. так -
хорошая защита!</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN138"
>3.3. Fetchmail</A
></H2
><P
>Я использовал  версию 1.9 patch level 9 ... Я нашел ее на сайте
sunsite.unc.edu, и  использую только эту программу для забора почты в
моих примерах - если вы хотите использовать другую, то вам выбирать! Вы
можете узнать о дополнительных возможностях, прочитав man Fetchmail :). Вам
нужно инсталлировать ее, будучи root'ом - так как я знаю, что это будет
работать наверняка :)))</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN141"
>3.4. Procmail</A
></H2
><P
>Я использовал версию 3.10 - опять же найденную на sunsite.unc.edu, и мне
нравится он, как лучший агент доставки почты ... Лучше использовать его,
чем "оригинальный" mda. ... То же самое, что и выше - procmail может
устанавливаться под root'ом или под обычным пользователем, но :) лучше
устанавливать под root'ом - т.к. я знаю, что это будет работать наверняка.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN144"
>3.5. Почтовая учетная запись</A
></H2
><P
>Вам обязательно нужно иметь почтовую учетную запись, через которую 
можно работать с вашей почтой. Сервер должен поддерживать протокол POP. Вы
должны иметь возможность работать с этим сервером, когда захотите
(чтобы пользователи на нем могли посылать почту круглосуточно). Это может
быть бесплатный почтовый сервис, а может быть коммерческий - иметь почтовую
учетную запись на нем более, чем достаточно. По способу B (с использованием
поля subject) вам не нужно чего-то больше, по способу A (с использованием
строки to:) вам необходимы некоторые настройки -  это будет описано.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN147"
>3.5.1. DNS запись (MX)</A
></H3
><P
>Нужно, чтобы работал ваш собственный домен - почтовый домен ... это
необходимо, так как администратор сервера не может использовать собственный
домен для ваших пользователей - т.к. может возникнуть конфликт имен ваших
пользователей с пользователями в его домене. Ваши письма фильтруются на том
сервере. Это может что-то стоить - вы должны попросить  сисадмина
добавить адрес, указывающий на его сервер, однако - это должен быть другой
домен.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN150"
>3.5.2. Перенаправление на вашу учетную запись</A
></H3
><P
>Системный администратор должен отправлять *ВСЮ* почту вашего домена на ВАШУ
учетную запись ... - это просто для него, когда он знает, как это сделать
.. иначе ему необходимо прочитать руководство по sendmail (или qmail). Вы
будете получать  почту на вашу учетную запись и фильтровать в своем
домене.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN153"
>4. Я меня все есть, что теперь?</A
></H1
><P
>Сейчас создайте дополнительную учетную запись - вы получите
почтовый адрес, и/или DNS запись и перенаправление на вашу учетную запись
на сервере... Также установите программы Procmail и Fetchmail.
<P
></P
><OL
TYPE="1"
><LI
><P
>Вам нужно создать файл .procmailrc, который будет содержать информацию о
"доставке почты" вашим пользователям.</P
></LI
><LI
><P
>Вам нужно создать файл "nosuchuser", чтобы автор письма знал, что его почта
не дошла к пользователю, если такого пользователя нет.</P
></LI
><LI
><P
>Для лучшей работы :) можно использовать crontab для проверки 
почты каждые XX минут, если у вас есть доступ к интернет.&#13;</P
></LI
></OL
>&#13;</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN163"
>4.1. Создание файла .fetchmailrc</A
></H2
><P
>Вам будет нужно создать файл .fetchmailrc, который будет содержать информацию (имя пользователя и пароль, а также агент доставки почты (mda), чтобы ее обрабатывать). Здесь дан пример файла ... </P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt;*** text ***) .fetchmailrc</TT
>"</SPAN
> 

<PRE
CLASS="PROGRAMLISTING"
>server my.mail.server.com
proto pop3
user myaccountthere
pass deepestsecrets
flush
mda /usr/bin/procmail</PRE
>&#13;</P
><P
>Этот файл будет использоваться для того, чтобы забрать вашу почту.
Пожалуйста, протестируйте его, используя программу fetchmail "fetchmail -vv"
- и посмотрите, правильно ли приходит ваша почта... Возможно возникнут
некоторые ошибки - т.к. управляющий файл procmail еще не создан. Вы можете
подождать с тестированием до того, как создадите файл procmailrc, но я
предупреждаю, если имеются проблемы, то они могут возникнуть из-за этого
файла :). Это потребует создания собственной учетной записи пользователя -
в моем случае, это "mailservice". Необходимо, чтобы читать файл мог только
владелец, но не группа или кто-либо другой - этот файл содержит пароль.
(используйте chmod 600 .fetchmailrc).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN171"
>4.2. Создание файла .procmailrc</A
></H2
><P
>Этот управляющий файл будет пересылать всю почту пользователям, указанным в
нем. Как описано выше, имеется два способа - 1), использующий строку
заголовка "to:", и 2), использующий поле "subject". Файл будет содержать
имя пользователя, которому надо отправлять сообщения. Все знаки "#"
означают комментарий и абсолютно не нужны, когда это не требуется - они
приведены только для того, чтобы вы знали, что я делал ... - вы также, с
помощью chmod, должны установить на файл права (600), чтобы группа и
остальные не знали о частных адресах эх :) ... Требуется также
принадлежность этого файла пользователю (например, "mailservice") :)). Файл
"nosuchuser" отсылает письмо назад автору - если пользователь не найден в
файле procmailrc ... - это делается для того, чтобы автор письма знал, что
письмо не дошло до получателя.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN174"
>4.2.1. для способа A</A
></H3
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     .procmailrc</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
># эта строка только для отладочных целей ! удалите по этическим соображениям
# - т.к. вы можете читать всю почту, проходящую через ваш почтовый сервер ...
# - вся почта будет скопирована в файл "passtrough" до того, как
# попадет к пользователям ... здесь вы можете смотреть, что пошло не так ...
:0 c
        passtrough

# почта с заголовком "to: freaker@mydom.com" будет отправлена прямо
# ко мне, другая почта будет пропущена через эту проверку ...
:0
* ^To:.*freaker@mydom.com
! freaker

# почта для root@mydom.com будет отправлена к root'у ... и также к postmaster'у!
:0
* ^To:.*root@mydom.com
! root

:0
* ^To:.*postmaster@mydom.com
! postmaster


# почта для barbara@mydom.com будет отправлена к barbara И будет
# отправлена на ее собственный почтовый адрес !

:0 c
* ^To:.*barbara@mydom.com
! barbara@her.private.one

:0
* ^To:.*barbara@mydom.com
! barbara

# почта для johnny@mydom.com и johnny@hisdom.com will будет отправлена к johnny

:0
* (^To:.*johnny@mydom.com)|(^To:.*johnny@hisdom.com)
! johnny

# почта для hans@mydom.com и все точные копии будут отправлены к hans'у

:0
* (^To:.*hans@mydom.com)|(^CC:.*hans@mydom.com)
! hans

# эти строки будут возвращать почту отправителю - когда она не дойдет
# до кого-то из вышеупомянутых пользователей ...
# содержимое файла "nosuchuser" будет отправлено в теле письма ...
# знайте ! вам нужно сделать такой файл ! - файл содержит текст
# "Пользователь, которого вы ищете не на этом сервере, не найден.
# Пожалуйста, попробуйте снова, это мог быть пользователь, которого сейчас нет".
#
:0
  |(/usr/bin/formail -r -k \
     -A"X-loop: mailservice@mydomain.dom "| \
       /usr/bin/gawk '{print }\
       /^/ &amp;!HEADER \
         { system("/bin/cat nosuchuser"); \
         print"--" ;\
         HEADER=1 }' ) |\
         /usr/bin/sendmail -t


exit</PRE
>&#13;</P
><P
>     </P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN181"
>4.2.2. для способа B</A
></H3
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     .procmailrc</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
># эта строка только для отладочных целей ! удалите ее из этических соображений
# - т.к. вы можете читать всю почту,  проходящую через ваш почтовый сервер ...
# - вся почта будет скопирована в файл "passtrough" до того, как
# попадет к пользователям ... здесь вы можете смотреть, что пошло не так ...
:0 c
        passtrough

# почта с заголовком "to: freaker@mydom.com" будет отправлена прямо
# ко мне, другая почта будет пропущена через эту проверку ...
:0
* ^To:.*freaker@ibm.net
! freaker

# почта для root@mydom.com будет отправлена к root'у
:0
* ^Subject:.root
! root

# почта для barbara@mydom.com будет отправлена к barbara ...
:0
* ^Subject:.barbara
! barbara

# вся почта для "subject: paul" на его внешний почтовый адрес.
:0
* ^Subject:.paul
! paul@his.personal.emailaddress

# вся почта для "subject: john" будет отправлена на его учетную запись на вашем сервере
# и копия на его персональный почтовый адрес ...
:0 c
* ^Subject:.john
! john@his.personal.emailaddress

:0
* ^Subject:.john
! john

# Вся почта от ibm, с их обновлениями и информацией, будет отправлена к freaker'у,
# поскольку он будет управлять почтовым сервисом, и
# т.к. ibm не хочет, чтобы ей присылали уведомление, если письмо не дошло - об этом смотрите ниже!!
# ... это также необходимо, если ваш провайдер посылает вам письма с новостями и т.д. ...
:0
* ^From:.*newsletter@ibm.net
! freaker

# Все сообщения от демона будут отброшены, в моем случае, будут
# сохранены в файл ... (используйте /dev/null, чтобы удалить их)
:0
* ^FROM_DAEMON
throwaway

# эти строки будут возвращать почту отправителю - когда она не дойдет
# до кого-то из вышеупомянутых пользователей ...
# содержимое файла "nosuchuser" будет отправлено в теле письма ...
# знайте ! вам нужно сделать такой файл ! - файл содержит текст
# "Пользователь не найден в поле subject, пожалуйста, используйте  "Subject: user",
# чтобы послать письмо для user, например, "subject: freaker" пошлет
# почту для freaker." Файл может быть длинный, а может и короткий :) ...
# "mailservice@mydomain.dom" будет предотвращать циклирование между вашим сервером и
# другим сервером - для него требуется иметь ТОЧНЫЙ адрес электронной почты !.
# Иначе вы можете создать бесконечный цикл с сервером, который посылает почту
# на "ваш email" с темой письма типа "don't spend 500$
# at your ..." и т.п. ...
:0
  |(/usr/bin/formail -r -k \
     -A"X-loop: mailservice@mydomain.dom "| \
       /usr/bin/gawk '{print }\
       /^/ &amp;!HEADER \
         { system("/bin/cat nosuchuser"); \
         print"--" ;\
         HEADER=1 }' ) |\
         /usr/bin/sendmail -t

exit

&#13;</PRE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN187"
>4.3. файл "nosuchuser"</A
></H2
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     nosuchuser</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>Пользователь, с которым Вы хотите связаться,
не зарегистрирован в этой системе.

Пожалуйста, используйте строку subject с именем получателя
- например, "subject: freaker" посылает почту freaker'у,
зарегистрированному в этой системе.&#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN193"
>4.4. файлы "crontab"</A
></H2
><P
>Если вы не знаете, как работает crontab :), лучше почитать руководство :)
... Вам нужно создать файл "checkmail", который будет смотреть, если есть
соединение с Интернет... - я использую ppp соединение :), Ниже приведен
пример того, как, используя cron, проверять каждые 10 минут, имеется ли
соединение ppp, и если оно есть, доставлять почту.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN196"
>4.4.1. checkformail</A
></H3
><P
>Файл .checkformail будет вызываться (он должен быть исполняемым) - и будет
проверять, есть ли ppp соединение. Если оно есть, то будет производиться
доставка почты. Crontab будет использовать этот файл, если вы используете
файл cronentry (см. ниже) ...

the .checkformail file will be called (needs to be executable as well) - and
will look if the ppp link is up. If it is up - then it will fetch for mail.
Crontab will use this file when you are using the below cronentry ...</P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** code ***)     .checkformail</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
#

        cd /home/mailservice

        if [ -f /var/run/ppp0.pid ]; then
        /usr/local/bin/fetchmail -s &#62; /dev/null 2&#62;&#38;
        fi&#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN203"
>4.4.2. crontab</A
></H3
><P
>Файл cronentry должен быть загружен в crontab. В результате этого, каждые 10
минут будет запускаться .checkformail. Он не будет посылать никакую почту и
никакую информацию на экран - т.к. я все переадресовываю на устройство
null.</P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     cronentry</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>0,10,20,30,40,50 * * * *  /home/mailservice/.checkformail 1&#62; /dev/null 2&#62; /dev/null</PRE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN210"
>4.5. На сайте администратора</A
></H2
><P
>При использовании способа "A" необходимо сделать следующее ... на
администраторском сайте вся почта для вашего домена должна идти на одного
пользователя. Это довольно просто, и как только вы сделали - это будет
работать.</P
><P
>Это возможно только при использовании более-менее новой версии sendmail;
старый sendmail, скорее всего, работать не будет. Почитайте в руководстве о
том, как заставить работать перенаправление почты.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN214"
>4.5.1. (старый sendmail) Добавьте некоторые строки в файл sendmail.cf</A
></H3
><P
>Добавте следующие строки в ваш файл /etc/sendmail.cf, таким образом будет
прочитан файл доменов .&#13;</P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** add ***)    /etc/sendmail.cf</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
># База данных обработаных доменов

Kmaildomains btree /etc/maildomains.db

# Добавте эти строки *В* Ruleset 98 !

R$+ &#60; @ $+  . &#62;		$: $1 &#60; @ $2 &#62; .
R$+ &#60; @ $+ &#62; $*		$: $(maildomains $1@$2 $: $1 &#60; @ $2 &#62; $3 $)
R$+ &#60; @ $+ &#62; $*		$: $(maildomains $2 $: $1 &#60; # $2 &#62; $3 $)
R$+ &#60; @ $* &#62; .		$: $1 &#60; @ $2 . &#62;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN221"
>4.5.2. (новый sendmail) Добавьте некоторые строки в файл sendmail.cf</A
></H3
><P
>Это работает с более новой программой sendmail (проверено с sendmail версий 8.8.7, 8.8.8). Игнорируйте способ A и добавьте следующие строки ... </P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** add ***)    /etc/sendmail.cf</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
># База данных обработаных доменов

Fw/etc/sendmail.cw
Kvirtuser btree /etc/maildomains.db

*OR*

Fw/yourhomedir/sendmail.cw
Kvirtuser btree /yourhomedir/maildomains.db&#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN228"
>4.5.3. (новый sendmail) отредактируйте файл /etc/sendmail.cw (или /ваш_каталог/sendmail.cw)</A
></H3
><P
>Если ваш файл sendmail.cw расположен в другом месте, то замените
"/etc/sendmail.cw" на "/ваш_каталог/sendmail.cw". Поместите этот файл в 
домашний каталог. Необязательно делать это под правами root'а. Более того,
это может составить угрозу системе безопасности, если не используется
должным образом!</P
><P
>Этот файл может уже существовать, или должен быть создан. Если он уже
существует, убедитесь, что Вы не записываете поверх него другие данные -
или можете почитать мою прекрасную оговорку (про ответственность) :)</P
><P
>Во-первых, создайте файл /etc/sendmail.cw, который будет использоваться,
чтобы переслать почту, предназначенную домену, определенному пользователю
... имеется пример ... (как вы уже знаете, имя "mailservice" может быть
любым, какое захотите - оно может быть даже вашим именем входа в системе
(как мое - freaker).</P
><P
>&#13;<SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***) /etc/sendmail.cw</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>mydomain.dom		mailservice</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN237"
>4.5.4. создание файла /etc/maildomains</A
></H3
><P
>Сначала создайте файл /etc/maildomains, который будет использоваться, чтобы
переслать почту, предназначенную домену, определенному пользователю ...
имеется пример ... (как вы уже знаете, имя "mailservice" может быть любым,
какое захотите - оно может быть даже вашим именем входа (как мое -
freaker). (поместите файл /etc/maildomains в каталог
/ваш_домашний_каталог/maildomains, как сказано выше, лишь измените
соответствующим образом пути :)</P
><P
>Со СТАРЫМИ версиями sendmail: </P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     /etc/maildomains</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>mydomain.dom		mailservice</PRE
>&#13;</P
><P
>С более НОВЫМИ версиями sendmail: </P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***)     /etc/maildomains</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>@mydomain.dom		mailservice</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN250"
>4.5.5. пусть работает !</A
></H3
><P
>Со старыми и новыми версиями sendmail Вы должны сгенерировать базу данных
btree. Для этого сделайте следующее:

With the old &#38; new sendmail versionsyou need to generate the btree
(database) files, you'll need to do the following:</P
><P
>cd /etc    (or /yourhomedir)
makemap btree maildomains &#60; maildomains</P
><P
>и после этого перезапустите sendmail. Все должно РАБОТАТЬ ! удачи :) </P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN255"
>5. Автоматизация</A
></H1
><P
>Хорошо, теперь, когда все, описанное выше, работает ... (если не работает -
даже не думайте об автоматизации, пока все не будет работать ...) - теперь
- нам нужен некоторый скрипт, чтобы избежать головной боли у
"mailadministrator'а" или root'а, при добавлении пользователей в файл
procmailrc ... Ниже будет приведен пример для "более опытных
пользователей", так как некоторые вещи ДОЛЖНЫ быть изменены ... - это
пример для "Способа B - строки Subject". Он может быть легко приспособлен к
"Способу A". "Способ B" будет больше использоваться (он более дешев), чем
способ "A" - лично я решил использовать "Способ B" ...</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN258"
>5.1. "Каркас (скелет)"</A
></H2
><P
>Необходимо иметь файл заголовка и файл конца. </P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN261"
>5.1.1. Файл .procmailrc-header (заголовок)</A
></H3
><P
>Этот файл будет содержать заголовки и список пользователей .... Здесь будут
добавленные и удаленные пользователи, поэтому это  важный файл ... -
лучше всего делать его резервную копию каждый раз, когда вы добавляете
пользователя ... - когда-нибудь МОЖНО сделать что-то не так, и система
начнет работать неправильно ...</P
><P
>&#13;<SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***) .procmailrc-header</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>:0 c
        passtrough

:0 
* ^To:.*freaker@ibm.net
! freaker

:0
* ^Subject:.root
! root

:0
* ^Subject:.barbara
! barbara

:0
* ^Subject:.paul
! paul@his.personal.emailaddress

:0 c
* ^Subject:.john
! john@his.personal.emailaddress

:0 
* ^Subject:.john
! john

:0
* ^From:.*newsletter@ibm.net
! freaker

:0
* ^FROM_DAEMON
throwaway&#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN268"
>5.1.2. Файл .procmailrc-footer (конец)</A
></H3
><P
>Как сказано выше, этот файл должен быть шаблоном окончания - т.к. все
данные ниже не будут использоваться - этот файл содержит код, возвращающий
ответ о том, что пользователь не найден !.</P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** text ***) .procmailrc-footer</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>&#13;:0
  |(/usr/bin/formail -r -k \
     -A"X-loop: mailservice@mydomain.dom "| \
       /usr/bin/gawk '{print }\
       /^/ &#38;&#38; !HEADER \
         { system("/bin/cat nosuchuser"); \
         print"--" ;\
         HEADER=1 }' ) |\
         /usr/bin/sendmail -t


exit&#13;</PRE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN275"
>5.2. Скрипт addmail</A
></H2
><P
>Этот скрипт будет добавлять пользователя в файл заголовка. Присоединим
заголовок и конец друг к другу - таким образом, получим полный файл
.procmailrc. Строка, начинающаяся со знака "#", означает комментарий, и он не
обязателен - это только информация для вас. :)</P
><P
><SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>(*** &lt; file &gt; *** code ***)     addmail   (* chmod 500 *)</TT
>"</SPAN
>

<PRE
CLASS="PROGRAMLISTING"
>#/bin/sh
#
# Copyright (c)1997 by Gunther Voet. rev 1.0.1
# пожалуйста, оставьте этот Copyright, когда будете распространять этот файл


echo ""
echo "Addmail v1.0.1 by Gunther Voet, Freaker / TuC'97-98 (21/04/97)"
echo ""

if [ $1 ]; then

        if [ $2 ]; then


# создать резервную копию !

        
        cp /home/mailserv/.procmailrc-header /home/mailserv/.procmailrc-backup
        
# Добавить (&#62;&#62;) информацию в заголовочный файл ...        

        echo ":0" &#62;&#62; /home/mailserv/.procmailrc-header
        echo "* ^Subject:.$1" &#62;&#62; /home/mailserv/.procmailrc-header
        echo "! $2" &#62;&#62; /home/mailserv/.procmailrc-header
        echo "" &#62;&#62; /home/mailserv/.procmailrc-header

# Скопировать содержимое заголовочного файла в .procmailrc -
# и добавить к нему окончание (.procmailrc-footer)


        cat /home/mailserv/.procmailrc-header &#62; /home/mailserv/.procmailrc
        cat /home/mailserv/.procmailrc-footer &#62;&#62; /home/mailserv/.procmailrc

# Сделаем владельцем "mailserv" и чтение/запись ТОЛЬКО для группы user ...


        chown mailserv /home/mailserv/.procmailrc
        chgrp users /home/mailserv/.procmailrc
        chmod 600 /home/mailserv/.procmailrc
else
        echo "No DESTINATION mail address has been given ..."
fi

else
        echo "usage:"
        echo ""
        echo "syntax:  addmail from_user to_user(domain)"
        echo ""
        echo "example: addmail freaker freaker@myemail.dom"
        echo ""
fi</PRE
>&#13;</P
><P
>Теперь этот скрипт будет добавлять информацию о пользователе и почтовый
адрес в заголовочный файл, затем все это копируется в файл
.procmailrc, после этого туда будет добавлен конец файла, и 
вы получите полный файл .procmailrc. Если вы захотите удалить пользователя,
то просто отредактируйте файл .procmailrc-header и при следующем добавлении
нового пользователя он будет удален из файла .procmailrc. Чтобы удалить его
немедленно, надо удалить пользователя из обоих файлов - .procmailrc и
.procmailrc-header.</P
><P
>Я думаю, что вы достаточно умны, чтобы написать скрипт, который
автоматически добавляет пользователей при использовании обоих методов, при
выполнении команды "adduser".</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN284"
>6. Помогите!</A
></H1
><P
>Внизу я опишу некоторые общие проблемы. Если у вас появятся другие
проблемы, НЕ описанные в этом разделе, то пишите мне - и я добавлю их,
упомянув, возможно, ваше имя/email :). **ДО** того, как написать мне -
пожалуйста, посмотрите, не забыли ли вы чего-нибудь - и если  хотите
получить какую-либо помощь от меня, посылайте мне более детальную
информацию, включая скрипты, и то, что вам необходимо. Не надо присылать
никаких бинарных файлов - я их все равно не буду запускать.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN287"
>6.1. Скрипт автоматизации не работает:</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>файл сделан исполняемым? &#13;</P
></LI
><LI
><P
>путь к вашему shell - /bin/sh ? </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN295"
>6.2. Что вы подразумеваете под "анонимным mailserver'ом"?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Вы можете создать учетную запись типа "anon0001@yourdom.dom" - и всю
входящую на этот адрес почту пересылать на другой электронный адрес...
никто не может просмотреть файл .procmailrc, и тогда ТОЛЬКО ВЫ
будете знать этот адрес !</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN301"
>6.3. Моя кошка сдохла</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Ну так в следующий раз не печатайте этот HOWTO на 200 граммовой бумаге,
т.к. 10 страниц этого HOWTO будут весить 2 кг. - для кота это СЛИШКОМ
ТЯЖЕЛО !</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN307"
>6.4. Моя собака сдохла</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>хмм - не могу ничего сказать по этому поводу ... Похороните и все ...</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN313"
>6.5. Linux?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Свободно распространяемая unix-подобная, posix-совместимая система -
создатель Linus Torvalds ... Почему вы читаете этот HOWTO, если даже не
знаете, что такое Linux ?</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN319"
>6.6. Вы можете мне помочь, обнаружить почтовую учетную запись?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Нет! - этот howto для ВАШЕЙ стороны, я не забочусь о вашем провайдере, нельзя никак получить ваш адрес электронной почты. </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN325"
>6.7. Почему, когда я позже делаю некоторые добавления, они оказываются удаленными ?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Внимательно читайте пункт 5.2, и вы увидите почему ... </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN331"
>6.8. Как я могу получить "домен" ?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Спросите провайдера - он должен помочь вам с этим. Может потребоваться несколько дней и даже недель для выяснения этого в Internic - ваш провайдер может помочь. </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN337"
>6.9. Почему вы так "криво" используете это?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Потому что я не хочу тратить деньги - и потому, что  хочу использовать это "криво" - я использую это - так к чему беспокоиться? </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN343"
>6.10. Файл "nosuchuser"?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Вы можете помещать в него все, что хотите - поместите туда некоторую
необходимую информацию так, чтобы автор письма знал, что случилось с его
"недошедшей" почтой.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN349"
>6.11. Мои пользователи могут писать/посылать почту тоже?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Это не имеет никакого отношения к тому, что я объяснил вам, читайте
руководство к sendmail ... - чтобы ПРИНИМАТЬ почту, она должна быть доступна
на сервере.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN355"
>6.12. Необходимо ли каждому пользователю иметь возможность входа в мою систему?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Нет .. но, для пользователей очень тяжело вообще не иметь доступа к
интернет :) ... У вас может быть сеть с маскарадингом, и ваш компьютер
может быть подключен к этой сети, поэтому пользователям надо будет
отправлять почту подобным образом; можно также создать связь между
почтой и доской объявлений; вы можете пересылать почту на шлюз fidonet :)
Много разных причин для того, чтобы не давать пользователям возможности
входа в систему.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN361"
>6.13. скелет?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>короче, мне просто нравится это слово. </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN367"
>6.14. Addmail?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Никаких вопросов - это все для автоматизации - вы лучше будьте уверены
относительно того, что  хотите сделать ... т.к. это МОЖЕТ быть троянский
конь, знайте :))) (это не так, но вам необходимо знать, как создаются
скрипты, прежде чем задавать вопросы). Он достаточно прост, чтобы понять -
вот почему в нем я поместил комментарии . *ЕСЛИ* вы будете распространять
этот скрипт - оставьте, пожалуйста, в нем мой Copyright! спасибо :).</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN373"
>6.15. Почему ты такой жестокий?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Я не жестокий :) я хороший :) я наилучший парень в мире, во вселенной! ТЕПЕРЬ ПРОВАЛИВАЙТЕ! (я только хотел в полной мере осветить тему и не слишком далеко уходить от нее - так вот :) это все). </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN379"
>6.16. Разве вы не получали жалоб на свой чрезмерный язык?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Нет еще, но мог бы, я фильтрую все, что содержит слова 'чрезмерный' и 'язык' ('excessive' и 'language') :) я не знаю :)) </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN385"
>6.17. Почему этот howto больше всех отличается от остальных?</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>потому что иногда чтение простого howto МОЖЕТ быть скучным ... я хотел добавить сюда кое-что свое ... </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN391"
>6.18. Локально мои домены работают, но удаленно нет</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>проверьте ваш файл "sendmail.cw", т.к. домены должны быть добавлены в него ! </P
></LI
></UL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN397"
>7. Конец</A
></H1
><P
>Это звучит как конец ... Если вы нашли любые нежелательные ошибки (или
особенности :)), то свяжитесь со мной ... отправляйте мне любые комментарии
и предложения. Если вам все не надоест после чтения этого документа,
пожалуйста, посетитте http://tuc.ml.org/ хе-хе-хе.</P
><P
>Мои благодарности: </P
><P
>Hannes van de Vel: за поддержку, Tetsu Isaji: японский перевод и
уведомление меня об ошибках :), Greg Hankins: за уведомление меня о
нескольких ошибках в sgml версии, Linus Torvalds: конечно ... без его
помощи этого howto не было бы вообще!</P
></DIV
></DIV
></BODY
></HTML
>