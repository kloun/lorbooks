<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Мини-HOWTO: Раздел подкачки Linux</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Мини-HOWTO: Раздел подкачки Linux</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Rahul U. Joshi</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;     jurahul@hotmail.com
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
> Перевод: <A
HREF="mailto:sam@asp-linux.com"
TARGET="_top"
>Станислав Рогин</A
>,
 <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>Версия 1.41, 9 декабря 1999 <BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>В этом документе содержится информация о том, как использовать раздел подкачки (swap partition) вашего Linux совместно с Windows. </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Swap-Space.html#AEN17"
>Введение</A
></DT
><DT
>2. <A
HREF="Swap-Space.html#AEN24"
>Что вам понадобится</A
></DT
><DT
>3. <A
HREF="Swap-Space.html#AEN35"
>Изменения и дополнения</A
></DT
><DT
>4. <A
HREF="Swap-Space.html#AEN67"
>Административные упоминания</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="Swap-Space.html#AEN69"
>Copyright</A
></DT
><DT
>4.2. <A
HREF="Swap-Space.html#AEN76"
>Авторские права</A
></DT
><DT
>4.3. <A
HREF="Swap-Space.html#AEN85"
>Ответственность</A
></DT
></DL
></DD
><DT
>5. <A
HREF="Swap-Space.html#AEN90"
>Перед тем, как вы начнете</A
></DT
><DT
>6. <A
HREF="Swap-Space.html#AEN94"
>Процедура</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="Swap-Space.html#AEN99"
>Отключите подкачку и создайте DOS-раздел</A
></DT
><DT
>6.2. <A
HREF="Swap-Space.html#AEN119"
>Укажите Windows местонахождение нового файла подкачки</A
></DT
><DD
><DL
><DT
>6.2.1. <A
HREF="Swap-Space.html#AEN121"
><I
CLASS="EMPHASIS"
>Windows 3.1</I
></A
></DT
><DT
>6.2.2. <A
HREF="Swap-Space.html#AEN130"
><I
CLASS="EMPHASIS"
>Windows 95/98 </I
></A
></DT
></DL
></DD
><DT
>6.3. <A
HREF="Swap-Space.html#AEN153"
>Сделайте резервную копию "Набора Специальных Секторов"</A
></DT
><DT
>6.4. <A
HREF="Swap-Space.html#AEN189"
>Исправьте скрипты загрузки и выключения для поддержки новой конфигурации</A
></DT
><DT
>6.5. <A
HREF="Swap-Space.html#AEN228"
>Включите подкачку</A
></DT
></DL
></DD
><DT
>7. <A
HREF="Swap-Space.html#AEN231"
>Пара замечаний</A
></DT
><DT
>8. <A
HREF="Swap-Space.html#AEN299"
>Что же мы сделали на самом деле?</A
></DT
><DT
>9. <A
HREF="Swap-Space.html#SWAPINIT"
>Скрипт swapinit.sh</A
></DT
><DT
>10. <A
HREF="Swap-Space.html#SWAPHALT"
>Скрипт swaphalt.sh</A
></DT
><DT
>11. <A
HREF="Swap-Space.html#MSINFO.SH"
>Скрипт msinfo.sh</A
></DT
><DT
>12. <A
HREF="Swap-Space.html#AEN334"
>Изначальный файл msinfo</A
></DT
><DT
>13. <A
HREF="Swap-Space.html#SECT1.4"
>Замечания для читателей версии 1.4 этого документа</A
></DT
><DT
>14. <A
HREF="Swap-Space.html#AEN364"
>Благодарности, отзывы и посвящения</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN17"
>1. Введение</A
></H1
><P
> 
Многие используют Linux и MS-Windows вместе. Возможность делать это - одно из условий "Linux-революции"; т.е. дать людям возможность экспериментировать с Linux (и привыкнуть к нему), сохраняя способы запускать их старые программы. Так как и Linux, и MS-Windows используют виртуальную память с подкачкой на диске, очень часто в конференции comp.os.linux.setup возникает вопрос "Как совместно использовать область подкачки", с целью сократить используемое дисковое пространство.
&#13;</P
><P
>Существует несколько различных методов разделения областей подкачки - тот, который описывается в этом документе, видимо, самый сложный - но это единственный способ, достигающий максимального быстродействия в обеих системах без риска потерять данные на диске. Если вы используете DOS, то  должны знать, что многие DOS-приложения также создают свои файлы подкачки. Можно использовать  для этого раздел подкачки Linux так же, как и для Windows.</P
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="http://www.linux.org.ru/books/images/caution.gif"
HSPACE="5"
ALT="Предостережение"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Внимание: В случае, если вы использовали советы старой версии этого
документа (1.4), и сейчас ваш SCANDISK выдает ошибку на диске X:, прочтите
раздел "<A
HREF="Swap-Space.html#SECT1.4"
><I
>Замечания для читателей версии 1.4 этого документа</I
></A
>" , написанный специально для того, чтобы вы восстановили все в
нормальное состояние.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN24"
>2. Что вам понадобится</A
></H1
><P
>У всей этой процедуры очень немного требований. Однако, я настоятельно
рекомендую, чтобы все эти требования были <I
CLASS="EMPHASIS"
>обязательно</I
> выполнены, т.к. с
более старыми версиями возникают проблемы. Итак, потребуются:&#13;</P
><P
>&#13;<P
></P
><OL
TYPE="1"
><LI
><P
>MS-DOS 5.0 или новее с MS-Windows 3.1/3.11 <I
CLASS="EMPHASIS"
>ИЛИ</I
> MS-Windows 95/98 </P
></LI
><LI
><P
>	 
Программы shutdown/init, умеющие запускать файлы в процессе загрузки и выключения. (Пакет SysVinit-2.50, например, может это делать. SysVinit-2.50 можно найти на сайте sunsite.unc.edu в каталоге /pub/Linux/system/Daemons. Почти все нынешние дистрибутивы используют этот пакет.) &#13;</P
></LI
></OL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN35"
>3. Изменения и дополнения</A
></H1
><P
>&#13;<P
></P
><UL
><LI
><P
>Версия 1.3 -- Написана H. Peter Anvin, и не поддерживается с 15 января 1998. </P
></LI
><LI
><P
>Версия 1.4 -- Основана на версии 1.3, но добавлено много деталей. Сейчас поддерживается Rahul U. Joshi </P
></LI
><LI
><P
>Версия 1.41 -- Изменены некоторые шаги процедуры для предотвращения ошибок на диске подкачки, который проверяется SCANDISK. </P
></LI
></UL
>&#13;</P
><P
>Изменения внесены Rahul U. Joshi</P
><P
>Дата: 26 ноября 1999 </P
><P
>&#13;<P
></P
><UL
><LI
><P
>Добавлены детали, касающиеся Windows 95/98. </P
></LI
><LI
><P
>Добавлены замечания о Red Hat Linux. </P
></LI
><LI
><P
>Исправлена программа msinfo. </P
></LI
><LI
><P
>Добавлены разделы 5 - 12. </P
></LI
><LI
><P
>Полностью переписан раздел "Процедура", чтобы он был более удобочитаемым. </P
></LI
><LI
><P
>Инициализация области подкачки и остановка системы разделены в два скрипта. </P
></LI
><LI
><P
>Изменены скрипты: внесена поддержка многократной проверки сигнатуры. </P
></LI
><LI
><P
>Добавлены замечания о новых видах областей подкачки. </P
></LI
><LI
><P
>Добавлены несколько более надежных схем действий. &#13;</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN67"
>4. Административные упоминания</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN69"
>4.1. Copyright</A
></H2
><P
>Unless otherwise stated, Linux HOWTO documents are copyrighted by
their respective authors. Linux HOWTO documents may be reproduced and
distributed in whole or in part, in any medium physical or electronic,
as long as this copyright notice is retained on all copies. Commercial
redistribution is allowed and encouraged; however, the author would
like to be notified of any such distributions.</P
><P
>All translations, derivative works, or aggregate works incorporating
any Linux HOWTO documents must be covered under this copyright notice.
That is, you may not produce a derivative work from a HOWTO and impose
additional restrictions on its distribution. Exceptions to these rules
may be granted under certain conditions; please contact the Linux
HOWTO coordinator at the address given below.</P
><P
>In short, we wish to promote dissemination of this information through
as many channels as possible. However, we do wish to retain copyright
on the HOWTO documents, and would like to be notified of any plans to
redistribute the HOWTOs.</P
><P
>If you have questions, please contact Tim Bynum, the Linux HOWTO
coordinator, at <A
HREF="mailto:linux-howto@sunsite.unc.edu"
TARGET="_top"
>linux-howto@sunsite.unc.edu</A
> via email.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN76"
>4.2. Авторские права</A
></H2
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN85"
>4.3. Ответственность</A
></H2
><P
>Автор не несет ответственности ни за какие потери или искажения данных, в процессе использования информации данной в этом документе. Невозможно проверить вещи под всеми конфигурациями, поэтому что-то из данного здесь может быть ошибочно или не работать на вашей системе. В случае, если вы обнаружите ошибку - сначала сообщите об этом мне!
&#13;</P
><P
>Этот документ распространяется "как есть". Я постарался описать весь процесс как можно точнее, но вы используете данную информацию на свой страх и риск. Я ни в коем случае не отвечаю за любые повреждения, явившиеся результатом использования этой информации.</P
><P
>Если вы планируете включить этот HOWTO в какой либо дистрибутив или использовать в печати, я буду рад получить уведомление об этом. В этом случае я могу предоставить вам последнюю версию этого документа. </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN90"
>5. Перед тем, как вы начнете</A
></H1
><P
>Этот документ <I
CLASS="EMPHASIS"
>не</I
> является пошаговой инструкцией. Предполагается, что
читатель сначала изучит весь документ, чтобы быть осведомленным о различных
подводных камнях и возможных трудностях. После того, как вы получите четкое
представление о том, какие шаги будут вами предприняты, вы можете начать
следовать инструкциям этого документа пошагово. Так как вы будете root-ом и
вам предстоит изменять системные файлы инициализации, будьте осторожны с
тем, что собираетесь делать. Пишите в этих файлах комментарии к тем
секциям, которые добавляете, а когда хотите убрать секцию, не удаляйте ее -
просто закомментируйте. (В скриптах комментарии начинаются с символа #).
В случае, если что-то пойдет не так, вы сможете восстановить  исходную
конфигурацию, просто убрав те изменения, которые  внесли. Несмотря на то,
что вы не обязательно должны хорошо знать синтаксис скриптов, и то, что я
дал в этом документе все, что необходимо, небольшие познания в этом вопросе
могут быть полезны, как со стороны понимания, так и со стороны поиска
ошибок.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN94"
>6. Процедура</A
></H1
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="http://www.linux.org.ru/books/images/caution.gif"
HSPACE="5"
ALT="Предостережение"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><I
CLASS="EMPHASIS"
>ВНИМАНИЕ:</I
> Эта глава написана с учетом особенностей RedHat Linux 6.0
Несмотря на то, что общие принципы, описанные здесь, применимы ко всем
дистрибутивам, некоторые детали могут отличаться. Я приветствую любые
отзывы с описанием деталей процедуры для других дистрибутивов. У многих
пользователей существует раздел подкачки, выделенный специально для Linux.
Я предполагаю, что вы - один из них.</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN99"
>6.1. Отключите подкачку и создайте DOS-раздел</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Загрузите Linux. Отключите подкачку, отредактировав файл /etc/fstab, закомментировав в нем строки, описывающие раздел подкачки. </P
></LI
><LI
><P
>Используя команду fdisk в Linux, удалите раздел подкачки, таким образом освободив дисковое пространство. </P
></LI
><LI
><P
>Загрузите DOS. Создайте DOS-раздел (используя команду FDISK) с необходимым вам размером. Если вы не можете создать такой раздел (например, если DOS FDISK сообщает о том, что "в расширенном разделе все пространство занято под логические диски"), можно использовать fdisk или cfdisk из Linux для создания этого раздела. Вы даже можете просто сменить тип раздела подкачки с 82h (Раздел подкачки Linux) на 06h (FAT16). В этом случае  не придется удалять этот раздел, а просто сменить тип.  </P
></LI
><LI
><P
>После того, как  создали раздел, загрузите DOS, если вы еще не в DOS. DOS выделит новому разделу букву диска. Используйте эту букву вместо X везде в этом тексте, где встретите команды типа "LABEL X:" или "COPY FOO X:DUMMY.DAT" </P
></LI
><LI
><P
>Отформатируйте этот раздел DOS-командой FORMAT. 

<PRE
CLASS="SCREEN"
> C:\&#62;FORMAT X: </PRE
>&#13;</P
></LI
><LI
><P
> 
Установите метку тома на эту новую "ОБЛАСТЬ ПОДКАЧКИ", используя DOS-команду LABEL. Проверьте правильность ее установки командой DIR. Проделайте это, как отдельный шаг. Некоторые версии FORMAT не устанавливали метку тома в загрузочный сектор, хотя должны были это делать. [Замечание: некоторые писали мне, что метка тома хранится в корневом каталоге. Это верно, но, начиная с DOS 5.0, она хранится также в загрузочном секторе.] 

<PRE
CLASS="SCREEN"
>C:\&#62;LABEL X:
C:\&#62;DIR X:  </PRE
>&#13;</P
></LI
><LI
><P
> 
На этой фазе вы имеете готовый DOS-раздел для подкачки. </P
></LI
></UL
>
 </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN119"
>6.2. Укажите Windows местонахождение нового файла подкачки</A
></H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN121"
>6.2.1. <I
CLASS="EMPHASIS"
>Windows 3.1</I
></A
></H3
><P
>&#13;<P
></P
><UL
><LI
><P
>Запустите Windows. Перейдите в Панель Управления (Control Panel), выберите пункт "386 расширенный" ("386 Enhanced"). Выберите "Виртуальная память" ("Virtual Memory") и создайте постоянный файл подкачки на диске X: максимально возможного размера (Его вам укажет Windows). Windows может пожаловаться, что не сможет использовать такой большой файл подкачки. Не обращайте на это внимания и все равно создайте файл. </P
></LI
><LI
><P
>Выйдите из Windows. </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN130"
>6.2.2. <I
CLASS="EMPHASIS"
>Windows 95/98 </I
></A
></H3
><P
>&#13;<P
></P
><UL
><LI
><P
>   
Запустите Windows. Перейдите в "Панель Управления"  (Пуск| Настройка | Панель управления). Выберите пункт "Система". (В это окно можно попасть проще: нажмите Win+Break) В диалоговом окне "Свойства системы" выберите пункт "Быстродействие". Нажмите кнопку "Виртуальная память". На экране появится диалог настройки параметров виртуальной памяти. Выберите пункт "Я хочу задать параметры виртуальной памяти самостоятельно". Выберите диск, на котором хотите иметь разделенный с Linux раздел подкачки (X:). Оставьте максимальные и минимальные значения такими, какими их установит Windows. Нажмите OK. Windows попросит вас перезапустить компьютер. Так и сделайте. </P
></LI
><LI
><P
> 
После того, как вы перезапустите Windows, увидите, что на диске X: появился файл win386.swp. В дополнение к этому появился каталог Recycled. По той причине, что вы не собираетесь хранить другие файлы на этом диске, и одного файла будет более, чем достаточно (да и тот не жалко, в случае чего), укажите Windows не поддерживать корзину на этом диске (X:). На рабочем столе нажмите правую кнопку мыши на корзине и в открывшемся меню нажмите Свойства. На экране появится диалог настройки Корзины. Нажмите на закладку "Глобальные" и выберите "Независимая конфигурация дисков". После этого выберите диск X: drive (у которого будет метка SWAP SPACE). В этом диалоге сдвиньте указатель "Предельный объем корзины" на 0 процентов. В графе "Зарезервированное место" должно быть написано 0 байт. Нажмите ОК и перезагрузите компьютер. </P
></LI
><LI
><P
>Казалось бы: раз вы больше не поддерживаете корзину для диска X, то Windows
каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
> там больше не нужен, и она могла бы его удалить. Она не
только не удаляет его, но и не разрешает вам сделать это. Как я говорил
раньше, нам этот каталог не нужен, и мы хотим, чтобы на диске X: был только
файл win386.swp. Чтобы удалить ненужный каталог, перезагрузите компьютер в
Режиме Эмуляции MS-DOS. Выберите Пуск | Завершение работы | Перезапуск
компьютера в режиме MS-DOS, или в момент загрузки Windows нажмите F8, и из
появившегося меню выберите пункт "Command Prompt only". Попав в режим
MS-DOS, выполните следующие команды:

<PRE
CLASS="SCREEN"
>C:\&#62;X:
X:\&#62;ATTRIB -R -H -S RECYCLED
X:\&#62;DELTREE RECYCLED</PRE
>&#13;</P
><P
>Теперь  на диске X: есть только один файл: win386.swp. Вы можете
проверить этот факт, используя различные опции команды <TT
CLASS="LITERAL"
>dir</TT
>. Но это не
означает, что каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
> больше на диске X: не появится. Когда
Windows загрузится и определит, что на диске X: нет каталога <TT
CLASS="LITERAL"
>RECYCLED</TT
>, то
он его снова создаст. Однако, когда мы будем восстанавливать диск X: из
Linux-а, он будет просто содержать один файл win386.swp. Если кто-нибудь
знает способ избавиться от каталога <TT
CLASS="LITERAL"
>RECYCLED</TT
> в Windows, пишите мне.</P
></LI
><LI
><P
> 
<I
CLASS="EMPHASIS"
> Вас беспокоит "Очистка диска"?   </I
></P
><P
>   
Если  включена опция "Очистка диска", то иногда вы будете получать сообщения "Не хватает места на диске X:". Так как мы используем все пространство диска X: для подкачки, то нам это свободное место не нужно. Чтобы это предупреждение больше не появлялось запустите настройку Очистки Диска (Пуск | Программы | Стандартные | Служебные | Очистка диска). В появившемся диалоге выберите диск X: и нажмите OK. Появится диалоговое окно "Очистка диска X:". Нажмите пункт "Настройки" и отключите опцию "Если на диске останется меньше...". </P
></LI
></UL
>&#13;</P
><P
>  
Начиная с этого момента, Windows будет считать, что его диск подкачки - это диск X:. Поэтому диск X: должен быть доступен каждый раз при загрузке Windows. Если вы используете какие-нибудь дополнительные системные утилиты, например, Norton Utilities для Windows 95, то вам, наверное, придется прочитать документацию и настройки, чтобы эти утилиты знали об изменениях, иначе это может привести к ошибкам. </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN153"
>6.3. Сделайте резервную копию "Набора Специальных Секторов"</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
> 
Загрузите Linux, и войдите в него как root. </P
></LI
><LI
><P
>Используйте команду fdisk, чтобы узнать название раздела и его размер в блоках. Создайте символьную ссылку <TT
CLASS="LITERAL"
>/dev/winswap</TT
>, указывающую на этот раздел. Например, если этот раздел - hda7, то наберите:  
<PRE
CLASS="SCREEN"
># ln -s /dev/hda7 /dev/winswap </PRE
>&#13;</P
><P
>[ЗАМЕЧАНИЕ К ЛЮБИТЕЛЯМ ЧИСТОТЫ: Пожалуйста, используйте символьную ссылку. Название этого раздела попадет в некоторые конфигурационные файлы и несоответствия могут привести к фатальным результатам.] </P
></LI
><LI
><P
>Узнайте размер "Набора Специальных Секторов" для диска подкачки. Это ничто
иное, как общее количество секторов, требуемое на загрузочный сектор, FAT и
корневой каталог. Существует несколько способов узнать это число. Наиболее
простой - использовать <A
HREF="Swap-Space.html#MSINFO.SH"
>Разд. 11</A
>. Используйте следующие команды:
<PRE
CLASS="SCREEN"
>  
# cp Swap-Space-HOWTO msinfo.sh 
# chmod +x msinfo.sh </PRE
>&#13;</P
><P
>(Кстати, это значительно проще сделать в редакторах из KDE или GNOME)</P
><P
>Откройте файл msinfo.sh file, в редакторе удалите все строки, кроме файла msinfo.sh из раздела 8. После этого запустите его командой 

<PRE
CLASS="SCREEN"
> 
# ./msinfo.sh /dev/winswap </PRE
>&#13;</P
><P
>Эта программа выдаст информацию о разделе подкачки. Запишите число под названием "Общее количество специальных секторов", и проверьте, чтобы метка тома называлась "SWAP SPACE". Если это не так, то перезагрузитесь в DOS и перезапустите команду LABEL</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Замечание:</I
> Вы также можете определить это число утилитами, показывающими
содержание загрузочного диска, например, Norton Disk Editor или minfo из
пакета mtools в Linux. В Norton Disk Editor, выберите пункт "Boot Sector" в
меню Object. Запишите следующие числа:
<PRE
CLASS="SCREEN"
>Reserved Sectors at beginning : r
FAT Copies                    : f
Sectors per FAT               : s
Root directory entries        : r</PRE
>
 </P
><P
>Теперь, "Общее количество специальных секторов" будет равно   </P
><P
>T = r + (s * f) + (d / 16)  </P
><P
>Однако, использовать программу из этого HOWTO значительно проще.</P
><P
>Запишем  "Общее Количество Специальных Секторов", как XXX. </P
></LI
><LI
><P
> 
[Необязательный шаг] Windows может оставить на этом разделе немного свободного места, даже если ему указать не делать этого. Не пытайтесь использовать  свободное место, так как оно будет уничтожаться при каждом запуске Linux. Если вы хотите избежать случайного использования этого места (с последующей потерей данных),  создайте на нем поддельный файл, заполняющий эту пустоту, используя следующие команды: 

<PRE
CLASS="SCREEN"
>mkdir /mnt 
mount -t msdos /dev/winswap /mnt 
dd if=/dev/zero of=/mnt/dummy.fil 
umount /mnt   </PRE
>&#13;</P
><P
>оманда dd выдаст сообщение "No space left on device" (На устройстве не осталось места). Это именно то, что нам нужно. </P
></LI
><LI
><P
> 
В приглашении командной строки наберите: 

<PRE
CLASS="SCREEN"
> 
# dd if=/dev/winswap bs=512 count=XXX | gzip -9 &#62; /etc/winswap.gz 
                                  ^^^</PRE
>
 </P
><P
>... где XXX надо заменить на "Общее количество специальных секторов".</P
><P
>Таким образом, мы создали резервную копию всех специальных секторов в компрессированной форме в файле /etc/winswap.gz </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN189"
>6.4. Исправьте скрипты загрузки и выключения для поддержки новой конфигурации</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Теперь мы исправим наши инициализационные скрипты, чтобы область подкачки создавалась при каждом запуске Linux, и специальные сектора DOS/Windows восстанавливались каждый раз при завершении работы Linux. </P
></LI
><LI
><P
>Вместо того, чтобы вставлять команды, отвечающие за эту часть процедуры, прямо в инициализационные скрипты, мы подготовим два отдельных файла, под названиями swapinit.sh и swaphalt.sh. Пример этих файлов, который будет работать в Red Hat Linux, дан в приложениях к этому документу. Вы можете поместить эти файлы в любой каталог, но наиболее предпочтительным будет /etc/rc.d/init.d. Создайте два файла в этом каталоге и скопируйте туда скрипты, приведенные в приложениях. Самый простой способ - скопировать этот документ в файлы командами 

<PRE
CLASS="SCREEN"
> 
# cp Swap-Space-HOWTO  /etc/rc.d/init.d/swapinit.sh
# cp Swap-Space-HOWTO  /etc/rc.d/init.d/swaphalt.sh</PRE
>&#13;</P
><P
>и затем, используя свои любимый редактор, удалить из них все, кроме необходимых скриптов. Не забудьте проставить им флаг "исполняемых" командами 


<PRE
CLASS="SCREEN"
># chmod +x swapinit.sh
# chmod +x swaphalt.sh</PRE
>&#13;</P
></LI
><LI
><P
>Запустите fdisk и найдите в нем размер раздела подкачки. В обоих файлах (swap????.sh) замените YYYYY на это число. </P
></LI
><LI
><P
> 
Проверьте имя скрипта завершения работы системы. В SysVinit этот файл указан в /etc/inittab; добавьте ссылку на него, если там ее нет. 

<PRE
CLASS="SCREEN"
># Уровень запуска 0 означает завершение работы системы

l0:0:wait:/etc/brc </PRE
>&#13;</P
><P
>(В Red Hat Linux, это, скорее всего, будет файл /etc/rc.d/init.d/halt) Если вы не в состоянии выяснить это, поищите в каталоге /etc файл, содержащий команду "swapon -a" command. Достаточно об этом! </P
><P
>Далее в тексте я буду предполагать, что это все-таки файл /etc/rc.d/init.d/halt (для краткости halt). </P
></LI
><LI
><P
>Проверьте название файла инициализации системы. В SysVinit этот файл также указан в /etc/inittab. 

<PRE
CLASS="SCREEN"
>     
# Инициализация системы

si::sysinit:/etc/rc.d/rc.sysinit </PRE
>&#13;</P
><P
>Имя файла может отличаться, если у вас не Red Hat. Я предполагаю, что это файл /etc/rc.d/rc.sysinit (для краткости rc.sysinit) </P
></LI
><LI
><P
>Добавьте следующие строки в файл инициализации системы (rc.sysinit), вместо команды "swapon -a". Я бы советовал вам не удалять эту команду, а просто закомментировать ее, чтобы восстановить скрипт в исходное состояние, если что-то пойдет не так. </P
><P
>Если ваша команда swapon находится в каталоге /etc, замените команду /sbin/swapon на /etc/swapon. Если она в /bin, замените на /bin/swapon. Проделайте то же самое с mkswap. 

<PRE
CLASS="SCREEN"
># ----------------------------------------------------------------------- 
# строки удалены ФИО 
# Запускаем подкачку.
# action "Активизируем разделы подкачки" swapon -a 
# ----------------------------------------------------------------------- 
 
# ---------------------------------------------------------------------- 
# строки добавлены ФИО 
# Проверяем и инициализируем область подкачки
# 
/etc/rc.d/init.d/swapinit.sh 
# ---------------------------------------------------------------------- </PRE
>&#13;</P
></LI
><LI
><P
>Самый простой путь вставить текст в файл - это использовать две виртуальных консоли. Зарегистрируйтесь на обеих как root . Используйте свой любимый редактор, чтобы открыть это HOWTO на одной консоли, и модифицируемый скрипт на второй. Выделите кусок скрипта, приведенный выше, мышью и переключитесь на вторую консоль. Установите курсор в желаемую позицию и нажмите правую кнопку мыши. Выделенный ранее текст будет вставлен в скрипт.  &#13;</P
></LI
><LI
><P
> 
Добавьте следующие строки в ваш скрипт завершения системы (halt). Поместите эти строки после всех команд, которые могут потребовать подкачку. Обычно, в этом файле будет команда "swapoff -a". Сначала замените -a на /dev/winswap. Затем, сразу после этой строки вставьте следующие команды. </P
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="http://www.linux.org.ru/books/images/caution.gif"
HSPACE="5"
ALT="Предостережение"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><I
CLASS="EMPHASIS"
>Замечание для RedHat Linux 6.1:</I
> По-видимому, скрипт завершения работы в Red
Hat Linux 6.1 автоматически находит все разделы подкачки и отключает их.
Поэтому пользователям RedHat Linux 6.1 <I
CLASS="EMPHASIS"
>не</I
> требуется заменять команду
<TT
CLASS="LITERAL"
>swapoff
$SWAPS</TT
> на <TT
CLASS="LITERAL"
>swapoff -a</TT
>. В этом случае, просто добавьте команду
<TT
CLASS="LITERAL"
>/etc/rc.d/init.d/swaphalt.sh</TT
> к файлу halt</P
></TD
></TR
></TABLE
></DIV
><P
>&#13;<PRE
CLASS="SCREEN"
># ------------------------------------------------------------------------ 
# Изменено ФИО 
# заменено "swapoff -a" на "swapoff /dev/winswap" 
# 
# Отключаем подкачку, затем отключаем фалйовые системы.
runcmd "Отключаем подкачку и учет ресурсов" swapoff /dev/winswap 
[ -x /sbin/accton ] &amp;&amp; /sbin/accton 
# ------------------------------------------------------------------------ 
 
# ------------------------------------------------------------------------ 
# Добавлено ФИО
# проверяем сигнатуру области подкаки и восстанавливаем информацию о файле подкачки Windows
/etc/rc.d/init.d/swaphalt.sh 
# ------------------------------------------------------------------------&#13;</PRE
>
 </P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN228"
>6.5. Включите подкачку</A
></H2
><P
>Уберите комментарий со строки с разделом подкачки в файле /etc/fstab (который вы добавили ранее). (Это конечно необязательно, так как мы больше не используем fstab для разделов подкачки). Перезагрузите Linux. У вас должна быть включена подкачка на новом устройстве подкачки. 
&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN231"
>7. Пара замечаний</A
></H1
><P
> 

<P
></P
><UL
><LI
><P
>Нет никакой необходимости добавлять /dev/winswap в файл /etc/fstab. Скорее всего, это вообще нельзя делать (если только как комментарий). 
&#13;</P
></LI
><LI
><P
> 
Если ваш Linux однажды аварийно прекратит работу без выполнения /etc/rc.d/init.d/halt, то вам придется перезагрузиться, загрузить Linux и выйти из него корректно -  только в этом случае подкачка в Windows будет работать нормально. Есть другой способ - дать команду FORMAT X: и создать файл подкачки Windows снова. Еще один путь был вроде очевиден - в файл AUTOEXEC.BAT DOS поместить некую программу-эквивалент /.../halt из Linux. Я пытался не раз написать подобную программу, но это ни к чему, кроме проблем, не привело! Первое и главное, что происходило - восстановление всех специальных секторов не удовлетворяет DOS. Скорее всего, необходимо также исправлять какие-то внутренние структуры DOS, чтобы он нормально понимал наличие диска, иначе DOS выдает примерно следующую ошибку: 


<PRE
CLASS="SCREEN"
>Invalid media type reading drive X:
Abort, Retry or Fail ?</PRE
>

Я не очень хорошо разбираюсь в деталях обработки дисков в DOS и Windows - я думаю, что по этому вопросу вам надо обратиться к специалистам по DOS. Конечно, если вас не беспокоит скорость загрузки, то вы просто можете при загрузке давать безусловную команду форматирования диска X: и после этого восстанавливать специальные сектора. Может быть, существуют другие решения. Если вы знаете такое решение, напишите мне сегодня!&#13;</P
></LI
><LI
><P
> 
Еще одним способом восстановления раздела подкачки Windows является следующий: загрузите Linux, отключите подкачку (как было описано выше) и затем дайте следующие команды: 

<PRE
CLASS="SCREEN"
> 
# swapoff -a 
# zcat /etc/winswap.gz &#62; /dev/winswap 
# reboot </PRE
>&#13;</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Зачем необходимо удалять каталог RECYCLED?</I
> В соответствии с тем, что было
описано выше, вы должны удалить каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
>. Это необходимо потому,
что мы будем сохранять и восстанавливать только сектора с начала раздела по
корневой каталог включительно, но не более того. Другой нашей задачей
является то, чтобы диск X: восстанавливался в "нормальном" состоянии и без
ошибок. Если мы бы не удалили каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
>, то сам он конечно бы
восстановился, но его содержимое, а точнее точки "." и ".." не
восстановились бы, и ScanDisk выдавал бы ошибку. Чтобы этого не случилось, мы
удаляем каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
> и, таким образом, восстанавливаться будет только
строка, отвечающая за файл win386.swp.</P
></LI
><LI
><P
>Если FDISK из DOS сообщает, что наш раздел является "логическим диском DOS", то его номер 5 (т.е. /dev/hda5) или больше. В этом случае он *НЕ* является разделом, называемым "расширенным", с номером 4 или меньше!! Если ваш fdisk в Linux не показывает логические разделы, то у вас нерабочая версия fdisk (В Slackware 2.2, например, был такой fdisk.) Вы можете использовать "cfdisk", если он у вас есть, или вам придется найти работающий fdisk. &#13;</P
></LI
><LI
><P
>При отключенной подкачке Linux вынужден все обрабатывать в основной памяти самостоятельно. Если в вашей системе немного памяти, скажем 16 Мб, то некоторые большие приложения, запускаемые в процессе загрузки системы, могут функционировать не совсем корректно. Например, вы можете получить следующее сообщение в процессе загрузки: </P
><P
>&#13;<PRE
CLASS="SCREEN"
>Finding module dependencies Out of memory</PRE
>&#13;</P
><P
>Я не думаю, что это может вызвать какие-то проблемы до возврата к
нормальному режиму подкачки. Но предосторожности никогда не помешают. Как
вы узнаете из того, что написано ниже, Linux может использовать файл
подкачки, вместо раздела. Поэтому, если вам кажется, что Linux не будет
работать нормально, используя только основную память, создайте временный
файл подкачки, который можно использовать до тех пор, пока не
восстановите подкачку на разделе. Этот файл подкачки лучше всего разместить
в корневом каталоге. Подсчитайте минимальный размер файла подкачки, который
вам будет необходим. Скорее всего он будет равен размеру вашей основной
памяти. Создайте файл подкачки следующими командами (предполагаем, что он  
размером 16 Мб):</P
><P
>&#13;<PRE
CLASS="SCREEN"
># dd if=/dev/zero of=/swap bs=1024 count=16384
# mkswap /swap 16384
# sync</PRE
>&#13;</P
><P
>После этого поместите команду <TT
CLASS="LITERAL"
>swapon /swap</TT
> сразу после <TT
CLASS="LITERAL"
>swapon -a</TT
> в файле
rc.sysinit. Таким образом ваша система будет настроена на использование
файла подкачки, что, наверно, исключит ошибки типа "Не хватает памяти".
После того, как вы получите работающий раздел подкачки (т.е. после
исполнения всех инструкций этого HOWTO), вы можете убрать строку <TT
CLASS="LITERAL"
>swapon /swap</TT
>, которую  добавили в файл rc.sysinit.</P
></LI
><LI
><P
> 
Пожалуйста, не пишите мне, пока не проверите дважды правильность копирования скриптов из этого документа. Больше половины проблем с применением этого Мини-HOWTO возникали из-за опечаток при переписывании скриптов. (Используйте копирование и вставку, если это возможно!). Даже неправильное использование пробелов может вызвать ошибку . Например, если при загрузке вы получаете ошибку типа 

<PRE
CLASS="SCREEN"
> 
Verifying swap space...Linux signature found 
swapon: /dev/winswap invalid argument </PRE
>&#13;</P
><P
>то, скорее всего, вы опечатались в скрипте. Еще раз перепроверьте все ваши скрипты.</P
></LI
><LI
><P
> 
Иногда скрипт не может определить принадлежность раздела ни к Linux, ни к Windows, и появляется ошибка "Сигнатура не найдена". Я пока еще точно не знаю, почему это происходит, но на этот случай я шесть раз запускаю в скриптах swap????.sh, код определения сигнатуры, перед тем, как выдавать ошибку. Обычно DOS-сигнатура находится с первого раза, но иногда на моей системе она обнаруживается со 2-го, 5-го раза или не обнаруживается даже после 12 попыток.. Вы можете просто увеличить количество попыток до 12 или 24, ничего страшного в этом нет. Однажды на моей системе скрипт не мог определить сигнатуру даже после 50 попыток! Если такая ситуация возникнет, то вы можете создать в вашем домашнем каталоге символьную ссылку на файл swapinit.sh и запускать его при запуске системы. 

<PRE
CLASS="SCREEN"
>       
# ln -s /etc/rc.d/init.d/swapinit.sh swapinit.sh 
# ./swapinit.sh  </PRE
>&#13;</P
><P
>Однако. я еще подметил, что если несколько раз запускать этот скрипт, то сигнатуры начинают определяться без проблем с первого раза. 
&#13;</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Для увеличения надежности </I
></P
><P
>В вашем Linux запускается нечто очень важное, или у вашей системы очень
мало основной памяти, и приложения просто перестают работать? Вы настроили
совместное с Windows использование раздела подкачки. Но, иногда, ваша
система не может определить соответствующие сигнатуры и запрещает подкачку
вообще. <I
CLASS="EMPHASIS"
>На свой собственный страх и риск</I
> вы можете удалить логику проверки
сигнатур, но есть более приемлемое решение.</P
><P
>Сначала прочтите <A
HREF="Swap-Space.html#SWAPFILE"
>советы, приведенные выше,</A
>
и создайте файл подкачки в корневом каталоге вашего Linux, назвав его
/swap. Его размер установите таким, какой вам необходимо. Затем откройте
файл swapinit.sh и измените последний оператор <TT
CLASS="LITERAL"
>if</TT
> следующим образом:</P
><P
>&#13;<PRE
CLASS="SCREEN"
>if [ $activated -ne 1 ] ; then 
  echo "Сигнатура подкачки не найдена после $loopcount попыток (Swap signature not found after $loopcount tries)" 
  echo "Активизирую файл подкачки (Activating swap file)"
  swapon /swap
  exit 1 
fi&#13;</PRE
>&#13;</P
><P
>Таким образом, если на разделе подкачки отсутствуют необходимые сигнатуры,
то  мы разрешаем использование файла подкачки. Так как файл подкачки
находится в корневом каталоге, а ядро Linux не запускается без подключения
корневой файловой системы, то получается, что файл подкачки всегда будет
нормально активизироваться. Вместо создания и хранения файла подкачки,
использующего впустую дисковое пространство, вы можете изменит код скрипта,
включив в него повторное создание файла подкачки <I
CLASS="EMPHASIS"
>на ходу</I
>.</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Более эффективное использование дискового пространства</I
>
Как мы уже показали, Linux и Windows могут совместно использовать раздел подкачки. Но что делать, если Windows не нужен такой большой файл подкачки, полностью занимающий раздел подкачки Linux? В этом случае, вы можете на разделе подкачки иметь свободное место (уменьшите размер файла подкачки Windows до необходимых размеров). Подкачка Windows-программ обрабатывается Windows самостоятельно. Но некоторые DOS-программы, например, Turbo C++ Compiler, Norton DOS и т.п. также создают свои файлы подкачки. В этом случае возможно их настроить таким образом, чтобы они свои личные файлы подкачки создавали на нашем разделе, вместо обычного местоположения. Это увеличит свободное место на основных дисках. Более того, некоторые из этих программ "забывают" удалить свои файлы подкачки, что приводит к неэффективному использованию дискового пространства. Но, используя нашу настройку, вы, каждый раз после завершения работы в Linux, получаете чистый раздел подкачки, тем самым исключая необходимость поиска и удаления старых файлов подкачки DOS-программ. Например, вы можете указать Turbo C++ использовать для подкачки, скажем, диск E:, запустив его командой 
<PRE
CLASS="SCREEN"
>C:\CLAN&#62;TC /RE</PRE
>

В Norton DOS настройте переменные файла NDOS.INI следующим образом: 

<PRE
CLASS="SCREEN"
>Swapping = E:\</PRE
>
Многие программы используют переменные окружения <TT
CLASS="LITERAL"
>TEMP</TT
> или <TT
CLASS="LITERAL"
>TMP</TT
> для
определения местоположения файлов подкачки. Вы можете настроить в файле
AUTOEXEC.BAT эти переменные так, чтобы они тоже указывали на данный раздел.</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
> Что делать, если раздел подкачки отформатирован как FAT32 ?   </I
>
К сожалению, нельзя отформатировать этот раздел  в формате FAT32. Во-первых, Linux не может иметь раздел подкачки больше 128MB. Это означает, что если он  больше 128MB, то часть этого раздела просто не используется. А Windows откажется конвертировать в FAT32 раздел размером 128MB. </P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Новый формат области подкачки  </I
>
Linux известны два формата областей подкачки - так называемые "новый" и "старый". По умолчанию вы будете использовать "старый" формат области подкачки с сигнатурой "SWAP-SPACE". Если вы хотите использовать "новый" формат этой области, то замените фразу "SWAP-SPACE" во всех приведенных здесь скиптах на "SWAPSPACE2". Также добавьте опцию -v1 к команде mkswap в скрипте swapinit.sh: 

<PRE
CLASS="SCREEN"
> 
/sbin/mkswap -v1 /dev/winswap YYYYY </PRE
>&#13;</P
><P
>И, в дополнение к этому, запустите следующие команды: 

<PRE
CLASS="SCREEN"
>   
# swapoff /dev/winswap 
# mkswap -v1 /dev/winswap YYYYY 
# swapon /dev/winswap </PRE
>&#13;</P
><P
>При использовании "нового" формата размер области подкачки может достигать 2 Гб на i386-платформах. Это означает, что вы можете использовать этот раздел  больше чем 512 Мб, которые Windows может преобразовать в FAT32. Кто-нибудь, помогите мне с записью "Набора Специальных Секторов" с раздела FAT32.</P
></LI
></UL
>
 </P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN299"
>8. Что же мы сделали на самом деле?</A
></H1
><P
>&#13;<P
></P
><UL
><LI
><P
>И Windows, и Linux используют области подкачки. Когда ОС выключена, эта 
область содержит абсолютно ненужный мусор, и ОС абсолютно не важно, что
находится в области подкачки. Проблема состоит в следующем: выделять
отдельно для Linux область подкачки размером 60 Мб и для Windows около 32
Мб не очень эффективно - в один момент времени работает только одна ОС
(Возможно запустить одновременно и Linux и Windows - спасибо VMWare. За
более подробной информацией обращайтесь на <A
HREF="http://www.vmware.com"
TARGET="_top"
>сайт VMWare</A
>). Итак, мы хотим
чтобы Linux и Windows использовали одно и то же пространство на диске для
подкачки.</P
></LI
><LI
><P
>Проблема состоит в том, что Linux использует для подкачки раздел на диске,
а Windows использует файл. (Возможно использовать и в Linux файл подкачки,
но это не рекомендуется. Смотрите <I
CLASS="EMPHASIS"
>"Руководство по установке и первому
запуску Linux"</I
> автора Matt Welsh). Поэтому, если Linux будет
использовать тот же раздел, где хранится файл подкачки Windows, он
перезапишет загрузочный сектор, FAT и другие таблицы, которые должны быть,
по предположению Windows, на каждом диске. В результате этого, Windows не
обнаружит файл подкачки на этом разделе и создаст файл win386.swp в
каталоге windows. Таким образом, если даже ваш Linux аварийно завершит
работу, Windows сможет запуститься. Если это произойдет (т.е. файл подкачки
Windows будет находиться в каталоге Windows), восстановите область подкачки
DOS/Windows простым перезапуском Linux. После этого Windows будет
использовать файл подкачки на диске X, и вы можете спокойно удалять файл
win386.swp в каталоге windows.
&#13;</P
></LI
><LI
><P
>Суть наших действий состоит в том, чтобы сохранять критичные для Windows таблицы данных с начала раздела подкачки где-нибудь в файле, находящемся в разделе Linux. При каждом запуске Linux мы проверяем, кто последний раз использовал область подкачки - Linux или Windows (используя метку, которую вы проставили этому разделу). Если это был Linux, то мы просто разрешаем подкачку, а иначе сначала создаем раздел подкачки на диске X: командой "mkswap /dev/winswap" и только затем разрешаем подкачку.  </P
></LI
><LI
><P
> 
Очень важно для нормального последующего запуска Windows восстановить формат FAT на разделе подкачки при выключении Linux. Для этого мы используем команду 

<PRE
CLASS="SCREEN"
> 
/bin/zcat /etc/winswap.gz &#62; /dev/winswap </PRE
>&#13;</P
><P
>в файле halt.</P
></LI
></UL
>
 </P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="SWAPINIT"
>9. Скрипт swapinit.sh</A
></H1
><P
>    
Этот скрипт инициализирует область подкачки на разделе. Код, отвечающий за определение сигнатуры, повторяется 6 раз, так как сигнатура иногда правильно определяется со второго или третьего раза. (Основано на скрипте, приведенном в Swap-Space-HOWTO автора H. Peter Anvin) </P
><P
>&#13;<PRE
CLASS="SCREEN"
>#!/bin/sh 
# 
# swapinit.sh - активизируем раздел подкачки (activate the swap partition) 
# 
# автор Rahul U. Joshi, перевод Станислав Рогин
# Проверяем и инициализируем область подкачки (Verify and initialize swap space)
# 
 
echo -n 'Проверка области подкачки (Verifying swap space...)' 
 
loopcount=0
 
# Флаг, указывающий, активизирован ли раздел
# flag to indicate whether the partition has been activated or not)
activated=0 
 
# Проверяем сигнатуру до 6 раз
# check for signatures 6 times before giving up
while [ $loopcount -lt 6 ] 
  do 
 
  if [ "`/bin/dd 2&#62;/dev/null if=/dev/winswap bs=1 count=10  skip=4086`" = 'SWAP-SPACE' ]; then 
    echo "Сигнатура Linux обнаружена с $loopcount раза" 
    echo "Активация раздела подкачки"  
    echo "Linux signature found, iteration $loopcount" 
    echo "Activating swap partitions"  
    swapon /dev/winswap 
    activated=1 
    break 
 
  elif [ "`/bin/dd 2&#62;/dev/null if=/dev/winswap bs=1 count=11 skip=43`" = 'SWAP SPACE ' ]; then    
    echo "Сигнатура DOS обнаружена с $loopcount раза" 
    echo "Подготовка раздела подкачки"   
    echo "DOS signature found, iteration $loopcount" 
    echo "Making swap partition"   
    mkswap /dev/winswap YYYYY 
    echo "Активация раздела подкачки"  
    echo "Activating swap partitions"  
    swapon /dev/winswap 
    activated=1 
    break 
 
  else    
   let loopcount=loopcount+1 
  fi   
 
  done 
 
if [ $activated -ne 1 ] ; then 
  echo "Сигнатура не найдена после $loopcount попыток" 
  echo "Разделы подкачки не активизированы" 
  echo "Swap signature not found after $loopcount tries" 
  echo "No swapping partitions activated" 
  exit 1 
fi
 &#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="SWAPHALT"
>10. Скрипт swaphalt.sh</A
></H1
><P
>Этот скрипт сначала проверяет сигнатуру области подкачки Linux, а затем восстанавливает на разделе файловую систему Windows. </P
><P
>(Основано на скрипте, приведенном в Swap-Space-HOWTO автора H. Peter Anvin) </P
><P
>&#13;<PRE
CLASS="SCREEN"
> 
#!/bin/sh 
# 
# swaphalt.sh   Этот файл вызывается из /etc/rc.d/init.d/halt           
#	       после того, как будут выключены учет ресурсов и подкачка
#
#               This file is executed through the /etc/rc.d/init.d/halt
#	       script after swapping and accounting has been turned off.
# 
# Автор:        Rahul U. Joshi        Перевод: Станислав Рогин
# 
 
# проверяем сигнатуру раздела подкачки и восстанавливаем таблицы данных Windows
 
loopcount=0 
 
# флаг, указывающий была ли восстановлена информация раздела подкачки Windows
# flag to indicate whether the swap info has been restored or not 
restored=0 
 
# проверяем сигнатуру до 3 раз (check for swap signature 3 times before giving up)
while [ $loopcount -lt 3 ] 
  do 
 
  if [ "`/bin/dd 2&#62;/dev/null if=/dev/winswap bs=1 count=10 skip=4086`" = 'SWAP-SPACE' ]; then 
    echo "Восстановление структуры раздела подкачки DOS/Windows ($loopcount-я попытка)"  
    echo "Restoring DOS/Windows swap info , iteration $loopcount)"  
    /bin/zcat /etc/winswap.gz  &#62;  /dev/winswap 
    restored=1 
    break 
  else 
    loopcount=loopcount+1 
  fi 
 
  done 
 
if [ $restored -ne 1 ] ; then 
   echo "Сигнатура области подкачки не обнаружена после $loopcount попыток" 
   echo "Swap signature not found after $loopcount tries" 
   echo "Восстановление таблиц не произведено" 
   echo "Skipping restoring" 
fi
 
 </PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="MSINFO.SH"
>11. Скрипт msinfo.sh</A
></H1
><P
>    
Этот скрипт анализирует загрузочный сектор заданного раздела и выдает различную информацию, включая "Общее Количество Специальных Секторов". Скрипт предполагает, что на данном разделе установлена файловая система FAT16. Если это не так, он выдаст сообщение об ошибке и прекратит работу. Скрипт запускается следующим образом 

<PRE
CLASS="SCREEN"
> 
# msinfo &#60;наименование раздела&#62; 
 </PRE
>
 </P
><P
>Для запуска этого скрипта вам понадобится программа "dialog", которая может
выводить диалоговые окна на экран. Вы можете найти ее <A
HREF="http://sunsite.unc.edu/pub/Linux/utils/shell"
TARGET="_top"
>здесь</A
>.</P
><P
>&#13;<PRE
CLASS="SCREEN"
>#!/bin/sh 
# 
# msinfo.sh           Этот скрипт показывает содержание загрузочного
#                     сектора заданного раздела.
#                     This shell script displays the boot sector of the 
#                     given partition.
# 
# Автор:              Rahul U. Joshi 
# Перевод:            Станислав Рогин
# 
# Изменения           Убрано использование команды expr, замененной на команду let 
# Modifications       Removed the use of expr and replaced it by the let 
#                     command. 
 
 
# проверяем параметры командной строки
# check for command line arguments 
if [ $# -ne 1 ]; then 
   echo "Использование: msinfo &#60;наименование раздела&#62;" 
   exit 1 
fi 
 
# проверяем, является ли входной файл блочным устройством
# check whether the input name is a block device 
if [ ! -b $1 ]; then 
   echo "msinfo: $1 не является блочным устройством"
   exit 1 
fi 
 
# создаем два временных файла
# create two temporary files for use 
TMPFILE=`mktemp -q /tmp/$0.XXXXXX` 
if [ $? -ne 0 ]; then 
    echo "msinfo: Не могу создать временный файл, прекращаю работу..." 
    exit 1 
fi 
 
TXTFILE=`mktemp -q /tmp/$0.XXXXXX` 
if [ $? -ne 0 ]; then 
   echo "msinfo: Не могу создать временный файл, прекращаю работу..." 
   rm -f $TMPFILE 
   exit 1 
fi 
 
backtitle="`printf "%78s" "msinfo, Информация о файловой системе FAT16 -- Rahul Joshi"`" 
 
dialog --title "Загрузочный сектор $1" --backtitle "$back_title" --infobox "\nАнализирую загрузочный сектор $1\nПодождите..."  14 60 
 
# создаем пустой текстовый файл TXTFILE
# truncate TXTFILE to zero length 
echo &gt; $TXTFILE 
 
# Получаем версию форматировавшей DOS
# get Formatting DOS version 
dd 2&#62;/dev/null if=$1  bs=1 count=8 skip=3 | dd 2&gt;/dev/null of=$TMPFILE 
printf &gt;&gt;$TXTFILE "%30s : %s\n" "Версия форматировавшей DOS" "`cat $TMPFILE`" 
 
 
# Получаем файловую систему
# get file system 
dd 2&gt;/dev/null if=$1  bs=1 count=8 skip=54 | dd 2&gt;/dev/null of=$TMPFILE 
printf &gt;&gt;$TXTFILE "%30s : %s\n" "Файловая система" "`cat $TMPFILE`" 
 
# проверяем, является ли файловая система FAT16 
# check if filesystem in a FAT16 
if [ "`cat $TMPFILE`" != "FAT16   " ]; then 
  dialog --title "Загрузочный сектор $1" --backtitle "$back_title" --infobox  "\nФайловая система $1 не является FAT16"  14 60 
  exit 2 
fi 
 
# Получаем метку тома из загрузочного сектора
# get volume label in boot sector 
dd 2&gt;/dev/null if=$1  bs=1 count=11 skip=43 | dd 2&gt;/dev/null of=$TMPFILE 
printf &gt;&gt;$TXTFILE "%30s : %s\n" "Метка тома в загрузочном секторе" "`cat $TMPFILE`" 
  
 
# Получаем размер сектора
# get Sector size 
dd 2&gt;/dev/null if=$1  bs=1 count=2 skip=11| od -An -tdS | dd 2&gt;/dev/null of=$TMPFILE 
printf &gt;&gt;$TXTFILE "%30s : %d\n" "Размер сектора" `cat $TMPFILE` 
sector_size=`cat $TMPFILE` 
 
 
# Получаем количество резервных секторов
# get Reserved sectors 
dd 2&gt;/dev/null if=$1  bs=1 count=2 skip=14| od -An -tdS | dd 2&gt;/dev/null of=$TMPFILE 
printf &gt;&gt;$TXTFILE "%30s : %d\n" " Резервные сектора" `cat $TMPFILE` 
reserved_sectors=`cat $TMPFILE` 
 
 
# Получаем количество секторов FAT
# get FAT sectors 
dd 2&gt;/dev/null if=$1  bs=1 count=1 skip=16| od -An -tdS | dd 2&gt;/dev/null of=$TMPFILE 
fat_count=`cat $TMPFILE` 
 
dd 2/dev/null if=$1  bs=1 count=2 skip=22| od -An -tdS | dd 2&#62;/dev/null of=$TMPFILE 
sectors_per_fat=`cat $TMPFILE` 
 
# расчитываем количество секторов, занимаемых FAT
# calculate the no of sectors allocated for FAT's 
let fat_sectors=fat_count*sectors_per_fat 
 
printf &gt;&gt;$TXTFILE "%30s : %u (%u x %u) \n" "Секторов FAT" "$fat_sectors" "$fat_count" "$sectors_per_fat" 
 
 
# Получаем количество секторов в корневом каталоге
# get root directory sectors 
dd 2&gt;/dev/null if=$1  bs=1 count=2 skip=17| od -An -tdS | dd 2&gt;/dev/null of=$TMPFILE 
root_sectors=`cat $TMPFILE` 
 
# расчитываем количество секторов, занимаемых корневым каталогом
# calculate the no of sectors allocated for root directory 
let root_sectors=root_sectors*32/sector_size 
 
printf &gt;$TXTFILE "%30s : %u\n" "Секторов корневого каталога" "$root_sectors" 
 
 
# получаем Общее Количество Специальных Секторов
# get Total special sectors 
let total=reserved_sectors+fat_sectors+root_sectors 
printf &gt;&gt;$TXTFILE "%30s : %u\n" "Всего специальных секторов" "$total" 
 
 
# вывод информации
dialog --title "Загрузочный сектор $1"  --backtitle "$back_title"  --msgbox "`cat $TXTFILE`" 14 60 
  
# удаление временных файлов
# delete temporary files
rm -f $TMPFILE 
rm -f $TXTFILE 
 
# end of msinfo.sh&#13;</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN334"
>12. Изначальный файл msinfo</A
></H1
><P
>Здесь приведен файл msinfo, при помощи которого можно определить "Общее Количество Специальных Секторов". Он был включен первоначальным автором этого HOWTO в закодированной форме. Скопируйте текст, начиная со строки "begin 755 msinfo.gz" до строки "end" во временный файл, скажем temp.uu. Затем раскодируйте и разархивируйте этот файл, чтобы получить файл msinfo. 
<PRE
CLASS="SCREEN"
> 
# uudecode temp.uu 
# gunzip  msinfo.gz  </PRE
>&#13;</P
><P
>Затем запустите программу командой 

<PRE
CLASS="SCREEN"
>    
# ./msinfo /dev/winswap </PRE
>
 
Эта программа показывает информацию из загрузочного сектора, включая "Общее
Количество Специальных Секторов".

<PRE
CLASS="SCREEN"
>begin 755 msinfo.gz 
---------------------------------------------------------------------
   Примечание переводчика: В этом месте автором текста была приведена
   программа msinfo.gz в формате UUENCODE. Однако многократные
   преобразования этого HOWTO могли повредить этот файл. Даже если он не
   был бы поврежден, то он бы выводил сообщения на английском. Используйте
   скрипт из предыдущей главы.
---------------------------------------------------------------------
end </PRE
>
 </P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="SECT1.4"
>13. Замечания для читателей версии 1.4 этого документа</A
></H1
><P
>Я, к сожалению, выяснил, что мои советы, данные в версии 1.4 этого документа содержали ошибку. Если вы использовали советы из версии 1.4 для настройки совместного использования пространства подкачки Linux и Windows и, в результате, получаете от ScanDisk сообщения об ошибках на диске X:, проделайте следующее: </P
><P
>&#13;<P
></P
><UL
><LI
><P
>Во-первых, загрузите Linux, и закомментируйте строку в файле rc.sysinit
file строку, отвечающую за вызов скрипта swapinit.sh, а также из файла halt
строку, отвечающую за вызов swaphalt.sh. В результате этого, при последующем
запуске Linux у вас будут отсутствовать области подкачки. <I
CLASS="EMPHASIS"
>Если у вас мало
системной памяти</I
>, создайте временный файл подкачки. Как это сделать, читайте
в разделе "Пара замечаний".</P
></LI
><LI
><P
>Затем, выключите Linux, запустите Windows, нажмите F8 при начале загрузки и загрузите систему в режиме "Command prompt only" из появившегося меню. Затем выполните следующие команды: 

<PRE
CLASS="SCREEN"
>C:\&#62;SCANDISK X:</PRE
>&#13;</P
><P
>ScanDisk сообщит, что каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
> поврежден. Укажите ему исправить
ошибки. Он может также найти потерянные кластера. Укажите ему удалить их.
Короче, исправьте все ошибки на диске X:, убедившись в том, что ScanDisk не
затронул файл win386.swp. Вы можете, например, запомнить размер файла
win386.swp до проверки, сравнив его затем с тем, что будет после ScanDisk.
Если ScanDisk изменил размер win386.swp, добавьте что-нибудь к нему, или
удалите из него лишнее, чтобы восстановить его размер.</P
></LI
><LI
><P
>Удалите все с диска X: кроме файла win386.swp. Удалите все другое
содержимое, включая каталог <TT
CLASS="LITERAL"
>RECYCLED</TT
>. Чтобы его удалить, используйте
следующие команды:
<PRE
CLASS="SCREEN"
>C:\&#62;X:
X:\&#62;ATTRIB -R -H -S RECYCLED
X:\&#62;DELTREE RECYCLED</PRE
>&#13;</P
></LI
><LI
><P
>Запустите Linux. Зайдите в систему root-ом и сделайте следующее: 

<PRE
CLASS="SCREEN"
># dd if=/dev/winswap bs=512 count=XXX | gzip -9 &#62; /etc/winswap.gz</PRE
>&#13;</P
><P
>где XXX - известное уже вам "Общее Количество Специальных Секторов". </P
></LI
><LI
><P
>Раскомментируйте команды в файлах swapinit.sh и swaphalt.sh, которые закомментировали ранее, и удалите из них все команды, добавленные вами для использования файла подкачки. Теперь с вашей системой все в порядке. &#13;</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN364"
>14. Благодарности, отзывы и посвящения</A
></H1
><P
>Этот Mini-HOWTO в значительной степени отталкивается от документа
Swap-Space Mini HOWTO (автор <I
CLASS="EMPHASIS"
>H. Peter Anvin</I
>). Я добавил сюда специфичные
вещи для Windows 95/98. Программа msinfo, полученная из оригинального HOWTO,
не работала на моей системе Red Hat Linux 6, я сделал подобную программу.
Однако, я также включил сюда оригинальную программу msinfo. Спасибо всем
людям, которые собрали превосходный дистрибутив Linux - <I
CLASS="EMPHASIS"
>Red Hat</I
> и особенно
<I
CLASS="EMPHASIS"
>Sanjiv Guha</I
> - один из соавторов "Red Hat Linux 6 Unleashed". Спасибо <I
CLASS="EMPHASIS"
>Matt Welsh</I
>,<I
CLASS="EMPHASIS"
> Greg Hankins</I
> и <I
CLASS="EMPHASIS"
>Eric S. Raymond</I
> - авторам SGML-Tool's Users Guide,
которые помогли мне конвертировать этот документ в SGML формат. Спасибо
<I
CLASS="EMPHASIS"
>Peter Norton</I
> и <I
CLASS="EMPHASIS"
>John Goodman</I
> за издание "Peter Norton's Inside the PC",
которое помогло мне разобраться в структуре файловой системы DOS.</P
><P
>Я полагаю, читатели, что этот HOWTO будет вам полезен. Если у вас
появляться предложения, комментарии, исправления, вопросы, флейм и т.п., не
стесняйтесь связаться со мной (jurahul@hotmail.com или
<A
HREF="mailto:amitanatu@sprynet.com"
TARGET="_top"
>amitanatu@sprynet.com</A
>).</P
><P
>Наконец, я хотел бы выделить работу <I
CLASS="EMPHASIS"
>Robert Lafore</I
> - автора замечательных
книг "Программирование на C с использованием Turbo C++" и
"Объектно-ориентированное программирование с использованием Turbo C++".</P
><P
>Наслаждайтесь Linux, </P
><P
>Rahul :-) </P
></DIV
></DIV
></BODY
></HTML
>