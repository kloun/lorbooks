<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Мини-HOWTO: Удаленная загрузка и Linux: Настройка удаленно загружаемых рабочих станций с Linux, DOS, Windows 95/98 и Windows NT </TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Мини-HOWTO: Удаленная загрузка и Linux: Настройка удаленно загружаемых рабочих станций с Linux, DOS, Windows 95/98 и Windows NT</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Marc Vuilleumier Stuckelberg</A
></H3
><H3
CLASS="AUTHOR"
><A
NAME="AEN8"
>David Clerc</A
></H3
><H3
CLASS="CORPAUTHOR"
> Перевод: <A
HREF="mailto:sam@asp-linux.com"
TARGET="_top"
>Станислав Рогин</A
>,
 <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>Версия 3.19, Февраль 1999 года<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>В этом документе содержится информация о том, как создать защищенный кластер PC,
основанный на сервере и позволяющий каждому клиенту выбирать при загрузке
компьютера необходимую операционную систему. Основой подобной конфигурации
является программа, базирующаяся на BootPROM, позволяющая пользователю
выбирать при загрузке один из образов загрузочного диска. Ее можно
реализовать, при помощи InCom TCP/IP BootPROM (дополнительный компонент,
подходящий почти ко всем сетевым картам) или любого PXE-совместимого BootROM
(он часто бывает установлен в компьютеры со встроенными сетевыми картами).
Последнюю версию этого документа (со ссылками на программы и сопутствующие
материалы) можно найти по адресу
<A
HREF="http://cuiwww.unige.ch/info/pc/remote-boot/howto.html"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/howto.html</A
>. В том же каталоге
находятся версии этого документа в формате <A
HREF="http://www.linux.org.ru/books/HOWTO/howto.sgml"
TARGET="_top"
>Linuxdoc-SGML</A
>,
<A
HREF="http://www.linux.org.ru/books/HOWTO/howto.dvi"
TARGET="_top"
>DVI</A
> и
<A
HREF="http://www.linux.org.ru/books/HOWTO/howto.ps"
TARGET="_top"
>PostScript</A
>. Если вы хотите, чтобы вам присылалась информация о дальнейшем
развитии проекта, пишите по адресу <TT
CLASS="LITERAL"
><A
HREF="mailto:David.Clerc@cui.unige.ch"
TARGET="_top"
>David.Clerc@cui.unige.ch</A
></TT
>.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Remote-Boot.html#AEN23"
>Disclaimer and Copyrights</A
></DT
><DT
>2. <A
HREF="Remote-Boot.html#AEN32"
>Авторские права</A
></DT
><DT
>3. <A
HREF="Remote-Boot.html#AEN41"
>Что изменилось...</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="Remote-Boot.html#AEN43"
>...по сравнению с версией 2.x?</A
></DT
><DT
>3.2. <A
HREF="Remote-Boot.html#AEN84"
>...по сравнению с версией 3.0?</A
></DT
></DL
></DD
><DT
>4. <A
HREF="Remote-Boot.html#AEN140"
>Введение</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="Remote-Boot.html#AEN173"
>Boot ROM и Жесткий диск</A
></DT
><DT
>4.2. <A
HREF="Remote-Boot.html#AEN183"
>Сеть</A
></DT
><DT
>4.3. <A
HREF="Remote-Boot.html#AEN188"
>Как это работает</A
></DT
><DT
>4.4. <A
HREF="Remote-Boot.html#AEN235"
>Сопутствующая некоммерческая документация</A
></DT
></DL
></DD
><DT
>5. <A
HREF="Remote-Boot.html#AEN259"
>Описание конфигурации</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="Remote-Boot.html#AEN273"
>Конфигурирование сервера</A
></DT
><DD
><DL
><DT
>5.1.1. <A
HREF="Remote-Boot.html#AEN288"
>Настройка DHCP</A
></DT
><DT
>5.1.2. <A
HREF="Remote-Boot.html#AEN303"
>Настройка Прокси-DHCP</A
></DT
><DT
>5.1.3. <A
HREF="Remote-Boot.html#AEN321"
>Настройка TFTP</A
></DT
></DL
></DD
><DT
>5.2. <A
HREF="Remote-Boot.html#AEN332"
>Настройка клиентских машин</A
></DT
><DT
>5.3. <A
HREF="Remote-Boot.html#AEN353"
>Настройка процесса загрузки</A
></DT
><DD
><DL
><DT
>5.3.1. <A
HREF="Remote-Boot.html#AEN409"
>Изучаем BpBatch</A
></DT
></DL
></DD
><DT
>5.4. <A
HREF="Remote-Boot.html#AEN442"
>Настройка Linux</A
></DT
><DD
><DL
><DT
>5.4.1. <A
HREF="Remote-Boot.html#AEN448"
>Настройка клиентской машины</A
></DT
><DT
>5.4.2. <A
HREF="Remote-Boot.html#AEN511"
>Проверка конфигурации</A
></DT
><DT
>5.4.3. <A
HREF="Remote-Boot.html#AEN524"
>Создаем образ диска</A
></DT
><DT
>5.4.4. <A
HREF="Remote-Boot.html#AEN545"
>Поддержка системы и обновления</A
></DT
></DL
></DD
><DT
>5.5. <A
HREF="Remote-Boot.html#AEN557"
>Настройка DOS 6 и Windows 3.1</A
></DT
><DD
><DL
><DT
>5.5.1. <A
HREF="Remote-Boot.html#AEN578"
>Создаем образ диска</A
></DT
><DT
>5.5.2. <A
HREF="Remote-Boot.html#AEN611"
>Адаптируем конфигурацию для других машин</A
></DT
><DT
>5.5.3. <A
HREF="Remote-Boot.html#AEN629"
>Поддержка системы и обновления</A
></DT
></DL
></DD
><DT
>5.6. <A
HREF="Remote-Boot.html#AEN641"
>Настройка Windows 95</A
></DT
><DD
><DL
><DT
>5.6.1. <A
HREF="Remote-Boot.html#AEN655"
>Настройка клиентской машины</A
></DT
><DT
>5.6.2. <A
HREF="Remote-Boot.html#AEN664"
>Создаем образ диска</A
></DT
><DT
>5.6.3. <A
HREF="Remote-Boot.html#AEN682"
>Адаптируем конфигурацию для других машин</A
></DT
><DT
>5.6.4. <A
HREF="Remote-Boot.html#AEN708"
>Поддержка системы и обновления</A
></DT
></DL
></DD
><DT
>5.7. <A
HREF="Remote-Boot.html#AEN720"
>Настройка Windows NT</A
></DT
><DD
><DL
><DT
>5.7.1. <A
HREF="Remote-Boot.html#AEN733"
>Создаем образ диска</A
></DT
><DT
>5.7.2. <A
HREF="Remote-Boot.html#AEN749"
>Поддержка системы и обновления</A
></DT
></DL
></DD
><DT
>5.8. <A
HREF="Remote-Boot.html#AEN767"
>Проблемы и их решение (FAQ)</A
></DT
></DL
></DD
><DT
>6. <A
HREF="Remote-Boot.html#AEN949"
>Справочное руководство по утилитам удаленной загрузки</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="Remote-Boot.html#AEN952"
>BpBatch, MrBatch и MrZip</A
></DT
><DD
><DL
><DT
>6.1.1. <A
HREF="Remote-Boot.html#AEN979"
>Опции командной строки</A
></DT
><DT
>6.1.2. <A
HREF="Remote-Boot.html#AEN1014"
>Синтаксические правила</A
></DT
><DT
>6.1.3. <A
HREF="Remote-Boot.html#AEN1135"
>Кэш-раздел</A
></DT
><DT
>6.1.4. <A
HREF="Remote-Boot.html#AEN1143"
>Специальные переменные</A
></DT
><DT
>6.1.5. <A
HREF="Remote-Boot.html#AEN1280"
>Команды контроля состояния</A
></DT
><DT
>6.1.6. <A
HREF="Remote-Boot.html#AEN1337"
>Команды управления</A
></DT
><DT
>6.1.7. <A
HREF="Remote-Boot.html#AEN1396"
>Команды работы с клавиатурой</A
></DT
><DT
>6.1.8. <A
HREF="Remote-Boot.html#AEN1433"
>Команды вывода текста</A
></DT
><DT
>6.1.9. <A
HREF="Remote-Boot.html#AEN1478"
>Команды вывода графики</A
></DT
><DT
>6.1.10. <A
HREF="Remote-Boot.html#AEN1557"
>Команды системы безопасности</A
></DT
><DT
>6.1.11. <A
HREF="Remote-Boot.html#AEN1601"
>Команды работы с диском</A
></DT
><DT
>6.1.12. <A
HREF="Remote-Boot.html#AEN1707"
>Команды загрузки системы</A
></DT
><DT
>6.1.13. <A
HREF="Remote-Boot.html#AEN1754"
>Поддержка различных языков</A
></DT
><DT
>6.1.14. <A
HREF="Remote-Boot.html#AEN1792"
>Команды MrZip</A
></DT
></DL
></DD
><DT
>6.2. <A
HREF="Remote-Boot.html#AEN1851"
>NoBreak.sys</A
></DT
></DL
></DD
><DT
>7. <A
HREF="Remote-Boot.html#AEN1870"
>Специальные TFTP-сервера</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="Remote-Boot.html#AEN1873"
>Улучшенный TFTP-сервер фирмы Incom</A
></DT
><DT
>7.2. <A
HREF="Remote-Boot.html#AEN1876"
>Улучшенный TFTP-сервер для Linux</A
></DT
><DT
>7.3. <A
HREF="Remote-Boot.html#AEN1881"
>Шлюз авторизации</A
></DT
><DT
>7.4. <A
HREF="Remote-Boot.html#AEN1893"
>Широковещательный TFTP-сервер</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN23"
>1. Disclaimer and Copyrights</A
></H1
><P
>This document and the related software are provided as is to the
Linux and Internet community, with no form of warranty. Please
note that <I
CLASS="EMPHASIS"
>some operations related in this document may
destroy the content of your hard-disk</I
>. We assume no liability
for any use, correct or not, of this document and of the related
software.</P
><P
>You are free to do anything you want with the remote-boot tools as long as
you do not make money by selling them or by distributing them
with a commercial product. If you want to commercialize
a product derived from these tools, please contact the authors
first to make a commercial agreement. These remote-boot tools
will remain available for free forever, but we may authorize
derived commercial tools.</P
><P
>These provisions shall be interpreted under and in accordance
with the laws of Switzerland, canton of Geneva. All disputes, defenses,
controversies or claims arrising in conncetion with this document and
the related software, shall be subject to the exclusive
juridiction of the courts of the canton of Geneva, Switzerland.</P
><P
>If you like this program, you can send us a Postcard and/or make
a gift to the <A
HREF="http://www.icrc.org"
TARGET="_top"
>International Committee of the Red Cross (ICRC)</A
> or to the
<A
HREF="http://www.unicef.org"
TARGET="_top"
>UNICEF</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN32"
>2. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN41"
>3. Что изменилось...</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN43"
>3.1. ...по сравнению с версией 2.x?</A
></H2
><P
>Честно говоря - практически все... Концепции сохранились практически без
изменений, но программное обеспечение полностью переделано - оно не имеет
ограничений предыдущих версий и значительно удобнее в работе. Краткий обзор
новых возможностей:
<P
></P
><UL
><LI
><P
>Все функции (bpmenu, bpclean, bpunzip) объединены в одну программу. </P
></LI
><LI
><P
>Программа может запускаться не только из ПЗУ удаленной загрузки (Boot ROM), но и из DOS, Windows 95 и Linux. </P
></LI
><LI
><P
>Программа теперь имеет возможность восстанавливать образы разделов FAT16, FAT32 и EXT2FS. Если кто-то желает реализовать поддержку NTFS - дайте мне знать... Пока пользователи NT должны оставаться на FAT16. </P
></LI
><LI
><P
>Программа имеет возможность не только восстанавливать образы дисков, но и
добавлять и исправлять конкретные файлы, чтобы удовлетворять любые нужды
пользователя клиентской машины.</P
></LI
><LI
><P
>Образы дисков больше не привязаны к 87 MB. Теперь это - независимые от файловой системы архивы. </P
></LI
><LI
><P
>Также существует средство автоматической загрузки дисковых образов на достаточно большое количество клиентских машин одновременно (широковещание (broadcast)). </P
></LI
><LI
><P
>Вы теперь можете написать защищенный загрузочный скрипт, который будет определять поведение машины перед загрузкой. </P
></LI
><LI
><P
>Вы можете загрузить любое ядро Linux без исправлений. Также возможно указывать ядру параметры и использовать образ электронного диска. </P
></LI
><LI
><P
>Вы имеете возможность производить авторизацию пользователей в процессе загрузки, используя сервер Unix, NT или Radius и отказывать в любом доступе к машине. </P
></LI
><LI
><P
>Включена полная поддержка любых языков. </P
></LI
><LI
><P
>И много, очень много других хороших возможностей... </P
></LI
></UL
>

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Существует ли программа, конвертирующая старые архивы в новый формат?</DT
><DD
><P
>Нет, потому что внутренний формат архива полностью отличается от старого.
Но вы можете легко сами произвести конвертацию, сделав следующее:
<P
></P
><OL
TYPE="1"
><LI
><P
>Загрузите старый образ (разархивируйте его на ваш диск) </P
></LI
><LI
><P
>Уберите вызов старой утилиты <TT
CLASS="LITERAL"
>unzipreg</TT
> и замените его на соответствующие
вызовы команды <TT
CLASS="LITERAL"
>patch</TT
> (это очень просто - смотри подробные инструкции ниже )</P
></LI
><LI
><P
>Запустите новую программу <TT
CLASS="LITERAL"
>mrzip</TT
>, чтобы создать новый образ диска </P
></LI
></OL
>&#13;</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN84"
>3.2. ...по сравнению с версией 3.0?</A
></H2
><P
>Версия 3.0 была бета-версией. Дюжина сайтов по всему миру тестировала ее в течение месяца и отдала достаточно много времени поиску ошибок, и предложениям о доработках. Спасибо им всем за беспокойство, особенно Maciek Uhlig, Dick Velders и Jeff Teeters. </P
><P
>Несколько незначительных возможностей были добавлены в версии
3.01, такие, как поддержка бездисковой загрузки Linux (с запретом
использования кэша).</P
><P
>Начиная с версии 3.10, внесена совместимость со стандартом сетевых машин
"<I
CLASS="EMPHASIS"
>Wired for Management
1.1a</I
>" фирмы Intel. Эти утилиты теперь работают с
любым PXE-совместимым ПЗУ удаленной загрузки (наиболее часто
устанавливаемыми на встроенные сетевые карты boot ROM). Большое спасибо
компании <A
HREF="http://www.incom.de/"
TARGET="_top"
>InCom GmbH</A
> за предоставленное PXE-ППЗУ, которые сделали возможным
создание этой версии. Мы также удачно протестировали эти утилиты с
PXE-BootROM, которое я случайно обнаружил в моем компьютере Dell, на
встроенной сетевой карте (под названием LanDesk Service Agent).</P
><P
>В версиях 3.11 и 3.12 добавлены утилиты для серверов UNIX (PXE-Прокси DHCP-сервер для Solaris и Linux, и улучшенный TFTP-сервер для Linux), а также полностью и подробно описана настройка сервера и процесса загрузки PXE. 
&#13;</P
><P
>В версии 3.13 добавлена поддержка Расширенного Управления Питанием (Advanced Power Management) (команда PowerOff (Выключить)). 
&#13;</P
><P
>В версию 3.14 внесены незначительные улучшения и некоторые исправления. Мы решили проблему, возникавшую с терминалом RedHat 5.1, и другую ошибку в синтаксисе команды "if". Также добавлены некоторые функции, предложенные Laboratori de Cаlcul de la Facultat d'Informаtica de Barcelona (LCFIB) : 



<P
></P
><UL
><LI
><P
>Новая переменная APM указывает, поддерживает ли ваша система Расширенное Управление Питанием (Advanced Power Management) (т.е. есть ли поддержка команды poweroff). 
 </P
></LI
><LI
><P
>Команда "beep". </P
></LI
><LI
><P
>Новый параметр команды DrawWindow, добавляющий заголовок окна при его создании. Теперь вы можете использовать команду DrawWindow 200 200 400 200 "Заголовок". &#13;</P
></LI
></UL
>&#13;</P
><P
>В версию 3.15 добавлена полная поддержка VESA. Программа BpBatch теперь поддерживает несколько видеорежимов, чтобы ее можно было использовать на старых компьютерах, не поддерживающих графику  800x600. К команде InitGraph добавлена возможность задавать видеорежим, и из новой переменной VESA-Modes можно получить список поддерживаемых видеорежимов. 
&#13;</P
><P
>В версии 3.16 исправлены следующие ошибки: 

<P
></P
><UL
><LI
><P
>Сообщение "Malloc failed" при процессе Fullunzip из разбитого на части zip-образа. Большое спасибо Christian Meyer за содействие. </P
></LI
><LI
><P
>Ошибка, не позволявшая linux-версии MrBatch правильно распаковывать образы
дисков. Эта ошибка была обнаружена в функциях низкого уровня MrBatch,
поэтому она могла вызывать другие проблемы, возникавшие с <I
CLASS="EMPHASIS"
>linux</I
>-версией
MrBatch. Большое спасибо Jeff Teeters за его содействие.</P
></LI
><LI
><P
>Ошибка, которая была в таблицах перекодировки. Эта ошибка была обнаружена в Laboratori de Cаlcul de la Facultat d'Informаtica de Barcelona (LCFIB). Отчет о ней вы можете прочитать в форуме BpBatch. &#13;</P
></LI
></UL
>&#13;</P
><P
>В версии 3.17 добавлены незначительные функции и исправлены ошибки: 

<P
></P
><UL
><LI
><P
>Fullunzip отключал Расширенную (Extended) память </P
></LI
><LI
><P
>Работает загрузка с загрузочных дисков RedHat </P
></LI
><LI
><P
>Файловая система FAT разжималась с ошибками, если было очень много каталогов. &#13;</P
></LI
><LI
><P
>Мы добавили повторные попытки пересылки текстовых файлов по TFTP. BpBatch теперь будет пытаться передать их три раза перед тем, как сказать "Не могу переслать файл"("Could not transfer the file"). 
 </P
></LI
><LI
><P
>Данные о времени теперь правильно обновляются в файловой системе FAT. (спасибо Francis Chan) &#13;</P
></LI
></UL
>&#13;</P
><P
>В версии 3.18 исправлена ошибка в функции IncrUnzip. Спасибо Gary Pike за содействие. </P
><P
>В версии 3.19 исправлена ошибка в обработке ошибок команды <TT
CLASS="LITERAL"
>delete</TT
> на
ext2fs, а также неправильная обработка имен файлов, начинающихся с A: в
Linux. Добавлены следующие возможности:
<P
></P
><UL
><LI
><P
>Есть возможность использовать новый синтаксис, вида <TT
CLASS="LITERAL"
>if valid disk:partition</TT
>, чтобы
проверить, отформатирован ли раздел</P
></LI
><LI
><P
>Образы дисков FAT32 теперь полностью работают (теперь они правильно загружаются) </P
></LI
><LI
><P
>Поддерживаются разделы Linux EXT2, размером больше 2 Гб </P
></LI
><LI
><P
>Поддерживаются разделы Linux Swap, размером больше 128 Мб (эта возможность
работает только с новыми ядрами, как минимум, версии 2.1.x)&#13;</P
></LI
><LI
><P
>Опцию FullUnzip можно запускать и без использования кэш-раздела, установив
параметр <TT
CLASS="LITERAL"
>CacheNever</TT
> в "<TT
CLASS="LITERAL"
>ON</TT
>". Это может быть полезно в единичных случаях, но,
вообще, не рекомендуется, в связи с возникающей, вследствие этого, большой
загрузкой сети.</P
></LI
></UL
>
Спасибо Ruben Schattevoy за его помощь и содействие в выпуске этого релиза.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN140"
>4. Введение</A
></H1
><P
>Конфигурация, описываемая здесь, создавалась с лета 1996 в CUI, Университет
Женевы. Факультет Компьютерных Наук использовал несколько серверов и
большое количество рабочих станций, которые можно поделить
<P
></P
><UL
><LI
><P
>компьютеры для студентов </P
></LI
><LI
><P
>компьютеры для исследований и обучения ассистентов </P
></LI
></UL
>

Мы разработали эту конфигурацию для достижения следующих целей: 

<P
></P
><UL
><LI
><P
>Каждый компьютер должен работать в Linux, DOS, Windows 3.1, Windows 95 или Windows NT. Пользователь должен иметь возможность выбирать необходимую ОС при каждом сеансе работы. &#13;</P
></LI
><LI
><P
>Все программы, включая операционные системы, должны браться с серверов, чтобы облегчить процедуры установки программ и их обновление. &#13;</P
></LI
><LI
><P
>Клиентские компьютеры должны иметь возможность работать без записи на сервер (из соображений безопасности), кроме домашнего каталога (куда запись разрешена). &#13;</P
></LI
><LI
><P
>Конфигурирование клиентских машин должно быть предельно упрощено. Клиенты должны автоматически получать параметры их IP-конфигурации, и вся эта конфигурация должна находиться в одном файле, используемом для всех операционных систем. &#13;</P
></LI
><LI
><P
>Так как почти каждый компьютер сегодня имеет жесткий диск, то клиенты должны иметь возможность воспользоваться им для облегчения нагрузки на сеть, а также использовать его, как место временного хранения данных пользователя. &#13;</P
></LI
><LI
><P
>Пользователь <I
CLASS="EMPHASIS"
>должен</I
> иметь имя входа, чтобы использовать любой из компьютеров. </P
></LI
><LI
><P
>Это имя входа должно быть одинаковым для всех операционных систем и должно позволять доступ к персональному домашнему каталогу, общему для всех операционных систем. &#13;</P
></LI
><LI
><P
>Компьютеры студентов (и секретарши :-) должны быть абсолютно чисты при каждом запуске. Таким образом, компьютер должен выглядеть так, как будто его только что установили. &#13;</P
></LI
><LI
><P
>Каждый компьютер должен быть защищен от вирусных атак. </P
></LI
></UL
>
Эти условия привели к тому, что нам пришлось основывать эту конфигурацию на утилитах
ПЗУ удаленной загрузки. Сначала мы разработали эти утилиты для <A
HREF="http://www.incom.de/products_en.shtml"
TARGET="_top"
>TCP/IP Bootprom</A
>
фирмы <A
HREF="http://www.incom.de"
TARGET="_top"
>InCom GmbH</A
>. По той причине, что сейчас появился полностью
оформленный стандарт удаленной загрузки, мы доделали эти утилиты, так что
они работают сейчас с любым PXE-совместимым ПЗУ удаленной загрузки.
PXE-BootROM, также называемые LanDesk Service Agent, теперь
распространяются практически со всеми встроенными в материнскую плату
сетевыми адаптерами. Чтобы более подробнее узнать о стандарте PXE и Intel

<I
CLASS="EMPHASIS"
>Wired for Management</I
>, читайте <TT
CLASS="LITERAL"
><A
HREF="http://www.intel.com/managedpc"
TARGET="_top"
>http://www.intel.com/managedpc</A
></TT
>.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN173"
>4.1. Boot ROM и Жесткий диск</A
></H2
><P
>ППЗУ удаленной загрузки существуют достаточно давно, но, до недавних пор,
они продавались исключительно с бездисковыми станциями. С 1996 года этот
How-to утверждает, что BootPROM значительно более интересны при
использовании в машинах с локальным жестким диском, потому что они позволяют
использовать плюсы и тех, и других:


<P
></P
><UL
><LI
><P
>ППЗУ удаленной загрузки позволяет иметь более "живучие" конфигурации, потому что с ним компьютер загружается всегда одинаково, не зависимо от вирусов или разрушения таблицы разделов. Он может использоваться даже (как у нас) для очистки диска до загрузки операционной системы. &#13;</P
></LI
><LI
><P
>Локальный диск может сделать конфигурацию более эффективной, потому что он
может сократить сетевой трафик при помощи кэширования, и позволяет сделать подкачку
более эффективной.&#13;</P
></LI
></UL
>
Мы рады видеть на сегодняшний день, что многие производители компьютеров пришли к
тому же выводу и внесли BootPROM  в стандартную конфигурацию новых
компьютеров.</P
><P
>Заметьте, что вы можете использовать утилиты, описанные ниже, <I
CLASS="EMPHASIS"
>по-старому</I
>, в
качестве простого загрузчика ядра/электронного диска, даже на бездисковых
компьютерах. Однако, мы бы не рекомендовали, такое их использование.&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN183"
>4.2. Сеть</A
></H2
><P
>Университет Женевы владеет сетью класса B, разделенной на несколько
подсетей. Компьютерный факультет использует четыре подсети, из которых одна
выделена для студентов.
&#13;</P
><P
>В исходном варианте наши компьютеры использовали два сетевых протокола: IPX и IP. Для IPX мы использовали сервер Novell Netware 3 для совместного использования программ и файлов пользователей в DOS и Windows. Для IP у нас был сервер SUN с программами и разделами пользователей для Linux, использующих NFS. 
&#13;</P
><P
>В последней версии конфигурации мы больше не используем IPX. У нас стоит
один сервер Unix (Это может быть и Linux, и SUN), позволяющий совместное
использование программ и файлов пользователей, при помощи NFS, для
Linux-клиентов и SMB (NetBIOS) поверх TCP/IP для Dos- и Windows-клиентов.
Таким образом, мы можем предоставить один общий домашний каталог на всех
операционных системах.&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN188"
>4.3. Как это работает</A
></H2
><P
>&#13;<P
></P
><OL
TYPE="1"
><LI
><P
>Когда клиентский компьютер включается, он производит стандартную проверку системы до того, как управление передается TCP/IP Bootprom или PXE Boot ROM. &#13;</P
></LI
><LI
><P
>ППЗУ удаленной загрузки посылает запрос BOOTP/DHCP, чтобы узнать параметры IP-конфигурации. &#13;</P
></LI
><LI
><P
>Если сервер узнает компьютер, пославший запрос, он посылает обратно
BOOTP/DHCP-ответ с различной информацией: IP адрес клиента, шлюз по
умолчанию и образ загрузочного диска, который нужно использовать.&#13;</P
></LI
><LI
><P
>В случае PXE Boot ROM, может существовать кое-какой дополнительный обмен информацией между клиентом и сервером до полного определения параметров загрузки. &#13;</P
></LI
><LI
><P
>После этого BootPROM скачивает загрузочный образ с сервера, используя протокол TFTP. Этот образ представляет из себя небольшую программу <TT
CLASS="LITERAL"
>bpbatch</TT
>, наш интерпретатор пакетных файлов загрузки систем. </P
></LI
><LI
><P
>Затем запускается наш интерпретатор пакетных файлов. К этому моменту он
единственный находится в памяти. Еще не загружена ни одна операционная
система, кроме дозагрузочного исполнительного окружения, формируемого Boot
ROM.&#13;</P
></LI
><LI
><P
>Интерпретатор обрабатывает ответ BOOTP/DHCP в поисках различных опций, и, иногда, имени пакетного файла, который надо исполнить. &#13;</P
></LI
><LI
><P
>В соответствии с инструкциями пакетного файла он, например: 

<P
></P
><OL
TYPE="a"
><LI
><P
>Загрузить национальную раскладку клавиатуры </P
></LI
><LI
><P
>Произведет авторизацию пользователя на сервере (Unix, Radius или Windows NT) </P
></LI
><LI
><P
>Даст возможность пользователю выбрать операционную систему </P
></LI
><LI
><P
>В соответствии с выбранной операционной системой, он создаст разделы на
жестком диске и произведет быстрое форматирование некоторых разделов&#13;</P
></LI
><LI
><P
>Проверит, имеется ли соответствующий компрессированный образ выбранной ОС в
конце жесткого диска. Если нет, то загружает его, при помощи TFTP&#13;</P
></LI
><LI
><P
>Разархивирует выбранную ОС на основной раздел </P
></LI
><LI
><P
>Если ОС - это Linux, загрузит ядро и запустит его </P
></LI
><LI
><P
>Если ОС - это DOS или Windows, то просто позволит компьютеру загрузиться со свежего жесткого диска &#13;</P
></LI
></OL
>
Для <I
CLASS="EMPHASIS"
>DOS и Windows 3.1</I
>, мы используем бесплатный Microsoft LanManager для
DOS (поищите в сети ближайшее зеркало этой программы; дистрибутив состоит
из трех файлов, названных от <TT
CLASS="LITERAL"
>disk1</TT
> по <TT
CLASS="LITERAL"
>disk4</TT
>) в качестве SMB-клиента.
Microsoft LanManager поддерживает динамическую конфигурацию, при помощи
DHCP. После входа в систему пользователь оказывается в DOS и затем обычным
образом может запустить Windows 3.1, набрав традиционную команду <TT
CLASS="LITERAL"
>win</TT
>.
Заметьте, что с этого момента DOS и Windows 3.1 выглядят так, как будто
установлены на локальной машине.

Для <I
CLASS="EMPHASIS"
>Windows 95 и Windows NT</I
>, мы также используем клиент SMB фирмы Microsoft
(называемый <I
CLASS="EMPHASIS"
>Клиент сетей Microsoft</I
>), поддерживающий динамическое
конфигурирование, при помощи DHCP. Мы уменьшаем нагрузку на сеть, используя
<A
HREF="http://www.lancache.com"
TARGET="_top"
>"Разделенный кэш локальных сетей"</A
></P
></LI
></OL
>
Компьютеры клиентов можно <I
CLASS="EMPHASIS"
>жестко</I
> отключать в любое время без какого-либо
риска, так как жесткий диск заново инициализируется, при каждом запуске
системы.</P
><P
>В "безопасных" компьютерах (напр. компьютерах лаборантов), как только
компьютер однажды загрузился с использованием вышеописанной системы, скрипт
может просто переключаться на загрузку с локального диска без его повторной
очистки. Это позволяет пользователям хранить данные на локальных дисках. Но
если, вдруг, конфигурация их компьютера откажет, то пользователь может в
любое время выбрать соответствующий пункт из загрузочного меню, получив,
таким образом, свежую инсталляцию&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN235"
>4.4. Сопутствующая некоммерческая документация</A
></H2
><P
>Эта конфигурация была успешно воспроизведена в нескольких других местах по
всему миру. Некоторые, из участвовавших в проекте, написали советы
и хитрости в дополнение к этому How-To. Если у вас тоже есть совет, и на
этой странице нет ссылок на вас, то пишите по адресу
<TT
CLASS="LITERAL"
>Marc.VuilleumierStuckelberg@cui.unige.ch</TT
>. Если у вас возникнут проблемы с
воспроизведением этой конфигурации, взгляните на эти страницы!
<P
></P
><UL
><LI
><P
>&#13;<TT
CLASS="LITERAL"
><A
HREF="http://www.br.fgov.be/RESEARCH/INFORMATICS/info/bootp.html"
TARGET="_top"
>http://www.br.fgov.be/RESEARCH/INFORMATICS/info/bootp.html</A
></TT
>,
автор - Alain Empain из Национального Ботанического Сада Бельгии. Много полезных примеров скриптов, и красивая программа на PERL, позволяющая автоматически создавать меню и HTML-документацию из описания более высокого уровня. &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
><A
HREF="http://www.katedral.se/system/elevsyst"
TARGET="_top"
>http://www.katedral.se/system/elevsyst</A
></TT
>,
автор - Johan Carlstedt из Кафедральной школы в Uppsala, Швеция. <I
CLASS="EMPHASIS"
>На
настоящий момент, конфигурация, описанная на этой странице базируется на
старой версии утилит удаленной загрузки, однако, практически все работает.
А также там приводятся некоторые советы.</I
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
><A
HREF="http://vitoria.upf.tche.br/~fred/"
TARGET="_top"
>http://vitoria.upf.tche.br/~fred/</A
></TT
>, на португальском, автор - Frederico Goldschmidt из Университета Passo Fundo, Бразилия. &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
><A
HREF="http://www.etse.urv.es/~larinyo"
TARGET="_top"
>http://www.etse.urv.es/~larinyo</A
></TT
>,на испанском, автор - Lluis Arino, из Высшей Инженерно-Технической Школы (Escola Tecnica Superio d'Enginyeria), Испания. &#13;</P
></LI
></UL
>&#13;</P
><P
>Вы можете послать мне свой BpBatch-скрипт, чтобы я внес его в <A
HREF="http://www.linux.org.ru/books/HOWTO/soft/sample-scripts"
TARGET="_top"
>коллекцию скриптов</A
>. </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN259"
>5. Описание конфигурации</A
></H1
><P
>Во-первых, сделайте так, чтобы у вас под рукой было две машины: 
<P
></P
><UL
><LI
><P
><I
CLASS="EMPHASIS"
>Сервер</I
> - обычно машина с Unix или Windows NT </P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Клиентская машина</I
> - компьютер с включенным BootPROM, у которого на жестком диске нет ничего ценного. </P
></LI
></UL
>
Если вы хотите испытать эту конфигурацию, но у вас еще нет ППЗУ удаленной
загрузки, то вы можете взять демонстрационную версию TCP/IP BootPROM с
сайта компании InCom GmbH по адресу <TT
CLASS="LITERAL"
><A
HREF="http://www.incom.de"
TARGET="_top"
>http://www.incom.de</A
></TT
>. При помощи этой
программы, ваш компьютер будет работать так, как будто в него вставлен
TCP/IP BootPROM.</P
><P
>Если же у вас уже есть Boot ROM, то надо его включить. Если у вас
TCP/IP BootPROM фирмы Incom, то вам надо использовать специальную программу
производителя вашей сетевой карты. Если же у вас PXE-совместимое ППЗУ, то
надо это сделать в BIOS, сменив устройство загрузки по умолчанию.</P
><P
>На компьютерах студентов мы первым пунктом ставим загрузку с сети и
запрещаем загрузку с винчестера или флоппи-диска. У ассистентов первым
пунктом также идет сеть, затем жесткий диск и флоппи.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN273"
>5.1. Конфигурирование сервера</A
></H2
><P
>На сервере вам понадобится настроить следующее: 



<P
></P
><OL
TYPE="1"
><LI
><P
>BOOTP/DHCP-сервер </P
></LI
><LI
><P
>Возможно - Прокси- DHCP сервер </P
></LI
><LI
><P
>TFTP-сервер </P
></LI
></OL
>
<I
CLASS="EMPHASIS"
>Замечание для пользователей PXE-совместимых BootPROM:</I
> После нескольких
часов изнурительных поисков мы обнаружили, что PXE-BootPROM версии ранее
0.99 не очень точно поддерживают IP-протокол и отказываются понимать все
пакеты, имеющие установленный флаг <I
CLASS="EMPHASIS"
>Не фрагментировать (Don't Fragment)</I
>
(DF). Это означает, что вам надо на сервере запретить опцию <I
CLASS="EMPHASIS"
>Path MTU
Discovery</I
>, или Boot ROM не увидит эти пакеты. В Solaris-е используйте
команду <TT
CLASS="LITERAL"
>ndd /dev/ip ip_path_mtu_discovery</TT
>, чтобы узнать, включена ли эта
опция, и команду <TT
CLASS="LITERAL"
>ndd -set /dev/ip ip_path_mtu_discovery 0</TT
>, чтобы эту опцию
выключить. Однако, эти команды не работают для широковещательных пакетов
(Спросите SUN, почему) Это означает, что работать будет только TFTP, но не
DHCP :-(. Intel недавно исправил эту ошибку - если вы купили свой компьютер
позже Июня 1998 года, то, скорее всего, у вас эта ошибка исправлена.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN288"
>5.1.1. Настройка DHCP</A
></H3
><P
>Задачей DHCP-сервера является выделение клиенту IP-адреса и указание ему
загрузить с TFTP-сервера файл <TT
CLASS="FILENAME"
>bpbatch.P</TT
>. DHCP в данном случае действует,
как дополнение к протоколу BOOTP. Если вы используете TCP/IP BootPROM фирмы
InCom, то вы можете обойтись без DHCP (используя старую версию
BOOTP-сервера).</P
><P
>На Windows NT вы, вероятнее всего, будете использовать встроенный
DHCP-сервер. Если у вас TCP/IP BootPROM фирмы InCom, то вам придется
использовать одну хитрость, чтобы указать имя загрузочного файла (подробную
информацию смотрите на веб-сайте фирмы InCom). Если же у вас
PXE-совместимое ППЗУ, то вам понадобится Прокси-DHCP-сервер, но никаких
дополнительных хитростей не потребуется, потому что имя загрузочного файла
будет передаваться Прокси-DHCP-сервером.</P
><P
>В Linux лучшим будет стандартный DHCP-сервер производства Internet Software
Consortium. Если у вас PXE- BootPROM, то, в дополнение к обычным опциям,
вам придется указать следующее:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>option dhcp-class-identifier "PXEClient" </TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>option vendor-encapsulated-options ff;</TT
></P
></LI
></UL
>&#13;</P
><P
>В Solaris вы можете использовать либо тот же стандартный DHCP-сервер
производства Internet Software Consortium (его можно взять на веб-сайте),
или Solaris DHCP-сервер (он входит в Solaris, начиная с версии 2.5). Однако,
DHCP-сервер в Solaris, по-видимому, не вставляет в ответ на DHCP-запрос
идентификатор класса клиента - чтобы исправить это, вам придется
использовать Прокси-DHCP-сервер. Более того, Прокси-DHCP-сервер должен
находиться не на сервере, потому что родной DHCP-сервер в Solaris блокирует
порт DHCP.</P
><P
>Мы предлагаем установить бесконечное время жизни выделенного DHCP для
клиентов IP-адреса. Не забудьте, что BOOTP/DHCP-запросы ограничены внутри
подсети. Если клиент и сервер находятся в разных подсетях, то вам придется
установить между этими подсетями мост BOOTP/DHCP (Relay agent). С этого
момента мы предполагаем, что обе машины находятся в одной подсети.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN303"
>5.1.2. Настройка Прокси-DHCP</A
></H3
><P
>Прокси-DHCP-сервер предназначен для того, чтобы обойти ограничения,
существующие в некоторых версиях серверов DHCP, а также реализовать
специфичные для PXE дополнения протокола DHCP. Использование
Прокси-DHCP-сервера имеет смысл только с PXE BootPROM.&#13;</P
><P
>Дополнения протокола DHCP, специфичные для PXE (меню и т.п.), вам не
понадобятся, потому что это входит в возможности BpBatch. Однако, вам
придется использовать Прокси-DHCP-сервер для дальнейшей работы, если ваш
DHCP-сервер полностью не совместим с PXE.&#13;</P
><P
>На Windows NT вы можете попытаться использовать WfM PDK фирмы Intel (этот
пакет есть на их веб-сайте), но это не очень просто. Мы бы посоветовали
все-таки установить небольшую Linux-машину в необходимой подсети и
установить на нем нашу версию прокси-DHCP. Основным плюсом нашей версии
Прокси-DHCP-сервера для BpBatch является поддержка дополнительной опции
производителя 155, которую BpBatch использует в качестве командной строки.&#13;</P
><P
>В Linux и Solaris вы можете запустить нашу Прокси- DHCP программу, которой
в качестве аргументов передаются IP-адрес TFTP-сервера, имя загрузочного
файла и дополнительные опции - и все остальное эта программа делает за вас.
Если DHCP-порт на сервере уже используется другим демоном, то прокси-DHCP
будет использовать порт 4011. В этом случае, очень важно, чтобы этот другой
демон в ответе на DHCP-запрос устанавливал класс клиента в <TT
CLASS="LITERAL"
>PXEClient</TT
>, чтобы
PXE-клиенты знали, что им надо работать через порт 4011.</P
><P
>На веб-сайте Intel есть полная документация по PXE расширениям протокола
DHCP. Однако эти документы достаточно сложны - протокол в них разбит на
несколько стадий, обеспечивая тем самым большую гибкость. Суть же состоит в
том, что PXE-клиенту необходим полный <I
CLASS="EMPHASIS"
>расширенный DHCP-ответ</I
>. Если он
получает лишь стандартный DHCP-ответ, то он продолжит поиск, пока не
получит
<P
></P
><OL
TYPE="1"
><LI
><P
>класс клиента (T60), установленный в <TT
CLASS="LITERAL"
>PXEClient</TT
></P
></LI
><LI
><P
>дополнительные опции производителя (T43) (возможно пустые, т.е. шестнадцатеричное <TT
CLASS="LITERAL"
>ff</TT
>)</P
></LI
><LI
><P
>непустое имя загрузочного файла </P
></LI
></OL
>

PXE BootPROM прекратит поиск, как только получит всю необходимую
информацию, но отсутствие части этой информации может привести к достаточно
сложным обменам между сервером и клиентом (запустится процедура обнаружения
сервера и т.п..).</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN321"
>5.1.3. Настройка TFTP</A
></H3
><P
>TFTP - это очень простой файловый сервер. В базовой версии TFTP данные
передавались блоками по 512 байт, что достаточно неэффективно. TCP/IP
BootPROM фирмы Incom и PXE-BootPROM поддерживают длину блока до 1408 байт,
что существенно увеличивает скорость передачи. Однако это работает только с
улучшенной версией TFTP-сервера.&#13;</P
><P
>В Windows NT мы рекомендуем использовать улучшенный TFTP-сервер фирмы
Incom, который можно взять на их веб-сайте.&#13;</P
><P
>&#13;В Linux вы можете использовать нашу версию улучшенного TFTP-сервера, который можно взять по адресу 
<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/etftpd.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/etftpd.tar.gz</A
></TT
>.</P
><P
>В Solaris вы должны использовать улучшенный TFTP-сервер фирмы Incom,
который есть на диске утилит, поставляемом вместе с TCP/IP BootPROM.</P
><P
><I
CLASS="EMPHASIS"
>Если вы хотите использовать стандартный TFTP-демон,
уберите <TT
CLASS="LITERAL"
>P</TT
> из всех расширений имен файлов
загрузочных образов, чтобы BootPROM использовало только стандартный порт
TFTP (Этот метод был впервые применен компанией InCom GmbH в TCP/IP
BootPROM. Мы также используем его, потому что это наиболее простой путь
заставить PXE BootPROM использовать стандартный порт TFTP). </I
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN332"
>5.2. Настройка клиентских машин</A
></H2
><P
>Сначала мы настроим часть, общую для всех операционных систем - интерпретатор пакетных файлов BpBatch. После этого для каждой операционной системы мы сделаем следующее: 
<P
></P
><OL
TYPE="1"
><LI
><P
>Настроим отдельную клиентскую машину </P
></LI
><LI
><P
>Сохраним его конфигурацию на сервере </P
></LI
><LI
><P
>Протестируем его работу в качестве клиента с удаленной загрузкой </P
></LI
><LI
><P
>Адаптируем эту настройку для любой подобной клиентской машины </P
></LI
></OL
>
После того, как мы все это проделаем, мы получим возможность настройки
любой дополнительной клиентской машины путем простой установки в его
сетевую карту ППЗУ удаленной загрузки (если его там еще нет) и добавлением
одной строки в файл конфигурации DHCP.</P
><P
>В наших примерах мы предполагаем, что у вас есть жесткий диск, объемом не
менее 1,4 Гб. Если у вас диск меньшего размера, то уменьшите размеры
разделов, но не забудьте оставить свободными несколько сот мегабайт в конце
диска, предназначенных для специального кэш-раздела. Более того, кэш всегда
начинается с цилиндра, следующего за последним занятым стандартными
разделами цилиндра, поэтому, если вы не будете использовать один и тот же
размер стандартных разделов для всех ОС, то вам придется всегда загружать с
сети необходимые файлы (кэш, в этом случае, очищается).&#13;</P
><P
>Никогда не отчаивайтесь. Если вы не можете заставить это все работать,
сначала взгляните в главу <I
CLASS="EMPHASIS"
>Проблемы и их решение</I
> - возможно, решение
находится там (возьмите самую свежую версию этого документа). Затем
посетите форум BpBatch. Может быть у кого-то возникали подобные трудности,
и ответ находится в форуме по адресу
<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/forum/"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/forum/</A
></TT
>. Если вы не нашли там
ответ на свой вопрос, попытайтесь последить за сетевым трафиком, на предмет
проблем с передачей данных в сети (используйте <TT
CLASS="LITERAL"
>tcpdump</TT
> на Linux или <TT
CLASS="LITERAL"
>snoop</TT
>
на Solaris). Если и это не поможет, то можно послать письмо по адресу
<TT
CLASS="LITERAL"
>David.Clerc@cui.unige.ch</TT
> или <TT
CLASS="LITERAL"
>Marc.VuilleumierStuckelberg@cui.unige.ch</TT
>. Если
ваша проблема действительно относится исключительно к конфигурированию
удаленной загрузки, и мы не перегружены, то попытаемся решить вашу
проблему.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN353"
>5.3. Настройка процесса загрузки</A
></H2
><P
>Скачайте программу <TT
CLASS="LITERAL"
>BpBatch</TT
> в любом формате: <TT
CLASS="LITERAL"
>.zip</TT
> или <TT
CLASS="LITERAL"
>.tar.gz</TT
>. Ее можно
найти по адресу
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/bpb-exe.zip"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/bpb-exe.zip</A
></TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/bpb-exe.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/bpb-exe.tar.gz</A
></TT
></P
></LI
></UL
>

Также по запросу там можно получить и исходные тексты программ (Assembler и C).</P
><P
>В каталоге <TT
CLASS="LITERAL"
>/tftpboot</TT
> сервера поместите три специальных загрузочных образа,
которые вместе составляют предзагрузочный пакетный интерпретатор:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>bpbatch.P</TT
>, динамический загрузчик (сохраните верхний регистр расширения!) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>bpbatch.ovl</TT
>, перемещаемый интерпретатор &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>bpbatch.hlp</TT
>, файл помощи </P
></LI
></UL
>
Затем добавьте строку в файл конфигурации DHCP, установив загрузочный файл
в <TT
CLASS="LITERAL"
>"bpbatch.P"</TT
>. Задайте дополнительную опцию производителя 155 (десятичное
155), присвоив ей значение <TT
CLASS="LITERAL"
>"-i"</TT
> (в стандартном DHCP-сервере это задается
командой <TT
CLASS="LITERAL"
>option option-155 "-i";</TT
>. Эту строку <TT
CLASS="LITERAL"
>bpbatch</TT
> воспринимает в
качестве командной, в которой <TT
CLASS="LITERAL"
>-i</TT
> означает "интерактивный".</P
><P
>Включите клиентский компьютер. Через некоторое время вы увидите

<P
></P
><UL
><LI
><P
>Копирайт BootPROM </P
></LI
><LI
><P
>Строку <TT
CLASS="LITERAL"
>DHCP</TT
>, означающую, что машина ожидает ответ DHCP </P
></LI
><LI
><P
>Строку <TT
CLASS="LITERAL"
>TFTP</TT
>, означающую, что машина ожидает первый пакет от TFTP </P
></LI
><LI
><P
>Строку <TT
CLASS="LITERAL"
>Loading BpBatch</TT
> в процессе загрузки интерпретатора </P
></LI
><LI
><P
>После этого вы увидите нашу заставку, за которой последует красивое приглашение. </P
></LI
></UL
>
Примите наши поздравления! Вы успешно запустили интерпретатор пакетных
файлов... Если вам интересно, что вы можете сделать с его помощью, то
читайте следующую главу. Если же вы торопитесь, пропустите ее и
перейдите к разделу "Установка вашей операционной системы". Если у вас
возникли проблемы с интерпретатором, запустите команду <TT
CLASS="LITERAL"
>help</TT
>.</P
><P
>Заметьте, что можно использовать этот же интерпретатор в DOS и Linux,
запустив программу <TT
CLASS="LITERAL"
>MrBatch</TT
>. Существуют, правда, незначительные различия
этих версий - в Linux-версии нет поддержки графики, а DOS-версия может
посылать BOOTP- и TFTP-запросы только в том случае, если BootPROM не скрыт
операционной системой.</P
><P
>Неплохо было бы прочитать и главу <I
CLASS="EMPHASIS"
>Синтаксические правила</I
> <TT
CLASS="LITERAL"
>BpBatch</TT
>, а
также главы, относящиеся к <I
CLASS="EMPHASIS"
>Ссылкам на файлы</I
> и <I
CLASS="EMPHASIS"
>Кэш-разделу</I
>. Это вам поможет
понять приводимые здесь примеры.</P
><P
>После настройки всех операционных систем сделайте меню,
позволяющее пользователю загрузить необходимую операционную систему. Вы,
скорее всего, сами сможете понять, как настроить такое меню. Все необходимые
для этого команды находятся в конце этого документа.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN409"
>5.3.1. Изучаем BpBatch</A
></H3
><P
>Попробуйте дать команду <TT
CLASS="LITERAL"
>LogVars</TT
>. Вы увидите
список, состоящий примерно из тридцати переменных. Если кратко, сначала идут установки
BpBatch, затем параметры из ответа на BOOTP/DHCP-запрос, и последняя
переменная - список размеров дисков в Мегабайтах.</P
><P
>Дайте команду <TT
CLASS="LITERAL"
>GetPartitions part</TT
>, а затем
снова <TT
CLASS="LITERAL"
>LogVars</TT
>. К списку должна добавиться еще
одна переменная, содержащая список разделов на вашем первом жестком диске.
Предположим, что ваш первый раздел - это BIGDOS, FAT32 or LINUX-EXT2. Дайте
команду <TT
CLASS="LITERAL"
>LogDir "{:1}"</TT
>, чтобы увидеть
содержимое корневого каталога, затем <TT
CLASS="LITERAL"
>LogDir
"{:1}/usr"</TT
>, если на диске есть каталог <TT
CLASS="LITERAL"
>usr</TT
>. Вы даже можете увидеть дерево каталогов, при
помощи команды LogTree <TT
CLASS="LITERAL"
>LogTree "{:1}/etc"</TT
>.</P
><P
>Поместите на TFTP-сервер картинку в формате GIF (GIF-87a, чересстрочный или
обычный, но не GIF-89a). Предположим, этот файл будет называться
<TT
CLASS="FILENAME"
>image.gif</TT
>. Вы можете скопировать его в любой каталог на
клиентской машине командой вида <TT
CLASS="LITERAL"
>Copy "image.gif"
"{:1}/temp/image.gif"</TT
>. Можно использовать его напрямую
с сервера. Теперь выполните команду <TT
CLASS="LITERAL"
>Logvars
"V*"</TT
> и посмотрите на значение переменной <TT
CLASS="LITERAL"
>VESA</TT
>. Если оно равно <TT
CLASS="LITERAL"
>On</TT
>,
то это означает, что у вас VESA-совместимый видеоадаптер. Вы можете увидеть
список доступных видеорежимов, при помощи команды <TT
CLASS="LITERAL"
>Echo
"$VESA-Modes"</TT
>. Чтобы вывести картинку на экран, используйте
команду <TT
CLASS="LITERAL"
>DrawGif "image.gif"</TT
>. Картинка
появится в верхнем левом углу экрана. Вы можете вывести ее в любое место
экрана, задав координаты после имени файла. Есть вохможность выводить любой
текст командой вида <TT
CLASS="LITERAL"
>DrawText 200 200 "Hello world"
yellow</TT
>. Или нарисовать окно: <TT
CLASS="LITERAL"
>DrawWindow 200
200 300 150</TT
>. Нарисовать окно с заголовком:  <TT
CLASS="LITERAL"
>DrawWindow 200 200 300 150 "My Window"</TT
> . Когда вам
надоест графический режим, наберите <TT
CLASS="LITERAL"
>CloseGraph</TT
>.</P
><P
>Небольшое замечание : по умолчанию все графические команды работают в
VESA-режиме 800x600 (256 цветов) - это первое поле в значении переменной
<TT
CLASS="LITERAL"
>VESA-Modes</TT
>. Чтобы использовать другой видеорежим, измените значение
переменной так, чтобы необходимый видео-режим был первым в списке.</P
><P
>Теперь запустите текстовый редактор, создайте файл <TT
CLASS="FILENAME"
>test.bpb</TT
> в каталоге
<TT
CLASS="LITERAL"
>tftpboot</TT
>, написав в нем следующее:
<PRE
CLASS="PROGRAMLISTING"
>:again
DrawWindow 150 200 400 160 "Identity check"
TextAttr Black LightGray
At 15,20 Print "Username : "
Input username 8
At 17,20 Print "Password : "
Getpasswd userpass 8
if "$username" != "smith" goto again
if not "$userpass" match-passwd "BpR8oiIlRR9bo" goto again
#
clear
DrawWindow 200 200 150 100 green blue "Congratulations"
DrawText 220 250 "You got it !" yellow
WaitForKey 3
CloseGraph
interact</PRE
>
В конфигурации BOOTP/DHCP измените опцию 155 (<TT
CLASS="LITERAL"
>"-i"</TT
>) на <TT
CLASS="LITERAL"
>"test"</TT
> и
перезагрузите клиентскую машину. Этот небольшой скрипт должен автоматически
запуститься, и вам будет задан вопрос, относительно имени пользователя и
пароля. Если вы не наберете <TT
CLASS="LITERAL"
>smith</TT
> и <TT
CLASS="LITERAL"
>justdoit</TT
>, то не сможете загрузить свой компьютер.
Позже вы узнаете, как производить аутентификацию, при помощи Unix, NT или
Radius.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN442"
>5.4. Настройка Linux</A
></H2
><P
>Чтобы установить Linux, вам понадобится загрузочный флоппи-диск, идущий в
комплекте поставки дистрибутива RedHat Linux. В BpBatch входит команда,
позволяющая загрузить систему с флоппи: <TT
CLASS="LITERAL"
>FloppyBoot</TT
>.</P
><P
>Установите на клиентскую машину <A
HREF="http://www.redhat.com"
TARGET="_top"
>RedHat Linux</A
>, включая поддержку сети, и все
пакеты, которые могут понадобиться. Вы также можете пересобрать ядро
специально для клиентской машины, но это не обязательно.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN448"
>5.4.1. Настройка клиентской машины</A
></H3
><P
>Неплохой идеей будет включить поддержку BOOTP в ядро, чтобы не настраивать
IP-адрес клиента вручную.&#13;</P
><P
>Чтобы уменьшить нагрузку на сеть, используйте <TT
CLASS="LITERAL"
>filecache</TT
> для кэширования на жестком диске файлов,
взятых с NFS. Грубо говоря, принцип файлового кэша состоит в следующем -
когда эта система встречает, в подкаталоге <TT
CLASS="LITERAL"
>cache</TT
>, символьную ссылку на файл, она заменяет его на
сам файл. Если это каталог, то для каждого элемента каталога создается
символьная ссылка на источник на сервере. Filecache был написан компанией
Unifix GmbH, и является частью Unifix Linux 2.0. Это некоммерческий
продукт, и все необходимые файлы можно взять по адресу <TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/filecache.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/filecache.tar.gz</A
></TT
>. Для того, чтобы использовать filecache вам надо
<P
></P
><UL
><LI
><P
>внести изменения в ядро (патч <TT
CLASS="LITERAL"
>patch-filecache</TT
>), включить поддержку filecache в
<TT
CLASS="LITERAL"
>make config</TT
>, и пересобрать ядро</P
></LI
><LI
><P
>скопировать исполняемый файл filecache в <TT
CLASS="LITERAL"
>/sbin</TT
></P
></LI
><LI
><P
>создать точку подключения <TT
CLASS="LITERAL"
>/mnt/nfs</TT
> (используя <TT
CLASS="LITERAL"
>mkdir</TT
>) </P
></LI
><LI
><P
>скопировать файл <TT
CLASS="LITERAL"
>filecache.conf</TT
> в <TT
CLASS="LITERAL"
>/etc</TT
>. Этот файл содержит следующие строки: 
Max 100 MB 50 % #
Cache /mnt/nfs/usr /usr
Cache /mnt/nfs/opt /opt</P
></LI
><LI
><P
>скопируйте содержимое каталогов <TT
CLASS="LITERAL"
>/usr</TT
> и
<TT
CLASS="LITERAL"
>/opt</TT
> на сервер, экспортируйте их в режиме
"только чтение" с флагом  <TT
CLASS="LITERAL"
>anon=0</TT
> (для того,
чтобы root имел к ним доступ), и подключите к <TT
CLASS="LITERAL"
>/mnt/nfs</TT
> (добавьте соответствующую строку в <TT
CLASS="LITERAL"
>/etc/fstab</TT
>)</P
></LI
><LI
><P
>переименуйте <TT
CLASS="LITERAL"
>/usr</TT
> в <TT
CLASS="LITERAL"
>/usr.orig</TT
></P
></LI
><LI
><P
>создайте символьную ссылку <TT
CLASS="LITERAL"
>/usr</TT
> на <TT
CLASS="LITERAL"
>/mnt/nfs/usr</TT
></P
></LI
><LI
><P
>переименуйте <TT
CLASS="LITERAL"
>/opt</TT
> в <TT
CLASS="LITERAL"
>/opt.orig</TT
></P
></LI
><LI
><P
>создайте символьную ссылку <TT
CLASS="LITERAL"
>/opt</TT
> на <TT
CLASS="LITERAL"
>/mnt/nfs/opt</TT
></P
></LI
><LI
><P
>проверьте, чтобы <TT
CLASS="LITERAL"
>/usr</TT
> и <TT
CLASS="LITERAL"
>/opt</TT
> не были пусты, и в них было правильное содержание </P
></LI
><LI
><P
>рекурсивно удалите <TT
CLASS="LITERAL"
>/usr.orig</TT
> и <TT
CLASS="LITERAL"
>/opt.orig</TT
> </P
></LI
><LI
><P
>скопируйте <TT
CLASS="LITERAL"
>filecache.init</TT
> в <TT
CLASS="LITERAL"
>/etc/rc.d/init.d</TT
> </P
></LI
><LI
><P
>И последнее: создайте символьную ссылку <TT
CLASS="LITERAL"
>/etc/rc.d/rc3.d/S35filecache</TT
> на <TT
CLASS="LITERAL"
>/etc/rc.d/init.d/filecache.init</TT
> </P
></LI
></UL
>
Если вы все сделали правильно, то filecache начнет работать сразу после
перезагрузки (если вы забыли внести патч в ядро).</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN511"
>5.4.2. Проверка конфигурации</A
></H3
><P
>Скопируйте компрессированный образ ядра (<TT
CLASS="LITERAL"
>zImage</TT
>, <TT
CLASS="LITERAL"
>bzImage</TT
>, <TT
CLASS="LITERAL"
>vmlinuz</TT
> или как
вы там его называете) в каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
> на сервере, назвав его <TT
CLASS="FILENAME"
>linux.krn</TT
>.
Если вам пришлось убрать BootPROM из клиентской машины, то вставьте его
обратно. Когда запустится <TT
CLASS="LITERAL"
>BpBatch</TT
>, наберите <TT
CLASS="LITERAL"
>LinuxBoot "linux.krn" "root=/dev/hda1 BOOT_IMAGE=linux"</TT
> (предполагаем, что первый раздел - это
корневая файловая система ext2). С другой стороны, если вы уже настроили
конфигурацию на компьютере без BootPROM, просто дайте ему загрузиться, при
помощи стандартного загрузчика (lilo, ...). Правда, во втором случае вам
придется для этого отдельно установить ядро с поддержкой filecache в
соответствующее место.</P
><P
>Дождитесь, пока загрузится система. Если у вас установлен filecache, то вы
можете проверить его работу - каталог <TT
CLASS="LITERAL"
>/usr</TT
> должен был развернуться в
каталог на диске, состоя наполовину из символьных ссылок на каталоги,
наполовину из таких же развернутых каталогов. Теперь запустите наиболее
часто используемые пользователями программы, чтобы они попали на жесткий
диск.</P
><P
>Теперь вы можете вносить любые изменения в систему, как будто работаете на
обычной выделенной linux-машине.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN524"
>5.4.3. Создаем образ диска</A
></H3
><P
>Когда вы настроите свою машину, зайдите в систему, как <TT
CLASS="LITERAL"
>root</TT
>, перейдите в
каталог <TT
CLASS="LITERAL"
>/tmp</TT
> и запустите нашу программу <TT
CLASS="LITERAL"
>mrzip</TT
>. <TT
CLASS="LITERAL"
>MrZip</TT
> - это интерпретатор
команд, такой же, как и <TT
CLASS="LITERAL"
>BpBatch</TT
>, но понимающий большее количество команд, по
сравнению с <TT
CLASS="LITERAL"
>BpBatch</TT
>. В частности, он знает следующие команды:

<PRE
CLASS="PROGRAMLISTING"
>showlog
filter -"tmp/*"
filter -"var/log/*"
fullzip "/" "/tmp/linux.imz"</PRE
>

С их помощью вы создадите образ диска в файле <TT
CLASS="LITERAL"
>/tmp/linux.imz</TT
>. Перенесите
его на сервер в каталог  <TT
CLASS="LITERAL"
>/tftpboot</TT
>. Затем создайте пакетный файл
<TT
CLASS="LITERAL"
>/tftpboot/linux.bpb</TT
>:, написав в нем следующее:

<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "linux-ext2:992 linux-swap:32"
fullunzip "linux.imz" 1
clean 2
linuxboot "linux.krn" "root=/dev/hda1 BOOT_IMAGE=linux"</PRE
>&#13;</P
><P
>Опция <TT
CLASS="LITERAL"
>BOOT_IMAGE</TT
> должна присутствовать для совместимости <TT
CLASS="LITERAL"
>lilo</TT
> с <TT
CLASS="LITERAL"
>rc.sysinit</TT
>
в RedHat версии 5.1 и позже.</P
><P
>Ваш удаленно загружаемый linux готов! Теперь вы можете установить опцию
BOOTP-155 в <TT
CLASS="LITERAL"
>"linux"</TT
>, или запустить команду <TT
CLASS="LITERAL"
>include "linux.bpb"</TT
> в BpBatch
для ее проверки.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN545"
>5.4.4. Поддержка системы и обновления</A
></H3
><P
>Если в будущем вам понадобится обновить версию программы, установить патчи и т.п., то сделайте следующее: 


<P
></P
><UL
><LI
><P
>Загрузите с сети клиентскую машину, чтобы получить свежую инсталляцию linux </P
></LI
><LI
><P
>Внесите изменения </P
></LI
><LI
><P
>Вновь создайте образ диска </P
></LI
><LI
><P
>Скопируйте новый образ диска поверх старого на сервер </P
></LI
></UL
>
Это означает, что вы можете обновлять программы в новой конфигурации так же, как будто это обычная локальная установка.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN557"
>5.5. Настройка DOS 6 и Windows 3.1</A
></H2
><P
>Загрузите клиентский компьютер с любимой загрузочной DOS-дискеты (уберите
BootPROM или выполните команду <TT
CLASS="LITERAL"
>FloppyBoot</TT
> в BpBatch). Отформатируйте
DOS-раздел на вашем диске с ключом <TT
CLASS="LITERAL"
>/S</TT
> , чтобы на нем была операционная
система. Размер раздела не имеет значения, так как компрессированная версия
этого раздела создается <TT
CLASS="LITERAL"
>MrZip</TT
>  Создайте каталог <TT
CLASS="LITERAL"
>DOS</TT
> и скопируйте туда DOS.
Установите предпочитаемый вами сетевой клиент (например, Microsoft
LanManager), Windows 3.1, и т.п.. Если вы используете Microsoft LanManager,
не используйте DHCP для настройки IP, потому что он там достаточно слабо
реализован и, скорее всего, не сработает в достаточно загруженной сети.
Чтобы сделать это, добавьте следующие строки в файл <TT
CLASS="FILENAME"
>protocol.ref</TT
>, в раздел,
загружающий,  <TT
CLASS="LITERAL"
>tcptsr</TT
> (конечно, замените <TT
CLASS="LITERAL"
>xxx</TT
> на настоящие параметры IP):



        IPADDRESS0 = xxx xxx xxx xxx
        SUBNETMASK0 = 255 255 xxx xxx
        DEFAULTGATEWAY0 = xxx xxx xxx xxx
        DISABLEDHCP = 1</P
><P
>Не бойтесь оптимизировать использование памяти, при помощи EMM386 - вы
можете даже использовать область, занятую ПЗУ сетевого адаптера, так как
оно нам больше не понадобится. Но аккуратно исключите из использования ОЗУ
сетевой карты, или вы не сможете связаться с сервером. При необходимости
используйте параметр <TT
CLASS="LITERAL"
>NOEMS</TT
>.</P
><P
>Если вы хотите, чтобы клиентская машина не могла быть использована без
правильного имени входа и пароля, загрузите наш драйвер псевдоустройства
<TT
CLASS="LITERAL"
>nobreak</TT
> (его можно взять по адресу
<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/nobreak.zip"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/nobreak.zip</A
></TT
>) и запустите
его в начале вашего <TT
CLASS="FILENAME"
>config.sys</TT
>. Затем добавьте в <TT
CLASS="FILENAME"
>autoexec.bat</TT
> примерно
следующее:


<PRE
CLASS="PROGRAMLISTING"
>rem -- мы используем файл c:\logged в качестве флага
del c:\logged &#62;nul
:loginneeded
cls
echo Пожалуйста, укажите свое имя и пароль
echo.
net logon *
rem -- скрипт входа должен был создать c:\logged
if not exist c:\logged goto loginneeded
del c:\logged
rem -- теперь снова разрешаем break
echo Yes &#62;NOBRK</PRE
>

&#13;</P
><P
>Проверьте, загружается ли в DOS ваша клиентская машина после перезагрузки
компьютера и выполнения в <TT
CLASS="LITERAL"
>BpBatch</TT
> следующих команд:

        HideBootprom
        HdBoot</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN578"
>5.5.1. Создаем образ диска</A
></H3
><P
>Создайте на сервере разделенный ресурс, назвав его, например, <TT
CLASS="LITERAL"
>admin</TT
>, в
который вы поместите некоторые файлы, необходимые системному
администратору. Если сервер работает под управлением Unix, то неплохо было
бы создать в <TT
CLASS="LITERAL"
>admin</TT
> символьную ссылку на каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
>, чтобы было можно
помещать туда образы напрямую с клиентской машины. В <TT
CLASS="LITERAL"
>admin</TT
> создайте каталог
<TT
CLASS="LITERAL"
>/utils</TT
> и поместите туда следующие файлы:

<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>mrbatch.exe</TT
>,
DOS-версию  <TT
CLASS="LITERAL"
>BpBatch</TT
></P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>mrzip.exe</TT
>,
DOS-версию программы, создающей образы дисков </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>bpbatch.hlp</TT
>,
файл помощи </P
></LI
></UL
>
Вы также можете поместить в этот же каталог простой MrZip-скрипт под
названием <TT
CLASS="FILENAME"
>zipdos.mrz</TT
>, содержащий команды, необходимые для создания образа
DOS-раздела, например такие:


<PRE
CLASS="PROGRAMLISTING"
>showlog
filter -"lanman.dos/lmuser.ini"
filter -"temp/*"
filter -"*.swp"
fullzip "c:/" "L:/tftpboot/dos.imz"</PRE
>

&#13;</P
><P
>Теперь вернитесь на клиентскую машину, подключите ресурс <TT
CLASS="LITERAL"
>admin</TT
> к диску <TT
CLASS="LITERAL"
>L:</TT
>,
перейдите в каталог <TT
CLASS="LITERAL"
>utils</TT
> и выполните следующую команду:
        mrzip -b zipdos</P
><P
>Через минуту или две на сервере в каталоге <TT
CLASS="LITERAL"
>/tftpboot</TT
> появится новый файл
<TT
CLASS="FILENAME"
>dos.imz</TT
>, представляющий из себя компрессированный образ вашего жесткого
диска. Создайте файл <TT
CLASS="LITERAL"
>/tftpboot/dos.bpb</TT
> и напишите в нем следующее:


<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "bigdos:1024"
setbootpart 1
fullunzip "dos.imz" 1
hidebootprom
hdboot :1</PRE
>

&#13;</P
><P
>Ваша конфигурация DOS для удаленной загрузки готова! Теперь вы можете
установить опцию BOOTP-155 в <TT
CLASS="LITERAL"
>"dos"</TT
>, или запустить команду <TT
CLASS="LITERAL"
>include "dos.bpb"</TT
>
в BpBatch для ее проверки.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN611"
>5.5.2. Адаптируем конфигурацию для других машин</A
></H3
><P
>Если вы хотите, чтобы некоторые настройки различались на разных машинах
(обычно это нужно для настроек IP, потому что Micro$oft DHCP работает
ужасно) вы можете указать <TT
CLASS="LITERAL"
>BpBatch</TT
> изменять некоторые файлы перед загрузкой.
Сначала зайдите в каталог <TT
CLASS="FILENAME"
>lanman.dos</TT
> и сделайте следующее
        copy *.ini *.ref
        
Затем отредактируйте файлы <TT
CLASS="LITERAL"
>.ref</TT
> и замените все фиксированные параметры на
имена переменных BOOTP следующим образом:

        computername = ${BOOTP-Host-Name}
        ipaddress0 = ${MS-IPAddress}
        subnetmask0 = ${MS-IPSubnet}
        defaultgateway = ${MS-IPRouter}
Затем снова создайте образ диска, как было описано в предыдущей главе. Мы
не можем напрямую использовать IP-параметры из переменных BOOTP, потому что
LanManager использует в качестве разделителей пробелы, а не точки. Измените
<TT
CLASS="FILENAME"
>dos.bpb</TT
> примерно так:


<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "bigdos:1024"
setbootpart 1
fullunzip "dos.imz" 1
set MS-IPAddress="$BOOTP-Your-IP"/.= /
set MS-IPSubnet="$BOOTP-Subnet-Mask"/.= /
set MS-IPRouter="$BOOTP-Routers"/.= /
patch "{:1}lanman.dos/protocol.ref" "{:1}lanman.dos/protocol.ini"
patch "{:1}lanman.dos/tcpputils.ref" "{:1}lanman.dos/tcputils.ini"
patch "{:1}lanman.dos/lanman.ref" "{:1}lanman.dos/lanman.ini"
hidebootprom
hdboot :1</PRE
>


Вы можете поместить <TT
CLASS="LITERAL"
>.ref</TT
>-файлы на сервер в каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
> вместо того,
чтобы поместить их в образ диска.</P
><P
>Неплохо также иметь возможность менять настройки клиентских машин без
повторного создания образов дисков. Для этого можно скопировать файлы
<TT
CLASS="FILENAME"
>autoexec.bat</TT
> и <TT
CLASS="FILENAME"
>config.sys</TT
> в <TT
CLASS="FILENAME"
>autoexec.ref</TT
> и <TT
CLASS="FILENAME"
>config.ref</TT
> соответственно,
поместить их на сервер в каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
> и добавить две строки в пакетный
файл, приведенный выше:

        patch "autoexec.ref" "{:1}autoexec.bat"
        patch "config.ref" "{:1}config.sys"
Вы можете теперь спокойно изменять эти файлы на сервере, и даже настраивать
в них машинно-зависимые параметры, получаемые от BOOTP.</P
><P
>После внесения изменений в конфигурацию клиентской машины не забывайте
создавать образы диска, при помощи <TT
CLASS="LITERAL"
>mrzip</TT
>, иначе все эти изменения не
сохранятся.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN629"
>5.5.3. Поддержка системы и обновления</A
></H3
><P
>Если в будущем вам понадобится установить новую программу или что-то изменить, то сделайте следующее: 



<P
></P
><UL
><LI
><P
>Загрузите с сети клиентскую машину, чтобы получить свежую инсталляцию </P
></LI
><LI
><P
>Внесите изменения </P
></LI
><LI
><P
>Вновь создайте образ диска </P
></LI
><LI
><P
>Скопируйте новый образ диска поверх старого на сервер </P
></LI
></UL
>

Это означает, что вы можете обновлять программы в новой конфигурации так же,
как будто это обычная локальная установка.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN641"
>5.6. Настройка Windows 95</A
></H2
><P
>В предыдущих версиях этого документа мы советовали использовать серверную установку Microsoft Windows 95, но ничего, кроме головной боли и проблем, это не приносит: 



<P
></P
><UL
><LI
><P
>Это очень, очень плохо реализованная конфигурация &#13;</P
></LI
><LI
><P
>Многие программы ее не поддерживают, и их установка не работает. Среди них
Microsoft Internet Explorer, OnNet 32, Novell's Protected-mode client
(кстати, ЗНАЧИТЕЛЬНО более безопасный и защищенный, чем "Клиент для сетей
Netware" от Microsoft).&#13;</P
></LI
><LI
><P
>Его нельзя использовать с "Клиентом для сетей Microsoft" по TCP/IP, потому
что у Microsoft нет драйвера TCP/IP для DOS-режима, совместимого с Windows
95. Это означает, что эту конфигурацию нельзя использовать с Samba&#13;</P
></LI
><LI
><P
>Обновления программ становятся практически невозможны - после включения
клиентской машины многие DLL на сервере оказываются заблокированы, и, при
попытке их изменения, выдается ошибка <I
CLASS="EMPHASIS"
>sharing violations</I
>.</P
></LI
></UL
>
Поэтому мы исключили из данного документа всю информацию, касающуюся этой
установки, включая советы по обходу трудных ситуаций, собиравшиеся месяцами
(вы все еще можете прочитать их в
<A
HREF="http://www.linux.org.ru/books/HOWTO/win95old/win95old.html"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/win95old/win95old.html</A
>), и
перешли к нашей новой концепции: базирование установки на локальном диске и
удаленная загрузка. Одним словом, сейчас конфигурация для Windows 95 так же
проста, как и для DOS.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN655"
>5.6.1. Настройка клиентской машины</A
></H3
><P
>Установите стандартную клиентскую конфигурацию Windows 95, либо начиная с
нуля (как было описано в установке DOS-клиента), либо запустив инсталляцию
в DOS-клиенте с сети (так сделали мы). Вы также можете использовать
предустановленную версию Windows, поставляемую вместе с компьютером, но вы,
скорее всего, не будете знать, что же там установлено.&#13;</P
><P
>Выполните процедуры, описанные ранее при установке DOS-клиента. Обычно НЕТ
необходимости использовать EMM386 в Windows 95. Если у вас Windows 95 OSR2
(он же MSWIN 4.1, он же Windows 95 service pack 1, он же Windows 95 с
Internet Explorer), вы должны добавить следующую строку в секцию <TT
CLASS="LITERAL"
>[Options]</TT
>
файла <TT
CLASS="FILENAME"
>MSDOS.SYS</TT
> (да-да, это текстовый файл):



<PRE
CLASS="PROGRAMLISTING"
>AUTOSCAN=0</PRE
>


Таким образом, ScanDisk не будет автоматически запускаться при загрузке Windows .&#13;</P
><P
>Если вы хотите облегчить нагрузку на сервер и сеть (что очень ускорит
работу всей системы) и держать все программы на сервере - мы бы
посоветовали использовать прекрасную программу: Shared LAN Cache
компании Measurement Techniques, Inc (см. <A
HREF="http://www.lancache.com"
TARGET="_top"
>http://www.lancache.com</A
>). Эта
программа запускается на каждой клиентской машине и кэширует на локальный
жесткий диск все данные, приходящие из сети. Даже MS-Office запускается
второй раз значительно быстрее... Вам нужна лицензия на каждый компьютер,
но она не очень дорогая, и существуют скидки для образовательных
учреждений. Наиболее простой способ - посетить их веб-сайт и взять
бесплатную оценочную версию.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN664"
>5.6.2. Создаем образ диска</A
></H3
><P
>Ваш MrZip-скрипт будет называться <TT
CLASS="LITERAL"
>zipwin95.mrz</TT
> и будет содержать следующее:


<PRE
CLASS="PROGRAMLISTING"
>showlog
filter -"temp/*"
filter -"*.swp"
fullzip "c:/" "L:/tftpboot/win95.imz"</PRE
>

&#13;</P
><P
>Чтобы создать образ, подключите ресурс <TT
CLASS="LITERAL"
>admin</TT
> к диску <TT
CLASS="LITERAL"
>L:</TT
>, перейдите в каталог
<TT
CLASS="LITERAL"
>utils</TT
> и запустите следующую команду:
        mrzip -b zipwin95</P
><P
>Через несколько минут на сервере в каталоге <TT
CLASS="LITERAL"
>/tftpboot</TT
> появится новый файл
<TT
CLASS="LITERAL"
>win95.imz</TT
>, представляющий из себя компрессированный образ вашего жесткого
диска. Если ваш компрессированный образ больше 87 Мб, то, скорее всего, он
будет разбит на несколько частей. Эти части будут автоматически загружаться
друг за другом при необходимости. Заметьте, что образ размером больше 87 Мб
обычно будет устанавливаться при загрузке Больше одной минуты, что может
плохо сказаться на пользователях. Наш образ Windows 95 имеет размер около
70 Мб, потому что большинство программ (кроме Office и Explorer) полностью
находятся на сервере. На декомпрессирование и восстановление диска тратится
около 45 секунд.</P
><P
>Создайте пакетный файл <TT
CLASS="LITERAL"
>/tftpboot/win95.bpb</TT
> и напишите в нем следующее: 


<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "bigdos:1024"
setbootpart 1
fullunzip "win95.imz" 1
hidebootprom
hdboot :1</PRE
>

&#13;</P
><P
>Ваша конфигурация Windows 95 для удаленной загрузки готова! Теперь вы
можете установить опцию BOOTP-155 в <TT
CLASS="LITERAL"
>"win95"</TT
> или запустить команду <TT
CLASS="LITERAL"
>include "win95.bpb"</TT
> в BpBatch для ее проверки.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN682"
>5.6.3. Адаптируем конфигурацию для других машин</A
></H3
><P
>Существует серьезное различие между Windows 3.1 и Windows 95: в последний
встроена поддержка Plug-and-play ,т.е. автоматическое определения
оборудования. Это не очень плохая штука, но иногда с ней возникают
проблемы: порой она слишком чувствительная, а порой не срабатывает.&#13;</P
><P
>Если вы попытаетесь загрузить другую клиентскую машину с тем же загрузочным
образом, вы, скорее всего, получите при загрузке сообщения о том, что Windows
обнаружила новое оборудование: новую звуковую карту, новый жесткий диск,
новую сетевую карты и даже новую мышь... Это может возникать по двум
причинам:
<P
></P
><UL
><LI
><P
>устройства используют разные ресурсы (скажем, мышь включена в другой порт,
или звуковая карта включена в другой слот - да-да это тоже определяется)</P
></LI
><LI
><P
>устройства могут давать Windows 95 свои персональные серийные номера
(например, Windows 95 различают сетевые карты на основе их уникального
Ethernet-адреса)</P
></LI
></UL
>
Факт того, что Windows 95 обнаруживает новые и измененные устройства, не
является проблемой, если механизм Plug&amp;Play работает нормально; трудности возникают,
если он не работает. Windows 95 Plug-and-Play, например, не работает для
наших мышей Logitech PS2/aux - в результате, мыши нет вообще. Чтобы подобных
проблем не возникало можно либо стараться сделать конфигурации компьютеров
предельно схожими, либо делать разные образы дисков для разного
оборудования. Позже вы узнаете, что вы можете использовать тот же образ
диска и иметь несколько копий системного реестра, который вы будете
копировать с сервера, после записи системы на диск перед загрузкой.</P
><P
>Правда, существует одно устройство, которое уникально на каждом компьютере
- это сетевая карта. Для PCI-карт это неважно, но с ISA PnP картами будут
проблемы. Нам очень не повезло - PnP код наших карт SMC EtherEZ "вешал"
компьютер. Единственное решение - заставить Win95 считать, что он уже знает
о сетевой карте и что не надо трогать PnP. Для этого в системный
реестр до загрузки Windows 95 необходимо внести данные о сетевой карте. Еще раз
напоминаем, что для PCI-карт этого делать не надо.</P
><P
>Перенесите <TT
CLASS="FILENAME"
>autoexec.bat</TT
> на сервер, как было ранее описано для DOS.
Отредактируйте его (на сервере), добавив следующие строки:

<PRE
CLASS="PROGRAMLISTING"
>rem --- Вносим изменения в реестр Windows для того, чтобы не работало определение PnP ISA карты
regedit /L:c:\windows\system.dat /R:c:\windows\user.dat c:\temp\patch.reg</PRE
>

<TT
CLASS="LITERAL"
>regedit</TT
> - это стандартная программа, входящая в комплект Windows 95,
позволяющая вам просматривать содержимое реестра в Windows 95, или
производить простые операции с ним из DOS. Запустите regedit в Windows 95,
найдите вашу сетевую карту, обычно в

<PRE
CLASS="PROGRAMLISTING"
>        HKEY_LOCAL_MACHINE\Enum\ISAPNP</PRE
>


и экспортируйте ветвь дерева реестра, используя меню <I
CLASS="EMPHASIS"
>Реестр</I
>. Вы получите
текстовый файл - назовите его  <TT
CLASS="FILENAME"
>patch.ref</TT
> и поместите в каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
> на
сервере. Откройте этот файл и найдите, где хранится Ethernet-адрес этой
карты (сделайте это на двух разных машинах и сравните файлы, если не можете
сами найти необходимую строку). Замените его на <TT
CLASS="LITERAL"
>${MACID}</TT
>. Добавьте в скрипт
<TT
CLASS="LITERAL"
>win95.bpb</TT
> примерно такие строки:

<PRE
CLASS="PROGRAMLISTING"
>        set macid = "$BOOTP-Client-ID"
        patch "patch.ref" "{:1}temp/patch.reg"</PRE
>

(если в реестре записан не совсем Ethernet-адрес карты клиентской машины,
то вам придется произвести кое-какие манипуляции с переменной <TT
CLASS="LITERAL"
>MACID</TT
>). Это
все - ваши клиентские машины должны прекратить попытки автоматически
определить сетевую карту.</P
><P
>Еще раз: все, что описано выше, касается только ISA-карт. Кстати, этот же
механизм можно использовать для автоматической настройки имени машины -
Windows 95 игнорирует это поле в ответе на запрос DHCP. Для этого добавьте
в файл <TT
CLASS="FILENAME"
>patch.ref</TT
> следующее:


<PRE
CLASS="PROGRAMLISTING"
>[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\VNETSUP]
"ComputerName"="${BOOTP-Host-Name}"

[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\MSTCP]
"HostName"="${BOOTP-Host-Name}"

[HKEY_LOCAL_MACHINE\System\CurrentControlSet\control\ComputerName\ComputerName]
"ComputerName"="${BOOTP-Host-Name}"</PRE
>

&#13;</P
><P
>Используя этот метод исправления реестра, вашу конфигурацию можно перенести
на любую машину с подобной конфигурацией. Если все-таки не удается
избежать автоматического определения устройств Windows, то попытайтесь
вновь создать образ диска. Таким образом, в реестре будет находиться
специфичная именно для этой машины информация, и проблема должна быть
решена.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN708"
>5.6.4. Поддержка системы и обновления</A
></H3
><P
>Если в будущем вам понадобится обновить версию программы, установить патчи и т.п., то сделайте следующее: 



<P
></P
><UL
><LI
><P
>Загрузите с сети клиентскую машину, чтобы получить свежую инсталляцию </P
></LI
><LI
><P
>Внесите изменения </P
></LI
><LI
><P
>Вновь создайте образ диска </P
></LI
><LI
><P
>Скопируйте новый образ диска поверх старого на сервер </P
></LI
></UL
>
Это означает, что вы можете обновлять программы в новой конфигурации так же,
как будто это обычная локальная установка.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN720"
>5.7. Настройка Windows NT</A
></H2
><P
>Мы в настоящий момент не используем Windows NT на удаленно загружаемых
машинах, но проверили нашу систему для NT. И она работает.
&#13;</P
><P
>В наших утилитах нет поддержки NTFS (у нас нет ни документации, ни времени
ее реализовывать, но я буду рад помочь тому, кому это интересно) - вам
придется установить NT на FAT16 (просто не преобразовывайте ваши разделы в
NTFS в процессе установки).&#13;</P
><P
>Скопируйте скрипт <TT
CLASS="FILENAME"
>win95.bpb</TT
> в <TT
CLASS="FILENAME"
>winnt.bpb</TT
>. Замените строку <TT
CLASS="LITERAL"
>setpartitions</TT
> в <TT
CLASS="FILENAME"
>winnt.bpb</TT
> на следующее: 

<PRE
CLASS="PROGRAMLISTING"
>        setpartitions "BIGDOS:512 BIGDOS:512"</PRE
>

Используя этот скрипт загрузите Windows 95 и установите NT на диск C. Пока
не волнуйтесь насчет второго раздела. Очень много не устанавливайте - иначе
у вас получится слишком большой и медленно разжимающийся образ диска.
Уберите Windows 95 с диска C - он вам больше не нужен (загрузочное меню
обрабатывает BootPROM, а не NT-loader).</P
><P
>Перезагрузите компьютер без перезаписи жесткого диска, то есть не
запускайте скрипт <TT
CLASS="LITERAL"
>winnt</TT
>, а просто дайте две команды:

<PRE
CLASS="PROGRAMLISTING"
>        hidebootprom
        hdboot</PRE
>
Ваша рабочая станция NT должна нормально загрузиться. Настройте систему необходимым образом.</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN733"
>5.7.1. Создаем образ диска</A
></H3
><P
>Проблема с Windows NT состоит в том, что прямой доступ к диску запрещен на
уровне ядра. Это означает, что <TT
CLASS="LITERAL"
>MrZip</TT
> не сможет прочитать даже загрузочные
сектора. Лучший способ сделать образ диска - загрузить Windows 95 и
запустить <TT
CLASS="LITERAL"
>MrZip</TT
> из окна DOS. Чтобы сделать это, подправьте скрипт <TT
CLASS="FILENAME"
>winnt.bpb</TT
>
так, чтобы он восстанавливал образ Windows 95 не на первый, а на второй
раздел:



<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "BIGDOS:512 BIGDOS:512"
setbootpart 2
fullunzip "win95.imz" 2
hidebootprom
hdboot :2</PRE
>


(если имеется дополнительный патч, замените в нем <TT
CLASS="LITERAL"
>"{:1}"</TT
> на
<TT
CLASS="LITERAL"
>"{:2}"</TT
>).
Загрузитесь при помощи этого скрипта - у вас должна запуститься Windows 95,
и должен появиться диск <TT
CLASS="LITERAL"
>D:</TT
>, на котором будет Windows NT.</P
><P
>Создайте образ диска (только, конечно, используя <TT
CLASS="LITERAL"
>D:</TT
>), и запишите его на
сервер под именем <TT
CLASS="FILENAME"
>winnt.imz</TT
> в каталог <TT
CLASS="LITERAL"
>/tftpboot</TT
>. Еще раз отредактируйте
скрипт <TT
CLASS="FILENAME"
>winnt.bpb</TT
>, добавив в него примерно следующее:


<PRE
CLASS="PROGRAMLISTING"
>hidelog
setpartitions "BIGDOS:512 BIGDOS:512"
setbootpart 1
fullunzip "winnt.imz" 1
clean 2
#fullunzip "win95.imz" 2
hidebootprom
hdboot :1</PRE
>


Ваша конфигурация для удаленной загрузки Windows NT готова. Конечно, если
вам не нравится иметь два раздела, можете оставить один. Но, когда
понадобится перестроить образ диска, вам придется снова установить второй
раздел для загрузки Windows 95.&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN749"
>5.7.2. Поддержка системы и обновления</A
></H3
><P
>Если в будущем вам понадобится обновить версию программы, установить патчи и т.п., то сделайте следующее:



<P
></P
><UL
><LI
><P
>Загрузите с сети клиентскую машину, чтобы получить свежую инсталляцию </P
></LI
><LI
><P
>Внесите изменения </P
></LI
><LI
><P
>Отредактируйте <TT
CLASS="FILENAME"
>winnt.bpb</TT
>: закомментируйте строки  <TT
CLASS="LITERAL"
>clean</TT
> и <TT
CLASS="LITERAL"
>fullunzip</TT
> winnt, и
уберите комментарий со строки <TT
CLASS="LITERAL"
>fullunzip</TT
> для win95</P
></LI
><LI
><P
>Вновь создайте образ диска </P
></LI
><LI
><P
>Скопируйте новый образ диска поверх старого на сервер </P
></LI
></UL
>
И все!</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN767"
>5.8. Проблемы и их решение (FAQ)</A
></H2
><P
>В этом разделе приводится решение наиболее часто возникающих проблем.</P
><DIV
CLASS="QANDASET"
><DL
><DT
>5.8.1. <A
HREF="Remote-Boot.html#AEN772"
>Загрузка образа не работает</A
></DT
><DT
>5.8.2. <A
HREF="Remote-Boot.html#AEN778"
>Процедура разархивации образа раздела сразу выдает ошибку</A
></DT
><DT
>5.8.3. <A
HREF="Remote-Boot.html#AEN787"
>Компьютер повисает во время загрузки/разархивирования (1)</A
></DT
><DT
>5.8.4. <A
HREF="Remote-Boot.html#AEN799"
>Компьютер повисает вместо загрузки/разархивирования (2)</A
></DT
><DT
>5.8.5. <A
HREF="Remote-Boot.html#AEN806"
>Прокрутка экрана в VESA не работает</A
></DT
><DT
>5.8.6. <A
HREF="Remote-Boot.html#AEN811"
>В кэше находится испорченный файл</A
></DT
><DT
>5.8.7. <A
HREF="Remote-Boot.html#AEN818"
>В пакетном файле не работает команда EXIT</A
></DT
><DT
>5.8.8. <A
HREF="Remote-Boot.html#AEN823"
>Команда Print ничего не выводит</A
></DT
><DT
>5.8.9. <A
HREF="Remote-Boot.html#AEN830"
>MrZip выдает ошибку <TT
CLASS="LITERAL"
>Malloc failed</TT
></A
></DT
><DT
>5.8.10. <A
HREF="Remote-Boot.html#AEN839"
>MrZip прерывает работу при чтении каталогов</A
></DT
><DT
>5.8.11. <A
HREF="Remote-Boot.html#AEN849"
>MrZip не может прочитать некоторые файлы</A
></DT
><DT
>5.8.12. <A
HREF="Remote-Boot.html#AEN862"
>Образы дисков всегда читаются с сервера</A
></DT
><DT
>5.8.13. <A
HREF="Remote-Boot.html#AEN867"
>Red Hat Linux 5.1 не загружается</A
></DT
><DT
>5.8.14. <A
HREF="Remote-Boot.html#AEN877"
>Электронный диск широковещательного TFTP повисает (<I
CLASS="EMPHASIS"
>Оставаясь в подключенном состоянии</I
>)</A
></DT
><DT
>5.8.15. <A
HREF="Remote-Boot.html#AEN883"
>BpBatch повисает при доступе к файлу, а MrBatch работает нормально</A
></DT
><DT
>5.8.16. <A
HREF="Remote-Boot.html#AEN888"
>Разархивирование образа, разбитого на части, не работает (выдается ошибка Malloc failed)</A
></DT
><DT
>5.8.17. <A
HREF="Remote-Boot.html#AEN893"
>MrBatch и MrZip жалуются на терминал в RedHat 5.x</A
></DT
><DT
>5.8.18. <A
HREF="Remote-Boot.html#AEN898"
>"libncurses.so.3.0: невозможно открыть разделенный объектный файл" в Linux</A
></DT
><DT
>5.8.19. <A
HREF="Remote-Boot.html#AEN904"
>MrBatch и MrZip не работают в Linux (файл не найден)</A
></DT
><DT
>5.8.20. <A
HREF="Remote-Boot.html#AEN909"
>У меня не работают никакие видеорежимы, кроме используемого по умолчанию VESA 800x600</A
></DT
><DT
>5.8.21. <A
HREF="Remote-Boot.html#AEN925"
>BpBatch выводит сообщение "Malloc failed" при разархивировании образов, разбитых на несколько частей</A
></DT
><DT
>5.8.22. <A
HREF="Remote-Boot.html#AEN930"
>Команда Fullunzip в Linux-версии MrBatch не работает</A
></DT
><DT
>5.8.23. <A
HREF="Remote-Boot.html#AEN935"
>Scandisk выдает сообщение об ошибках на диске</A
></DT
><DT
>5.8.24. <A
HREF="Remote-Boot.html#AEN940"
>RedHat не загружается с загрузочного диска, при помощи команды FloppyBoot</A
></DT
><DT
>5.8.25. <A
HREF="Remote-Boot.html#AEN945"
>Диск с файловой системой FAT32 не загружается</A
></DT
></DL
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN772"
></A
><B
>5.8.1. </B
>Загрузка образа не работает</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Вы, скорее всего, используете стандартный TFTP-севрер, который не
поддерживает передачу более 65535 пакетов данных, размером по 512 байт (а в
Solaris, вообще, только 32767 пакетов!). В результате этого образ раздела
должен быть разбит на части, не более 30 Мб каждая (или не более 15 Мб в
Solaris). Смотрите описание команды <I
CLASS="EMPHASIS"
>CopyArchive</I
>, которая имеет возможность
разбивать на части уже существующий образ раздела. Однако мы настоятельно
рекомендуем вам использовать улучшенный TFTP-сервер фирмы InCom - он
значительно более эффективен (используя пакеты размером 1408 байт,
вместо 512).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN778"
></A
><B
>5.8.2. </B
>Процедура разархивации образа раздела сразу выдает ошибку</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Существуют три варианта: или образ раздела на диске содержит ошибку
(используйте MrZip, чтобы определить, есть ли такие ошибки), или файл
передан неправильно, из-за превышения времени ожидания в протоколе TFTP, или
из-за несовместимости протокола.</P
><P
>Превышение времени ожидания TFTP происходит, если сеть перегружена
(например, если вы пытаетесь загрузить большие образы разделов более, чем
на 4 машины одновременно). В этом случае, <TT
CLASS="LITERAL"
>BpBatch</TT
> не пытается повторять
процедуру загрузки бесконечно, потому что это все равно не поможет.
Выключите несколько компьютеров и попытайтесь снова не более, чем на 4
компьютерах (или даже на трех). Если у вас есть необходимость часто
загружать образы на большое количество компьютеров, то используйте наш
специальный широковещательный TFTP-сервер (смотрите посвященный ему
раздел).</P
><P
>Несовместимость протокола возникает при попытке использования стандартного
TFTP-сервера (обычно входящего в комплект вашего UNIX-сервера), вместе с
указанием BpBatch работать с улучшенной версией TFTP. Если вы используете
стандартный TFTP-сервер, <I
CLASS="EMPHASIS"
>то должны убрать расширение .P у файла
загрузочного образа</I
> (это будет разъяснено в ответе на следующий вопрос).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN787"
></A
><B
>5.8.3. </B
>Компьютер повисает во время загрузки/разархивирования (1)</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Если вы используете TFTP-сервер фирмы Incom - попытайтесь указать ему опцию
-s 1408 59 в командной строке. Если вы не используете улучшенную версию
TFTP-сервера, уберите на сервере расширение <TT
CLASS="LITERAL"
>.P</TT
> в имени файла BpBatch и в
<TT
CLASS="LITERAL"
>bootptab</TT
>.</P
><P
>Подробное разъяснение: эта проблема возникает в том случае, если вы, не
установив улучшенную версию TFTP-сервера, использовали <TT
CLASS="LITERAL"
>bpbatch.P</TT
> в качестве
тэга "имя файла загрузки" в DHCP/BOOTP. BpBatch будет пытаться связаться с
улучшенной версией TFTP-сервера, если имя файла загрузки оканчивается на
<TT
CLASS="LITERAL"
>.P</TT
>. Чтобы решить эту проблему, можно либо убрать расширение <TT
CLASS="LITERAL"
>.P</TT
> из имени
файла загрузки (таким образом, BpBatch будет использовать стандартный TFTP),
либо установить улучшенной версию TFTP-сервера. Единственный,
поддерживаемый нами на сегодняшний день, улучшенный TFTP-сервер - это
сервер фирмы Incom. Вы можете найти собранную версию на их веб-сайте, или в
нашем каталоге дистрибутива нашей системы. Для того, чтобы TFTP-сервер
фирмы Incom корректно работал с дополнительными функциями TFTP, ему надо в
командной строке указать опцию <TT
CLASS="LITERAL"
>-s 1408 59</TT
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN799"
></A
><B
>5.8.4. </B
>Компьютер повисает вместо загрузки/разархивирования (2)</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>
Возможно, в вашем компьютере некорректно работает поддержка VESA.
Попробуйте использовать опцию <TT
CLASS="LITERAL"
>-v</TT
> в командной строке или установите
переменную VESA в <TT
CLASS="LITERAL"
>"OFF"</TT
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN806"
></A
><B
>5.8.5. </B
>Прокрутка экрана в VESA не работает</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Мы используем для прокрутки функции VESA версии 1.1. Если ваш видеоадаптер
не поддерживает VESA 1.1, то забудьте о прокрутке. Если же прокрутка
работает на одну страницу, а затем на экране появляется странная сдвинутая
картинка - не волнуйтесь. Я знаю об этой ошибке, и исправлю ее, как только
у меня появится свободное время (прокрутка VESA, на самом деле, не
очень то и важна...)</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN811"
></A
><B
>5.8.6. </B
>В кэше находится испорченный файл</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Если файл в кэше бывает испорчен внешней программой, то он оттуда
автоматически удаляется. Если файл не полностью записан в кэш (это может
произойти, если компьютер выключить во время передачи файла), то он также
автоматически удаляется. Однако, если сервер передал испорченный файл или
передача остановлена со стороны сервера, то, возможно, этот файл останется
в кэше. Вы можете очистить кэш, нажав одновременно две клавиши Shift при
загрузке <TT
CLASS="LITERAL"
>BpBatch</TT
>. Вы также можете использовать команду <TT
CLASS="LITERAL"
>clean -1</TT
> в
интерактивном режиме BpBatch.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN818"
></A
><B
>5.8.7. </B
>В пакетном файле не работает команда EXIT</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Это не ошибка. Exit - это не команда. В BpBatch нет команд exit или quit -
нет никакого смысла в том, чтобы выходить из загрузочного скрипта без
загрузки системы. И MrBatch - это полная копия BpBatch. Вместо этой команды
вы можете вызвать HdBoot. Вот это имеет смысл - DOS версия просто прекратит
свою работу без перезагрузки. Заметьте, что вы в любое время можете
выйти из DOS-версии, нажав Ctrl-Break. Перед выходом программа также
восстановит все прерывания, которые она использовала.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN823"
></A
><B
>5.8.8. </B
>Команда Print ничего не выводит</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Если вы пытаетесь что-то печатать, а затем сразу же входите в интерактивный
режим, то можно и не увидеть свой текст. Это происходит потому, что
текст выводится на рабочий экран, а команда <TT
CLASS="LITERAL"
>Interact</TT
> переключила вас на
экран Журнала. Поместите команду <TT
CLASS="LITERAL"
>GetKey</TT
> сразу после команд Print, и
увидите свой текст.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN830"
></A
><B
>5.8.9. </B
>MrZip выдает ошибку <TT
CLASS="LITERAL"
>Malloc failed</TT
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>MrZip требует большое количество памяти для своей работы. Если вы
столкнулись с этой проблемой, то, во-первых, убедитесь в том, что
BootPROM выгружен командой <TT
CLASS="LITERAL"
>HideBootprom</TT
> или при помощи утилиты <TT
CLASS="LITERAL"
>bputil</TT
>
фирмы Incom. Если вы запускаете MrZip из чистого MS-DOS (не в окне MSDOS в
Windows 95) - используйте EMM386 для загрузки сетевых драйверов в верхнюю
память, чтобы максимально высвободить основную память. В окне DOS в Windows
95 эта проблема обычно не возникает (если только вы не оставили много
старых 16-битных программ в <TT
CLASS="FILENAME"
>autoexec.bat</TT
> после установки Windows 95).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN839"
></A
><B
>5.8.10. </B
>MrZip прерывает работу при чтении каталогов</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эту ошибку уже исправили. Возьмите свежую версию <TT
CLASS="LITERAL"
>MrZip</TT
>. Если ошибка
повторилась, то попробуйте создать образ раздела вновь с опцией <TT
CLASS="LITERAL"
>Trace</TT
>,
установленной в <TT
CLASS="LITERAL"
>"ON"</TT
> (и, обычно, <TT
CLASS="LITERAL"
>PauseLog</TT
>, установленной в <TT
CLASS="LITERAL"
>"OFF"</TT
>); это
поможет вам узнать причину проблемы. Если возможно, то пошлите нам
подробный отчет о найденной ошибке.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN849"
></A
><B
>5.8.11. </B
>MrZip не может прочитать некоторые файлы</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>MrZip, скорее всего, пытается прочитать заблокированный, открытый или
специальный файл, например, файл подкачки Windows. Обычно нет необходимости
включать подобные файлы в образ раздела, и их, в этом случае, необходимо
отфильтровывать (при помощи команды <TT
CLASS="LITERAL"
>filter</TT
>). Также возможно, что файл не
дает вам прочитать сама операционная система. Если MrZip не указывает, с
каким именно файлом у него возникли проблемы, попытайтесь создать образ с
опцией <TT
CLASS="LITERAL"
>Trace</TT
>, установленной в <TT
CLASS="LITERAL"
>"ON"</TT
> (и, обычно, <TT
CLASS="LITERAL"
>PauseLog</TT
>, установленной в
<TT
CLASS="LITERAL"
>"OFF"</TT
>). Вы также можете попытаться использовать прямой доступ к диску (то
есть ссылаясь на раздел не как на <TT
CLASS="LITERAL"
>"C:"</TT
> или <TT
CLASS="LITERAL"
>"/"</TT
>, а на <TT
CLASS="LITERAL"
>"{:1}"</TT
>). Создание
образа с использованием прямого доступа к диску обычно продолжается дольше,
но, иногда, оно оказывается значительно надежнее.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN862"
></A
><B
>5.8.12. </B
>Образы дисков всегда читаются с сервера</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Образы дисков хранятся на локальной машине в специальном кэш-разделе и не
должны загружаться с сети, если они не изменились на сервере. Однако,
кэш-раздел начинается сразу за последним существующим разделом -
соответственно, если суммарный объем разделов в системах изменяется, то
изменяется и месторасположение кэша, и, вследствие этого, теряется его
содержимое. Вторая возможная причина исчезновения файла из кэша -
предыдущий файл увеличился больше, чем в полтора раза, заняв, тем самым,
место, в котором был исчезнувший файл. Данные этого файла были испорчены, и
он должен быть загружен с сервера. Так, практически, никогда не происходит.
Третья причина - слишком маленький размер кэш-раздела. Если свободное от
разделов место меньше, чем сумма объемов всех компрессированных образов,
умноженная на 1,5, то в кэше будут храниться только наиболее новые образы,
а остальные будут загружаться с сервера при необходимости.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN867"
></A
><B
>5.8.13. </B
>Red Hat Linux 5.1 не загружается</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Этот дистрибутив предполагает, что Linux загружается при помощи <TT
CLASS="LITERAL"
>lilo</TT
>, и
проверяет наличие в командной строке ядра аргумента <TT
CLASS="LITERAL"
>BOOT_IMAGE</TT
> (в скрипте
<TT
CLASS="LITERAL"
>/etc/rc.d/rc.sysinit</TT
>). Просто добавьте этот аргумент к команде <TT
CLASS="LITERAL"
>linuxboot</TT
>,
или подправьте <TT
CLASS="LITERAL"
>rc.sysinit</TT
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN877"
></A
><B
>5.8.14. </B
>Электронный диск широковещательного TFTP повисает (<I
CLASS="EMPHASIS"
>Оставаясь в подключенном состоянии</I
>)</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Клиент DHCP в Linux - это специальная программа, меняющая IP-адрес
клиентской машины в соответствии с ответами на DHCP-запросы. Если адрес был
дан "навсегда" (на бесконечное время), то DHCP-клиент просто устанавливает
адрес и выходит (это именно то, что нам нужно). Однако, если время жизни
адреса ограничено, DHCP-клиент должен оставаться в памяти и передавать
повторные запросы на получение адреса, каждые несколько минут. А если
DHCP-клиент не прекращает работу, то MrBatch не загружается вообще...
Решение - установить бесконечное время выделения IP-адреса (иногда оно
бывает указано, как -1).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN883"
></A
><B
>5.8.15. </B
>BpBatch повисает при доступе к файлу, а MrBatch работает нормально</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эта проблема возникла с AMI BIOS, датированной 25/07/94. Мы пытались решить
эту проблему, но так и не смогли. Скорее всего эта проблем возникает из-за
ошибки в BIOS (по-видимому, портится содержимое регистра или ячейка
памяти).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN888"
></A
><B
>5.8.16. </B
>Разархивирование образа, разбитого на части, не работает (выдается ошибка Malloc failed)</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эта ошибка появилась после реализации совместимости с PXE, но теперь она исправлена. Возьмите более новую версию. </P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN893"
></A
><B
>5.8.17. </B
>MrBatch и MrZip жалуются на терминал в RedHat 5.x</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эта ошибка исправлена в MrBatch/MrZip в версии от 9 августа. Она возникала из-за проблем с новой версией ncurses, включенной в состав RedHat 5.1.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN898"
></A
><B
>5.8.18. </B
>"libncurses.so.3.0: невозможно открыть разделенный объектный файл" в Linux</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>MrZip был собран для libncurses версии 3.0. Вы можете использовать другие
версии libncurses, если они новее, чем 3.0. Чтобы их использовать создайте
символьную ссылку с вашего файла libncurses.so.xx на libncurses.so.3.0. В
RedHat 5.1 используйте следующую команду: <TT
CLASS="LITERAL"
>cd /usr/lib ; ln -s libncurses.4.2 libncurses.3.0</TT
>
 Вы также можете установить новую версию
mrzip/mrbatch. Начиная с 25/10/98 mrbatch собирается в RedHat 5.1.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN904"
></A
><B
>5.8.19. </B
>MrBatch и MrZip не работают в Linux (файл не найден)</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Проблема абсолютно противоположна предыдущей. Сейчас вышла официальная
версия libc6, которую невозможно использовать вместе с libc5. Если вы
встретились с этой проблемой - обновите свой Linux (Ну, если мы получим
слишком много жалоб на это, мы попытаемся держать на сайте два
дистрибутива...).</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN909"
></A
><B
>5.8.20. </B
>У меня не работают никакие видеорежимы, кроме используемого по умолчанию VESA 800x600</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Сначала посмотрите на содержимое переменной <TT
CLASS="LITERAL"
>VESA-Modes</TT
>, и убедитесь в том,
что ваша видеокарта поддерживает нужный вам режим. Затем используйте один
из двух способов установить необходимый видеорежим:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>InitGraph "режим"</TT
>: Попробуйте дать команду InitGraph "1024x768", и затем
проверьте работу этого режима (например, при помощи <TT
CLASS="LITERAL"
>DrawGif</TT
>).</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>VESA-Modes</TT
>: Режим, указанный первым в переменной <TT
CLASS="LITERAL"
>VESA-Modes</TT
> - это режим,
используемый по умолчанию. Если вы измените содержимое переменной
<TT
CLASS="LITERAL"
>VESA-Modes</TT
>, то все команды работы с графикой будут использовать выбранный
вами режим.</P
></LI
></UL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN925"
></A
><B
>5.8.21. </B
>BpBatch выводит сообщение "Malloc failed" при разархивировании образов, разбитых на несколько частей</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Мы исправили в BpBatch ошибку в процедуре выделения памяти. Убедитесь в том, что ваша версия BpBatch выпущена после 22 сентября 1998. </P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN930"
></A
><B
>5.8.22. </B
>Команда Fullunzip в Linux-версии MrBatch не работает</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Мы исправили эту ошибку в версии от 22/09/1998. </P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN935"
></A
><B
>5.8.23. </B
>Scandisk выдает сообщение об ошибках на диске</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>В версии от 25/10/98 исправлена ошибка, возникавшая с большими образами дисков. Установите новую версию BpBatch. 
  </P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN940"
></A
><B
>5.8.24. </B
>RedHat не загружается с загрузочного диска, при помощи команды FloppyBoot</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эта ошибка исправлена в версии от 25/10/98. </P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN945"
></A
><B
>5.8.25. </B
>Диск с файловой системой FAT32 не загружается</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Эта ошибка исправлена в версии от 09/02/99.</P
></DIV
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN949"
>6. Справочное руководство по утилитам удаленной загрузки</A
></H1
><P
>В этой главе приведено подробное описание утилит удаленной загрузки,
разработанных нами на факультете компьютерных наук Университета Женевы.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN952"
>6.1. BpBatch, MrBatch и MrZip</A
></H2
><P
>Эти три названия относятся к трем вариантам одной и той же программы, различающихся в следующем: 
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>BpBatch</TT
> - это специальная программа, которую
можно запустить из BootPROM до загрузки операционной системы. Она состоит
из двух частей: <TT
CLASS="LITERAL"
>bpbatch.P</TT
> - динамического
загрузчика, и <TT
CLASS="LITERAL"
>bpbatch.ovl</TT
> - собственно самой
программы. <TT
CLASS="LITERAL"
>BpBatch</TT
> предоставляет возможность
работать с дисками и файлами на них, при помощи собственной встроенной
поддержки FAT16, FAT32 и Ext2fs, а также с сетевыми ресурсами, при помощи
BootPROM TFTP API. <TT
CLASS="LITERAL"
>BpBatch</TT
> был собран в DOS,
при помощи Borland C 5.0 и Turbo Assembler 3.2.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>MrBatch</TT
> - это DOS/Linux-версия <TT
CLASS="LITERAL"
>BpBatch</TT
>. Все команды, известные <TT
CLASS="LITERAL"
>BpBatch</TT
>, обрабатываются <TT
CLASS="LITERAL"
>MrBatch</TT
> и наоборот. Она бывает очень полезна, если вы
хотите проверить работу своих пакетных скриптов из DOS/Linux. В DOS,
<TT
CLASS="LITERAL"
>MrBatch</TT
> эмулирует удаленный доступ к файлам,
при помощи ОС, если BootPROM не доступен. В Linux, BootPROM недоступен
вообще, но <TT
CLASS="LITERAL"
>MrBatch</TT
> эмулирует его работу, при
помощи встроенной в Linux поддержки IP, или, в крайнем случае, при помощи
ОС. <TT
CLASS="LITERAL"
>MrBatch</TT
> был собран в Linux при помощи GCC
2.7.2.1, и в DOS, при помощи Borland C 5.0 и Turbo Assembler 3.2.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>MrZip</TT
> - это интерпретатор, обрабатывающий
дополнительный набор команд языка <TT
CLASS="LITERAL"
>MrBatch</TT
>,
служащий для создания образов дисков. В <TT
CLASS="LITERAL"
>MrZip</TT
>
ограниченный доступ к удаленным файлам заменен на полноценный доступ к
файлам, при помощи ОС. В <TT
CLASS="LITERAL"
>MrZip</TT
> не встроена
поддержка VESA. <TT
CLASS="LITERAL"
>MrZip</TT
> был собран в Linux, при
помощи GCC 2.7.2.1, и в DOS, при помощи Borland C 5.0 и Turbo Assembler 3.2.</P
></LI
></UL
>&#13;</P
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN979"
>6.1.1. Опции командной строки</A
></H3
><P
>Все программы имеют одинаковый набор возможных опций. <TT
CLASS="LITERAL"
>MrBatch</TT
> и <TT
CLASS="LITERAL"
>MrZip</TT
> берут
их из командной строки, а <TT
CLASS="LITERAL"
>MrBatch</TT
> берет их из опции 155 BOOTP. Список
возможных опций:

<PRE
CLASS="PROGRAMLISTING"
>        [-x] [-l] [-b] [-v] [-w] [-i] [базовое_имя_скрипта]</PRE
>

где: 

<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>-x</TT
> запрещает использование расширенной памяти </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>-l</TT
> запрещает использование набора символов ISO-latin-8859-1 в качестве стандартного </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>-b</TT
> запрещает обнаружение BootPROM (вызывающее инициализацию флоппи-диска в DOS) </P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>-v</TT
> запрещает обнаружение VESA (вызывающее переключение в полноэкранный режим в Windows 95) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>-w</TT
> разрешает прямую запись на диск (она запрещена по умолчанию в DOS и Linux) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>-i</TT
> включает интерактивный режим, даже если было задано имя скрипта &#13;</P
></LI
></UL
>
<TT
CLASS="LITERAL"
>Базовое_имя_скрипта</TT
> - это необязательный аргумент. Если оно задано, <TT
CLASS="LITERAL"
>MrBatch</TT
>
и <TT
CLASS="LITERAL"
>BpBatch</TT
> загружают скрипт с этим именем и расширением <TT
CLASS="LITERAL"
>.bpb</TT
>, а <TT
CLASS="LITERAL"
>MrZip</TT
>
загружает скрипт с этим именем и расширением <TT
CLASS="LITERAL"
>.mrz</TT
>. Если это имя не задано,
<TT
CLASS="LITERAL"
>MrBatch</TT
> и <TT
CLASS="LITERAL"
>MrZip</TT
> работают в интерактивном режиме, а <TT
CLASS="LITERAL"
>MrBatch</TT
> загружает файл с
тем же именем, что и загрузочный файл BOOTP, только с расширением .bpb.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1014"
>6.1.2. Синтаксические правила</A
></H3
><P
>При обработке команды <TT
CLASS="LITERAL"
>BpBatch</TT
> следует нижеприведенным правилам. 
<P
></P
><UL
><LI
><P
>Команды обрабатываются построчно. Строки разделяются переводом строки и/или возвратом каретки. </P
></LI
><LI
><P
>Максимальная длина строки - 255 символов. </P
></LI
><LI
><P
>Регистр ключевых слов и имен переменных не имеет значения. </P
></LI
><LI
><P
>" - это специальный символ - ограничитель строковых констант </P
></LI
><LI
><P
>Когда в тексте встречается конструкция вида ${variable} или $variable, она заменяется на значение переменной или на пустую строку, если переменная не определена.. Эта подстановка выполняется также и внутри строк. Более того, подставляемое значение должно быть также включено в кавычки, если предполагается, что оно является строкой (т.е. можно говорить скорее о макро-подстановке, а не о переменных). 
 </P
></LI
><LI
><P
>&#13;<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>\a</TT
> заменяется на символ звукового сигнала (ASCII 7) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\b</TT
> заменяется на символ "забой" (ASCII 8) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\n</TT
> заменяется на символ "перевод строки" (ASCII 10) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\r</TT
> заменяется на символ "возврат каретки" (ASCII 13) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\t</TT
> заменяется на символ "табуляция" (ASCII 9) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\v</TT
> заменяется на символ "вертикальная табуляция" (ASCII ...) </P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>\nnn</TT
> где nnn - это трехзначное восьмеричное число от 000 до 377, заменяется на символ с ASCII-кодом nnn &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\X</TT
>, где X - это любой символ, не перечисленный выше, заменяется на сам символ X. В частности: 


<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>\"</TT
> заменяется на стандартную двойную кавычку (т.е. не является ограничителем строки) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\$</TT
> заменяется на символ $ (не выполняет подстановку переменных) </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\\</TT
> заменяется на символ \ (не является специальным символом) </P
></LI
></UL
>&#13;</P
></LI
></UL
>&#13;</P
></LI
><LI
><P
>Символ "конец строки" (ASCII код 0) НЕ МОЖЕТ быть использован в тексте, так как он является внутренним ограничителем строки </P
></LI
><LI
><P
>Символ "волнистые линии" (ASCII код 249, 0F9h, 0371 - KOI-8 символ "Ы") НЕ МОЖЕТ быть использован в тексте, так как он используется программой в качестве внутреннего ограничителя строки. &#13;</P
></LI
><LI
><P
>Символ "блок" (ASCII код 255, 0FFh, 0377) НЕ МОЖЕТ быть использован в тексте, так как он используется программой в качестве внутреннего ограничителя переменных. &#13;</P
></LI
></UL
>&#13;</P
><P
>Пустые строки игнорируются. Строки, начинающиеся с символа <TT
CLASS="LITERAL"
>#</TT
>
воспринимаются, как комментарии, и также игнорируются. Строки, начинающиеся
с двоеточия (<TT
CLASS="LITERAL"
>:</TT
>), воспринимаются как метки перехода и не обрабатываются.</P
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Строковые выражения</DT
><DD
><P
>Строки ограничиваются с обеих сторон двойными кавычками: 

        "Hello world"
Чтобы включить символ "двойная кавычка" в строку, используйте символ "обратный слэш": 
        "I said: \"Hello world\""
За строками могут следовать некоторые операторы их преобразования. 

<P
></P
><UL
><LI
><P
>Оператор замены символа: 
        "Hello world"/o=u/      ==      "Hellu wurld"
        "198.76.54.32"/.= /     ==      "198 76 54 32"</P
></LI
><LI
><P
>Оператор выбора слова (отсчет ведется с нуля): 
        "Hello world"{0}        ==      "Hello"
        "198 76 54 32"{1-3}     ==      "76 54 32"</P
></LI
><LI
><P
>Оператор вырезания подстроки (отсчет ведется с нуля): 
        "Hello world"[4]        ==      "o"
        "Hello world"[4-7]      ==      "o wo"</P
></LI
></UL
>

Эти операторы могут следовать друг за другом. Описание операторов "длина строки" и "количество слов в строке" смотрите в главе "Числовые выражения". </P
></DD
><DT
>Числовые выражения</DT
><DD
><P
>Числовые выражения работают с 32-битными целыми числами (от -2,147,483,646 до 2,147,483,647). Поддержка шестнадцатеричных, восьмеричных и двоичных чисел не встроена. При необходимости получить числовое выражения система распознает следующие конструкции: 

<P
></P
><UL
><LI
><P
>Положительное или отрицательное целое число </P
></LI
><LI
><P
>Выражение в форме (<I
CLASS="EMPHASIS"
>выражение1 операция выражение2</I
>), где операция - это +,
-, * (умножение), / (деление) или <TT
CLASS="LITERAL"
>%</TT
> (остаток от деления), а <TT
CLASS="LITERAL"
>выражение</TT
> - это
числовое выражение. Заметьте, что КАЖДАЯ операция должна заключаться в
скобки:

        ((3 * 5)+2)             == 17</P
></LI
><LI
><P
>Оператор "длина строки" (@), за которым следует собственно строка: 
        @"Hello world"          == 11</P
></LI
><LI
><P
>Оператор "количество слов в строке" (#), за которым следует собственно строка: 
        #"Hello world"          == 2</P
></LI
></UL
>&#13;</P
></DD
><DT
>Промежутки времени</DT
><DD
><P
>Некоторые команды в качестве аргументов обрабатывают промежутки времени. Эти промежутки измеряются в секундах с точностью до десятых: 
        Delay 3                 пауза 3 секунды
        Delay 0.3               пауза 3/10 секунды</P
></DD
><DT
>Цвета</DT
><DD
><P
>В командах, которые требуют указание цвета, вы можете использовать либо его название (регистр не имеет значения) или его номер: 
<PRE
CLASS="PROGRAMLISTING"
>&#13;        Black           0	(Черный)
        Blue            1	(Синий)
        Green           2	(Зеленый)
        Cyan            3	(Голубой)
        Red             4	(Красный)
        Magenta         5	(Фиолетовый)
        Brown           6	(Коричневый)
        LightGray       7	(Светло-серый)
        DarkGray        8	(Темно-серый)
        LightBlue       9	(Светло-синий)
        LightGreen     10	(Светло-зеленый)
        LightCyan      11	(Ярко-голубой)
        LightRed       12	(Ярко-красный)
        LightMagenta   13	(Светло-фиолетовый)
        Yellow         14	(Желтый)
        White          15	(Белый)</PRE
>&#13;</P
></DD
><DT
>Ссылки на файлы</DT
><DD
><P
>Имена файлов - это строки. Следовательно, они должны заключаться в двойные
кавычки. Регистр имен файлов имеет значение в зависимости от файловой
системы. Слэш и обратный слэш могут свободно использоваться, заменяя друг
друга. Не забудьте, что надо использовать двойной обратный слэш: одинарный
обратный слэш - это специальный символ.</P
><P
>Существует два вида ссылок на файлы: 



<P
></P
><UL
><LI
><P
>Прямой доступ к файлам на локальном диске </P
></LI
><LI
><P
>Косвенный доступ к файлам (удаленные файлы и локальные файлы при помощи ОС) </P
></LI
></UL
>&#13;</P
><P
>Прямой доступ к файлам на диске описывается следующим образом:
"{номер_диска:номер_раздела}/полный_путь/имя_файла" 
Номер диска можно не
указывать - по умолчанию он будет 0. Например, <TT
CLASS="LITERAL"
>"{:1}/usr/bin"</TT
> указывает на <TT
CLASS="LITERAL"
>/usr/bin</TT
>, если такой каталог есть на первом разделе. Прямой доступ к файлам
на диске производится, исключительно при помощи нашей программы (мы не
используем операционную систему).</P
><P
>Существует также два <I
CLASS="EMPHASIS"
>специальных</I
> раздела. Раздел с номером 0 указывает на
Главную Загрузочную Запись (master boot record (MBR)) и имеет
псевдо-файловую систему, позволяющую вам иметь доступ к загрузочному коду.
Раздел с номером -1 - это кэш-раздел (см. ниже).</P
><P
>В BpBatch/MrBatch косвенный доступ работает с удаленными файлами, находящимися на TFTP-сервере, если доступ к BootPROM: 

<PRE
CLASS="PROGRAMLISTING"
>        "help.bpb"           - это файл help.bpb в каталоге /tftpboot
        "gifs/MyImage.gif"   - этой файл в каталоге /tftpboot/gifs</PRE
>

Можно получить доступ к другим TFTP-серверам: 
<PRE
CLASS="PROGRAMLISTING"
>        "198.76.54.32:help.bpb" </PRE
>

Также можно получить доступ к файлам на сервере, находящемся за шлюзом: 
<PRE
CLASS="PROGRAMLISTING"
>        "198.70.0.1/198.76.54.31:help.bpb"</PRE
>

Можно также указать специальный порт для TFTP-соединения: 
<PRE
CLASS="PROGRAMLISTING"
>        "198.76.54.32@89:getpasswd/smith"</PRE
>

В один момент времени может быть открыт только один удаленный файл. Если
BootPROM недоступен, доступ к удаленным файлам производится, при помощи
операционной системы, но существуют ограничения, накладываемые ОС.</P
><P
>В MrZip косвенный доступ работает с файлами ОС в соответствии с ее
правилами обращения к файлам. Не существует никаких ограничений - косвенный
доступ можно использовать везде, где можно использовать прямой. Косвенный
доступ обычно работает быстрее прямого, потому что в ОС есть большее
количество буферов и кэш. При помощи косвенного доступа, можно работать с
удаленными файлами, если это поддерживается ОС.

<PRE
CLASS="PROGRAMLISTING"
>        "C:\\autoexec.bat"
        "C:/config.sys"
        "/mnt/net/usr"</PRE
></P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1135"
>6.1.3. Кэш-раздел</A
></H3
><P
>С целью уменьшить нагрузку на сеть и ускорить процесс загрузки, образы
дисков, ядра Linux и, возможно, другие файлы кэшируются на жестком диске.
Кэш-раздел находится в конце диска между последним цилиндром, занятым
стандартными разделами, и последним цилиндром диска (то есть за пределами
стандартных разделов). Для того, чтобы это кэширование работало, между
последним разделом и концом диска ДОЛЖНО быть пустое пространство.
Кэш-раздел ДОЛЖЕН существовать, если вы хотите восстановить образ диска.</P
><P
>Кэш-раздел представляет из себя надежную файловую систему с контролем CRC:
Каждый каталог и каждый 32-килобайтный блок данных имеет свою 32-битную
CRC-контрольную сумму. Если содержимое каталога или блока данных испорчено,
то файл автоматически удаляется из кэша, и при обращении к нему, снова
загружается с сервера.&#13;</P
><P
>Вы имеете возможность работать с файлами кэш-раздела из BpBatch, MrBatch и
MrZip, используя прямой доступ к специальному разделу <TT
CLASS="LITERAL"
>"{:-1}"</TT
>. Чтобы
увидеть содержимое кэш-раздела, наберите:
<PRE
CLASS="PROGRAMLISTING"
>        logdir "{:-1}"</PRE
>
Если данные в кэше испорчены, и автоматически не очищаются (этого не должно происходить), вы можете либо дать в интерактивном режиме команду: 
<PRE
CLASS="PROGRAMLISTING"
>        clean -1</PRE
>
, либо удерживать обе клавиши Shift при загрузке BpBatch</P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1143"
>6.1.4. Специальные переменные</A
></H3
><P
>Некоторые переменные бывают установлены при запуске интерпретатора и/или имеют специальное назначение. Некоторые из них существуют во всех программах, другие есть только в MrZip. Часть из них появляются только после получения ответа на BOOTP/DHCP-запрос. 
&#13;</P
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Общие переменные</DT
><DD
><P
>&#13;<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>$Program</TT
> имеет значение "BpBatch" в BpBatch, "MrBatch" в MrBatch и "MrZip" в MrZip </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$Basename</TT
> базовое имя скрипта, автоматически запущенного в интерпретаторе </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$HelpFile</TT
> имя файла, выводимого по команде <TT
CLASS="LITERAL"
>Help</TT
>. По умолчанию оно равно <TT
CLASS="LITERAL"
>"${Basename}.hlp"</TT
> </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$BOOTP-...</TT
> - переменные, установленные в соответствии с ответом на BOOTP-запрос (см. ниже подробное описание этих переменных) </P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>$DHCP-...</TT
>  - переменные, установленные в соответствии с ответом на DHCP-запрос (см. ниже подробное описание этих переменных) &#13;</P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>$Disks</TT
> содержит список размеров
дисков, разделенных пробелами. Соответственно, <TT
CLASS="LITERAL"
>#"$Disks"</TT
> - это количество
дисков, а <TT
CLASS="LITERAL"
>"$Disks"{0}</TT
> - размер первого диска</P
></LI
><LI
><P
>&#13;<TT
CLASS="LITERAL"
>$Keypressed</TT
> равен первому не запрошенному коду клавиши из буфера клавиатуры (если таковой имеется) &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$LBA</TT
> контролирует использование режима LBA для доступа к дискам размером более 2 Гб. Значение по умолчанию: "ON" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$FDA</TT
> контролирует быстрый доступ к диску (черезцилиндровая запись). Значение по умолчанию: "ON" </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$VESA</TT
>  контролирует использование VESA-графики. Значение по умолчанию: "ON", если существует поддержка VESA &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$VESA-Modes</TT
> содержит в себе список всех доступных VESA-видеорежимов. Первый из этого списка - это видеорежим, используемый по умолчанию (если режим не указан в команде InitGraph). Замечание: если VESA="OFF", то эта переменная будет пуста &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$APM</TT
> установлено в "ON", если ваш компьютер поддерживает Расширенное Управление Питанием (Advanced Power Management). Если $APM установлено в "ON", вы можете использовать команду PowerOff для отключения компьютера. Значение по умолчанию зависит от вашего компьютера &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$Trace</TT
> контролирует вывод на экран каждой команды перед ее исполнением. Она также контролирует вывод имен файлов при создании нового архива. Значение по умолчанию: "OFF" </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$AutoShowLog</TT
> контролирует автоматическое переключение на экран журнала при нажатии клавиши ESC. Значение по умолчанию: "ON" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$PauseLog</TT
> контролирует задержку вывода журнала, если экран журнала полностью заполнен. Значение по умолчанию: "ON" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$CacheDisk</TT
> номер диска, используемого для кэширования удаленных файлов. Значение по умолчанию: пусто == 0, первый жесткий диск &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$CacheAlways</TT
> контролирует автоматическое кэширование удаленных файлов, скопированных, модифицированных или нарисованных в формате GIF. Значение по умолчанию: "OFF" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$CacheNever</TT
> полностью отключает кэширование файлов. Включите эту переменную для удаленной загрузки Linux на бездисковой машине. Значение по умолчанию: "OFF" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$CacheReserve</TT
> контролирует безусловное выделение на кэш-разделе дополнительных к размеру файла 25 процентов места для того, чтобы файлы могли менять размер. Отключите эту переменную, если у вас мало места на диске. Значение по умолчанию: "ON" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$ExtMemory</TT
> разрешает использование расширенной памяти (или XMS). Один раз запретив использование этой памяти, разрешить обратно его нельзя. Значение по умолчанию: "ON", если в компьютере имеется расширенная память. &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$IsoLatin</TT
> контролирует обработку ASCII-кодов от 128 до 255, включенных в скрипты и модифицируемые файлы. Установки IsoLatin обрабатываются при загрузке файла, а не при его обработке. Значение по умолчанию: "ON" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$ProgressX</TT
> и <TT
CLASS="LITERAL"
>$ProgressY</TT
> задают координаты графического окна, отражающего процесс загрузки и декомпрессирования образа диска. Значение по умолчанию: 200 200 </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$EXT2-Backup</TT
> контролирует обновление резервных копий суперблоков в файловой системе ext2 в Linux. Копии суперблоков создаются несколько секунд и не используются текущими версиями ядер (их использует только e2fsck). &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$Security-Gateway</TT
> содержит имя шлюза,
используемого для авторизации пользователей. На указанном в этой переменной
компьютере должна работать наша специальная программа-шлюз. Значение по
умолчанию: <TT
CLASS="LITERAL"
>"${BOOTP-Server-IP}@89"</TT
> (т.е. порт 89 TFTP-сервера)&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$Security-Check</TT
> содержит ответ сервера безопасности на последнюю проведенную авторизацию, соответственно PASSED или FAILED. Значение по умолчанию: "FAILED" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$Security-Passwd, $HelpTopic, $OnExit, $OnKey-...</TT
>  
внутренние переменные. </P
></LI
></UL
>&#13;</P
><P
>Смотрите также список специальных переменных BOOTP и MrZip. 
&#13;</P
></DD
><DT
>Специальные переменные MrZip</DT
><DD
><P
>Следующие переменные используются только в MrZip. 
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>$TempPath</TT
> содержит каталог, в котором
содержатся временные файлы. Значение по умолчанию: &lt;пустая строка&gt; ==
текущий каталог</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$DumpFormat</TT
> содержит формат вывода в журнал данных о создаваемых архивах. Это строка, содержащая 

<P
></P
><UL
><LI
><P
>"h"/"H" - вывод заголовка архива </P
></LI
><LI
><P
>"b"/"B" - вывод итогов/содержимого загрузочных секторов &#13;</P
></LI
><LI
><P
>"s"/"S" - вывод краткой/подробной информации о занятом месте </P
></LI
><LI
><P
>"d"/"D" - вывод краткого/подробного содержимого каталогов &#13;</P
></LI
><LI
><P
>"f"/"F" - вывод итогов/содержимого файлов </P
></LI
></UL
>

Значение по умолчанию: "hbD" </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$FragmentSize</TT
> задает размер частей архива. Если вы не используете улучшенную версию TFTP-сервера фирмы InCom, установите ее в "30 MB". Значение по умолчанию: "87 MB" &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>$SourceArchive, $DestArchive, $Filter...</TT
> внутренние переменные. </P
></LI
></UL
>&#13;</P
></DD
><DT
>Переменные BOOTP</DT
><DD
><P
>Системой распознаются следующие переменные BOOTP-... и DHCP-... ,
заполняемые после получения соответствующего ответа на BOOTP/DHCP запрос
(TCP/IP BootPROM должна существовать и работать):
<PRE
CLASS="PROGRAMLISTING"
>	$BOOTP-Client-ID
	$BOOTP-Your-IP
	$BOOTP-Server-IP
	$BOOTP-Gateway-IP
	$BOOTP-Bootfile
	$BOOTP-Server-Name
        $BOOTP-Subnet-Mask
        $BOOTP-Time-Offset
        $BOOTP-Routers
        $BOOTP-Time-Servers
        $BOOTP-Name-Servers
        $BOOTP-Domain-name-Servers
        $BOOTP-BOOTP-Log-Servers
        $BOOTP-Cookie-Servers
        $BOOTP-Lpr-Servers
        $BOOTP-Impress-Servers
        $BOOTP-Resource-Location-Servers
        $BOOTP-Host-Name
        $BOOTP-Boot-Size
        $BOOTP-Merit-Dump
        $BOOTP-Domain-Name
        $BOOTP-Swap-Servers
        $BOOTP-Root-Path
        $BOOTP-Extensions-Path
        $BOOTP-IP-Forwarding
        $BOOTP-Interface-MTU
        $BOOTP-All-Subnets-Are-Local
        $BOOTP-Broadcast-Address
        $BOOTP-NIS-Domain
        $BOOTP-NIS-Servers
        $BOOTP-NTP-Servers
        $BOOTP-Font-Servers
        $BOOTP-X-Display-Manager
        $DHCP-IP-Address-Lease-Time
        $DHCP-Message-Type
        $DHCP-Server-Identifier
        $DHCP-Message
        $DHCP-Renewal-Time
        $DHCP-Rebinding-Time
        $BOOTP-NIS+-Domain
        $BOOTP-NIS+-Servers
        $BOOTP-Server-Name
        $BOOTP-Bootfile
        $BOOTP-Mobile-IP-Agent
        $BOOTP-SMTP-Servers
        $BOOTP-POP3-Servers
        $BOOTP-NNTP-Servers
        $BOOTP-WWW-Servers
        $BOOTP-Finger-Servers
        $BOOTP-IRC-Servers
        $BOOTP-StreetTalk-Servers
        $BOOTP-STDA-Servers</PRE
></P
><P
>Другие параметры BOOTP/DHCP можно использовать следующим образом:
<PRE
CLASS="PROGRAMLISTING"
>        $BOOTP-Option-n</PRE
>
где n - это десятичный номер опции BOOTP.</P
><P
>Не путайте значения переменной <TT
CLASS="LITERAL"
>BOOTP-Gateway-IP</TT
>, содержащей адрес
TFTP-шлюза, которая должна быть установлена в 0.0.0.0, если TFTP-сервер
находится в той же подсети, что и клиентская машина, и переменной
<TT
CLASS="LITERAL"
>BOOTP-Routers</TT
>, содержащей адрес IP-шлюза, используемого по умолчанию.
TCP/IP BootPROM иногда, по-видимому, устанавливает значение
<TT
CLASS="LITERAL"
>BOOTP-Gateway-IP</TT
>, копируя его из <TT
CLASS="LITERAL"
>BOOTP-Routers</TT
>, в результате чего каждый
пакет подтверждения TFTP сначала посылается на IP-шлюз. Чтобы этого не
происходило, когда ваш TFTP-сервер находится в той же подсети, что
и клиент - отдельно устанавливайте <TT
CLASS="LITERAL"
>BOOTP-Gateway-IP</TT
> в <TT
CLASS="LITERAL"
>0.0.0.0</TT
> (спасибо
Maciek Uhlig за то, что он описал нам эту проблему).&#13;</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1280"
>6.1.5. Команды контроля состояния</A
></H3
><P
>В этом разделе описываются команды, служащие для контроля состояния
системы. В круглых скобках приведены необязательные аргументы этих команд
(Я сам предпочитаю квадратные, но их не очень любит LaTeX...)
<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Interact</DT
><DD
><P
>Активировать экран журнала и включить интерактивный режим до выполнения команд QUIT или EXIT. Выполните команду HideLog перед выходом из этого режима, чтобы отключить вывод на экран сообщений о ходе выполнения пакетного файла. </P
></DD
><DT
>Help (тема)</DT
><DD
><P
>Загрузить файл контекстной помощи (<TT
CLASS="FILENAME"
>bpbatch.hlp</TT
>) и вывести на экран справку
по данной теме. Если тема не задана, или такой темы нет в файле, то
выводится оглавление.</P
></DD
><DT
>Log "текст"</DT
><DD
><P
>Вывести строку в журнал. Перевод строки/возврат каретки автоматически НЕ добавляются.</P
></DD
><DT
>Echo "текст"</DT
><DD
><P
>Вывести строку в журнал и перевести курсор на следующую строку. Эквивалентно 
        Log "текст\r\n".&#13;</P
></DD
><DT
>LogVars ("шаблон")</DT
><DD
><P
>Вывести в журнал содержимое всех переменных, имя которых соответствует шаблону. Шаблон может содержать символы ? и *. 
Пример: LogVars "BOOTP-*"              вывести все переменные BootP
&#13;</P
></DD
><DT
>LogDir "путь/шаблон"</DT
><DD
><P
>Вывести в журнал наименования всех файлов, находящихся в каталоге "путь", соответствующих шаблону. Шаблон может содержать символы ? и *. 
Пример: LogDir "/usr/g*p"              вывести список всех файлов с именами вида g...p
&#13;</P
></DD
><DT
>LogTree "путь"</DT
><DD
><P
>Вывести в журнал дерево каталогов, начиная с заданного пути.</P
></DD
><DT
>LogFile "имя_файла"</DT
><DD
><P
>Вывести в журнал содержимое файла. Размер файла не должен превышать 64 Кб.</P
></DD
><DT
>ShowLog</DT
><DD
><P
>Активизировать экран журнала, если он был скрыт. Автоматически выполняется
при нажатии клавиши ESC, если переменная "$AutoShowLog" == "ON", а также
при переходе в интерактивный режим.</P
></DD
><DT
>HideLog</DT
><DD
><P
>Дезактивировать экран журнала. Стандартное состояние интерпретатора, если при запуске BpBatch, MrBatch и MrZip задан пакетный файл.</P
></DD
><DT
>CaptureLog</DT
><DD
><P
>Копировать все, что выводится в журнал, в 64-килобайтный буфер до тех пор, пока не будет выполнена команда EndCapture. Если содержимое журнала превышает 64 Кб, то его начало отсекается. Эту команду можно использовать для создания текстового файла с необходимым содержимым. Команда EndCapture ДОЛЖНА выполняться в том же пакетном файле.
&#13;</P
></DD
><DT
>EndCapture ("имя_файла")</DT
><DD
><P
>Прекратить копирование содержимого журнала в буфер. Если задано имя файла, то содержимое буфера записывается в файл, иначе буфер очищается.</P
></DD
><DT
>Beep</DT
><DD
><P
>Звуковой сигнал. Эта команда эквивалентна Echo "\007". </P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1337"
>6.1.6. Команды управления</A
></H3
><P
>В этом разделе описываются команды, служащие для управления порядком исполнения команд в пакетных файлах. В круглых скобках приведены необязательные аргументы этих команд. 
<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Include "имя_файла"</DT
><DD
><P
>Загружает файл и выполняет указанные в нем команды. Возвращается к исходному пакетному файлу после выполнения этих команд. Обработка символов с ASCII-кодами 128-255 в этом файле зависит от значения переменной $IsoLatin на момент его запуска. </P
></DD
><DT
>OnExit <I
CLASS="EMPHASIS"
>команда</I
></DT
><DD
><P
>Установить команду, автоматически выполняемую при завершении выполнения текущего пакетного файла.</P
></DD
><DT
>Goto <I
CLASS="EMPHASIS"
>метка</I
></DT
><DD
><P
>Перейти к метке (т.е. к строке, начинающейся с :<I
CLASS="EMPHASIS"
>метка</I
>)</P
></DD
><DT
>Eval "команда"</DT
><DD
><P
>Выполнить все операции подстановки в строке "команда", и затем выполнить полученную команду.</P
></DD
><DT
>If ...</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  If (not) &#60;выражение1&#62; (==|!=|&#60;|&#62;|&#62;=|&#60;=|=&#62;|=&#60;|&#60;&#62;) &#60;выражение2&#62; &#60;команда&#62;
  If (not) (ci) "строка1" (==|!=|&#60;|&#62;|&#62;=|&#60;=|=&#62;|=&#60;|&#60;&#62;) "строка2" &#60;команда&#62;
  If (not) (ci) "строка" Match-Expr "шаблон" &#60;команда&#62;
  If (not) (ci) "строка" Match-Passwd "unix пароль" &#60;команда&#62;
  If (not) (ci) "строка" in "список_слов" &#60;команда&#62;
  If (not) (ci) "строка" in-file "файл" &#60;команда&#62;
  If (not) exist "файл" &#60;команда&#62;
  If (not) valid &#60;номер_диска&#62;:&#60;номер раздела&#62; &#60;команда&#62;</PRE
></P
><P
>Этот оператор исполняет <I
CLASS="EMPHASIS"
>команду</I
> при положительном результате проверки
условия. В первом случае сравниваются два числовых выражения. Во втором
сравниваются две строки (с учетом регистра или без него). В третьем
проверяется, соответствует ли строка шаблону (в шаблоне можно применять
символы * и ?). Четвертый вариант служит для проверки соответствия строки
паролю, зашифрованному по правилам Unix. Пятый проверяет, находится ли
строка в списке слов. В шестом варианте проверяется, есть ли строка в
файле. Седьмой вариант предназначен для проверки существования файла.
Восьмой проверяет структуру раздела (форматирован ли он). Последняя форма
поддерживается в версиях BpBatch, выпущенных после февраля 1999 года.</P
></DD
><DT
>Set ...</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  Set переменная = "строковое-выражение"
  Set переменная = &lt;выражение&gt;</PRE
></P
><P
>Задает значение переменной. Если значение является числовым выражением, то
результат преобразовывается в строку. Переменная может использоваться, где
угодно, в программе при помощи конструкции $переменная или ${переменная}.
Если в переменной содержится строковое значение, то ссылку на нее надо
заключать в двойные кавычки: "$переменная" или "${переменная}".</P
></DD
><DT
>Delay <I
CLASS="EMPHASIS"
>промежуток_времени</I
></DT
><DD
><P
>Задержка исполнения программы на некоторый промежуток времени (заданный в секундах). Смотрите также описание формата промежутков времени.</P
></DD
><DT
>GetTime <I
CLASS="EMPHASIS"
>переменная</I
>, GetDate <I
CLASS="EMPHASIS"
>переменная</I
></DT
><DD
><P
>Получить системное время из CMOS и поместить его в  <I
CLASS="EMPHASIS"
>переменную</I
> в формате
ЧЧ:ММ:СС. Получить системную дату из CMOS и поместить его в <I
CLASS="EMPHASIS"
>переменную</I
> в
формате ГГ/ММ/ДД. Эти команды можно использовать для изменения действий
вашей программы в зависимости от даты или времени.</P
></DD
><DT
>SetTime "ЧЧ:ММ:СС", SetDate "ГГ/ММ/ДД"</DT
><DD
><P
>Установить системную дату или время в CMOS. Если есть шлюз безопасности
(наша версия TFTP-сервера), то можно автоматически устанавливать
системную дату и время на клиентских машинах аналогично дате и времени на
сервере следующей командой:

<PRE
CLASS="PROGRAMLISTING"
>        include "$Security-Gateway:gettime"</PRE
>

Если хотите узнать, что же делает эта команда, наберите: 
<PRE
CLASS="PROGRAMLISTING"
>        logfile "$Security-Gateway:gettime"</PRE
>

&#13;</P
></DD
><DT
>Poweroff</DT
><DD
><P
>Выключить компьютер. Эта команда работает только в том случае, если в вашем
компьютере есть поддержка Расширенного Управления Питанием (Advanced Power
Management (APM)).&#13;</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1396"
>6.1.7. Команды работы с клавиатурой</A
></H3
><P
>В этом разделе описываются команды работы с клавиатурой. В круглых скобках
приведены необязательные аргументы этих команд. Смотрите также главу
<I
CLASS="EMPHASIS"
>Поддержка различных языков</I
>.

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>GetKey (<I
CLASS="EMPHASIS"
>переменная</I
>)</DT
><DD
><P
>&#13;Ждать нажатия любой клавиши и затем поместить ее значение в <I
CLASS="EMPHASIS"
>переменную. </I
></P
></DD
><DT
>WaitForKey <I
CLASS="EMPHASIS"
>промежуток_времени</I
> (<I
CLASS="EMPHASIS"
>команда</I
>)</DT
><DD
><P
>Ожидать нажатия клавиши в течение <I
CLASS="EMPHASIS"
>промежутка_времени</I
>. Если клавиша не была
нажата, выполнить <I
CLASS="EMPHASIS"
>команду</I
>. Иначе оставить код клавиши в буфере клавиатуры.
Смотрите также главу с описанием формата задания промежутков времени.</P
></DD
><DT
>Input (<I
CLASS="EMPHASIS"
>переменная</I
> (<I
CLASS="EMPHASIS"
>максимальная_длина</I
>))</DT
><DD
><P
>Ввести с клавиатуры строку, оканчивающуюся символом "возврат каретки", и
поместить результат в <I
CLASS="EMPHASIS"
>переменную</I
> (без символа "ВК").
Если задано значение <I
CLASS="EMPHASIS"
>максимальной_длины</I
>, то строка ограничивается при вводе
этим количеством символов.</P
><P
>Смотрите также описание команды <TT
CLASS="LITERAL"
>GetPasswd</TT
> в разделе <I
CLASS="EMPHASIS"
>Команды системы безопасности</I
>.</P
></DD
><DT
>OnKey "к" <I
CLASS="EMPHASIS"
>команда</I
></DT
><DD
><P
>Включить перехватчик нажатия клавиши, автоматически выполняющий <I
CLASS="EMPHASIS"
>команду</I
> при
нажатии клавиши "к" (Кроме тех, которые нажимаются при исполнении команд
GetChar или Input). Если вместо одного символа используется строка
<TT
CLASS="LITERAL"
>"default"</TT
>, то команда выполняется при нажатии любой клавиши.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1433"
>6.1.8. Команды вывода текста</A
></H3
><P
>В этом разделе описываются команды вывода текста на экран. Все эти команды
работают и в графическом режиме (за исключением того, что в текстовом
режиме размер экрана - 80х25 символов, а в графике - 100х37 (в графическом
режиме используются символы размером 8х16 точек). В круглых скобках
приведены необязательные аргументы этих команд. Смотрите также главу
<I
CLASS="EMPHASIS"
>Поддержка различных языков</I
>.

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Print <I
CLASS="EMPHASIS"
>"текст"/выражение</I
></DT
><DD
><P
>Вывести на экран текст/выражение в текущую позицию курсора и передвинуть
курсор. Добавьте "\r\n" в конце строки для перехода к следующей строке на
экране.&#13;</P
></DD
><DT
>TextAttr <I
CLASS="EMPHASIS"
>цвет_текста</I
> <I
CLASS="EMPHASIS"
>цвет_фона</I
></DT
><DD
><P
>Задать цвет текста и фона. Можно также вместо цветов использовать числовое
выражение, определяющее оба цвета, рассчитываемое как
16*<I
CLASS="EMPHASIS"
>цвет_фона</I
>+<I
CLASS="EMPHASIS"
>цвет_текста</I
>.</P
><P
>Если вы хотите немного пофантазировать, используйте <TT
CLASS="LITERAL"
>LoadFont</TT
>. Смотрите
также главу <I
CLASS="EMPHASIS"
>Поддержка различных языков</I
>.</P
></DD
><DT
>At <I
CLASS="EMPHASIS"
>строка колонка</I
> (<I
CLASS="EMPHASIS"
>команда</I
>)</DT
><DD
><P
>Переместить курсор на заданную позицию на экране и выполнить команду, если она задана. 
Пример: At 10,20 Print "Привет!"
&#13;</P
></DD
><DT
>Clear (<I
CLASS="EMPHASIS"
>цвет</I
> (<I
CLASS="EMPHASIS"
>символ</I
> (<I
CLASS="EMPHASIS"
>верхняя_строка</I
>,<I
CLASS="EMPHASIS"
>левая_колонка</I
>,<I
CLASS="EMPHASIS"
>нижняя_строка</I
>,<I
CLASS="EMPHASIS"
>правая_колонка</I
>)))</DT
><DD
><P
>Заполнить заданную текстовую область <I
CLASS="EMPHASIS"
>символом</I
> (заданным в виде строки или
числового выражения - кода символа). По умолчанию заполняется весь экран,
используется символ "полный блок" (ASCII код 219), а цвет - черный (очистка
экрана). Курсор перемещается в верхний левый угол очищенной области.</P
></DD
><DT
>Команды, обеспечивающие совместимость с BpMenu</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  .ATT (&lt;атрибут&gt;)
  .CLS (&lt;атрибут&gt;)
  .DEF &lt;клавиша&gt; (&lt;время_ожидания&gt;)
  .KEY &lt;клавиша&gt; &lt;имя_файла&gt;
  .POS ((&lt;x&gt;) &lt;y&gt;)
  .PWD &lt;клавиша&gt; &lt;пароль&gt;
  .WLN (&lt;текст&gt;)
  .WRT &lt;текст&gt;</PRE
></P
><P
>Более подробная информация приведена в документации фирмы InCom. Когда-то
мы написали <A
HREF="http://www.linux.org.ru/books/HOWTO/soft/menuedit.zip"
TARGET="_top"
>программу</A
>, которая позволяла редактировать меню с
использованием этого синтаксиса, но будет лучше, если вы будете
использовать новый формат. Заметьте также, что команда .PWD не работает -
мы просто не знаем алгоритм шифрования паролей фирмы InCom GmbH.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1478"
>6.1.9. Команды вывода графики</A
></H3
><P
>В этом разделе описываются команды работы с графикой. Координаты в этих
командах задаются в точках. В графическом режиме вы можете
использовать команды вывода текста (см. выше). В круглых скобках приведены
необязательные аргументы.&#13;</P
><P
>Заметьте, что графический режим автоматически включается при выполнении
одной из этих команд (если только переменная <TT
CLASS="LITERAL"
>VESA</TT
> не установлена <TT
CLASS="LITERAL"
>"OFF"</TT
>).
<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>InitGraph ("режим")</DT
><DD
><P
>Включить графический видеорежим VESA. Начало координат находится в верхнем
левом углу экрана (0 0). Включение VESA графики может привести к повисанию
некоторых компьютеров в Windows 95. Используйте ключ -v MrBatch для того,
чтобы избежать подобных проблем.</P
><P
>Вы можете указать специфический видеорежим, используя параметр "режим". Его использование необязательно - по умолчанию включается первый видеорежим из списка, находящегося в переменной VESA-Modes. 
&#13;</P
><P
>Возможные режимы: 

<P
></P
><UL
><LI
><P
>640x480    =&#62;  640 на 480 точек, 256 цветов &#13;</P
></LI
><LI
><P
>800x600    =&#62;  800 на 600 точек, 256 цветов (стандартный режим) </P
></LI
><LI
><P
>1024x768   =&#62;  1024 на 768 точек, 256 цветов </P
></LI
><LI
><P
>1280x1024  =&#62;  1280x1024 =&#62; 1280 на 1024 точек, 256 цветов </P
></LI
></UL
>&#13;</P
><P
>В переменной VESA-Modes находится список видеорежимов, поддерживаемых вашей видеокартой. </P
><P
>Пример: <TT
CLASS="LITERAL"
>InitGraph "640x480"</TT
></P
></DD
><DT
>CloseGraph</DT
><DD
><P
>Выключить графический видеорежим и перейти в текстовый.</P
></DD
><DT
>DrawBar <I
CLASS="EMPHASIS"
>x</I
> <I
CLASS="EMPHASIS"
>y</I
> <I
CLASS="EMPHASIS"
>ширина</I
> <I
CLASS="EMPHASIS"
>высота</I
> <I
CLASS="EMPHASIS"
>цвет</I
></DT
><DD
><P
>VESA-графика. Нарисовать залитый прямоугольник данного размера и цвета.</P
></DD
><DT
>DrawWindow <I
CLASS="EMPHASIS"
>x</I
> <I
CLASS="EMPHASIS"
>y</I
> <I
CLASS="EMPHASIS"
>ширина</I
> <I
CLASS="EMPHASIS"
>высота</I
> (<I
CLASS="EMPHASIS"
>цвет_фона</I
> (<I
CLASS="EMPHASIS"
>цвет_фона_заголовка</I
>)) ("заголовок" (<I
CLASS="EMPHASIS"
>цвет_заголовка</I
>))</DT
><DD
><P
>VESA-графика. Нарисовать окно данного размера и цвета. Цвет фона по умолчанию - светлосерый, цвет фона заголовка - синий.</P
></DD
><DT
>Drawtext <I
CLASS="EMPHASIS"
>x</I
> <I
CLASS="EMPHASIS"
>y</I
> "текст" (<I
CLASS="EMPHASIS"
>цвет</I
>)</DT
><DD
><P
>VESA-графика. Вывести строку в указанных координатах с прозрачным цветом фона. Цвет по умолчанию равен текущему цвету текста.</P
></DD
><DT
>DrawGif "gif-файл" (<I
CLASS="EMPHASIS"
>x</I
> <I
CLASS="EMPHASIS"
>y</I
> (<I
CLASS="EMPHASIS"
>тип_цветов</I
>))</DT
><DD
><P
>VESA-графика. Загрузить заданный файл формата GIF-87a и вывести его на
экран. Файл может быть черезстрочным, но обязательно в формате GIF-87a (не
GIF-89a). Изображение должно помещаться в экран, т.е. нельзя загрузить
картинку размером в 1024x768 в режиме 640x480. По умолчанию картинка
выводится в верхнем левом углу экрана (0 0).</P
><P
><I
CLASS="EMPHASIS"
>Тип_цветов</I
> задает тип обработки цветов в палитре при необходимости использовать более 256 цветов (это необходимо, например, при одновременном выводе двух GIF-файлов по 256 цветов в каждом): 
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>Best-Colors</TT
>  - использовать лучшие для последнего GIF цвета &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>Spare-Colors</TT
> - попытаться избежать пересечения цветов, изменяя существующие &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>Share-Colors</TT
> - попытаться избежать пересечения цветов, используя существующие &#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>Reuse-Colors</TT
> не выделять новых цветов, использовать только существующие &#13;</P
></LI
></UL
>

По умолчанию тип устанавливается в <TT
CLASS="LITERAL"
>Best-Colors</TT
>.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1557"
>6.1.10. Команды системы безопасности</A
></H3
><P
>В этом разделе описываются команды авторизации пользователей. В круглых скобках приведены необязательные аргументы. 
&#13;</P
><P
>Некоторые из этих команд используют <I
CLASS="EMPHASIS"
>Шлюз безопасности</I
>, который должен быть
установлен. Смотрите раздел <I
CLASS="EMPHASIS"
>Специальные TFTP-сервера</I
>.
<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>GetPasswd (<I
CLASS="EMPHASIS"
>переменная </I
> (<I
CLASS="EMPHASIS"
>максимальная_длина</I
>))</DT
><DD
><P
>То же самое, что и Input, только вместо набранных символов выводятся звездочки. </P
></DD
><DT
>Crypt "текст" "ключ" <I
CLASS="EMPHASIS"
>переменная</I
></DT
><DD
><P
>Выполнить Unix-процедуру шифрования пароля из заданного 8-символьного
текста и поместить результат в <I
CLASS="EMPHASIS"
>переменную</I
>. "ключ" - это обычно два символа,
равные первым двум символам зашифрованной строки.</P
><P
>Заметьте, что это необращаемая процедура. Расшифровать такую строку невозможно. Можно лишь взять другую строку и зашифровать ее, используя этот же ключ, а затем сравнить результат шифрования. 
&#13;</P
></DD
><DT
>DESCrypt "текст" "ключ" <I
CLASS="EMPHASIS"
>переменная</I
></DT
><DD
><P
>Зашифровать данный текст при помощи заданного 8-символьного ключа, и
сохранить полученную шестнадцатеричную строку в
<I
CLASS="EMPHASIS"
>переменной</I
>.</P
></DD
><DT
>DESDecrypt "шестнадцатеричная_строка" "ключ" <I
CLASS="EMPHASIS"
>переменная</I
></DT
><DD
><P
>Расшифровать шестнадцатеричную строку при помощи заданного 8-символьного
ключа, и сохранить результат в <I
CLASS="EMPHASIS"
>переменной</I
>.</P
></DD
><DT
>MD5 "текст" <I
CLASS="EMPHASIS"
>переменная</I
></DT
><DD
><P
>Рассчитать контрольную сумму текста по стандарту MD5 и поместить результат
в <I
CLASS="EMPHASIS"
>переменную</I
>. Может быть использован в качестве альтернативы
Unix-шифрованию для проверки паролей длиной более 8 символов.</P
></DD
><DT
>CheckUser "пользователь" "пароль" "домен"</DT
><DD
><P
>Связаться с Security-Gateway и проверить, существует ли в заданном домене
этот пользователь, и использует ли он этот пароль. Если домен - <TT
CLASS="LITERAL"
>"Unix"</TT
>, то
используется система определения пользователей Unix на самом шлюзе
безопасности. При любом другом значении домена, использовать систему доменов
шлюза безопасности для определения настоящего Radius- или NT-домена для
проведения проверки.</P
><P
>Устанавливает переменную $Security-Check в "PASSED" или "FAILED". Пароль не передается по сети в явном виде. &#13;</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1601"
>6.1.11. Команды работы с диском</A
></H3
><P
>В этом разделе описываются команды работы с дисками. В круглых скобках приведены необязательные аргументы. 


<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>GetPartitions <I
CLASS="EMPHASIS"
>переменная</I
> (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Прочитать таблицу разделов данного диска и сохранить результат в
<I
CLASS="EMPHASIS"
>переменной</I
>. Результат представляет из себя разделенный пробелами список
конструкций вида <I
CLASS="EMPHASIS"
>Тип:Размер</I
>, где
<P
></P
><UL
><LI
><P
><I
CLASS="EMPHASIS"
>Тип</I
> - это FAT16, EXT, BIGDOS, NTFS, FAT32, FAT32-LBA, BIGDOS-LBA, EXT-LBA, LINUX-SWAP, LINUX-EXT2 или десятичный номер типа файловой системы для остальных видов. &#13;</P
></LI
><LI
><P
><I
CLASS="EMPHASIS"
>Размер</I
> - размер раздела в мегабайтах. </P
></LI
></UL
>

См. также команду SetPartitions. </P
></DD
><DT
>SetPartitions "разделы" (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Заполнить таблицу разделов в соответствии со строкой, заданной в том же
формате, что и в команде GetPartitions. Эта команда также очищает все флаги
"активный раздел" (используйте команду SetBootPart).</P
><P
>В главной таблице разделов в Главной Загрузочной Записи (master boot record
(MBR)) есть возможность описать лишь четыре раздела. Более того, DOS и
Windows позволяют иметь только ОДИН FAT-раздел (он называется первичным
разделом, диск C:) в главной таблице разделов. Все дополнительные
FAT-разделы должны находиться в расширенном разделе (такие разделы
называются Логическими). Если мы выделим номера 1-4 разделам, описанным в
таблице разделов в MBR, и номера 5-8 разделам, описанным в первом
расширенном разделе, то описание двух FAT-разделов будет следующим: раздел
1 имеет тип FAT, раздел 2 имеет тип "расширенный раздел", раздел 5 - FAT.
Разделы 3,4,6,7 и 8 должны быть помечены как "неиспользуемые". Подобная
схема может быть использована для задания еще одного FAT-раздела:
дополнительный расширенный раздел может находиться внутри 2-го раздела, а
внутри его может находиться логический раздел FAT под номером 9.&#13;</P
><P
>Если точно следовать спецификациям DOS - 3-ий и 4-ый раздел в таблицах
разделов никогда не используются. На самом деле, некоторые версии DOS и
другие системы могут использовать более 2-х разделов в каждой таблице
разделов, но конкретных правил не существует. С этой точки зрения BpBatch
значительно более гибок, в своем понимании таблиц разделов - он часто
понимает вещи, непонятные некоторым ОС.
&#13;</P
><P
>Одно универсальное правило никогда не должно нарушаться - в одной таблице разделов не может быть больше одного расширенного раздела, иначе система нумерации разделов полностью рушится. 
&#13;</P
><P
>Если вы хотите поэкспериментировать - пожалуйста, но только потом не жалуйтесь, что ваша операционная система не может распознать разделы. Единственный гарантированно правильный путь использования разделов - иметь один первичный раздел, а все остальные поместить по одному в расширенные разделы. 
&#13;</P
><P
>Пример работы с расширенным разделом: 

        SetPartitions "BIGDOS:100 EXT:400 EMPTY EMPTY BIGDOS:400"
&#13;</P
></DD
><DT
>GetBootPart <I
CLASS="EMPHASIS"
>переменная</I
> (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Получить номер активного (загружаемого) раздела, и поместить его в
<I
CLASS="EMPHASIS"
>переменную</I
>. Первый раздел имеет номер 1. Если активных разделов нет, то
возвращается 0.</P
></DD
><DT
>SetBootPart <I
CLASS="EMPHASIS"
>раздел</I
> (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Сделать данный раздел активным. С этого раздела MBR начинает загрузку
система. Первый раздел имеет номер 1.</P
></DD
><DT
>Blank <I
CLASS="EMPHASIS"
>раздел</I
> (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Заполнить заданные разделы нулями. Это может занять достаточно долгое время
на больших разделах. Эта команда не форматирует раздел для какой-либо
определенной ОС. См. также команду <TT
CLASS="LITERAL"
>Clean</TT
>.</P
></DD
><DT
>Clean <I
CLASS="EMPHASIS"
>разделы</I
> (<I
CLASS="EMPHASIS"
>диск</I
>) ("метка")</DT
><DD
><P
>Произвести быстрое форматирование разделов, в соответствии с типом раздела,
заданным в таблице разделов. Также устанавливается метка раздела, если она
поддерживается ОС и задана в команде. Для  "полного" форматирования сначала
используйте команду <TT
CLASS="LITERAL"
>Blank</TT
>.</P
><P
>Команда Clean поддерживается для разделов (FAT16) BIGDOS, FAT32, EXT,
LINUX-EXT2 и LINUX-SWAP. Для очистки MBR используйте <TT
CLASS="LITERAL"
>Clean 0</TT
>.</P
><P
>Команда Clean должна использоваться на разделах с данными, а также на
разделах MBR или EXT. Абсолютно не имеет смысла очищать раздел перед
выполнением команды <TT
CLASS="LITERAL"
>FullUnzip</TT
>.</P
></DD
><DT
>FullUnzip "образ_раздела" <I
CLASS="EMPHASIS"
>раздел</I
> (<I
CLASS="EMPHASIS"
>диск</I
>)</DT
><DD
><P
>Разархивировать компрессированный образ диска в заданный раздел. При этом заданный раздел полностью очищается от других данных (очистка на-лету).</P
><P
>Команда FullUnzip поддерживается для разделов (FAT16) BIGDOS, FAT32 и LINUX-EXT2. 
&#13;</P
><P
>При этом в графическом режиме на экран выводится индикатор процесса
разархивирования, если переменная <TT
CLASS="LITERAL"
>VESA</TT
> не установлена в <TT
CLASS="LITERAL"
>OFF</TT
>.</P
></DD
><DT
>IncrUnzip "доп-архив" "путь"</DT
><DD
><P
>Разархивировать "дополняющий" архив в указанный путь. Файлы из архива заменяют файлы на диске с совпадающими именами, но остальные файлы не удаляются.</P
><P
>Команда IncrUnzip поддерживается для (FAT16) BIGDOS, FAT32 и LINUX-EXT2.
Эта команда менее эффективна, чем FullUnzip, потому что необходимо
сохранить структуру существующей файловой системы. Однако, при помощи этой
команды, можно избежать создания большого количества разных образов дисков,
сохраняя лишь отличия одного от другого.
&#13;</P
></DD
><DT
>FileUnzip "исходный_файл" "результирующий_файл"</DT
><DD
><P
>Разархивировать файл, сжатый ранее при помощи команды FileZip программы
<TT
CLASS="LITERAL"
>MrZip</TT
>. Правильность разархивации контролируется 32-битным CRC.</P
></DD
><DT
>Copy "исходный_файл" "результирующий_файл"</DT
><DD
><P
>Побайтно скопировать исходный файл в результирующий. Эту команду можно
использовать, например, после команды FullUnzip для копирования
конфигурационных файлов в сервера без создания нового образа диска. Для
больших и легко компрессируемых файлов лучше использовать <TT
CLASS="LITERAL"
>FileUnzip</TT
>.</P
></DD
><DT
>Append "исходный_файл" "результирующий_файл" ("префикс" ("суффикс"))</DT
><DD
><P
>Скопировать побайтно сначала первый, затем второй файл в результирующий.
Эту команду можно использовать для разделения на части больших файлов.
Результирующий файл не может быть ни одним из исходных.</P
></DD
><DT
>Patch "исходный_файл" "результирующий_файл" ("префикс" ("суффикс"))</DT
><DD
><P
>Прочитать содержимое исходного файла, произвести в нем подстановку
переменных и записать результат в результирующий файл. Обработка символов
с ASCII-кодами 128-255 зависит от значения переменной $IsoLatin.&#13;</P
><P
>По умолчанию переменные должны начинаться с префикса "${" и оканчиваться
суффиксом "}". Эти два значения могут быть изменены на любую другую
непустую строку. Помните, что если вы хотите использовать знак доллара в
префиксе или суффиксе, то вы должны поставить перед ним обратный слэш,
иначе он будет интерпретирован как макро-подстановка. Например, если вы
хотите отдельно задать значения, используемые по умолчанию, то дайте
команду: 
Patch "исходный_файл" "результирующий_файл" "\${" "}"</P
></DD
><DT
>MkDir "путь"</DT
><DD
><P
>Рекурсивно создать каталоги, начиная с корневого, до заданного пути. Если путь уже существует, команда игнорируется.</P
></DD
><DT
>Delete "файл", Del "файл"</DT
><DD
><P
>Удалить файл. Файл должен существовать. </P
></DD
><DT
>DelTree "путь"</DT
><DD
><P
>Рекурсивно удалить все файлы и каталоги, находящиеся в заданном пути, и затем удалить сам каталог.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1707"
>6.1.12. Команды загрузки системы</A
></H3
><P
>В этом разделе описываются команды загрузки ОС. В круглых скобках приведены необязательные аргументы. 


<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>HideBootProm</DT
><DD
><P
>Освободить память и векторы прерываний, занятые BootPROM. После выполнения
этой команды TFTP-сервер будет недоступен. Чаще всего эта команда
применяется при загрузке DOS или Windows - таким образом бывает
высвобождена "верхняя" память. Эта команда автоматически выполняется при
вызове FloppyBoot.</P
><P
>Заметьте, что эта функция восстанавливает только те векторы, которые
корректно перенаправлены на BootPROM - все остальное остается неизменным.
Но, по-видимому, для DOS и Windows этого достаточно.
&#13;</P
></DD
><DT
>LoadRamDisk "имя_файла-электронного_диска"</DT
><DD
><P
>Загрузить образ флоппи диска в расширенную память и перенаправить вызовы
флоппи-диска BIOS на этот "электронный" флоппи диск. Эта команда
автоматически выполняет <TT
CLASS="LITERAL"
>HideBootProm</TT
>. Вы можете использовать команду
<TT
CLASS="LITERAL"
>FloppyBoot</TT
> для загрузки системы с электронного диска, который вы только что
создали.</P
><P
>Этот электронный диск не настолько гибок, по сравнению с возможностями команды TFTPBoot. Единственное его преимущество - он использует несколько сот байт памяти вместо 64 Кб, используемых TCP/IP BootPROM. Внимание: в расширенной памяти после создания этот электронный диск ничем не защищен! Выгрузить этот электронный диск нельзя. 
&#13;</P
></DD
><DT
>LoadZRamDisk "имя_файла-электронного_диска"</DT
><DD
><P
>Аналогично <TT
CLASS="LITERAL"
>LoadRamDisk</TT
>, но образ диска должен быть сжат командой FileZip
программы <TT
CLASS="LITERAL"
>MrZip</TT
>. Компрессированные диски защищены от потери данных (и
неполной загрузки с сети) при помощи 32-битной контрольной суммы.</P
></DD
><DT
>TFTPBoot "файл"</DT
><DD
><P
>Продолжить загрузку системы (например, с образа флоппи-диска, созданного программой BpShell фирмы InCom). Смотрите также правила обращения к файлам, находящимся на других TFTP-серверах.</P
></DD
><DT
>FloppyBoot</DT
><DD
><P
>Скрыть ППЗУ удаленной загрузки, загрузить в память загрузочный сектор флоппи-диска и передать ему управление.</P
></DD
><DT
>HdBoot (<I
CLASS="EMPHASIS"
>диск</I
>)(:<I
CLASS="EMPHASIS"
>раздел</I
>)</DT
><DD
><P
>Загрузить заданный загрузочный сектор и передать ему управление. По
умолчанию используется раздел 0 на диске номер 0, т.е. MBR первого жесткого
диска. Вы можете загрузить ОС с любого раздела, но помните, что Windows 95
может не загрузиться, если у ее раздела не установлен флаг "активный"
(подсказка: используйте SetBootPart).</P
><P
>Эта команда автоматически НЕ вызывает HideBootProm. 
&#13;</P
></DD
><DT
>LinuxBoot "файл_ядра" ("командная_строка" ("файл_электронного_диска"))</DT
><DD
><P
>Загрузить в верхнюю память ядро и электронный диск Linux и запустить ядро,
передав ему командную строку. Неплохая идея - передавать ядру в параметрах
местоположение корневой файловой системы (например, <TT
CLASS="LITERAL"
>"root=</TT
>dev/hda1"). Если
вы используете Linux, сильно привязанный к <TT
CLASS="LITERAL"
>lilo</TT
> (например RedHat Linux
5.1), то, возможно, вам понадобится передать ядру дополнительные параметры,
например, <TT
CLASS="LITERAL"
>BOOT_IMAGE=linux</TT
>. Заметьте, что при помощи этой команды, ядро можно
загрузить с сети (и оно автоматически попадет в кэш-раздел) или напрямую с
заданного раздела.</P
><P
>Эта команда работает как с маленькими, так и с большими ядрами (<TT
CLASS="LITERAL"
>zImage</TT
> и <TT
CLASS="LITERAL"
>bzImage</TT
>). </P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1754"
>6.1.13. Поддержка различных языков</A
></H3
><P
>В этом разделе описываются команды поддержки национальных языков. В круглых скобках приведены необязательные аргументы. 


<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>RemapKeys "исходные_клавиши" "переназначенные_клавиши"</DT
><DD
><P
>Переназначить заданные клавиши на другие. Например, если вы хотите поменять
местами клавиши Y и Z, дайте команду Remapkeys "yzYZ" "zyZY" Небольшой
совет - для символов, не включенных в первую половину ASCII, лучше будет
использовать восьмеричные коды, а не напрямую символы - в последнем случае
вам придется постоянно контролировать содержимое переменной $IsoLatin.</P
><P
>На некоторых клавиатурах существуют две клавиши с символом "обратный слэш".
Они могут быть переназначены независимо - это возможно благодаря тому, что
<TT
CLASS="LITERAL"
>BpBatch</TT
> распознает одну из них как клавишу с ASCII-кодом 0252
(восьмеричное), а другую как 0335 (восьмеричное).</P
><P
>Если вы пошлете мне пример скрипта, переназначающий клавиши для вашей
национальной клавиатуры, то я помещу его в <TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/sample-scripts"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/sample-scripts</A
></TT
>.Чтобы
вам было проще создать свою раскладку, я советую нажимать все
<I
CLASS="EMPHASIS"
>необходимые</I
> клавиши без переназначения и записать
символы, которые они производят. Это будут <TT
CLASS="LITERAL"
>исходные_клавиши. Переназначенные_клавиши</TT
> - это те
символы, которые вы хотите видеть, вместо исходных, в том же порядке. Если
некоторые из символов (исходные или переназначаемые) выдают символы с
ASCII-кодом больше 127, используйте восьмеричные коды. Восьмеричный код
символа вы можете найти в любой таблице ASCII-кодов, например, в программе
HelpPC (HelpPC - это программа контекстной помощи от David Jurgens).</P
></DD
><DT
>RemapAltkeys "исходные_клавиши" "переназначенные_клавиши"</DT
><DD
><P
>Переназначить клавиши при нажатии их вместе с ALT. Например, чтобы переназначить Alt-2 на знак амперсанд используйте 
<PRE
CLASS="PROGRAMLISTING"
>        RemapAltKeys "2" "&#38;"</PRE
>

Заметьте, что программа не поддерживает переключение клавиатуры с одной раскладки на другую.
(Примечание переводчика: можно попытаться использовать для этого команду OnKey)</P
></DD
><DT
>LoadCodePage "cp???.bin"</DT
><DD
><P
>Загрузить и включить заданную таблицу кодировки. Эти таблицы используются
для преобразования символов Unicode (используемые, например, в файловой
системе VFAT) в 8-битные символы. Если не загрузить верную таблицу
кодировки, то FAT будет выдавать сообщения о том, что на диске в менах
файлов используются специальные символы.</P
><P
>Все таблицы кодировок можно найти по адресу

<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/codepage.zip"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/codepage.zip</A
></TT
></P
><P
>По умолчанию используется кодовая страница 850 - переупорядоченная версия
ISO-Latin-1. Если вы хотите использовать другую страницу, установите
переменную <TT
CLASS="LITERAL"
>$IsoLatin</TT
> в <TT
CLASS="LITERAL"
>"off"</TT
>, или получите абсолютно
непредсказуемый результат.</P
></DD
><DT
>LoadFont "файл_шрифта"</DT
><DD
><P
>Загрузить заданный шрифт VGA/VESA и использовать его в текстовом и графическом режиме. Файл шрифта - это двоичный файл, в котором находятся изображения символов, по 16 байт на символ (размером 8x16). Эта команда может использоваться как в целях поддержки национальных языков, так и в целях украшения шрифтов.</P
><P
>Архив с достаточно красивыми шрифтами можно найти по адресу
<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/fonts.zip"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/fonts.zip</A
></TT
>. В этот файл
входит программа, которая позволяет извлекать шрифты вашей кодовой страницы
из файлов <TT
CLASS="LITERAL"
>.CPI</TT
> DOS.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H3
CLASS="SECT3"
><A
NAME="AEN1792"
>6.1.14. Команды MrZip</A
></H3
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Source...</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  Source (i)archive "имя_файла"
  Source path "путь"</PRE
>
   </P
><P
>Установить источник при работе с архивами в заданный (i - дополняющий) архив или путь на диске. 
&#13;</P
></DD
><DT
>Dest...</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  Dest (i)archive "имя_файла"
  Dest (i)dump
  Dest path "путь"</PRE
>
&#13;</P
><P
>Установить приемник при работе с архивами в заданный (i-дополняющий) архив,
дамп или путь на диске. Для задания формата вывода дампа в журнал
используйте переменную $DumpFormat.&#13;</P
></DD
><DT
>FileZip "файл_источник" "файл_приемник"</DT
><DD
><P
>Сжать файл для дальнейшего использования командой FileUnzip или LoadZRamDisk. Файл защищен от потерь данных 32-битной контрольной суммой.</P
></DD
><DT
>Filter...</DT
><DD
><P
><PRE
CLASS="PROGRAMLISTING"
>  Filter -"шаблон"
  Filter +"шаблон"</PRE
>
&#13;</P
><P
>Исключить из архива/включить в архив файлы и каталоги, соответствующие шаблону (в нем можно использовать символы * и ?). Шаблон сверяется с полным путем к файлу или каталогу. Включающий фильтр имеет больший приоритет, чем исключающий - то есть, если файл исключается по шаблону со знаком минус и включается по шаблону со знаком плюс, то он войдет в архив. 
&#13;</P
><P
>Для образов DOS/Windows-разделов используйте 

<PRE
CLASS="PROGRAMLISTING"
>        Filter -"*.swp"
        Filter -"temp/*"</PRE
>

Для образов Unix-дисков используйте 
<PRE
CLASS="PROGRAMLISTING"
>        Filter -"var/log/*"
        Filter -"tmp/*"</PRE
>
&#13;</P
></DD
><DT
>CopyArchive</DT
><DD
><P
>Начать операцию работы с архивами в соответствии с установками, заданными
командами source, destination и filter. Эта команда обычно вызывается реже,
чем ее краткие формы, приведенные ниже. Правда, ее можно использовать для
разбивки уже готового архива на части, например:
<PRE
CLASS="PROGRAMLISTING"
>        set FragmentSize="30 MB"
        Source archive "original.imz"
        Dest archive "refragmented.imz"
        CopyArchive</PRE
></P
></DD
><DT
>FullZip "путь" "полный_архив"</DT
><DD
><P
>Сокращенная форма от 
<PRE
CLASS="PROGRAMLISTING"
>                Source path "путь"
                Dest archive "полный_архив"
                CopyArchive</PRE
>

До этой команды обычно задаются фильтры.</P
></DD
><DT
>IncrZip "путь" "доп_архив"</DT
><DD
><P
>Сокращенная форма от 
<PRE
CLASS="PROGRAMLISTING"
>                Source archive "полный_архив"
                Dest dump
                CopyArchive</PRE
>

&#13;</P
></DD
><DT
>FullDump "полный_архив"</DT
><DD
><P
>Сокращенная форма от 
<PRE
CLASS="PROGRAMLISTING"
>                Source archive "полный_архив"
                Dest dump
                CopyArchive</PRE
>

&#13;</P
></DD
><DT
>IncrDump "доп_архив"</DT
><DD
><P
>Сокращенная форма от 
<PRE
CLASS="PROGRAMLISTING"
>                Source iarchive "доп_архив"
                Dest dump
                CopyArchive</PRE
>

&#13;</P
></DD
><DT
>XCopy "путь-источник" "путь-приемник"</DT
><DD
><P
>Сокращенная форма от 
<PRE
CLASS="PROGRAMLISTING"
>                Source path "путь-источник"
                Dest path "путь-приемник"
                CopyArchive</PRE
>
&#13;</P
></DD
></DL
></DIV
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN1851"
>6.2. NoBreak.sys</A
></H2
><P
><TT
CLASS="LITERAL"
>Nobreak.sys</TT
> - это небольшая программа (размером около 350 байт), которую вы
можете загрузить в начале <TT
CLASS="FILENAME"
>config.sys</TT
>. Ее цель - обезопасить процесс
загрузки и авторизации пользователя от нажатия Ctrl-Break. В DOS есть
подобный механизм (<TT
CLASS="LITERAL"
>BREAK=OFF</TT
>), но он не настолько надежен, и практически не
работает в <TT
CLASS="FILENAME"
>autoexec.bat</TT
>. Наш драйвер обрабатывает скан-коды клавиш на
уровне BIOS. Таким образом, ни одна программа просто не получит код клавиши
Break, пока его обработка не будет разрешена.</P
><P
>Драйвер должен быть загружен в <TT
CLASS="FILENAME"
>config.sys</TT
> (или при помощи программы <TT
CLASS="LITERAL"
>devlod</TT
>
из <I
CLASS="EMPHASIS"
>Недокументированной DOS</I
>). После этого Break можно снова разрешить,
послав <TT
CLASS="LITERAL"
>Yes</TT
> специальному псевдо-устройству <TT
CLASS="LITERAL"
>NOBRK</TT
>, или запретить, послав <TT
CLASS="LITERAL"
>No</TT
>
(на самом деле обрабатывается только первый символ - <TT
CLASS="LITERAL"
>Y</TT
> или <TT
CLASS="LITERAL"
>N</TT
>).</P
><P
>Драйвер использует вызовы BIOS, и, соответственно, работает только в DOS и Windows 3.1. В Windows 95 встроена своя внутренняя обработка клавиатуры. 
&#13;</P
><P
>Исходный текст на ассемблере можно взять  <A
HREF="http://www.linux.org.ru/books/HOWTO/soft/nobreak.zip"
TARGET="_top"
>здесь</A
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN1870"
>7. Специальные TFTP-сервера</A
></H1
><P
>Единственная поддержка сети, встроенная в TCP/IP BootPROM - это TFTP.
Поэтому нам интересны специальные версии TFTP-серверов, позволяющих немного
больше, чем обычные.&#13;</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN1873"
>7.1. Улучшенный TFTP-сервер фирмы Incom</A
></H2
><P
>Фирма InCom GmbH вместе со своим TCP/IP BootPROM распространяет улучшенную
версию TFTP-сервера, который может посылать пакеты размером до 1408 байт,
вместо стандартных 512. Это очень важное дополнение, которое мы рекомендуем
использовать. Этот сервер есть на диске утилит TCP/IP Bootprom в вариантах
для Solaris, Windows и Netware NLM.&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN1876"
>7.2. Улучшенный TFTP-сервер для Linux</A
></H2
><P
>Мы собрали модифицированную версию TFTP-сервера для Linux, работающего
аналогично улучшенной версии TFTP-сервера фирмы Incom. На самом деле, мы
просто увеличили размер пакета с 512 до 1408 байт и поменяли порт с 69 на
59. Его можно получить по адресу <TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/etftpd.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/etdtpd.tar.gz</A
></TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN1881"
>7.3. Шлюз авторизации</A
></H2
><P
>Мы также написали специальную версию TFTP-сервера, работающего, как шлюз
системы безопасности для авторизации пользователей. Этот сервер работает в
Linux или Solaris и может авторизовать пользователей в системе паролей
Unix (с поддержкой NIS и shadow), на сервере Windows NT (или Samba) server
или на сервере Radius. Его можно взять по адресу
<TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/stftpd.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/stdtpd.tar.gz</A
></TT
>, вместе с
исходными текстами и заранее собранными программами. Заранее собранные
программы не включают систему шифрования паролей NT - мы не можем
распространять библиотеку <TT
CLASS="LITERAL"
>libdes</TT
>, но сборка программы - дело достаточно
простое.</P
><P
>Чтобы использовать шлюз безопасности, вам надо настроить достаточно простой
файл конфигурации <I
CLASS="EMPHASIS"
>доменов</I
> безопасности, в котором описывается соответствие
серверов авторизации и доменов (домен <TT
CLASS="LITERAL"
>Unix</TT
> соответствует системе паролей
Unix на той машине, на которой работает шлюз). Ниже приведен пример
конфигурации


<PRE
CLASS="PROGRAMLISTING"
>#
# Файл конфигурации STFTPD
#  
# В этом файле описываются сервера, соответствующие "доменам безопасности". Поддерживаются 
# два вида серверов - radius или winnt (winnt включает в себя
# NT Server и Samba)
#
# Формат строки для серверов radius
# radius        &lt;домен&gt;         &lt;адрес_сервера&gt;         &lt;ключевое_слово&gt;
#
# ключевое_слово - это слово, указанное в файле /etc/raddb/clients
#
# Формат строки для SMB-серверов
# winnt         &lt;домен&gt;         &lt;адрес_сервера&gt;         &lt;имя_NetBios&gt;
#
# имя_NetBios - это наименование сервера в NETBIOS
#
# Примеры
radius         sec-dom-rad     radiusserver    testing123
winnt          sec-dom-nt1     192.168.1.1     NTSERVER1
winnt          sec-dom-smb     samba           SAMBA1
&#13;</PRE
>



Заметьте, что, если вы используете Samba, вы должны установить параметр  <TT
CLASS="LITERAL"
>security = user</TT
>.</P
><P
>Вы также можете указать шлюзу безопасности файл со списком пользователей, которым нельзя входить в систему при любых обстоятельствах (для них проверка пароля будет всегда давать отрицательный результат). </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN1893"
>7.4. Широковещательный TFTP-сервер</A
></H2
><P
>Мы написали специальную версию TFTP-сервера, включающую в себя самодельную
версию широковещательного TFTP. Используя его, мы смогли достичь скорости
передачи данных клиентам в 6 Мб/с на сильно загруженной 10-мегабитной сети
(этот способ значительно более эффективен - он не посылает подтверждения на
каждый пакет). Этот сервер работает в Linux или Solaris. Его можно взять по
адресу <TT
CLASS="LITERAL"
><A
HREF="http://www.linux.org.ru/books/HOWTO/soft/btftpd.tar.gz"
TARGET="_top"
>http://cuiwww.unige.ch/info/pc/remote-boot/soft/btdtpd.tar.gz</A
></TT
>,
вместе с исходными текстами и заранее собранными программами.</P
><P
>TCP/IP-BootPROM не поддерживает этот протокол, поэтому мы загружаем небольшой вариант ядра Linux, использующий электронный диск, при помощи ранее описанных утилит, в котором запускаем Linux-версию программы MrBatch, в которую встроена поддержка широковещательного TFTP. Простой пакетный файл загружает все необходимые файлы в кэш-раздел в течение пары минут одновременно на всех компьютерах. Вам не надо устанавливать Linux для использования этого пакета (за исключением того случая, если ваше очень экзотическое оборудование требует специального ядра). 
&#13;</P
><P
>Процедура состоит из нескольких шагов. Во-первых, загрузите вручную широковещательный сервер, задав ему количество клиентских машин в качестве параметра (запомните, что эта процедура должна производиться не ежедневно, а лишь в тех случаях, когда вы хотите синхронизировать образы дисков на всех машинах). Затем включите все клиентские машины, которые должны выполнить следующий скрипт: 





<PRE
CLASS="PROGRAMLISTING"
>#
# Этот файл запускает мини-вариант linux с электронным
# диском, который затем запустит mrbatch.
#
# Широковещательный TFTP-протокол работает только в Linux-версии
# mrbatch, потому что в BootPROM нет поддержки широковещания.
#
# 1. Создаем небольшой раздел, оставляя большое пространство для кэша
setpartitions "BIGDOS:50"
# 2. Очищаем MBR
clean 0
# 3. Запускаем ядро Linux с поддержкой initrd (Загрузочный Электронный Диск) и 
#    используем в качестве этого диска bcastrd.gz (он будет подключен в 
#    качестве корневой файловой системы и запущен через /linuxrc). См. initrd.txt,
#    в котором приведено подробное описание загрузочных дисков. Вам не надо задавать корневое
#    устройство) - ядро будет использовать электронный диск.
linuxboot "linux.krn" "" "bcastrd.gz"
# 4. Сначала linux запустит dhcpcd для настройки сети.
#    Затем он выполнит команду mrbatch -w bcastlx
&#13;</PRE
>



В электронный диск входят:


<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>dhcpcd</TT
> - DHCP-клиент для настройки сети </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>mrbatch</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>linuxrc</TT
> - небольшой скрипт, автоматически запускаемый initrd и запускающий  <TT
CLASS="LITERAL"
>dhcpcd</TT
> и <TT
CLASS="LITERAL"
>mrbatch</TT
>.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>usr/lib/terminfo/l/linux</TT
> - используемый MrBatch </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>dev/*</TT
> - устройства, необходимые Linux и mrbatch </P
></LI
></UL
>

Все программы собраны статически и из них удалена отладочная информация -
таким образом мы избегаем включения в электронный диск файла <TT
CLASS="FILENAME"
>libc.so</TT
>,
имеющего достаточно серьезный размер. Полученный электронный диск сжат GZIP
и имеет размер меньше 300 Кб. Ядро занимает около 450 Кб (с поддержкой
многих сетевых карт и initrd). После загрузки Linux MrBatch запускает
нижеприведенный скрипт (вы можете отредактировать его необходимым
образом):



<PRE
CLASS="PROGRAMLISTING"
># Этот файл выполняется mrbatch, после его загрузки с электронного диска
# bcastrd.gz
# Его главная задача - "широко скопировать" файлы в кэш
#
# 1. Выводим диагностические сообщения
showlog
# 2. Отключаем фразу "press a key"
set pauselog="OFF"
# 3. Устанавливаем реальные размеры разделов. 
#    Внимание: Так как вы копируете файлы в кэш для дальнейшего использования,
#    задайте именно те размеры разделов, которые вы будете использовать.
setpartitions "BIGDOS:1024"
# 4. Очищаем кэш-раздел
clean -1
# 5. И копируем файлы в кэш, используя широковещательный TFTP-протокол
#    (порт 99)
#
# Вы можете использовать этот скрипт "как есть", но последнюю строку обязательно
# измените! В нашем примере мы загружаем файл mblinux.imz, который является образом
# нашей инсталляции Linux.
copy "$BOOTP-Server-IP@99:mblinux.imz" "{:-1}mblinux.imz"
&#13;</PRE
>



После завершения пересылки вы можете просто выключить клиентские машины и
изменить их загрузочные скрипты на любимое меню.</P
></DIV
></DIV
></DIV
></BODY
></HTML
>