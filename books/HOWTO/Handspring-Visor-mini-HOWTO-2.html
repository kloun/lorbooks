<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Handspring-Visor mini-HOWTO: Установка программного обеспечения</TITLE>
 <LINK HREF="Handspring-Visor-mini-HOWTO-3.html" REL=next>
 <LINK HREF="Handspring-Visor-mini-HOWTO-1.html" REL=previous>
 <LINK HREF="Handspring-Visor-mini-HOWTO.html#toc2" REL=contents>
</HEAD>
<BODY>
<A HREF="Handspring-Visor-mini-HOWTO-3.html">Следующий</A>
<A HREF="Handspring-Visor-mini-HOWTO-1.html">Предыдущий</A>
<A HREF="Handspring-Visor-mini-HOWTO.html#toc2">Содержание</A>
<HR>
<H2><A NAME="install"></A> <A NAME="s2">2. Установка программного обеспечения</A></H2>

<H2><A NAME="requirements"></A> <A NAME="ss2.1">2.1 Что вам потребуется</A>
</H2>

<P>Вам, само собой, потребуются такие вещи, как компьютер, USB-порты,
Handspring
Visor (с USB-кроваткой), Linux и прочее. Вам также нужно знать, как
компилировать и устанавливать разное ПО, например, ядро. Если у вас
отсутствуют эти знания и умения, то вам, скорее всего, поможет документ
kernel-HOWTO: 
<A HREF="http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html">http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html</A>.
<H2><A NAME="kernel"></A> <A NAME="ss2.2">2.2 Ядро</A>
</H2>

<P>Сначала вам потребуется ядро, которое поддерживает USB. Вы можете взять
"последнее" разрабатываемое ядро, которое на момент написания этого
документа
имело версию 2.4.0-test5 (на момент перевода версия была уже не такой,
но я не
вижу большого смысла указывать ее -- Прим. переводчика). Его можно найти
по
адресу 
<A HREF="ftp://ftp.kernel.org/pub/linux/kernel/v2.4/">ftp://ftp.kernel.org/pub/linux/kernel/v2.4/</A>.
Второй вариант -- взять последнее стабильное ядро, и последний бэк-порт
USB-кода. На момент написания этого документа (7 августа, 2000)
стабильным
ядром было 2.2.16 и его можно было найти здесь:
<A HREF="ftp://ftp.kernel.org/pub/linux/kernel/v2.2/">ftp://ftp.kernel.org/pub/linux/kernel/v2.2/</A>. Последний бэк-порт
USB-кода распространяется
проектом linux-usb project и находится тут: 
<A HREF="http://www.suse.cz/development/usb-backport/">http://www.suse.cz/development/usb-backport/</A>
Текущая версия (7 августа, 2000) -- usb-2.4.0-test2-pre2-for-2.2.16-v3.
Возможно, как бэк-порту есть патчи. Вы сможете найти их по адресу
<A HREF="http://sourceforge.net/patch/?group_id=1404">http://sourceforge.net/patch/?group_id=1404</A>.
Выкачайте и установите исходный код ядра, включив в него USB-код, если
вы
используете версию 2.2. Ниже приведен пример установки исходного кода
2.2 и
бэк-порта.
<P>
<PRE>
cd /usr/src
tar xzvf linux-2.2.14.tar.gz
cd linux
gzip -dc ../usb-2.3.50-1-for-2.2.14.diff.gz | patch -p1
make distclean
</PRE>
<P>Следующий шаг, чрезвычайно важный, заключается в том, что вы должны
определить, какой тип USB-контроллера используется в вашем компьютере.
USB-контроллер -- это аппаратное устройство, обрабатывающее
USB-ввод/вывод.
Материнские платы на чипсете Intel, то есть на чипсете BX, обычно
содержат
UHCI-контроллеры. Большинство карт расширения являются
OHCI-контроллерами. Вы
можете определить тип вашего контроллера при помощи команды
'lspci -v'. (Если у вам нет lspci, обратитесь к разделу "Ссылки"). Если
вы
увидите что-нибудь такого типа:
<P>
<PRE>
    USB Controller: ......
    Flags: .....
    I/O ports at ....
</PRE>
<P>то у вас UHCI-контроллер.  Если же вывод выглядит следующим образом:
<P>
<PRE>
     USB Controller: .....
     Flags: ....
     Memory at .....
</PRE>
<P>то ваш контроллер -- OHCI.  (Описание процесса определения типа
контроллера
было украдена из документации к ядру, Documentation/usb/scanner.txt).
Дополнительную информацию вы можете найти на сайте
<A HREF="http://www.linux-usb.org">http://www.linux-usb.org</A>.
Вам также может помочь документация на ядро в каталоге
Documentation/usb/usb.txt.
<P>Если у вам нет USB-контроллера, то вам нужно либо купить "кроватку" для
Visor,
подключающуюся к последовательному порту (кстати, зачем вы это
читаете?), либо
устройство, имеющее USB-контроллер (то есть карту расширения или
материнскую
плату).
<P>Теперь нам предстоит настроить и собрать ядро. При настройке не забудьте
<P>включить
<P>
<UL>
<LI>USB support (CONFIG_USB),</LI>
<LI>соответствующий тип контроллера -- UHCI, alternate UHCI, или OHCI
(CONFIG_USB_UHCI, CONFIG_USB_UHCI_ALT, или CONFIG_USB_OHCI)</LI>
<LI>USB Serial Converter support (CONFIG_USB_SERIAL)</LI>
<LI>USB Handspring Visor Driver (CONFIG_USB_SERIAL_VISOR) (подпункт
пункта USB
Serial Converter support)</LI>
</UL>
<P>(Я не знаю, в чем разница между двумя UHCI-драйверами, и не знаю, какой
порекомендовать. Кто-нибудь может объяснить?)
Я компилировал драйвера как отдельными модулями, так и включая их в
ядро.
Работает и так, и так. Разработчики предпочитают модули, но решайте
сами.
<P>После этого заканчивайте сборку и установку ядра, а затем
перезагружайтесь.
<P>Еще не все! Чтобы драйвер Visor заработал, нам потребуется выполнить
дополнительные процедуры по обеспечению работоспособности USB Serial
driver. Вы
можете найти их описание в документации по ядру:
Documentation/usb/usb-serial.txt. Вкратце, вам потребуется создать
необходимые
устройства. Для этого достаточно с полномочиями пользователя root
выполнить
следующие команды:
<P>
<PRE>
mknod /dev/ttyUSB0 c 188 0
mknod /dev/ttyUSB1 c 188 1
etc...
chmod 666 /dev/ttyUSB*
</PRE>
<P>В настоящий момент ограничения в коде позволяют использовать до 16
подключений/портов/устройств, так что вам потребуются только устройства
с
номерами от 0 до 15. Команда chmod позволит всем пользователям получить
доступ
к Visor. По мнению автора этого документа, такая настройка хороша лишь
для
персонального компьютера. Для многопользовательских машин этот вопрос
следует
рассмотреть дополнительно.
<P>При подключении Visor образуются два открытых "порта". (В большинстве
случаев
это будут /dev/ttyUSB0 и /dev/ttyUSB1, или что-нибудь подобное).
Первый порт (номер ноль) -- общее соединение. Второй порт --
hotsync-порт.
Это позволит в будущих разработках устроить что-нибудь типа, например,
экспорта файловой системы с Visor. Полезно будет создать ссылку с
hotsync-порта, чтобы синхронизирующее программное обеспечение по
умолчанию
использовало нужное устройство. Это можно сделать так:
<P>
<PRE>
cd /dev
ln -s /dev/ttyUSB1 pilot
</PRE>
<P>Просто для развлечения вы также можете создать ссылку с /dev/visor
на /dev/ttyUSB1, ну, просто потому, что у нас visor, а не pilot
(или Palm(tm)). Реальный номер устройства может изменяться, в
зависимости от
того, сколько (активных?) USB-последовательных устройств подключено к
вашей
системе. При нажатии на "кроватке" кнопки синхронизации будет выведено
сообщение, указывающее, какое устройство используется.
<P>Если вы скомпилировали USB-код как модули, вам также потребуется
включить эти
модули в работающее ядро. Как пользователь root введите следующие
команды:
<P>
<PRE>
/sbin/modprobe usb-uhci
/sbin/modprobe usb-ohci
/sbin/modprobe usb-serial
</PRE>
<H2><A NAME="coldsync"></A> <A NAME="ss2.3">2.3 Установка ColdSync</A>
</H2>

<P>ColdSync представляет собой пакет, который содержит программы,
предназначенные
для коммуникации с Visor (или Palm(tm), если у вас один из них). Другим
популярным пакетом для решения тех же задач является pilot-link. Однако,
как
кажется, в работе pilot-link есть ошибки, особенно при работе с
USB-драйверами. Поэтому я рекомендую ColdSync. Системы с
UHCI-контроллерами
работают с coldsync прекрасно, хотя у OHCI-контроллеров есть некоторые
проблемы. (При использовании pilot-link все хуже и в том, и в другом
случае.)
Дополнительную информацию вы можете найти в списке рассылки
разработчиков
visorusb:
<A HREF="http://www.geocrawler.com/lists/3/SourceForge/1169/">http://www.geocrawler.com/lists/3/SourceForge/1169/</A>.
<P>На момент написания этого документа (7 августа, 2000) последней
стабильной
версий ColdSync была 1.2.5. Последняя версия pilot-link, насколько я
знаю, --
0.9.3. Одним из преимуществ pilot-link является то, что существует
больше
графических интерфейсов, использующих библиотеки pilot-link, нежели
использующих coldsync.
<P>Обсуждавшиеся программы могут быть найдены по следующим адресам:
<UL>
<LI>
<A HREF="http://www.ooblick.com/software/coldsync/">http://www.ooblick.com/software/coldsync/</A></LI>
<LI>
<A HREF="ftp://ryeham.ee.ryerson.ca/pub/PalmOS/pilot-link.0.9.3.tar.gz">ftp://ryeham.ee.ryerson.ca/pub/PalmOS/pilot-link.0.9.3.tar.gz</A>
или, конечно: 
<A HREF="http://pilot-link.sourceforge.net/">http://pilot-link.sourceforge.net/</A></LI>
</UL>
<P>Выкачайте и установите программу, которую вы хотите использовать. (Если
вы
устанавливаете coldsync, вам следует прочитать файл INSTALL.)
<P>
<PRE>
cd /usr/src
gzip -dc coldsync-1.2.5.tar.gz | tar xvf -
cd coldsync-1.2.5
./configure
make
make install
</PRE>
<P>Если вы предпочитаете лениться, то, вероятно, существуют пакеты для
redhat и
debian, которые вы можете выкачать и установить. Я их не поддерживаю.
<H2><A NAME="testing"></A> <A NAME="ss2.4">2.4 Почти готово! (aka тестирование)</A>
</H2>

<P>Мы уже почти закончили. Теперь нужно протестировать, как все работает.
Конечно, Visor должен быть в "кроватке", а она должна быть подключена к
USB-порту.
<P>Для тестирования мы можем использовать coldsync. Для того, чтобы
компьютер
осознал, что Visor действительно здесь, вам потребуется нажать кнопку
синхронизации на "кроватке". (Я заметил, что при подключении
USB-устройства на
экране появляется куча информации. Обновление: это происходит при
включенной
отладке.) После этого драйвер для Visor создаст запись в
/proc/drivers/visor,
которая будет содержать дополнительный (minor) номер и назначение.
Подробнее
об этом -- потом. А сейчас давайте запустим coldsync.
<P>
<PRE>
coldsync -p /dev/visor
</PRE>
<P>(Помните, /dev/visor -- символическая ссылка на /dev/ttyUSB1).
Начиная с этого момента используйте другую документацию. Полезен man.
<HR>
<A HREF="Handspring-Visor-mini-HOWTO-3.html">Следующий</A>
<A HREF="Handspring-Visor-mini-HOWTO-1.html">Предыдущий</A>
<A HREF="Handspring-Visor-mini-HOWTO.html#toc2">Содержание</A>
</BODY>
</HTML>
