<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Звук в Linux HOWTO: Ответы на часто задаваемые вопросы (FAQ)</TITLE>
 <LINK HREF="Sound-HOWTO-7.html" REL=next>
 <LINK HREF="Sound-HOWTO-5.html" REL=previous>
 <LINK HREF="Sound-HOWTO.html#toc6" REL=contents>
</HEAD>
<BODY>
<A HREF="Sound-HOWTO-7.html">Следующий</A>
<A HREF="Sound-HOWTO-5.html">Предыдущий</A>
<A HREF="Sound-HOWTO.html#toc6">Содержание</A>
<HR>
<H2><A NAME="s6">6. Ответы на часто задаваемые вопросы (FAQ)</A></H2>

<P>В этом разделе даются ответы на некоторые вопросы, которые часто
задаваются в группах новостей и списках рассылки.
<P>Ответы на большее количество вопросов также может быть найдено на странице
звукового драйвера OSS.
<P>
<H2><A NAME="ss6.1">6.1 Для чего различные файлы звукового устройства?</A>
</H2>

<P>Это наиболее "стандартные" имена файлов устройства, некоторые пакеты
Linux могут использовать немного отличные имена.
<P>
<DL>
<DT><B>/dev/audio</B><DD><P>обычно ссылка на файл /dev/audio0
<DT><B>/dev/audio0</B><DD><P>устройство звука совместимое с устройством на
рабочей станцией Sun (только частичная реализация, не
поддерживается ioctl-интерфейс фирмы Sun, только u-law кодер)
<DT><B>/dev/audio1</B><DD><P>второе аудио-устройство (если поддерживается
звуковой картой или у вас установлено больше одной звуковой карты)
<DT><B>/dev/dsp</B><DD><P>обычно ссылка на файл /dev/dsp0
<DT><B>/dev/dsp0</B><DD><P>первое устройство цифровой дискретизации
<DT><B>/dev/dsp1</B><DD><P>первое устройство цифровой дискретизации
<DT><B>/dev/mixer</B><DD><P>обычно ссылка на файл /dev/mixer0
<DT><B>/dev/mixer0</B><DD><P>первый микшер звука
<DT><B>/dev/mixer1</B><DD><P>второй микшер звука
<DT><B>/dev/music</B><DD><P>высокоуровневый интерфейс sequencer
<DT><B>/dev/sequencer</B><DD><P>низкоуровневый доступ к MIDI, FM, и GUS
<DT><B>/dev/sequencer2</B><DD><P>обычно ссылка на файл /dev/music
<DT><B>/dev/midi00</B><DD><P>1-й порт необработанных данных MIDI
<DT><B>/dev/midi01</B><DD><P>2-й порт необработанных данных MIDI
<DT><B>/dev/midi02</B><DD><P>3-й порт необработанных данных MIDI
<DT><B>/dev/midi03</B><DD><P>4-й порт необработанных данных MIDI
<DT><B>/dev/sndstat</B><DD><P>выводит состояние звукового драйвера при
чтении (также доступен как /proc/sound)
</DL>
<P>Драйвер PC speaker обеспечивает следующие устройства:
<P>
<DL>
<DT><B>/dev/pcaudio</B><DD><P>эквивалент /dev/audio
<DT><B>/dev/pcsp</B><DD><P>эквивалент /dev/dsp
<DT><B>/dev/pcmixer</B><DD><P>эквивалент /dev/mixer
</DL>
<P>
<H2><A NAME="ss6.2">6.2 Как я могу проиграть звуковой пример?</A>
</H2>

<P>Звуковые файлы рабочей станции Sun (.au) могут быть проиграны
копированием их на устройство /dev/audio.  Необработанные
(сырые) данные могут быть посланы на устройство /dev/dsp. Это
в общем дает правильные результаты, однако предпочтительно использование
программ таких как <CODE>play</CODE>, так как они будут распознавать
большинство типов файлов и устанавливать правильные параметры звуковой
карты&nbsp;-- скорость дискретизации и т.п.
<P>Программы подобные wavplay или vplay (из пакета snd-util) будут давать
наилучшие результаты с файлами WAV files. Однако они не
распознают WAV-файлы Microsoft, сжатые по технологии
ADPCM. Также старые версии программы play (из пакета Lsox) не
работают нормально с 16-битными WAV-файлами.
<P>Команда splay, включенная в пакет the snd-util, может быть использована
для проигрывания большинства звуковых файлов, если правильные параметры
будут вручную введены в командной строке.
<P>
<H2><A NAME="ss6.3">6.3 Как я могу записать пример?</A>
</H2>

<P>При чтении устройств /dev/audio или /dev/dsp
будут возвращаться оцифрованные данные, которые могут быть перенаправлены в
файл. Программы, такие как <CODE>vrec</CODE> делают этот процесс легче,
контролируя скорость дискретизации, продолжительность и т.п. Вам может
также понадобится программа микширования для выбора нужного устройства
ввода.
<P>
<H2><A NAME="ss6.4">6.4 Как я могу использовать более чем одну звуковую карту?</A>
</H2>

<P>В настоящее время звуковой драйвер позволяет иметь несколько
одновременно установленных в системе карт SoundBlaster, SoundBlaster/Pro,
SoundBlaster16, MPU-401 или MSS. Установка двух карт SoundBlaster возможно,
но требует определения макросов SB2_BASE, SB2_IRQ, SB2_DMA и (в некоторых
случаях) SB2_DMA2, путем редактирования файла local.h
вручную. Также возможно установить SoundBlaster одновременно с PAS16.
<P>С ядрами 2.0.x и более новыми, которые настраивают звук используя make
config, вместо local.h, вам необходимо отредактировать файл
/usr/include/linux/autoconf.h.  После секции содержащей
строки:
<P>
<BLOCKQUOTE><CODE>
<PRE>
#define SBC_BASE 0x220
#define SBC_IRQ (5)
#define SBC_DMA (1)
#define SB_DMA2 (5)
#define SB_MPU_BASE 0x0
#define SB_MPU_IRQ (-1)
</PRE>
</CODE></BLOCKQUOTE>
<P>поместите следующие строки (со значениями для вашей системы):
<P>
<BLOCKQUOTE><CODE>
<PRE>
#define SB2_BASE 0x330
#define SB2_IRQ (7)
#define SB2_DMA (2)
#define SB2_DMA2 (2)
</PRE>
</CODE></BLOCKQUOTE>
<P>Следующие драйвера не разрешают иметь много карт:
<P>
<UL>
<LI>GUS (ограничения драйвера)</LI>
<LI>MAD16 (ограничения оборудования)</LI>
<LI>AudioTrix Pro (ограничения оборудования)</LI>
<LI>CS4232 (ограничения оборудования)</LI>
</UL>
<P>
<H2><A NAME="ss6.5">6.5 Ошибка: No such file or directory (Нет такого файла или директории)</A>
для устройств звука</H2>

<P>Вам необходимо создать файлы устройства драйвера звука. Сотрите раздел о
создании файлов устройства. Если вы имеете файлы устройства, убедитесь, что
они имеют правильные первичные (major) и вторичные (minor) номера
(Некоторые старые дистрибутивы Linux могут не создавать правильные файлы
устройства в течении установки).
<P>
<H2><A NAME="ss6.6">6.6 Ошибка: No such device (Нет такого устройства) для устройств звука</A>
</H2>

<P>Либо вы не загрузили ядро содержащее драйвер звука, либо настройки
адресов портов ввода/вывода не соответствуют вашему
оборудованию. Проверьте, что вы загрузили скомпилированное ядро и
проверьте, что параметры которые вы ввели, когда настраивали драйвер звука,
соответствуют настройкам вашего оборудования.
<P>
<H2><A NAME="ss6.7">6.7 Ошибка: No space left on device (Не осталось места на устройстве)</A>
для устройств звука</H2>

<P>Это может случится, если вы попытаетесь записать данные в файлы
/dev/audio или /dev/dsp без создания необходимых
файлов устройства. В настоящее время устройство звука является регулярным
устройством и заполняет часть вашего диска. Вам необходимо запустить
скрипт, описанный в разделе <EM>Создание файлов устройства</EM> этого
документа.
<P>Это также может случаться с Linux 2.0 и более поздними если они не имеют
достаточное количество свободной памяти, когда устройство открыто. Драйвер
звука требует по крайней мере двух страниц (8k) непрерывной оперативной
памяти для каждого канала DMA. Это случается иногда на машинах, которые
имеют меньше чем 16M оперативной памяти или тех которые работают длительное
время.  Возможно освободить некоторое количество памяти откомпилировав и
запустив следующую C-программу до открытия устройства снова:
<P>
<BLOCKQUOTE><CODE>
<PRE>
main() {
  int i;
  char mem[500000];
  for (i = 0; i &lt; 500000; i++)
    mem[i] = 0;
  exit(0);
}
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss6.8">6.8 Ошибка: Device busy (Устройство занято) для устройств звука</A>
</H2>

<P>Только один процесс может открыть звуковое устройство. Скорее всего
какой-то другой процесс использует устройство. Один из путей определить
это&nbsp;-- использование команды <CODE>fuser</CODE>:
<P>
<BLOCKQUOTE><CODE>
<PRE>
% fuser -v /dev/dsp
/dev/dsp:             USER       PID ACCESS COMMAND
                      tranter    265 f....  tracker
</PRE>
</CODE></BLOCKQUOTE>
<P>В вышеприведенном примере, команда <CODE>fuser</CODE> показывает, что процесс
265 открыл устройство. Ожидание пока процесс не завершится или его
завершение (kill) позволит иметь доступ к устройству звука.  Вы должны
запустить команду <CODE>fuser</CODE> как администратор для того чтобы получить
информацию об использовании другими пользователями.
<P>В некоторых системах вы должны быть администратором, для запуска программы
<CODE>fuser</CODE>, для того, чтобы увидеть процессы других пользователей.
<P>
<H2><A NAME="ss6.9">6.9 Я все равно получаю ошибку: устройство занято!</A>
</H2>

<P>Согласно сведениям Brian Gough, для карт SoundBlaster, которые
используют DMA-канал 1, существует потенциальный конфликт с драйвером ленты
QIC-02, который также использует DMA 1, вызывая ошибки "device busy
(устройство занято)". Если вы используете FTAPE, у вас может быть разрешен
этот драйвер. Согласно информации в FTAPE-HOWTO, драйвер QIC-02 не является
необходимым для использования FTAPE; требуется только драйвер QIC-117.
Перенастройка ядра для использования QIC-117, а не QIC-02 позволит
сосуществовать FTAPE и драйверу звука.
<P>
<H2><A NAME="ss6.10">6.10 Частичное проигрывание звукового файла</A>
</H2>

<P>Обычный симптом&nbsp;-- звуковой пример играет около секунды и затем
останавливается полностью или выдает сообщение об ошибке "missing IRQ
(пропавшее IRQ)" или "DMA timeout (таймаут DMA)".  Вероятнее всего у вас
неправильные настройки IRQ или каналов DMA.  Проверьте, что настройки ядра
соответствуют установкам звуковой карты и что они не конфликтуют с другими
картами.
<P>Другой симптом <EM>зацикливание</EM> звука. Это обычно вызывается
конфликтом IRQ.
<P>
<H2><A NAME="ss6.11">6.11 Возникают паузы во время проигрывания файлов MOD</A>
</H2>

<P>
<P>Проигрывание MOD-файлов требует значительных мощи процессора. У
вас может быть запущено слишком много процессов или ваш компьютер может
быть слишком медленным для проигрывания в реальном времени. Вы можете
сделать следующее:
<P>
<UL>
<LI>попытаться проигрывать с более низкой скоростью дискретизации
или в моно режиме</LI>
<LI>убрать другие процессы</LI>
<LI>купить более мощный компьютер</LI>
<LI>купить более мощную звуковую карту (например Gravis UltraSound)</LI>
</UL>
<P>Если у вас карта Gravis UltraSound, вы должны использовать один из
проигрывателей mod-файлов написанных специально для GUS (например
<CODE>gmod</CODE>).
<P>
<H2><A NAME="ss6.12">6.12 Ошибки компиляции при компиляции звуковых приложений</A>
</H2>

<P>Версия 1.0c драйвера звука и более ранние использовали другую и
несовместимую схему <CODE>ioctl()</CODE>. Возьмите более свежую версию драйвера
звука или сделайте необходимые изменения для адаптации приложений к новому
драйверу звука. Для деталей смотрите файл Readme из поставки
звукового драйвера.
<P>Также убедитесь, что вы используете последние версии файлов
soundcard.h и ultrasound.h при компиляции
приложения. Смотрите инструкции по инсталляции в начале этого текста.
<P>
<H2><A NAME="ss6.13">6.13 SEGV при запуске звукового приложения, которое до этого работало</A>
</H2>

<P>Вероятно это та же проблема, что и описана в предыдущем вопросе.
<P>
<H2><A NAME="ss6.14">6.14 Какие известны ошибки или ограничения звукового драйвера?</A>
</H2>

<P>Смотрите файлы, включенные в исходные тексты звукового драйвера.
<P>
<H2><A NAME="ss6.15">6.15 Где документированы ioctl() и т.п. звукового драйвера?</A>
</H2>

<P>В настоящее время наилучшей документацией кроме исходного кода является
доступная с сервера 4Front Technologies 
<A HREF="http://www.opensound.com">http://www.opensound.com</A>. Другой источник документации&nbsp;--
<EM>Linux Multimedia Guide</EM>, описанное в разделе ссылок.
<P>
<H2><A NAME="ss6.16">6.16 Какие ресурсы процессора необходимы для проигрывания или</A>
записи без пауз?</H2>

<P>
<P>На этот вопрос не легко ответить, так как это зависит от:
<P>
<UL>
<LI>используете вы PCM дискретизацию или FM-синтез</LI>
<LI>скорость дискретизации и размер примера</LI>
<LI>какое приложение используется для проигрывания или записи</LI>
<LI>оборудование звуковой карты</LI>
<LI>скорость ввода/вывода диска, скорость процессора, размер
кэша, и т.п.</LI>
</UL>
<P>В общем, любая 386 машина легко должна проигрывать примеры или
FM-синтезированную музыку на 8-битной звуковой карте.
<P>Однако проигрывание MOD-файлов требует значительных ресурсов
процессораs. Некоторые экспериментальные измерения показывают, что
проигрывание на 44kHz требует более чем 40% скорости машины 486/50 и 386/25
может проигрывать едва быстрее чем 22 kHz (это все ч 8-битной звуковой
картой такой как SoundBlaster). Такие карты как Gravis UltraSound выполняют
больше функций сами, в железе, и будут требовать меньших ресурсов
процессора.
<P>Эти выводы предполагают, что компьютер не выполняет другие ресурсоемкие
задачи.
<P>Преобразование звуковых файлов или добавление эффектов, используя утилиты,
такие как <CODE>sox</CODE> также быстрее, если у вас установлен
математический сопроцессор (или CPU со встроенным FPU). Драйвер
сам не выполняет любых вычислений с плавающей точкой.
<P>
<H2><A NAME="ss6.17">6.17 Проблемы с PAS16 и адаптером SCSI Adaptec 1542</A>
</H2>

<P>(следующее объяснение было сделано <CODE>seeker@indirect.com</CODE>)
<P>Linux распознает адаптер 1542 только на адресе 330 (по умолчанию) или 334,
и PAS разрешает эмуляцию MPU-401 только на адресе 330.  Даже когда вы
программно запретите MPU-401, что-нибудь захочет конфликтовать с адаптером
1542 если выбран адрес по умолчанию.  Перестановка адаптера 1542 на адрес
334 сделает всех счастливыми.
<P>В качестве дополнения, и адаптер 1542 и PAS-16 используют 16-битное DMA,
так что если вы используете 16-bit 44 KHz стерео-звук и сохраняете файл на
SCSI-диск, установленный на адаптер 1542, вы будете иметь проблемы. Каналы
DMA перекрываются и не остается достаточного времени для обновления
оперативной памяти, так что вы получите ужасное сообщение ``PARITY ERROR -
SYSTEM HALTED (ОШИБКА ЧЕТНОСТИ - СИСТЕМА ОСТАНОВЛЕНА)'', без объяснений что
вызвало ее. Это ухудшается потому-что некоторые продавцы рекомендуют для
ленточных устройств QIC-117 времена on/off шины, такие что даже для 1542
они дольше, чем нормальные. Возьмите программу SCSISEL.EXE с Adaptec BBS
или с нескольких мест в internet, и уменьшайте время BUS ON или
увеличивайте время BUS OFF до тех пор пока проблема не исчезнет. SCSISEL
изменяет установки EEPROM, так что это более постоянно чем заплатка (patch)
к строке драйвера DOS в CONFIG.SYS, и будет работать правильно если вы
загрузитесь в Linux (в отличии от заплатки к DOS). Следующая проблема
решена.
<P>
<P>Последняя проблема - старые наборы микросхем Symphony резко уменьшали
синхронизацию циклов ввода/вывода для ускорения доступа к шине. Ни одна из
разных карт, которые я пробовал не имеет <EM>ни какой</EM> проблемы с
уменьшенной синхронизацией, исключая PAS-16.  На BBS Media Vision есть
SYMPFIX.EXE, который используется для решения этой проблемы путем изменения
диагностического бита в контроллере шины Symphony, но это не дает твердой
гарантии. Вы можете нуждаться в следующем:
<P>
<UL>
<LI>заставьте продавца материнской платы заменить старую версию
контроллера шины,</LI>
<LI>заменить материнскую плату, или</LI>
<LI>купить другой тип звуковой платы.</LI>
</UL>
<P>Young Microsystems обновляет импортируемые карты примерно за $30
(US); другие продавцы могут делать подобное, если вы сообщите кто произвел
или импортировал материнскую плату (желаю удачи). Что касается меня, то
проблема в микросхеме интерфейса шины ProAudio; <EM>никто</EM> не покупает
$120 звуковую карту и засовывает ее в 6MHz AT. Большинство их
используется в 25-40MHz 386/486 машинах, и должны по крайней мере
обслуживать скорость шины 12MHz, если микросхемы спроектированы правильно.
<P>
<P>Первая проблема зависит от набора микросхем, используемых на вашей
материнской плате, какая скорость шины и других настроек BIOS, а также фазы
луны. :-) Вторая проблема зависит от ваших настроек обновления памяти
(скрытая или синхронная), скорости DMA адаптера 1542 и (возможно) скорости
ввода/вывода шины. Третья может быть определена вызвав службу Media Vision
и спросив какой тип микросхемы Symphony несовместим с их замедленным
дизайном. Будьте осторожны, 3 из 4-х техников в которыми я говорил имеют
"повреждение мозга". Должен ли я доверять <EM>всему</EM>, что они сказали о
каком-то другом оборудовании, если они даже не знают свое собственное.
<P>
<H2><A NAME="ss6.18">6.18 Возможно ли читать и записывать примеры одновременно?</A>
</H2>

<P>
<P>Драйвера некоторых звуковых карт поддерживают полнодуплексный
режим. Посмотрите документацию доступную с 4Front Technologies для
получения информации о том как его использовать.
<P>
<H2><A NAME="ss6.19">6.19 Моя карта SB16 установлена на IRQ 2, но программа настройки не</A>
разрешает это значение.</H2>

<P>
<P>На 286 и поздних машинах, прерывание IRQ 2 каскадировано на второй
контроллер прерываний. Это эквивалентно IRQ 9.
<P>
<H2><A NAME="ss6.20">6.20 Если я запускаю Linux, затем загружаясь в DOS, я получаю ошибки</A>
и/или звуковые приложения не работают правильно.</H2>

<P>Это случается после "теплой" перезагрузки в DOS. Иногда сообщение об
ошибке обманчива показывает на плохой файл CONFIG.SYS.
<P>Большинство современных звуковых карт имеют программируемые настройку IRQ и
DMA. Если вы используете различные настройки в Linux и MS-DOS/Windows, это
может вызвать проблемы. Некоторые звуковые карты не принимают новые
параметры без полного сброса предыдущих (т.е. переключения питания или
использования кнопки сброса).
<P>Для быстрого решения этой проблемы необходимо выполнить полную перезагрузку
используя кнопку сброса (reset) или переключив питание вместо "теплой"
перезагрузки (например Ctrl-Alt-Del).
<P>Правильное решение убедится, что вы используете те же самые настройки IRQ и
DMA в MS-DOS и Linux (или не используйте DOS :-).
<P>
<H2><A NAME="ss6.21">6.21 Проблемы с запуском DOOM под Linux</A>
</H2>

<P>
<P>Пользователям игры DOOM компании ID software (версия для
Linux) могут быть интересны эти сведения.
<P>Для правильного вывода звука вам нужен звуковой драйвер версии 2.90 или
более поздней; он имеет поддержку для <CODE>DOOM режима</CODE>x реального
времени.
<P>Звуковые примеры являются 16-битными. Если у вас 8-битная звуковая карта вы
все равно можете иметь звук, используя разные программы, доступные на 
<A HREF="ftp://metalab.unc.edu/pub/Linux/games/doom">ftp://metalab.unc.edu/pub/Linux/games/doom</A>.
<P>Если производительность DOOM в вашей системе плоха, то запрет звука
(переименованием файла <CODE>sndserver</CODE>) может улучшить ее.
<P>По умолчанию DOOM не поддерживает музыку (как в версии DOS).  Программа
<CODE>musserver</CODE> добавит поддержку музыки в DOOM для Linux. Она может
быть найдена на 
<A HREF="ftp://pandora.st.hmc.edu/pub/linux/musserver.tgz">ftp://pandora.st.hmc.edu/pub/linux/musserver.tgz</A>.
<P>
<H2><A NAME="ss6.22">6.22 Как я могу уменьшить шум, испускаемый моей звуковой платой?</A>
</H2>

<P>
<P>Использование хороших, качественно изолированных кабелей и попытка
использования звуковой платы в разных слотах может помочь уменьшить
шум. Если звуковая карта имеет контроль громкости, вы можете
попытаться использовать разные настройки (вероятно максимальное значение
будет наилучшим). Используя программу микширования вы можете
убедится, что уровни устройств ввода (например микрофон) установлены в
нулевое значение.
<P>Philipp Braunbeck рассказал, что звуковые карты ESS-1868 имели
переключатель, для отключения встроенного усилителя, который помогал
уменьшить шум.
<P>В конце замечу, что на одной системе с процессором 386 я обнаружил, что
опция командной строки ядра <CODE>no-hlt</CODE> уменьшает уровень шума. Она
сообщает ядру, чтобы оно не использовало инструкцию halt при выполнении
цикла ожидания процессов. Вы можете попробовать это вручную или установить
используя команду <CODE>append="no-hlt"</CODE> в вашем файле конфигурации LILO.
<P>Некоторые звуковые карты просто не спроектированы с хорошей защитой и
заземлением и выдают шум.
<P>
<H2><A NAME="ss6.23">6.23 Я могу проигрывать звук, но не записывать.</A>
</H2>

<P>
<P>Если вы можете проигрывать звук, но не можете записывать, попробуйте
сделать следующие шаги:
<P>
<UL>
<LI> используйте программу микширования для выбора необходимого
устройства (например микрофона)</LI>
<LI> используйте микшер для установки уровней ввода на максимум</LI>
<LI>Если вы можете, попытайтесь протестировать работу записи
звуковой карты под MS-DOS для того, чтобы определить может это
аппаратная проблема</LI>
</UL>
<P>Иногда для записи и проигрывания звука используются разные каналы DMA. В
этом случае наиболее вероятная причина в том, что канал DMA для записи
установлен неправильно.
<P>
<H2><A NAME="ss6.24">6.24 Моя "совместимая" звуковая карта работает только если я сначала</A>
проинициализирую ее под MS-DOS.</H2>

<P>
<P>В большинстве случаев карты "совместимые с SoundBlaster" будет работать
лучше под Linux если ее настроить под драйвер отличный от
SoundBlaster. Большинство звуковых карт объявлено совместимыми (например
"совместимая с 16-битным SB Pro" or "SB совместимая 16 бит"), но обычно
этот режим SoundBlaster всего лишь "hack" сделанный для совместимости с
играми для DOS. Большинство карт имеют собственный 16-битный режим, который
скорее всего поддерживается недавними версиями Linux (2.0.1 и поздними).
<P>Только с некоторыми (обычно довольно старыми) картами необходимо попытаться
заставить работать их в режиме SoundBlaster. Только новейшие карты, которые
являются исключением из этого правила, являются картами основанными на
Mwave.
<P>
<H2><A NAME="ss6.25">6.25 Моя 16-битная "совместимая" с SoundBlaster звуковая карта работает</A>
только в 8-битном режиме под Linux.</H2>

<P>
<P>16-битные звуковые карты описанные как совместимые с SoundBlaster в
действительности совместимы только с 8-битной SoundBlaster Pro.
Типично они имеют 16-битный режим, который не совместим с
SoundBlaster 16 и не совместим с драйвером звука Linux.
<P>Вы можете заставить карту работать в 16-битном режиме используя драйвер
MAD16 или MSS/WSS.
<P>
<H2><A NAME="ss6.26">6.26 Где я могу найти звуковые приложения для Linux?</A>
</H2>

<P>
<P>Здесь перечислены хорошие архивные сервера для поиска звуковых приложений
специально для Linux:
<P>
<UL>
<LI> 
<A HREF="ftp://metalab.unc.edu/pub/Linux/kernel/sound/">ftp://metalab.unc.edu/pub/Linux/kernel/sound/</A></LI>
<LI> 
<A HREF="ftp://metalab.unc.edu/pub/Linux/apps/sound/">ftp://metalab.unc.edu/pub/Linux/apps/sound/</A></LI>
<LI> 
<A HREF="ftp://tsx-11.mit.edu/pub/linux/packages/sound/">ftp://tsx-11.mit.edu/pub/linux/packages/sound/</A></LI>
<LI> 
<A HREF="ftp://nic.funet.fi/pub/Linux/util/sound/">ftp://nic.funet.fi/pub/Linux/util/sound/</A></LI>
<LI> 
<A HREF="ftp://nic.funet.fi/pub/Linux/xtra/snd-kit/">ftp://nic.funet.fi/pub/Linux/xtra/snd-kit/</A></LI>
<LI> 
<A HREF="ftp://nic.funet.fi/pub/Linux/ALPHA/sound/">ftp://nic.funet.fi/pub/Linux/ALPHA/sound/</A></LI>
</UL>
<P>Также смотрите раздел Ссылки в этом документе.
<P>
<H2><A NAME="ss6.27">6.27 Может ли звуковой драйвер быть скомпилирован как загружаемый</A>
модуль?</H2>

<P>
<P>В недавно появившихся ядрах звуковой драйвер поддерживается как загружаемый
модуль.
<P>Для деталей смотрите файлы в каталоге
/usr/src/linux/drivers/sound/, особенно файлы
Introduction и /usr/src/linux/README.modules.
<P>
<H2><A NAME="ss6.28">6.28 Могу я использовать звуковую карту для замены сигнала системной</A>
консоли?</H2>

<P>
<P>Попробуйте программу <CODE>oplbeep</CODE>, которую можно найти на
<A HREF="ftp://metalab.unc.edu/pub/Linux/apps/sound/oplbeep-alpha.tar.gz">ftp://metalab.unc.edu/pub/Linux/apps/sound/oplbeep-alpha.tar.gz</A><P>Другим вариантом является программа <CODE>beep</CODE> доступная на 
<A HREF="ftp://metalab.unc.edu/pub/Linux/kernel/patches/misc/modreq_beep.tgz">ftp://metalab.unc.edu/pub/Linux/kernel/patches/misc/modreq_beep.tgz</A><P>Пакет <CODE>modutils</CODE> имеет пример программы и заплатку (patch)
для ядра, которая поддерживает вызов произвольной внешней программы
для генерации звука, когда требуется ядром.
<P>В качестве альтернативы на некоторых звуковых картах вы можете
соединить вывод PC speaker'а к звуковой карте, так что все звуки
будут выводится на динамики звуковой карты.
<P>
<H2><A NAME="ss6.29">6.29 Что такое VoxWare?</A>
</H2>

<P>
<P>Коммерческая версия звуковых драйверов, продаваемых компанией 4Front
Technologies была ранее известна под другими названиями, такими как
<EM>VoxWare</EM>, <EM>USS</EM> (Unix Sound System), и даже <EM>TASD</EM>
(Temporarily Anonymous Sound Driver). Теперь он продается как <EM>OSS</EM>
(Open Sound System). На версию, включенную в ядро Linux часто
ссылаются как на <EM>OSS/Free</EM>.
<P>Для большей информации смотрите страницу 4Front Technologies по
адресу 
<A HREF="http://www.4front-tech.com/">http://www.4front-tech.com/</A>. Я написал обзор
OSS/Linux в выпуске за Июнь 1997 
<A HREF="http://www.ssc.com/lj/">Linux Journal</A>.
<P>
<H2><A NAME="ss6.30">6.30 Sox/Play/Vplay сообщает "invalid block size 1024</A>
(неправильный размер блока 1024)"</H2>

<P>
<P>Изменения в драйвере звука в версии 1.3.67 некоторые программы проигрывания
звука, которые (неправильно) проверяли, что результат из ioctl
SNDCTL_DSP_GETBLKSIZE был больше чем 4096. Последние версии драйвера звука
были также исправлены, чтобы избегать выделения фрагментов короче чем 4096
байтов, которое решило эту проблему для старых утилит.
<P>
<H2><A NAME="ss6.31">6.31 Настройки микшера сбрасываются когда я загружаю модуль</A>
звукового драйвера</H2>

<P>
<P>Вы можете скомпилировать драйвер звука как загружаемый модуль и
использовать <CODE>kerneld</CODE> для того чтобы автоматически загружать и
выгружать его. Это может представить одну проблему - когда модуль
перезагружается установки микшера устанавливаются в значения по
умолчанию. Для некоторых звуковых карт это может быть слишком шумным
(например SoundBlaster16) или слишком тихим. Markus Gutschke
(<CODE>gutschk@uni-muenster.de</CODE>) нашел решение. Используйте подобную
строку в вашем файле /etc/conf.modules:
<P>
<BLOCKQUOTE><CODE>
<PRE>
options sound dma_buffsize=65536 &amp;&amp; /usr/bin/setmixer igain 0 ogain 0 vol 75
</PRE>
</CODE></BLOCKQUOTE>
<P>Это запустит вашу программу микширования (в этом случае <CODE>setmixer</CODE>)
немедленно после загрузки звукового драйвера.  Параметр
<CODE>dma_buffsize</CODE> это просто значение, необходимое потому-что команда
option требует опцию командной строки. Измените эту строку как необходимо
для соответствия вашей программе микширования и установкам уровней.
<P>Если вкомпилировали ваш драйвер звука в ядро и хотите установить уровни
микширования во время загрузки, вы можете поместить вызов вашей программы
микширования в стартовый файл системы такой как
/etc/rc.d/rc.local.
<P>
<H2><A NAME="ss6.32">6.32 Только администратор может записывать звук</A>
</H2>

<P>
<P>По умолчанию скрипт в файле Readme.linux, который создает файлы устройства
звука, разрешает чтение устройств только пользователю <CODE>root</CODE>. Это
затыкает потенциальную дыру в защите. В сетевой среде внешний пользователь
может удаленно войти в систему с звуковой картой и микрофоном и
подслушивать. Если вы не заботитесь об этом, вы можете изменить разрешения,
используемые в скрипте.
<P>С настройками по умолчанию, пользователи могут проигрывать звуковые
файлы. Это не риск безопасности, но потенциальная досада.
<P>
<H2><A NAME="ss6.33">6.33 Поддерживается ли звуковое оборудование IBM ThinkPad?</A>
</H2>

<P>
<P>Информация о том как использовать звуковую карту mwave на портативном
компьютере IBM ThinkPad под Linux может быть найдена в файле
/usr/src/linux/Documentation/sound/mwave, который является
частью дистрибутива исходного кода ядра.
<P>
<H2><A NAME="ss6.34">6.34 Приложение не работает, потому что на моей звуковой карте нет</A>
микшера</H2>

<P>Некоторый старые 8-битные карты SoundBlaster не имеют устройства
микширования. Некоторые звуковые приложения требуют возможности открыть
устройство микширования и поэтому не работают на таких картах. Jens Werner
(
<A HREF="mailto:werner@bert.emv.ing.tu-bs.de">werner@bert.emv.ing.tu-bs.de</A>) предложил решение, заключающееся в
создании ссылки с <CODE>/dev/mixer</CODE> на <CODE>/dev/null</CODE> и все должно
работать нормально.
<P>
<H2><A NAME="ss6.35">6.35 Проблемы с  SB16 CT4170</A>
</H2>

<P>
<P>Из сообщения Scott Manley (
<A HREF="mailto:spm@star.arm.ac.uk">spm@star.arm.ac.uk</A>):
<P>
<BLOCKQUOTE>
Кажется, что есть новый тип Soundblaster - он продается как SB16 - номер модели на 
карте равен CT4170. Эти штуки имеют только один канал DMA, так что если вы 
попытаетесь настроить ее, то у ядра будут проблемы с доступом к 16-битному каналу
DMA. Решением этой проблемы будет установка значения второго канала DMA равным 1,
так что карта будет вести себя как заявлено.
</BLOCKQUOTE>
<P>
<H2><A NAME="ss6.36">6.36 Как подключить MIDI-клавиатуру к звуковой карте</A>
</H2>

<P>Из письма Kim G. S. OEyhus (
<A HREF="mailto:kim@pvv.ntnu.no">kim@pvv.ntnu.no</A>):
<P>
<BLOCKQUOTE>
Я просмотрел много информации в internet и в документации на звуковую
систему, на предмет того как сделать такую простую вещь как подключение
MIDI-вывода с основной (master) клавиатуры к MIDI-вводу на звуковой карте. Я не
нашел ничего. Проблема в том, что они используют одно и тоже устройство,
/dev/midi, по крайней мере при использовании звуковой системы OSS. Я нашел
способ сделать это, которым я хочу поделится. Это создает очень простой
синтезатор, с полной поддержкой MIDI:
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
ПОДКЛЮЧЕНИЕ MIDI MASTER-КЛАВИАТУРЫ НАПРЯМУЮ К ЗВУКОВОЙ КАРТЕ С MIDI
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
MIDI master-клавиатура --- это клавиатура без любого синтезатора, и только
с разъемом MIDI-вывода. Он может быть подключен к 15-штырьковому D-SUB
порту на большинстве звуковых карт, с помощью подходящего кабеля.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Таким образом клавиатура может использоваться для управления устройством
синтезирования MIDI карты, создавая таким образом простой, контролируемый с 
клавиатуры синтезатор.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Откомпилируйте следующую программ с помощью команды 'gcc -o prog prog.c', и 
запустите ее:
</BLOCKQUOTE>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#include &lt;fcntl.h&gt;

main()
{
  int fil, a;
  char b[256];

  fil=open("/dev/midi", O_RDWR);
  for(;;)
    {
      a=read(fil, b, 256);
      write(fil, b, a);
    }
}
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss6.37">6.37 Проблемы с IRQ 15 и Ensoniq PCI 128</A>
</H2>

<P>
<P>Из письма Matthew Inger (
<A HREF="mailto:mattinger@mindless.com">mattinger@mindless.com</A>):
<P>
<BLOCKQUOTE>
Информация о том, как заставить работать карту Ensoniq PCI 128.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
 Проблема проявлялась в том, что карта по умолчанию использовала
прерывание 15 (за это отвечала подсистема Plug and Pray). Это прерывание
используется дополнительным контроллером ide, и не может быть
использоваться другими устройствами. Вам необходимо как то заставить es1370
использовать другое прерывание (например использовать прерывание 11, как
это делается в Windows).
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Я определил это для себя, вы можете верить или нет.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Что я для этого сделал:
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
a) в BIOS, вы должны указать, что у вас не Plug and Play операционная
система. Я нашел это в меню advanced options в моем BIOS.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
b) в меню PCI settings в BIOS, скажите компьютеру зарезервировать
прерывание 15 для обычных устройств ISA. В моем bios, под разделом
advanced options, есть раздел для настройки PCI. В нем есть область
Resource Exclusion и эта операция делается там.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
После загрузки в linux вы сможете использовать звук. (Я не помню,
показывается ли это в сообщениях при загрузке или нет). Для того, чтобы
быть уверенным, я запустил sndconfig, так что он должен был проиграть
тестовое сообщение, которое звучит не совсем хорошо, но оно есть. Однако
когда проиграл CD, он звучал великолепно.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Не беспокойтесь о Windows, я попробовал обе мои карты: ISA Modem, и
звуковую карту, и они работали без каких либо погрешностей.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
Может быть так, что ваш BIOS будет отличаться от моего, но вы должны найти
место, где находятся эти настройки. Всего хорошего.
</BLOCKQUOTE>
<P>
<H2><A NAME="ss6.38">6.38 Где я могу найти свободно доступные  MIDI заплатки для запуска SoftOSS?</A>
</H2>

<P>SoftOSS --- это программный  wavetable синтезатор, включенный в драйвер
звука ядра, так что он совместим с картой Gravis Utrasound. Для управления
драйвером вам нужны совместимые с GUS файлы заплаток для MIDI. В
документации отмечено, что "свободно доступные MIDI-заплатки доступны с
разных ftp серверов".
<P>Как объясняется на странице 4Front Technologies 
<A HREF="http://www.opensound.com/softoss.html">http://www.opensound.com/softoss.html</A> они могут быть загружены с 
<A HREF="ftp://archive.cs.umbc.edu/pub/midia/instruments.tar.gz">ftp://archive.cs.umbc.edu/pub/midia/instruments.tar.gz</A>.
<P>
<P>
<HR>
<A HREF="Sound-HOWTO-7.html">Следующий</A>
<A HREF="Sound-HOWTO-5.html">Предыдущий</A>
<A HREF="Sound-HOWTO.html#toc6">Содержание</A>
</BODY>
</HTML>
