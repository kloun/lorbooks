<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> The Linux Serial HOWTO : Я могу использовать более, чем два последовательных устройства?</TITLE>
 <LINK HREF="Serial-HOWTO-10.html" REL=next>
 <LINK HREF="Serial-HOWTO-8.html" REL=previous>
 <LINK HREF="Serial-HOWTO.html#toc9" REL=contents>
</HEAD>
<BODY>
<A HREF="Serial-HOWTO-10.html">Next</A>
<A HREF="Serial-HOWTO-8.html">Previous</A>
<A HREF="Serial-HOWTO.html#toc9">Contents</A>
<HR>
<H2><A NAME="s9">9. Я могу использовать более, чем два последовательных устройства?</A></H2>

<P> 
Вы не должны читать этот раздел, если не хотите использовать три или более
последовательных устройства ... (принимая, что у вас нет многопортовой платы).
<P> 
Если у вас есть другой запасной последовательный порт, то да, вы можете. Число 
последовательных портов, которые вы можете использовать, ограничено числом 
прерываний (IRQs) и адресов портов ввода-вывода. Это - ограничение не системы 
Linux, а ограничение шины PC. Каждому последовательному устройству должны быть 
назначены адрес и собственное прерывание.
<P> 
Если два устройства совместно используют одно и тоже прерывание, то они могут 
нормально работать, при условии, что эти два устройства не будут действовать 
одновременно. (В большинстве случаев, две программы не должны даже выполняться 
одновременно.) Последовательное устройство может быть последовательным портом, 
внутренним модемом или многопортовой последовательной платой.
<P> 
Многопортовые последовательные платы специально разработаны для получения
множества последовательных портов, которые совместно используют одно и то же
IRQ для всех последовательных портов на плате.
<P> 
Linux получает данные из них, используя различные адреса ввода-вывода для 
каждого порта на плате.
<P>
<P>
<H2><A NAME="ss9.1">9.1 Выбор прерываний последовательных устройств</A>
</H2>

<P> 
Обычный PC имеет ttyS0 и ttyS2 на IRQ 4, и ttyS1 и ttyS3 на IRQ 3. Вы можете 
увидеть, какие IRQs используются, напечатав: setserial /dev/ttyS2, и т.д. 
Просмотр /proc/interrupts покажет некоторых из них. Чтобы использовать более, 
чем два последовательных устройства, вы должны будете переназначить прерывания.
Хороший подход состоит в переназначении прерывания для параллельного порта. В 
PC обычно для ваших параллельных портов установлены прерывания IRQ 5 и IRQ 7,
но мало кто использует два параллельных порта. Вы можете переназначать одно из 
прерываний на последовательное устройство, и прекрасно использовать оставшийся
параллельный порт. чтобы сделать это, вам нужна будет программа setserial. 
Кроме того, вы должны поиграть с перемычками на матернской плате, свериться с
документацией на вашу плату. Установите перемычки на IRQ, который вы хотите 
назначить каждому порту.
<P> 
Вы должны установить все так, чтобы имелось одно и только одно прерывание 
для каждого последовательного устройства. Вот как Грэг устанавливает его в 
/etc/rc.d/rc.local - вы должны сделать это в файле, который выполняется после 
запуска:
<BLOCKQUOTE><CODE>
<PRE>
 
        /sbin/setserial /dev/ttyS0 irq 3        # моя последовательная мышь
        /sbin/setserial /dev/ttyS1 irq 4        # мой Wyse dumb терминал
        /sbin/setserial /dev/ttyS2 irq 5        # мой модем Zoom
        /sbin/setserial /dev/ttyS3 irq 9        # мой модем USR
</PRE>
</CODE></BLOCKQUOTE>
 
<P>Стандартные назначения IRQ:
<P>
<BLOCKQUOTE><CODE>
<PRE>
 
                 IRQ  0    Таймер, канал 0
                 IRQ  1    Клавиатура
                 IRQ  2    Cascade for controller 2
                 IRQ  3    Последовательный порт 2
                 IRQ  4    Последовательный порт 1
                 IRQ  5    Параллельный порт 2
                 IRQ  6    Накопитель на гибких дисках
                 IRQ  7    Параллельный порт 1
                 IRQ  8    Часы реального времени
                 IRQ  9    Перенаправлен на IRQ2
                 IRQ 10    не назначен
                 IRQ 11    не назначен
                 IRQ 12    не назначен
                 IRQ 13    Математический сопроцессор
                 IRQ 14    Накопитель на жестких дисках 1
                 IRQ 15    Накопитель на жестких дисках 2
</PRE>
</CODE></BLOCKQUOTE>
 
<P>В действительности нет никакого "правильного способа" назначения прерывания. 
Только удостоверьтесь, что оно не используется материнской платой или любыми 
другими платами.
<P> 
Номера прерываний 2, 3, 4, 5 или 7 - это хороший выбор. ``не назначен" означает,
что в настоящее время ничего стандартно не использует эти IRQS. Также обратите 
внимание, что IRQ 2 - это тоже, что и IRQ 9. Вы можете вызывать его или как 2 
или как 9, последовательный драйвер очень понятливый. Если у вас 
последовательная плата с 16-разрядным разъемом шины, то вы можете также 
использовать IRQ 10, 11, 12 или 15.
<P> 
Только удостоверьтесь, что вы не используете IRQ 0, 1, 6, 8, 13 или 14! Они 
используются вашей материнской платой. Вы модете заработать множество 
неприятностей, используя эти IRQ не по назначению. Когда вы закончите, 
посмотрите /proc/interrupts и удостоверьтесь, что конфликтов нет.
<P>
<P>
<H2><A NAME="ss9.2">9.2 Установка адресов последовательных устройств</A>
</H2>

<P> 
Затем, вы должны установить адрес порта. Проверьте в руководстве по вашей плате 
установки перемычек. Подобно прерываниям, одно последовательное устройство 
может иметь только один адрес. Ваши порты обычно будут приходить с такими
установками:
<P>
<BLOCKQUOTE><CODE>
<PRE>
 
        ttyS0 адрес 0x3f8
        ttyS1 адрес 0x2f8
        ttyS2 адрес 0x3e8
        ttyS3 адрес 0x2e8
</PRE>
</CODE></BLOCKQUOTE>
 
<P>Выберите адреса, которые вы хотите использовать для каждого последовательного 
устройства и соответственно установите перемычки. Мой модем установлен на 
ttyS3, мышь на ttyS0, а мой терминал на ttyS2.
<P> 
Когда вы перезагрузитесь, Linux должен увидеть ваши последовательные порты по 
тем адресам, на которые вы их установили. IRQ, который видит Linux, может не 
соответствовать IRQ, который вы устанавливаете перемычками. Не волнуйтесь об
этом. Linux не делает попыток определить IRQ при загрузке, потому что 
определение IRQ рисковано и может быть неправильным. Используйте setserial, 
чтобы сообщить Linux, какое IRQ используется портом. Вы можете проверить 
/proc/ioports, чтобы увидеть, какие адреса порта ввода-вывода используются
после загрузки Linux.
<P>
<P>
<HR>
<A HREF="Serial-HOWTO-10.html">Next</A>
<A HREF="Serial-HOWTO-8.html">Previous</A>
<A HREF="Serial-HOWTO.html#toc9">Contents</A>
</BODY>
</HTML>
