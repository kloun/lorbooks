<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Мини-HOWTO: Визуализация звукового сигнала</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Мини-HOWTO: Визуализация звукового сигнала</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Alessandro Rubini</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>rubini@linux.it</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
>Перевод: <A
HREF="mailto:pax@asp-linux.com"
TARGET="_top"
>Павел Гашев</A
>,
<A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
></H3
></DIV
><P
CLASS="PUBDATE"
>версия 2.2, 11 ноября 1997<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>В этом документе содержится информация о том, как визуализировать звуковой сигнал при помощи termcap.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Visual-Bell.html#AEN17"
>Введение</A
></DT
><DT
>2. <A
HREF="Visual-Bell.html#AEN21"
>Онемение</A
></DT
><DT
>3. <A
HREF="Visual-Bell.html#AEN26"
>Настройка звукового сигнала на каждой консоли</A
></DT
><DT
>4. <A
HREF="Visual-Bell.html#AEN50"
>Основные понятия Termcap и Terminfo</A
></DT
><DT
>5. <A
HREF="Visual-Bell.html#AEN81"
>Определение визуального сигнала</A
></DT
><DT
>6. <A
HREF="Visual-Bell.html#AEN96"
>Отключение звукового сигнала в текстовом режиме</A
></DT
><DT
>7. <A
HREF="Visual-Bell.html#AEN102"
>Заставляем приложение замолчать</A
></DT
><DT
>8. <A
HREF="Visual-Bell.html#AEN160"
>Другая сторона проблемы</A
></DT
><DT
>9. <A
HREF="Visual-Bell.html#AEN166"
>Авторские права</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN17"
>1. Введение</A
></H1
><P
>Драйвер консоли Linux производит звуковой сигнал каждый раз, когда выводится символ BEL (ASCII код 7). Это считается нормальным поведением, но некоторым пользователям не нравится, когда их компьютер начинает пищать. Это мини-HOWTO описывает, как указать приложениям не выводить символ BEL, и как заставить ядро и X-windows не пищать при выводе символа BEL. Замечу, что большая часть этого документа имеет отношение к текстовой консоли; тем не менее любой пользователь, работающий в графическом окружении, может легко понять, как настроить X-сервер.</P
><P
>Хотя, по-моему, лучший выход усмирить нервный компьютер - это отключить динамик (что я и сделал).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN21"
>2. Онемение</A
></H1
><P
>Онемение (лат. speakerotomy :-) - это самое лучшее решение нашей проблемы. Как следует из названия, она представляет из себя удаление звуковых сигналов путем удаления того, что издает эти сигналы. Операция довольна проста и не требует никаких анестезирующих средств.</P
><P
>Персональный компьютер обычно поставляется с идиотской кнопкой "Turbo", снижающей тактовую частоту процессора. Обычно она никогда не используется, за исключением случаев, когда вы хотите поиграть в старую-добрую игру времен XT. Т.е. обычно мы не используем эту кнопку по прямому назначению, но мы можем легко ее переделать для включения/выключения динамика, т.к. иногда динамик очень даже нужен (например, для уведомления о том, что закончилась продолжительная компиляция). Чтобы это сделать, просто отключите ее от материнской платы и подсоедините провода последовательно с динамиком.</P
><P
>К сожалению, пользователи портативных компьютеров не имеют доступа к динамику, кроме того, у них нет свободной кнопки для этого. Самое лучшее решение для таких пользователей - соответственно настроить программное обеспечение. Что мы и сделаем.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN26"
>3. Настройка звукового сигнала на каждой консоли</A
></H1
><P
>В Linux 1.3.43, Martin Mares, изменив <TT
CLASS="LITERAL"
>console.c</TT
>, добавил возможность настраивать частоту и длительность звукового сигнала. Каждая консоль, при помощи escape-последовательностей, может быть настроена на звуковой сигнал с разной частотой и/или длительностью. Вы можете изменить <TT
CLASS="LITERAL"
>~/.profile</TT
>
или <TT
CLASS="LITERAL"
>~/.login</TT
>, настроив разный сигнал для каждой консоли (или вообще его выключить).</P
><P
>Escape-последовательности следующие:

<P
></P
><UL
><LI
><P
>ESC-<TT
CLASS="LITERAL"
>[10;</TT
>xx<TT
CLASS="LITERAL"
>]</TT
> устанавливает частоту сигнала в герцах. Значение должно быть в диапазоне 21-32766. При отсутствии или неправильном значении `xx', устанавливается значение по умолчанию (750Гц).</P
></LI
><LI
><P
>ESC-<TT
CLASS="LITERAL"
>[11;</TT
>xx<TT
CLASS="LITERAL"
>]</TT
> устанавливает длительность звукового сигнала в миллисекундах. Опять же при отсутствии или неправильном значении `xx' устанавливается значение по умолчанию (125мс).</P
></LI
></UL
>&#13;</P
><P
>Например для установки звукового сигнала в 50Гц и длительностью в одну секунду, вы можете выполнить
"<TT
CLASS="LITERAL"
>echo -e "\\33[10;50]\\33[11;1000]"</TT
>" в <TT
CLASS="LITERAL"
>bash</TT
> (гдк "-e" означает `используются escape-последовательности'. Если вы пользуетесь <TT
CLASS="LITERAL"
>tcsh</TT
>, та же команда выгдядит так "<TT
CLASS="LITERAL"
>echo "\\033[10;50]\\033[11;1000]"</TT
>".</P
><P
>Насколько я знаю, команда <TT
CLASS="LITERAL"
>setterm</TT
> не поддерживает такую настройку, хотя вполне может быть, что будущие версии будут делать это.</P
><P
>Если у вас Linux-1.3.43 или выше, вас могут удовлетворить escape-последовательности, и можно не читать дальше. Если у вас старое ядро или вы хотите настроить визуальный сигнал, то вам понравится оставшаяся часть документа.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN50"
>4. Основные понятия Termcap и Terminfo</A
></H1
><P
><TT
CLASS="LITERAL"
>/etc/termcap</TT
> - это текстовый файл, описывающий возможности терминала 
(<TT
CLASS="LITERAL"
>term</TT
>inal <TT
CLASS="LITERAL"
>cap</TT
>abilities). Различные приложения используют
<TT
CLASS="LITERAL"
>termcap</TT
> для получения информации о том, как двигать курсор по экрану и т.д. <TT
CLASS="LITERAL"
>tcsh</TT
>, <TT
CLASS="LITERAL"
>bash</TT
>, <TT
CLASS="LITERAL"
>vi</TT
> и другие приложения, основанные на <TT
CLASS="LITERAL"
>curses</TT
>, используют базу данных <TT
CLASS="LITERAL"
>termcap</TT
>.</P
><P
>База данных описывает различные типы терминалов. Переменная окружения 
<TT
CLASS="LITERAL"
>TERM</TT
> указывает приложениям на соответствующий терминал в <TT
CLASS="LITERAL"
>termcap</TT
>.</P
><P
>Внутри базы данных каждая возможность терминала описывается двухбуквенным кодом и представляет из себя escape-последовательность, которую надо вывести, чтобы добиться желаемого эффекта. Для разделения используется символ двоеточия (":"). Например, звуковой сигнал с кодом "bl" обычно описывается как "<TT
CLASS="LITERAL"
>bl=&circ;G</TT
>". Это значит, что для звукового сигнала нужно вывести символ Ctrl-G (ASCII BEL).</P
><P
>В дополнении к <TT
CLASS="LITERAL"
>bl</TT
> поддерживается код <TT
CLASS="LITERAL"
>vb</TT
> Он описывает визуальный сигнал ("visible bell") и обычно отсутствует в файле <TT
CLASS="LITERAL"
>termcap</TT
> для терминала <TT
CLASS="LITERAL"
>linux</TT
>.</P
><P
>Большинство современных приложений и библиотек вместо <TT
CLASS="LITERAL"
>termcap</TT
> используют базу данных <TT
CLASS="LITERAL"
>terminfo</TT
>. Эта база данных описывает каждый вид терминала в отдельном файле из каталога <TT
CLASS="LITERAL"
>/usr/lib/terminfo</TT
>. Чтобы избежать использования каталога с большим количеством файлов, каждый файл находится в подкаталоге, названном по первой букве названия терминала; например, терминал <TT
CLASS="LITERAL"
>linux</TT
> описывается в файле <TT
CLASS="LITERAL"
>/usr/lib/terminfo/l/linux</TT
>. Чтобы создать запись в
<TT
CLASS="LITERAL"
>terminfo</TT
>, вы должны "откомпилировать" описание <TT
CLASS="LITERAL"
>termcap</TT
> (<TT
CLASS="LITERAL"
>man tic</TT
>).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN81"
>5. Определение визуального сигнала</A
></H1
><P
>Вы можете добавить запись <TT
CLASS="LITERAL"
>vb</TT
> в файл termcap, если там ее еще нет. Dennis Henriksen (duke@diku.dk) предложил вставлять в
<TT
CLASS="LITERAL"
>termcap</TT
> для терминала <TT
CLASS="LITERAL"
>linux</TT
> (в старых дистрибутивах
<TT
CLASS="LITERAL"
>console</TT
>) следующую строку:

<PRE
CLASS="SCREEN"
>:vb=\E7\E[?5h\E[?5l\E[?5h\E[?5l\E[?5h\E[?5l\E[?5h\E[?5l\E8:\</PRE
>

Последняя наклонная черта необходима, чтобы избежать перевод строки в файле базы данных. Эта строка выполняет следующее (по словам Dennis'а):

<P
></P
><UL
><LI
><P
>Сохраняем позицию курсора (просто мера предосторожности).</P
></LI
><LI
><P
>Несколько раз меняем цвет фона с нормального на реверсный и обратно.</P
></LI
><LI
><P
>Восстанавливаем позицию курсора.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN96"
>6. Отключение звукового сигнала в текстовом режиме</A
></H1
><P
>Если вы хотите использовать визуальный сигнал вместо звукового, определите в
<TT
CLASS="LITERAL"
>termcap</TT
> "<TT
CLASS="LITERAL"
>bl</TT
>" так же, как "<TT
CLASS="LITERAL"
>vb</TT
>" из предыдущего раздела. Этот метод удобен, если вы не хотите настраивать каждое приложение (впрочем, это все равно описывается ниже). Я использую этот способ на всех машинах, где не могу отключить динамик.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN102"
>7. Заставляем приложение замолчать</A
></H1
><P
>Вот незаконченный список приложений, которые можно заставить использовать визуальный сигнал вместо звукового:</P
><P
>&#13;<P
></P
><UL
><LI
><P
>X-сервер: используйте команду "<TT
CLASS="LITERAL"
>xset b</TT
>", чтобы определить параметры звукового сигнала. Она имеет три числовых аргумента: громкость, частоту и длительность. Кроме того, "<TT
CLASS="LITERAL"
>xset -b</TT
>" вообще выключат звуковой сигнал. Эта настройка оказывает влияние на все приложения, запущенные на данном X-сервере.&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>xterm</TT
>: xterm может преобразовывать визуальный и звуковой сигнал из одного в другой. В
<TT
CLASS="LITERAL"
>xterm</TT
> сигнал по умолчанию - звуковой, но вы можете использовать "<TT
CLASS="LITERAL"
>xset -vb</TT
>" или изменить ресурс "<TT
CLASS="LITERAL"
>xterm*visualBell: true</TT
>", чтобы превратить звуковой сигнал в визуальный. Для переключения визуального/звукового сигнала, можно также использовать меню, вызываемое Ctrl-левая_кнопка_мыши. Если вы работаете в основном под X-windows, дальнейшая информация может не понадобиться.
&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>tcsh</TT
> (6.04 и выше): "<TT
CLASS="LITERAL"
>set visiblebell</TT
>". Команда может быть помещена в <TT
CLASS="LITERAL"
>.cshrc</TT
> или введена вручную. "<TT
CLASS="LITERAL"
>unset visiblebell</TT
>" снова включает звуковой сигнал. Чтобы вообще выключить любые сигналы, используйте "<TT
CLASS="LITERAL"
>set nobeep</TT
>".&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>bash</TT
> (любой bash, насколько я знаю): поместите "<TT
CLASS="LITERAL"
>set bell-style
visible</TT
>" в <TT
CLASS="LITERAL"
>&tilde;/.bashrc</TT
>. Возможные типы сигналов также "none" или "audible".&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>bash</TT
> (С <TT
CLASS="LITERAL"
>readline</TT
>, как и для других приложений основанных на <TT
CLASS="LITERAL"
>readline</TT
>
): поместите "<TT
CLASS="LITERAL"
>set prefer-visible-bell</TT
>" в
<TT
CLASS="LITERAL"
>&tilde;/.inputrc</TT
>.&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nvi</TT
> и <TT
CLASS="LITERAL"
>elvis</TT
>: поместите "<TT
CLASS="LITERAL"
>set flash</TT
>" в
<TT
CLASS="LITERAL"
>&tilde;/.exrc</TT
> или наберите "<TT
CLASS="LITERAL"
>:set flash</TT
>" вручную. Чтобы выключить звуковой сигнал, введите <TT
CLASS="LITERAL"
>noflash</TT
> вместо <TT
CLASS="LITERAL"
>flash</TT
>.&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>emacs</TT
>: поместите "<TT
CLASS="LITERAL"
>(setq visible-bell t)</TT
>" в
<TT
CLASS="LITERAL"
>&tilde;/.emacs</TT
>. Чтобы выключить - "<TT
CLASS="LITERAL"
>(setq visible-bell
nil)</TT
>".&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>less</TT
>: используйте опцию "<TT
CLASS="LITERAL"
>-q</TT
>" для визуального сигнала, и "<TT
CLASS="LITERAL"
>-Q</TT
>" вообще без сигналов. Опции по умолчанию могут быть помещены в переменную окружения "<TT
CLASS="LITERAL"
>LESS</TT
>".&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>screen</TT
>: CtrlA-CtrlG меняет поведение всех виртуальных экранов. Чтобы установить это по умолчанию, см. man screen раздел "НАСТРОЙКА" ("CUSTOMIZATION").&#13;</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN160"
>8. Другая сторона проблемы</A
></H1
><P
>Есть плохие новости. Не каждое приложение использует <TT
CLASS="LITERAL"
>termcap</TT
> или
<TT
CLASS="LITERAL"
>terminfo</TT
>. Большинство маленьких программ используют символы '\a' (alarm) прямо в исходном тексте на C. Во время выполнения программы этот символ превращается в ASCII BEL. Реальное приложение обычно не падает под эту категорию, но остерегайтесь новичков в C, дающих вам свои программы. Из них хуже всего студенты, изучающие информатику.</P
><P
>Единственный путь заставить эти программы замолчать - это онемение, или использование escape-последовательностей Martin'а Mares'а.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN166"
>9. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
></DIV
></BODY
></HTML
>