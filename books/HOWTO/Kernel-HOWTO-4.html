<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux Kernel HOWTO: Компиляция ядра</TITLE>
 <LINK HREF="Kernel-HOWTO-5.html" REL=next>
 <LINK HREF="Kernel-HOWTO-3.html" REL=previous>
 <LINK HREF="Kernel-HOWTO.html#toc4" REL=contents>
</HEAD>
<BODY>
<A HREF="Kernel-HOWTO-5.html">Следующий</A>
<A HREF="Kernel-HOWTO-3.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc4">Содержание</A>
<HR>
<H2><A NAME="s4">4. Компиляция ядра</A></H2>

<H2><A NAME="ss4.1">4.1 Очистка и создание зависимостей</A>
</H2>

<P>Когда настроечный скрипт закончит свою работу, он также скажет вам, чтобы 
вы выполнили `<CODE>make dep</CODE>' и (вероятно) `<CODE>clean</CODE>'. Так что
выполните `<CODE>make dep</CODE>'. Он обеспечит, чтобы все зависимости, такие
как файлы заголовков, находятся на месте. Эта процедура не длиться долго,
если у вас не медленный компьютер. Для более старых версий ядер, при
окончании вы должны выполнить `<CODE>make clean</CODE>'. Эта процедура удаляет
все объектные файлы и некоторые другие вещи оставшиеся от предыдущей
компиляции. В любом случае, <I>не</I> забывайте выполнить этот шаг до
начала перекомпиляции ядра. 
<P>
<H2><A NAME="ss4.2">4.2 Время компиляции</A>
</H2>

<P>После выполнения <CODE>dep</CODE> и <CODE>clean</CODE>, вы можете выполнять
`<CODE>make zImage</CODE>' или `<CODE>make zdisk</CODE>' (эта часть процесса
занимает длительное время). `<CODE>make zImage</CODE>' скомпилирует ядро и
оставит в директории <CODE>arch/i386/boot</CODE> файл названный
`<CODE>zImage</CODE>' (среди других вещей). Это новое сжатое ядро. `<CODE>make
zdisk</CODE>' делает тоже самое, но также помещает новый файл <CODE>zImage</CODE> 
на гибкий диск, который вы должны вставить в устройство
``A:''. `<CODE>zdisk</CODE>' является довольно удобным для тестирования новых
ядер; если оно не загружается (или просто работает неправильно), то просто
вытащите дискету из дисковода и загрузитесь со старым ядром. Это может быть 
также удобным в том случае, если вы случайно удалили ядро (или сделали
что-нибудь подобное по своему разрушительному действию). Вы также можете
использовать его для установки новых систем, в том случае когда вы просто
делаете дамп с одного диска на другой(``это все и больше! Теперь, сколько
вы могли бы купить?''). 
<P>
<P>Все, даже сравнительно недавние ядра являются сжатыми, поэтому они имеют
букву `<CODE>z</CODE>' в начале имени. Сжатое ядро автоматически разжимается
при выполнении.
<P>
<H2><A NAME="ss4.3">4.3 Другие вещи, можно сделать с помощью ``make''</A>
</H2>

<P>`<CODE>make mrproper</CODE>' выполнит более интенсивную очистку дерева
исходных текстов. Иногда она является необходимой; вы можете выполнять эту
команду после каждого наложения заплаток. `<CODE>make mrproper</CODE>' также
удалит ваши файлы конфигурации, так что вы можете захотеть сохранить
резервную копию вашего файла (<CODE>.config</CODE>), если вы считаете его
ценным. 
<P>
<P>`<CODE>make oldconfig</CODE>' попытается настроить ваше ядро используя
старый файл настроек; он проделает путь по процессу конфигурации `<CODE>make
config</CODE>' вместо вас. Если у вас нет скомпилированного ядра или у вас
нет старого файла настроек, то вам скорее всего не надо делать этой
операции, поскольку вы вероятно захотите изменить настройки по умолчанию. 
<P>
<P>Смотрите раздел о модулях для описания операции `<CODE>make modules</CODE>'.
<P>
<H2><A NAME="ss4.4">4.4 Установка ядра</A>
</H2>

<P>После того как вы установили, что новое ядро работает так как вам надо,
наступает время его установки. Большинство людей для этого использует LILO
(Загрузчик Linux). Команда `<CODE>make zlilo</CODE>' установит новое ядро,
запустит для него LILO, и все будет готово к перезагрузке, НО ТОЛЬКО если
lilo настроено правильно в вашей системе: ядро располагается в файле
<CODE>/vmlinuz</CODE>, lilo находится в директории <CODE>/sbin</CODE>, и ваш
конфигурационный файл lilo (<CODE>/etc/lilo.conf</CODE>) отражает эти условия. 
<P>
<P>Иначе вам придется использовать LILO непосредственно. Это довольно
легкий в установке и в работе пакет, но он имеет тенденцию вводить в
замешательство людей своим конфигурационным файлом. Посмотрите
конфигурационный файл (либо <CODE>/etc/lilo/config</CODE> для старых версий
либо <CODE>/etc/lilo.conf</CODE> для более новых версий), и посмотрите текущие
настройки. Конфигурационный файл выглядит примерно так:
<P>
<PRE>
    image = /vmlinuz
        label = Linux
        root = /dev/hda1
        ...
</PRE>
<P>`<CODE>image =</CODE>' указывает на установленное в настоящее время
ядро. Большинство людей используют <CODE>/vmlinuz</CODE>. `<CODE>label</CODE>'
используется для определения какое ядро или операционная система будет
загружаться, и `<CODE>root</CODE>' это корневой раздел отдельной операционной
системы. Сделайте резервную копию вашего ядра и скопируйте только что
сделанное ядро на его место (вы должны выполнить команду `<CODE>cp zImage
/vmlinuz</CODE>' если вы используете `<CODE>/vmlinuz</CODE>'). Затем
перезапустите lilo -- на более новых системах вы можете просто запустить
`<CODE>lilo</CODE>', но на старых вы должны выполнить
<CODE>/etc/lilo/install</CODE> или даже <CODE>/etc/lilo/lilo -C
/etc/lilo/config</CODE>.
<P>
<P>Если вы хотите знать больше о настройке LILO или у вас его нет, то
возьмите самую новую его версию с вашего любимого сервера ftp и следуйте
инструкциям. 
<P>
<P>Для загрузки одного из ваших старых ядер на жестком диске (еще один
способ обезопасить себя при использовании нового ядра), скопируйте
нижеприведенные строки (и включите) `<CODE>image = xxx</CODE>' в файл
конфигурации LILO в конце файла, и измените `<CODE>image = xxx</CODE>' на
`<CODE>image = yyy</CODE>', где `<CODE>yyy</CODE>' это полный путь вашего старого
ядра. Затем измените `<CODE>label = zzz</CODE>' на `<CODE>label =
linux-backup</CODE>' и перезапустите <CODE>lilo</CODE>. Вам может быть будет
необходимо поместить строку в конфигурационный файл, которая выглядит так
`<CODE>delay=x</CODE>', где x это количество десятых долей секунды, на которое
LILO задержится до загрузки, так что вы можете прервать его выполнение
(например при помощи клавиши  shift), и набрать метку имя сохраненного
образа загрузки (в случае, если произойдут разные неприятные вещи).
<P>
<HR>
<A HREF="Kernel-HOWTO-5.html">Следующий</A>
<A HREF="Kernel-HOWTO-3.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc4">Содержание</A>
</BODY>
</HTML>
