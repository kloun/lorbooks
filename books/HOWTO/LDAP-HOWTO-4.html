<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>LDAP Linux HOWTO: Запуск LDAP сервера</TITLE>
 <LINK HREF="LDAP-HOWTO-5.html" REL=next>
 <LINK HREF="LDAP-HOWTO-3.html" REL=previous>
 <LINK HREF="LDAP-HOWTO.html#toc4" REL=contents>
</HEAD>
<BODY>
<A HREF="LDAP-HOWTO-5.html">Next</A>
<A HREF="LDAP-HOWTO-3.html">Previous</A>
<A HREF="LDAP-HOWTO.html#toc4">Contents</A>
<HR>
<H2><A NAME="4"></A> <A NAME="s4">4. Запуск LDAP сервера</A></H2>

<P>slapd может быть запущен в двух различных режимах: как автономный (stand-alone) сервис и из под inetd(8). Рекомендуется использовать автономный режим, особенно если в качестве базы данных Вы используете базу LDBM. Это позволяет базе использовать все преимущества кеширования, и избежать проблем совпадений в индексных файлах LDBM. Если Вы используете только PASSWD или SHELL базы, запуск из iinetd может быть приемлемым вариантом.
<P>
<H2><A NAME="4.1"></A> <A NAME="ss4.1">4.1 Параметры Коммандной Строки</A>
</H2>

<P>slapd предполагает следующие параметры в коммандной строке:
<P>
<BLOCKQUOTE><CODE>
<PRE>
-d &lt;level&gt; | ? 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр устанавливает отладочный уровень slapd в &lt;level&gt;. Когда в качестве level стоит символ ?, slapd распечатывает все доступные уровни и заканчивает работу независимо от остальных установленных параметров. Сейчас доступны следующие уровни отладки:
<BLOCKQUOTE><CODE>
<PRE>
1 трассировка вызова функций 
2 обработка отладочных пакетов 
4 детальная отладочная трассировка 
8 управление соединениями 
16 протоколирование входящих и исходящих пакетов 
32 обработка фильтра поиска 
64 обработка конфигурационного файла 
128 обработка параметров доступа 
256 протокол статистики соединения/обработка/результаты 
512 протокол статистики отсылаемых статей 
1024 протокол взаимодействия с shell 
2048 протокол отладочной информации парсера различных элементов 
65535 режим полной отладки
</PRE>
</CODE></BLOCKQUOTE>

Уровни отладки адитивны. Т.е., если Вы хотите оттрассировать вызовы функций и посмотреть обработку конфигурационного файла, в качесте уровня отладки Вы устанавливаете сумму интересующих уровней (в этом случае 65). Для более детальной информации см. &lt;ldap.h&gt;.
Заметьте, что для того, чтобы все эти уровни (за исключением статистики) были доступны, slapd должен быть собран с ключем -DLDAP_DEBUG.
<P>
<BLOCKQUOTE><CODE>
<PRE>
-f &lt;filename&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет альтернативный конфигурационный файл для slapd.
<P>
<BLOCKQUOTE><CODE>
<PRE>
-i 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр указывает slapd, что он запускается из под inetd, а не как автономный сервер. В следующем разделе Вы найдетее больше информации о работе slapd из под inetd. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
-p &lt;port&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет альтернативный ТСP порт, на котором slapd должен отвечать на соединения. Порт по умолчанию - 389. 
<P>
<H2><A NAME="4.2"></A> <A NAME="ss4.2">4.2 Запуск slapd в качестве автономного демона</A>
</H2>

<P>В общем slapd запускается следующим образом:
<BLOCKQUOTE><CODE>
<PRE>
$(ETCDIR)/slapd [&lt;option&gt;]* 
</PRE>
</CODE></BLOCKQUOTE>
<P>где ETCDIR имеет значение, которое Вы задали в файле Make-common или передали скрипту configureперед сборкой, а &lt;option&gt; один из вышеописанных параметров. Если Вы только не задали уровень отладки, slapd автоматически отсоединяется от контрольного терминала, и используя fork переходит в режим демона.
При такой форме запуска, slapd можно передавать любые из рассмотренных выше параметров, как то ТСР порт, другой конфигурационный файл и т.д.
<P>Вот пример запуска slapd:
<BLOCKQUOTE><CODE>
<PRE>
$(ETCDIR)/slapd -f /home/malere/myslapd.conf -d 255 
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss4.3">4.3 Запуск slapd из под inetd</A>
</H2>

<P>Перво-наперво убедитесь в том, что запуск из под inetd действительно необходим. Если Вы используете LDBM, это не так. Если Вы работаете в требовательной к ресурсам системе, то накладные расходы от работы из под inetd, также переводят эту идею в разряд плохой. В противном случае, для достижения цели необходимо сделать два шага.
<P>Шаг 1, добавить следующую строку в файл /etc/services:
<BLOCKQUOTE><CODE>
<PRE>
ldap 389 # ldap directory service 
</PRE>
</CODE></BLOCKQUOTE>
<P>Шаг 2, добавить следующую строку в файл /etc/inetd.conf:
<BLOCKQUOTE><CODE>
<PRE>
ldap stream tcp nowait nobody $(ETCDIR)/slapd slapd -i 
</PRE>
</CODE></BLOCKQUOTE>
<P>где ETCDIR имеет значение, которое Вы задали в файле Make-common или передали скрипту configureперед сборкой. В качестве финального акта пошлите HUP процессу inetd, и Вы получили то, что хотели.
<P>
<HR>
<A HREF="LDAP-HOWTO-5.html">Next</A>
<A HREF="LDAP-HOWTO-3.html">Previous</A>
<A HREF="LDAP-HOWTO.html#toc4">Contents</A>
</BODY>
</HTML>
