<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> Text-Terminal-HOWTO : terminfo и termcap (подробно)</TITLE>
 <LINK HREF="Text-Terminal-HOWTO-14.html" REL=next>
 <LINK HREF="Text-Terminal-HOWTO-12.html" REL=previous>
 <LINK HREF="Text-Terminal-HOWTO.html#toc13" REL=contents>
</HEAD>
<BODY>
<A HREF="Text-Terminal-HOWTO-14.html">Next</A>
<A HREF="Text-Terminal-HOWTO-12.html">Previous</A>
<A HREF="Text-Terminal-HOWTO.html#toc13">Contents</A>
<HR>
<H2><A NAME="s13">13. terminfo и termcap (подробно)</A> </H2>

<P>
<H2><A NAME="ss13.1">13.1 Введение</A>
 </H2>

<P>terminfo (прежде termcap) - база данных возможностей терминала и больше того. 
Для каждой (ну, почти) модели терминала он сообщает прикладным программам, что 
может выполнять терминал. Он сообщает то, какие escape-последовательности (или 
управляющие символы) посылать терминалу, чтобы делать вещи типа перемещения 
курсор в новое положение, стирания части экрана, пролистывания экрана, смены 
режима, изменения вида изображения (цветность, яркость, мигание, подчеркивание, 
негативное изображение и т.д.). После 1980 года многие терминалы стали 
поддерживать более сотни таких команд.
<P>
<P>
<H2><A NAME="ss13.2">13.2 База данных terminfo  </A>
</H2>

<P>База данных terminfo компилируется и таким образом имеет исходную часть и 
скомпилированную часть. Старая база данных termcap имеет только исходную часть, 
но этот источник может быть и преобразован в источник terminfo, и затем 
скомпилирован одной командой. Чтобы увидеть, есть ли ваш терминал (скажем, 
vt100) в базы данных terminfo, напечатайте "locate vt100 ". Это команда может 
выдать /usr/lib/terminfo/v/vt100 или /usr/share/terminfo/v/vt100, которые 
являются возможными расположениями скомпилированных файлов terminfo. Некоторые 
старые программы могут ожидать, что они будут находитсья в каталоге 
/etc/terminfo.
<P>Исходный текст, который вы используете, может постоянно находиться в 
/etc/termcap и/или в terminfo.src. См. man-страницы: terminfo (5) или termcap 
(5), в которых описан формат, требуемый для создания (или изменения) этих 
файлов. Файл terminfo.src может быть расположен в других мастах, или вовсе может 
не быть включен в ваш дистриьутив linux. Чтобы попробовать найти его, 
используйте команду locate.  Можно скачать из Интернет (под именем termtypes.ti) 
из 
<A HREF="http://www.linux.org.ru/books/HOWTO/locke.ccil.org/~esr/terminfo">locke.ccil.org/~esr/terminfo</A><P>
<P>
<H3>Компилятор terminfo(tic) </H3>

<P>Данные в исходных файлах компилируются программой "tic", которая может  
преобразовывать формат termcap в/из формат terminfo.
<P>Таким образом вы можете создавать скомпилированную базу данных terminfo из  
исходного текста termcap.
<P>Программа установки, которая использовалась для установки Linux, вероятно 
установила скомпилированные файлы на ваш жесткий диск, так что вы не должны 
компилировать что-либо, если не изменяете /etc/termcap (или terminfo.src).
<P>"tic" автоматически установит возникающие в результате компиляции файлы в 
каталог terminfo, готовые для использования прикладными программами.
<P>
<P>
<H3>Рассмотрим ваш terminfo </H3>

<P>Это хорошая идея - рассмотреть вашу запись termcap/terminfo (исходный текст 
конечно) и прочитать комментарии. Быстрый способ посмотреть его без комментариев 
- только напечатайте "infocmp". Но комментарии могут сообщить вам нечто особое о 
терминале типа того, как вы должны установить его, чтобы он правильно работал с 
базой данных terminfo.
<P>
<P>
<H3>Удаление ненужных данных </H3>

<P>Чтобы сохранять дисковое пространство, можно удалить всю базу данных, кроме 
типов терминалов, которые у вас есть. Не удаляйте ничего из Linux termcap или 
xterm, если вы используете X-Window. Терминал типа "dumb" используется когда 
прикладная программа не может выяснять какой терминал вы используете. Если бы 
программы установки устанавливали terminfo только для терминалов, которые вы 
имеете, и если бы вы могли бы получать termcap для недавно установленного 
терминала за доли секунд из Интернет, то это сберегло бы дисковое пространство 
вашего жесткого диска.
<P>
<P>
<H2><A NAME="ss13.3">13.3 Инициализация</A>
 </H2>

<P>Часто в terminfo включены пара строк инициализации, которые могут быть посланы 
терминалу для его инициализации. Он могут изменять вид экрана, изменять режим, в 
коором работает терминал и/или заставить терминал эмулировать другой терминал. 
Строки инициализации автоматически не отсылаются терминалу, чтобы 
проинициализировать его.
<P>Чтобы сделать это, вы должны использовать команду, вводимую в командной строке 
(или в скрипте оболочки) типа: "tset", "tput init" или "setterm -initialize". 
Иногда ненужно посылать init-строку, так как терминал может устанавливать сам 
себя правильно, когда включаяется (используя опции/парметры, которые установлены 
и сохранены в энергонезависимой памяти  терминала).
<P>
<P>
<H2><A NAME="ss13.4">13.4 Переменная TERM</A>
 </H2>

<P>Переменная окружения TERM должна быть установлена по типу терминала, который вы 
используете. Обычно она устанавливается параметром terminal_type, переданным 
программе getty (посмотрите это в файле /etc/inittab
<P>Это имя должно быть в базе данных terminfo. Только напечатайте "set" в командной 
строке, чтобы видеть, какой значение присвоено TERM (или напечатайте: tset -q). 
В консоли (мониторе) TERM установлен в "linux", который является монитором PC, 
подражающим модели несуществующего терминала по имени  "linux". Так как "linux"  
близок к терминалу vt100, а также ко многим другим текстовым терминалам, то 
обозначение "linux" будет иногда работать как временное с текстовым терминалом.
<P>Если на один и тот же порт могут быть подсоединено более одного типа терминала
(/dev/tty ...) (например, если имеется переключатель, разрешающий использовать 
различные типы терминалов на одном и том же самом последовательном порту, или 
если порт соединен с модемом, на который звонят люди с различных типов 
терминалов), тогда TERM нужно устанавливать каждый раз, когда кто-то 
соединяется с последовательным портом. Часто имеется escape-последовательность 
запроса такая, чтобы компьютер мог запрашивать у терминала его тип. Другой 
способ состоит в том, чтобы попросить пользователя напечатать (или выбрать) 
тип своего терминала.
<P>Возможно для этого действия вам понадобиться использовать tset в коротком 
скрипте shell.
<P>Один способ сделать это состоит в том, чтобы использовать "tset" (см. man).
Tset пробует определить имя терминала, который вы используете. Затем он ищет 
данные в terminfo и посылает вашему терминалу init строку.
<P>Также можно устанавливать значение TERM. Например, пользователь звонит и
и регистрируется в системе. Выполняется скрипт регистрации в системе .profile, 
который содержит внутри себя следующее выражение: eval `tset -s? Vt100`. Это 
приводит к следующему: пользователя спрашивают, использует ли он(а) vt100. 
Пользователь или отвечает да или печатает имя фактически используемого 
терминала. Затем tset посылает init строку и устанавливает TERM в это имя (тип)
терминала.
<P>
<P>
<H2><A NAME="ss13.5">13.5 Termcap документы</A>
</H2>

<P>
<UL>
<LI>  The Termcap Manual 
<A HREF="http://www.delorie.com/gnu/docs/termcap/termcap_toc.html">http://www.delorie.com/gnu/docs/termcap/termcap_toc.html</A>
от Richard M. Stallman -- это руководство GNU.
</LI>
<LI>  man terminfo (5) и/или termcap (5).
</LI>
<LI>  /etc/termcap (файл) или terminfo.src содержит информацию о различных 
версиях termcap файлов, именные соглашения для терминалов и коды специальных
возможностей, называемые u6-u9
</LI>
<LI>  "Termcap and Terminfo " -- книга, изданная O'Reilly в 1988.</LI>
</UL>
<P>
<HR>
<A HREF="Text-Terminal-HOWTO-14.html">Next</A>
<A HREF="Text-Terminal-HOWTO-12.html">Previous</A>
<A HREF="Text-Terminal-HOWTO.html#toc13">Contents</A>
</BODY>
</HTML>
