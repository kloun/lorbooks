<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux IPCHAINS-HOWTO: Приложение. Различия между ipchains и ipfwadm.</TITLE>
 <LINK HREF="Ipchains-HOWTO-9.html" REL=next>
 <LINK HREF="Ipchains-HOWTO-7.html" REL=previous>
 <LINK HREF="Ipchains-HOWTO.html#toc8" REL=contents>
</HEAD>
<BODY>
<A HREF="Ipchains-HOWTO-9.html">Next</A>
<A HREF="Ipchains-HOWTO-7.html">Previous</A>
<A HREF="Ipchains-HOWTO.html#toc8">Contents</A>
<HR>
<H2><A NAME="s8">8. Приложение. Различия между ipchains и ipfwadm.</A></H2>

<P>Некоторые из этих изменений - результат изменений в ядре, и поэтому
в ipchains есть отличия от ipfwadm.
<OL>
<LI> Многие параметры были повторно переопределены: заглавные буквы теперь 
указывают команду, а строчные буквы теперь указывают опцию.
</LI>
<LI> Поддерживаются произвольные цепочки, так даже встроенные цепочки 
обозначаются именами вместо флажков (напр. "input" вместо "-I").
</LI>
<LI> "-k" опция исчезла: используйте "! -y'.
</LI>
<LI> "-b" опция фактически вставляет/добавляет/удаляет два правила, скорее чем 
одно правило `bidirectional'.
</LI>
<LI> "-b" опцию можно использовать с "-C", чтобы сделать две проверки (в каждом 
направлении).
</LI>
<LI> "-x" опция в "-l" была заменена на "-v".
</LI>
<LI> Больше не поддерживаются множественные порты источника и адресата.
Однако можно воспользоваться возможностью отрицать диапазоны портов.
</LI>
<LI> Интерфейсы могут быть определены только именем (не адресом). Старая 
семантика заменена в ядре 2.1.
</LI>
<LI> Фрагменты проверяются, не разрешены автоматически.
</LI>
<LI> Explicit accounting chains have been done away with.
</LI>
<LI> Могут быть проверены произвольные протоколы над IP.
</LI>
<LI> Изменено старое поведение соответствий SYN и ACK (который предварительно 
игнорировались для не-TCP пакетов); опция SYN не допустима для 
не-TCP-специфичных правил.
</LI>
<LI> Счетчики на 32-разрядных машинах теперь 64-разрядные, а не 32-разрядные.
</LI>
<LI> Поддерживаются обратные опции.
</LI>
<LI> Поддерживаются ICMP коды.
</LI>
<LI> Поддерживаются уайлдкарты интерфейсов.
</LI>
<LI> Исправлены манипуляции с TOS: старый код ядра просто зависал при 
(неправильном) управлении битом `Must Be Zero' TOS; теперь в этом и 
аналогичных случаях ipchains возвращает ошибку.</LI>
</OL>
<P>
<H2><A NAME="ss8.1">8.1 Краткая таблица перекрестных ссылок.</A>
</H2>

<P>[В основном, аргументы команд в ВЕРХНЕМ РЕГИСТРЕ, а параметры опций - в нижнем] 
<P>Обратите внимание на такую вещь: маскарадинг определяется "-j MASQ'; 
это полностью отличается " -j ACCEPT', и не обрабатыватся как просто 
побочный эффект, как это делает ipfwadm.
<PRE>
  ================================================================
  | ipfwadm      | ipchains              | Notes
  ----------------------------------------------------------------
  | -A [both]    | -N acct               | Создает `acct' цепочку
  |              |&amp; -I 1 input -j acct   | для входящих с исходящих
  |              |&amp; -I 1 output -j acct  | пакетов.
  |              |&amp; acct                 |
  ----------------------------------------------------------------
  | -A in        | input                 | Правило без действия
  ----------------------------------------------------------------
  | -A out       | output                | Правило без действия
  ----------------------------------------------------------------
  | -F           | forward               | Использ. это как [цепочка].
  ----------------------------------------------------------------
  | -I           | input                 | Использ. это как [цепочка].
  ----------------------------------------------------------------
  | -O           | output                | Использ. это как [цепочка].
  ----------------------------------------------------------------
  | -M -l        | -M -L                 |
  ----------------------------------------------------------------
  | -M -s        | -M -S                 |
  ----------------------------------------------------------------
  | -a policy    | -A [chain] -j POLICY  | (но см. -r и -m).
  ----------------------------------------------------------------
  | -d policy    | -D [chain] -j POLICY  | (но см. -r и -m).
  ----------------------------------------------------------------
  | -i policy    | -I 1 [chain] -j POLICY| (но см. -r и -m).
  ----------------------------------------------------------------
  | -l           | -L                    |
  ----------------------------------------------------------------
  | -z           | -Z                    |
  ----------------------------------------------------------------
  | -f           | -F                    |
  ----------------------------------------------------------------
  | -p           | -P                    |
  ----------------------------------------------------------------
  | -c           | -C                    |
  ----------------------------------------------------------------
  | -P           | -p                    |
  ----------------------------------------------------------------
  | -S           | -s                    | Можно указывать только
  |              |                       | один порт, не несколько.
  ----------------------------------------------------------------
  | -D           | -d                    | Можно указывать только
  |              |                       | один порт, не несколько.
  ----------------------------------------------------------------
  | -V           | &lt;нету>                | Использ. -i [имя].
  ----------------------------------------------------------------
  | -W           | -i                    |
  ----------------------------------------------------------------
  | -b           | -b                    | Факт-ки создает 2 правила.
  ----------------------------------------------------------------
  | -e           | -v                    |
  ----------------------------------------------------------------
  | -k           | ! -y                  | Не работает, если нет
  |              |                       | опции -p tcp.
  ----------------------------------------------------------------
  | -m           | -j MASQ               |
  ----------------------------------------------------------------
  | -n           | -n                    |
  ----------------------------------------------------------------
  | -o           | -l                    |
  ----------------------------------------------------------------
  | -r [redirpt] | -j REDIRECT [redirpt] |
  ----------------------------------------------------------------
  | -t           | -t                    |
  ----------------------------------------------------------------
  | -v           | -v                    |
  ----------------------------------------------------------------
  | -x           | -x                    |
  ----------------------------------------------------------------
  | -y           | -y                    | Не работает, если нет
  |              |                       | опции -p tcp.
  ----------------------------------------------------------------
</PRE>
<P>
<H2><A NAME="ss8.2">8.2 Примеры транслируемых команд ipfwadm</A>
</H2>

<P>
<PRE>
Старая команда: ipfwadm -F -p deny
Новая команда: ipchains -P forward DENY

Старая команда: ipfwadm -F -a m -S 192.168.0.0/24 -D 0.0.0.0/0
Новая команда: ipchains -A forward -j MASQ -s 192.168.0.0/24 -d 0.0.0.0/0

Старая команда: ipfwadm -I -a accept -V 10.1.2.1 -S 10.0.0.0/8 -D 0.0.0.0/0
Новая команда: ipchains -A input -j ACCEPT -i eth0 -s 10.0.0.0/8 -d 0.0.0.0/0
</PRE>

(Обратите внимание, что интерфейсы адресами указать нельзя: используйте имя 
интерфейса. На этой машине, 10.1.2.1 соответствует eth0).
<P>
<HR>
<A HREF="Ipchains-HOWTO-9.html">Next</A>
<A HREF="Ipchains-HOWTO-7.html">Previous</A>
<A HREF="Ipchains-HOWTO.html#toc8">Contents</A>
</BODY>
</HTML>
