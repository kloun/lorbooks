<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Сжатие TCP/IP-соединений при помощи ssh</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Сжатие TCP/IP-соединений при помощи ssh</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Sebastian Schreiber</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>Schreib@SySS.de</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
>  Перевод: <A
HREF="mailto:pax@asp-linux.com"
TARGET="_top"
>Павел Гашев</A
>,
  <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>2.2.2000<BR></P
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Compressed-TCP.html#AEN15"
>Введение</A
></DT
><DT
>2. <A
HREF="Compressed-TCP.html#AEN21"
>Сжатие HTTP/FTP,...</A
></DT
><DT
>3. <A
HREF="Compressed-TCP.html#AEN36"
>Сжатие электронной почты</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="Compressed-TCP.html#AEN38"
>Входящая почта (POP3, IMAP4)</A
></DT
><DT
>3.2. <A
HREF="Compressed-TCP.html#AEN67"
>Исходящая почта (SMTP)</A
></DT
></DL
></DD
><DT
>4. <A
HREF="Compressed-TCP.html#AEN85"
>Быстродействие.</A
></DT
><DT
>5. <A
HREF="Compressed-TCP.html#AEN89"
>Благодарности</A
></DT
><DT
>6. <A
HREF="Compressed-TCP.html#AEN94"
>Авторские права</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN15"
>1. Введение</A
></H1
><P
>Раньше мы использовали сжатые файлы для того, чтобы освободить место на
диске. Сегодня дисковое пространство стало довольно дешево, но ограничены
пропускные способности каналов. Сжатием потоков данных, мы достигаем
следующих целей:</P
><P
>1) Уменьшаем размер передаваемых данных (это важно, если мы платим за трафик, или если сеть перегружена).</P
><P
>2) Ускоряем передачу по медленным каналам (Модем, GSM, ISDN).</P
><P
>Это HOWTO рассказывает, как достигнуть этих целей, используя такие утилиты,
как SSH1, SSH2, OpenSSH или LSH.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN21"
>2. Сжатие HTTP/FTP,...</A
></H1
><P
>Мой офис подключен к Интернет через ISDN на скорости 64Кбит, так что
максимальная скорость передачи является около 7Кб/сек. Можно повысить
скорость соединения, путем сжатия передаваемой информации: теперь, когда я
скачиваю файлы, Netscape показывает скорость до 40Кб/сек (файлы журналов
сжимаются в 15 раз). SSH - это утилита, предназначенная для обеспечения
безопасного соединения через небезопасные сети, при помощи шифрования
данных. Но, кроме того, SSH способна сжимать информацию и осуществлять
переадресацию портов (аналогично rinetd или redir). Так что она вполне
подходит для сжатия простых TCP/IP соединений. "Простых" \- значит, что
открывается только одно TCP-соединение. FTP-соединения или соединения между
M$-Outlook и MS-Exchange не являются "простыми", т.к. открывается несколько
соединений одновременно. SSH использует алгоритм сжатия LempleZiv (LZ77),
обеспечивая такую же компрессию, как и в winzip/pkzip. Для того, чтобы
сжимать все HTTP-соединения с Интернет, мне необходимо запустить одну
команду на своей машине:</P
><P
><TT
CLASS="LITERAL"
>ssh -l &lt;login ID&gt; &lt;hostname&gt; -C -L8080:&lt;proxy_;at_;ISP&gt;:80
-f sleep 10000</TT
> </P
><P
>&lt;<TT
CLASS="LITERAL"
>hostname</TT
>&gt; = машина
моего провайдера, обеспечивающая доступ через SSH.</P
><P
>&lt;<TT
CLASS="LITERAL"
>login ID</TT
>&gt; = мое имя входа на &lt;<TT
CLASS="LITERAL"
>hostname</TT
>&gt;</P
><P
><TT
CLASS="LITERAL"
>&lt;proxy_;at_;ISP&gt; =</TT
>веб-прокси-сервер моего провайдера</P
><P
>Обозреватель настроен на работу через прокси-сервер <TT
CLASS="LITERAL"
>localhost:8080</TT
>. Портативный компьютер настроен на этот же порт моей машины. Соединения сжимаются и переназначаются реальному прокси-серверу сервером SSH. Инфраструктура выглядит примерно так:</P
><PRE
CLASS="SCREEN"
>                      64KBit ISDN
Мой компьютер--------------------------------Компьютер (Unix/Linux/Win-NT)
SSH-клиент         сжато                     моего провайдера  
порт 8080                                    SSH-сервер, порт 22
 |                                            |
 |                                            |
 |                                            |
 |10МБит Ethernet                             |100МБит
 |не сжато                                    |не сжато
 |                                            |
 |                                            |
Мой второй компьютер                         WWW-прокси провайдера
с Netscape,...                               порт 80
(портативный)

 </PRE
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN36"
>3. Сжатие электронной почты</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>3.1. Входящая почта (POP3, IMAP4)</A
></H2
><P
>Большинство людей принимают электронную почту с почтового сервера при помощи POP3. POP3 - это протокол со многими недостатками.</P
><P
>&#13;<P
></P
><OL
TYPE="1"
><LI
><P
>POP3 передает пароль, как обычный текст. (Хотя есть различные реализации SSL для POP/IMAP и аутентификация типа запрос/ответ, описанные в RFC-2095/2195).</P
></LI
><LI
><P
>POP3 - избыточный протокол: сначала клиент запрашивает сообщение, затем
сервер посылает его. После этого клиент может дать серверу команды удаления
принятых сообщений. Сервер подтверждает удаление. Далее сервер дает понять,
что он готов к следующей команде. Таким образом, необходимо 4 команды, чтобы
принять каждое письмо.</P
></LI
><LI
><P
>POP3 передает почту без сжатия, хотя она очень хорошо компрессируется (в 3.5 раза).</P
></LI
></OL
>&#13;</P
><P
>Возможно осуществить сжатие POP3, перенаправляя соединения с адреса localhost:110 через сжатое соединение к вашему провайдеру на порт POP3. Для этого необходимо в почтовой программе установить сервер входящей почты в localhost:110. Это безопасное и быстрое соединение, но оно все еще зависит от недостатков протокола POP3.</P
><P
> </P
><P
>Имеет смысл заменить POP3 на более эффективный протокол. Идея заключается в том, чтобы перекачивать все содержимое почтового ящика, хранящегося на почтовом сервере, без какого-то ни было почтового протокола. SCP - хорошая утилита для выполнения этого. Вы можете скачать ваш почтовый ящик примерно так:</P
><P
> </P
><P
><TT
CLASS="LITERAL"
>scp -C -l имя:/var/spool/mail/loginid /tmp/newmail</TT
></P
><P
> </P
><P
>Но есть проблема: что произойдет, если во время передачи на сервер придет новая почта? Новая почта будет потеряна. Таким образом, лучше всего использовать следующие команды:</P
><P
><TT
CLASS="LITERAL"
>ssh -l имя почтовый_сервер -f mv /var/spool/mail/имя /tmp/имя_fetchme</TT
></P
><P
><TT
CLASS="LITERAL"
>scp -C -l имя:/tmp/my_;new_;mail /tmp/имя_fetchme</TT
></P
><P
>mv - это простая операция, мгновенно переносящая файл в другое место, так
что у вас не будет проблем, если придет новая почта. Но если каталоги /tmp/
и /var/spool/mail находятся на разных дисках/разделах, у вас все-таки могут
возникнуть некоторые трудности. Решение - это создать файл блокировки на
сервере перед тем, как перекачивать почту: <TT
CLASS="LITERAL"
>touch
/var/spool/mail/имя.lock</TT
>. Вы должны убрать его после того, как
закончите перекачку. А еще лучше, переименовать почтовый ящик внутри этого
же каталога:</P
><P
><TT
CLASS="LITERAL"
>ssh -l имя почтовый_сервер -f mv /var/spool/mail/имя /var/spool/mail/имя_fetchme</TT
></P
><P
>Затем обработайте полученный почтовый ящик /tmp/newmail, при помощи команд
formail и procmail: <TT
CLASS="LITERAL"
>formail -s procmail &lt;
/tmp/newmail</TT
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN67"
>3.2. Исходящая почта (SMTP)</A
></H2
><P
>Передача электронной почты через сжатое и шифрованное SSH-соединение обеспечивает:</P
><P
>&#13;<P
></P
><UL
><LI
><P
>Уменьшение трафика сети</P
></LI
><LI
><P
>Безопасность (впрочем, это не имеет смысла, если далее почта идет по незащищенным сетям)</P
></LI
><LI
><P
>Аутентификация посылающего. Большинство почтовых серверов не принимают почту с других машин, предназначенную для внешней доставки (relay). Если вы посылаете почту через SSH-соединение, почтовый сервер (sendmail или MS-exchange) думает, что она посылается с локальной программы...</P
></LI
></UL
>&#13;</P
><P
>Если на почтовом сервере установлен доступ SSH, используйте следующую команду:</P
><P
><TT
CLASS="LITERAL"
>ssh -C -l имя почтовый_сервер -L2525:почтовый_сервер:25</TT
></P
><P
>Если у вас нет SSH-доступа к почтовому серверу, но есть сервер с SSH, которому разрешена связь с другими машинами, вы можете использовать его:</P
><P
><TT
CLASS="LITERAL"
>ssh -C -l имя другой_сервер -L2525:почтовый_сервер:25</TT
></P
><P
>После этого вы можете настроить свою почтовую программу (или почтовый сервер: см. "smarthost") так, чтобы она посылала исходящую почту через localhost:2525.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN85"
>4. Быстродействие.</A
></H1
><P
>Конечно же, сжатие/шифрование занимает процессорное время. Например старый Пентиум-133 может сжимать и шифровать около 1Гб в час, а это достаточно много. Чтобы увеличить скорость, вы можете скомпилировать SSH с опцией "-with-none", и он не будет шифровать информацию. Следующая таблица дает сравнение между различными методами загрузки (файл 6МБ передавался с Pentium-133 на Pentium-233 через сеть 10Мбит).</P
><PRE
CLASS="SCREEN"
>+-------------------+--------+----------+-----------+------------------------+
|                   |  FTP   |шифрованый|   сжатый  |сжатый   &amp;   шифрованный|
+-------------------+--------+----------+-----------+------------------------+
+-------------------+--------+----------+-----------+------------------------+
|       Время       |  7.6с  |   26с    |    9с     |          23с           |
+-------------------+--------+----------+-----------+------------------------+
|      Скорость     | 790K/с |  232K/с  |  320K/с   |        264K/с          |
+-------------------+--------+----------+-----------+------------------------+
|       Сжатие      |   1    |    1     |    3.8    |          3.8           |
+-------------------+--------+----------+-----------+------------------------+
 </PRE
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN89"
>5. Благодарности</A
></H1
><P
>Выражаю благодарность Harald Koenig <TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:koenig@tat.physik.uni-tuebingen.de"
>koenig@tat.physik.uni-tuebingen.de</A
>&#62;</TT
>, который дал идею использования rcp при перекачке почтового ящика. Последняя версия этого документа находится на <TT
CLASS="LITERAL"
>http://www.syss.de/howto.</TT
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN94"
>6. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
></DIV
></BODY
></HTML
>