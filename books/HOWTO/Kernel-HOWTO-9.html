<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux Kernel HOWTO: Модули</TITLE>
 <LINK HREF="Kernel-HOWTO-10.html" REL=next>
 <LINK HREF="Kernel-HOWTO-8.html" REL=previous>
 <LINK HREF="Kernel-HOWTO.html#toc9" REL=contents>
</HEAD>
<BODY>
<A HREF="Kernel-HOWTO-10.html">Следующий</A>
<A HREF="Kernel-HOWTO-8.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc9">Содержание</A>
<HR>
<H2><A NAME="s9">9. Модули</A></H2>

<P>Загружаемые модули ядра могут сохранить память и упростить
настройку. Область применения модулей включает файловые системы, драйвера
карт ethernet, драйверы ленточных накопителей и т.п.
<P>
<H2><A NAME="ss9.1">9.1 Установка утилит для работы с модулями</A>
</H2>

<P>Утилиты для работы с модулями доступны от туда же откуда вы получили
свое ядро, они называются <CODE>modules-x.y.z.tar.gz</CODE>; выберите самый
большой номер <CODE>x.y.z</CODE>, который равен или ниже чем номер вашего
текущего ядра. Распакуйте их с помощью команды `<CODE>tar zxvf
modules-x.y.z.tar.gz</CODE>', перейдите в директорию, которую эта команда
создала (<CODE>modules-x.y.z</CODE>), посмотрите файл <CODE>README</CODE>, и
выполните приведенные в нем инструкции по установке (которые обычно
являются очень простыми, такими как  <CODE>make install</CODE>). Вы должны
теперь получить программы <CODE>insmod</CODE>, <CODE>rmmod</CODE>, <CODE>ksyms</CODE>,
<CODE>lsmod</CODE>, <CODE>genksyms</CODE>, <CODE>modprobe</CODE>, и <CODE>depmod</CODE> в
директории <CODE>/sbin</CODE>. Если вы хотите, протестируйте полученные
программы с помощью демонстрационного драйвера ``hw'' в <CODE>insmod</CODE>;
для более детальной информации смотрите файл <CODE>INSTALL</CODE>, который
находится в директории с исходными текстами.
<P>
<P>Команда <CODE>insmod</CODE> вставляет модуль в работающее ядро. Модули
обычно имеют расширение <CODE>.o</CODE>; пример драйвера, упомянутый выше
называется <CODE>drv_hello.o</CODE>, так для того чтобы вставить его, вы должны 
выполнить `<CODE>insmod drv_hello.o</CODE>'. Для того чтобы увидеть список
загруженных модулей используйте команду <CODE>lsmod</CODE>. Ее вывод выглядит
примерно так:
<P>
<PRE>
    blah# lsmod
    Module:        #pages:  Used by:
    drv_hello          1
</PRE>
<P>`<CODE>drv_hello</CODE>' это имя модуля, он использует 1 страницу оперативной
памяти (4k), и ни какие модули ядра не зависят от него на текущий
момент. Для удаления этого модуля используйте команду `<CODE>rmmod
drv_hello</CODE>'. Заметим, что <CODE>rmmod</CODE> требует <I>имя модуля,</I> а 
не имя файла; вы можете получить его из списка выдаваемого
<CODE>lsmod</CODE>. Назначение других утилит для работы с модулями описано в их 
справочных страницах. 
<P>
<H2><A NAME="ss9.2">9.2 Модули распространяемые с ядром</A>
</H2>

<P>В версии 2.0.30, почти все доступно как загружаемые модули. Для их
использования сначала сначала убедитесь, что вы не настроили их
вкомпилированными в ядро; то есть вы не ответили <CODE>y</CODE> в процессе
выполнения `<CODE>make config</CODE>'. Скомпилируйте новое ядро и загрузитесь с 
ним. Затем снова перейдите в <CODE>/usr/src/linux</CODE>, и выполните `<CODE>make
modules</CODE>'. это скомпилирует все модули, которые вы не указали при
настройке ядра, и поместит ссылки на них в
<CODE>/usr/src/linux/modules</CODE>. ВЫ можете использовать их прямо из этой
директории, или выполните команду `<CODE>make modules_install</CODE>', которая
установит модули в директорию <CODE>/lib/modules/x.y.z</CODE>, где
<CODE>x.y.z</CODE> это версия ядра.
<P>
<P>Это может быть особенно полезным в использовании файловых систем. Вы
можете нечасто использовать файловые системы minix или msdos. Например,
если я сталкиваюсь с гибким диском с  msdos, я должен сделать <CODE>insmod
/usr/src/linux/modules/msdos.o</CODE>, и затем <CODE>rmmod msdos</CODE>, когда
все закончено. Эта процедура сохраняет примерно 50k ОЗУ в ядре в течении
нормальной работы. Маленькое замечание для использования файловой системы
minix: вы должны <I>всегда</I> настроить его прямо в ядро для
использования в ``восстановительных (rescue)'' дисках.
<P>
<HR>
<A HREF="Kernel-HOWTO-10.html">Следующий</A>
<A HREF="Kernel-HOWTO-8.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc9">Содержание</A>
</BODY>
</HTML>
