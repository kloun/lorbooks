<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>NFS HOWTO: Часто Задаваемые Вопросы (FAQ)</TITLE>
 <LINK HREF="NFS-HOWTO-9.html" REL=next>
 <LINK HREF="NFS-HOWTO-7.html" REL=previous>
 <LINK HREF="NFS-HOWTO.html#toc8" REL=contents>
</HEAD>
<BODY>
<A HREF="NFS-HOWTO-9.html">Следующий</A>
<A HREF="NFS-HOWTO-7.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc8">Содержание</A>
<HR>
<H2><A NAME="s8">8. Часто Задаваемые Вопросы (FAQ)</A></H2>

<P>Это раздел часто задаваемых вопросов (FAQ). Большая часть его основана
на старом FAQ, написанном Alan Cox.
<P>
<P>Если у вас есть проблемы с монтированием файловой системы, то пожалуйста
посмотрите, не описана ли она в разделе ``Список проверок при
монтировании''.
<P>
<OL>
<LI>Я получаю сообщения об ошибках ``stale nfs handle (устарелый
дескриптор nfs)'' при использовании Linux как сервера nfs.
<P>Это вызывается ошибкой в одной из старых версий nfsd. Это
исправлено в nfs-server2.2beta16 и более поздних.
<P>
</LI>
<LI>Когда я пытаюсь примонтировать файловую систему я получаю сообщение
<BLOCKQUOTE><CODE>
<PRE>
 can't register with portmap: system error on send
 (не могу зарегистрироваться с помощью portmap: системная ошибка при посылке)
</PRE>
</CODE></BLOCKQUOTE>

<P>Вы вероятно используете систему Caldera. Это ошибка в скриптах
rc. Пожалуйста свяжитесь с Caldera для получения исправления.
<P>
</LI>
<LI>Почему я не могу выполнить файл после копирования его на NFS сервер?
<P>Причина в том, что nfsd кэширует дескрипторы открытых файлов для
улучшения производительности (помните, что он запущен в пространстве
пользователей). Пока nfsd держит файл открытым (как в этом случае, после
записи в него), то ядро не позволит вам выполнять его. Nfsds новее чем
версии выпуска весны 95 держат файлы открытыми в течении нескольких
секунд, более старые могут держать файл открытым в течении нескольких
дней.
<P>
</LI>
<LI>Мои файлы на NFS все считаются с правом только на чтение

<P>По умолчанию сервер NFS для Linux выдается все как только для
чтения. Перечитайте разделы ``Mountd и nfsd'' и ``Экспортирование
файловых систем'' данного документа, а также справочные страницы по
``exports'' и nfsd. Вам необходимо изменить файл <CODE>/etc/exports</CODE>.
<P>
</LI>
<LI>Я монтирую файловую систему с сервера nfs под linux и пока работает
команда <CODE>ls</CODE> я не могу читать или записывать файлы.

<P>На старых версиях Linux вы должны монтировать сервер NFS с опциями
<CODE>rsize=1024,wsize=1024</CODE>.
<P>
</LI>
<LI>Я монтирую файловую систему с сервера NFS под Linux с размером блока
между 3500-4000 и это регулярно роняет машину с Linux

<P>Обычно не делайте так. Это не случается с ядрами версий 2.0 и 2.2. 
Также нет проблемы с ядрами серии 2.1.
<P>
</LI>
<LI>Может Linux выполнять NFS по TCP
<P>Нет
<P>
</LI>
<LI>Я получаю странные ошибки при монтировании машины с машины под  Linux. 
<P>Убедитесь, что ваш пользователь находится в 8 или меньшем количестве
групп. Старые сервера требую этого.
<P>
</LI>
<LI>Когда я перезагружаю свою машину она иногда вешается при попытке
отмонтироваться от зависшего сервера NFS. 
<P><B>Не</B> отмонтируйтесь от серверов NFS при перезагрузке или выключении,
просто проигнорируйте это, ничто не повредится, если вы не отмонтируетесь 
от него. Команда будет выглядеть следующим образом <CODE>umount -avt
nonfs</CODE>. 
<P>
</LI>
<LI>Клиент NFS для Linux работает очень медленно при записи на системы Sun
и BSD. 

<P>Обычно NFS записывает в синхронном режиме (вы можете запретить это, если 
вы считаете, что вы не рискуете потерять данные). Хуже всего то, что ядра
произошедшие от BSD не могут работать с маленькими блоками. Таким образом
когда вы пишете 4K данных с машины под Linux в 1K пакетах, то BSD
выполняет это следующим образом
<BLOCKQUOTE><CODE>
<PRE>
        прочитать страницу размером 4K
        изменить 1K
        записать страницу размером 4K обратно на диск
        прочитать страницу размером 4K
        изменить 1K
        записать страницу размером 4K обратно на диск
        и т.д...
</PRE>
</CODE></BLOCKQUOTE>
<P>
</LI>
<LI>Когда я подключаю много клиентов к Linux NFS серверу, его
производительность неожиданно падает.

<P>Протокол NFS использует использует фрагментированые UDP-пакеты. В
ядре имеется предел на то, как много фрагментов или неполных пакетов
прибудет до того, как оно начнет отбрасывать пакеты. В ядрах серии 2.2 это
настраивается во время работы через файловую систему /proc:
<CODE>/proc/sys/net/ipv4/ipfrag_high_thresh</CODE> и
<CODE>ipfrag_low_thresh</CODE>.  В ядрах серии 2.0 эти константы определяются
во время компиляции и определены в файле
<CODE>.../linux/net/ipv4/ip_fragment.c</CODE>, <CODE>IPFRAG_HIGH_THRESH</CODE> и
<CODE>IPFRAG_LOW_THRESH</CODE>. Эти параметры означают, что когда потребление
памяти не собранными фрагментами пакетов UDP достигает значения
``ipfrag_high_thresh'' в байтах (по умолчанию 256K в ядрах 2.2.3 и 2.0.36)
оно уменьшится до значения  ``ipfrag_low_tresh''. Это делается
отбрасыванием фрагментов. Это будет выглядеть как почти полная потеря
пакетов и если будет достигнута верхняя граница, то производительность
вашего сервера сильно уменьшится.
<P>
<P>256K достаточно для обслуживания до 30 клиентов. Если у вас 60 клиентов, 
то увеличьте это значение в 2 раза. И также увеличьте значение нижней
границы. 
<P>
</LI>
<LI>Я использую Linux 2.2 (или более поздний) с knfsd и я не могу
заставить мои машины с AIX, IRIX, Solaris, DEC-Unix, ... монтироваться к
нему. 

<P>Knfsd объявляет, что реализует NFS версии 3. Это не так. Существует
опция, которая запрещает ему анонсировать это. Используйте ее. Или вы
можете поместить параметр "<CODE>vers=2</CODE>" в список опций монтирования на
клиенте.
<P>
</LI>
<LI>Моя машина с AIX 4 не может произвести монтирование моего NFS
сервера под Linux. Она сообщает

<BLOCKQUOTE><CODE>
<PRE>
        mount: 1831-011 access denied for server:/dir
        mount: 1831-008 giving up on:
        server:/dir
        The file access permissions do not allow the specified action.
  
</PRE>
</CODE></BLOCKQUOTE>


или что-то подобное.

<P>AIX 4.2 использует зарезервированные порты (&lt;1024) для NFS.  AIX 4.2.1
и 4.3 не ограничены резервированными портами. Также AIX 4.2.1 и 4.3
пытаются произвести монтирование используя версию NFS3, затем NFS/TCP, и
только потом NFS/UDP.
<P>
<P>Добавление строк
<P>
<HR>
<PRE>
nfso -o nfs_use_reserved_ports=1
</PRE>
<HR>
<P>
<P>в конец файла <CODE>rc.tcpip</CODE> заставит его использовать резервированные
порты. (Этот совет был послан Brian Gorka).
<P>
</LI>
</OL>
<P>
<P>
<HR>
<A HREF="NFS-HOWTO-9.html">Следующий</A>
<A HREF="NFS-HOWTO-7.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc8">Содержание</A>
</BODY>
</HTML>
