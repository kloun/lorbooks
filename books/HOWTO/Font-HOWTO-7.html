<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Font HOWTO: WYSIWYG-приложения и фонты</TITLE>
 <LINK HREF="Font-HOWTO-8.html" REL=next>
 <LINK HREF="Font-HOWTO-6.html" REL=previous>
 <LINK HREF="Font-HOWTO.html#toc7" REL=contents>
</HEAD>
<BODY>
<A HREF="Font-HOWTO-8.html">Далее</A>
<A HREF="Font-HOWTO-6.html">Назад</A>
<A HREF="Font-HOWTO.html#toc7">Оглавление</A>
<HR>
<H2><A NAME="s7">7. WYSIWYG-приложения и фонты</A></H2>

<H2><A NAME="ss7.1">7.1 Введение и обзор</A>
</H2>

<P>Установка фонтов для WYSIWYG-приложений в Linux представляет собой 
относительно сложную задачу. Она обычно решается в три этапа:
<UL>
<LI>Сделать фонты доступными для X-сервера</LI>
<LI>Сделать фонты доступными для ghostscript</LI>
<LI>Сделать фонты доступными для приложения</LI>
</UL>

Основная причина сложности в том, что <EM>система вывода фонта на принтер</EM> 
(ghostscript) никак не связана (is unrelated) с <EM>системой вывода фонта на 
экран</EM>. Можно сказать, что левая рука Линукса не знает, что делает правая. 
Решение этой проблемы нетривиально, поскольку может оказаться, что 
принтерные фонты и экранные фонты находятся на разных компьютерах, так что нет 
гарантии что все используемые X-клиентом фонты доступны для подсистемы 
печати.
<P>Однако решение этой проблемы для большинства WYSIWYG-приложений существует. 
Оно заключается в том, что создается некоторый механизм  для преобразования 
экранных фонтов в принтерные фонты (это основная идея; кроме того,
используется группировка фонтов в семейства, включающие варианты 
bold, italic и roman). К сожалению, не существует стандартного способа 
сделать это преобразование. Представляется, что стандарты управления фонтами, которые 
определяли бы и механизм  для преобразования экранных фонтов в принтерные 
фонты, существенно упростили бы установку фонтов для  WYSIWYG-приложений , 
потому что все приложения могли бы использовать единую системную 
конфигурацию, а не специфичную для каждого отдельного приложения.

<H2><A NAME="ss7.2">7.2 Applixware</A>
</H2>

<P>Существует два пути установки фонтов для Applixware. Первый метод 
заключается в использовании FontTastic, "частного" сервера фонтов 
Applixware. Второй метод предполагает редактирование собственного перечня 
каталогов фонтов Applixware, чтобы подключить фонты, уже установленные 
в системе. Установка через фонт-сервер более удобна, но установленные таким 
образом фонты могут использоваться принтером только при разрешении 300 dpi.

<H3>FontTastic</H3>

<P>FontTastic предоставляет легкий способ осуществить установку фонтов. Для того, 
чтобы установить новые шрифты, просто сделайте следующее:
<OL>
<LI>Запустите Applixware как root</LI>
<LI>Вызовите меню <EM>tools</EM>.</LI>
<LI>Выберите "Font Installer"</LI>
<LI>Отметьте "OK" в появившемся диалоговом окне</LI>
<LI>Вызовите меню "Catalogs" и выберите пункт "create"</LI>
<LI>Введите <EM>имя каталога</EM>. Не важно, что Вы здесь введете. Для примера 
мы будем предполагать, что подключаются фонты из каталога "foobar".</LI>
<LI>Выберите каталог foobar из списка каталогов.</LI>
<LI>В меню "Services" выберите "install fonts into -&gt; FontTastic 
font server"</LI>
<LI>Убедитесь, что каталог foobar выбран в списке каталогов, после чего 
нажмите кнопку "select files".</LI>
<LI>Используйте каталог выбора файлов для выбора тех фонтов, которые Вы 
хотите установить. Когда закончите выбор, нажмите "OK". Например, если 
Вы хотите выбрать arial.ttf в каталоге /usr/share/fonts/ttfonts/, Вы 
должны ввести <EM>/usr/share/fonts/ttfonts</EM> в диалоговом окне 
"Current Directory", затем выбрать arial.ttf в окне выбора файлов, 
после чего щелкнуть по клавише "OK". Заметьте, что Вы можете выбрать 
несколько файлов, но только из одной и той же директории.
</LI>
<LI>Вы можете отредактировать полученный список путем добавления 
других фонтов, удаления некоторых или переименования их.
</LI>
<LI>Когда Вы закончите, щелкните по кнопке "install fonts", 
а потом по "OK".</LI>
<LI>Перейдите в меню "services" и выберите "update". Выберите "OK" 
в навязчиво появляющемся окне предупреждений, затем выберите exit 
в меню services. Выйдите из Applixware. </LI>
<LI>Поздравляю, Вы все сделали ! Новые фонты будут доступны, когда Вы 
снова запустите Applixware.</LI>
</OL>

<H3>Использование в Applixware системных фонтов</H3>

<P>Этот метод посложнее, но дает лучший результат. Я рекомендую использовать 
этот метод для тех фонтов, которые по-настоящему важны, и для тех, 
которые Вы часто используете. Снова надо пройти несколько шагов:

<H3>Делаем фонты доступными для X</H3>

<P>Как это сделать, было объяснено в  
<A HREF="Font-HOWTO-4.html#xfonts">предыдущей секции</A>

<H3>Делаем фонты доступными для ghostscript</H3>

<P>Это тоже объяснено в  
<A HREF="Font-HOWTO-5.html#ghostscript">предыдущей секции</A>

<H3>Редактируем fontmap.dir</H3>

<P>Это последний шаг в обеспечении 
доступа к фонтам из Applix и требующий больше всего времени. Файл 
<EM>fontmap.dir</EM> находится в подкаталоге <EM>axdata/fontmetrics</EM> 
структуры каталогов applix. Основная цель данного шага - сказать applix, 
какой экранный фонт идет с каким контурным фонтом. В общем случае это очень 
нетривиальная проблема, потому что экранные фонты не всегда расположены 
на том же компьютере, на котором установлено приложение.
<P>Мы опишем как добавить фонты к fontmap.dir. В приводимом ниже примере 
мы добавляем фонт Baskerville Italic.
<P>
<OL>
<LI>Во-первых, добавим строку 
<br>FontRecord = Baskerville-Normal-Italic
<br>Фактически, имя, которое используется в FontRecord, полностью произвольно.
Однако, font record должно быть уникальным для каждого фонта. Поэтому 
будет правильно, если Вы используете то же имя, которое используется 
для этого фонта в ghostscript.
</LI>
<LI>Далее добавляем строку
<br>Family = Baskerville
<br>Имя семейства (The family name) для фонта - это имя, которое 
будет появляться в меню выбора шрифта в Applix. Обычно, оно <EM>не 
уникально</EM>, потому что варианты bold, italic, roman и bold-italic 
фонта имеют то же самое имя семейства.
</LI>
<LI>Если фонт является вариантом italic, 
мы должны добавить следующую строку:
<PRE>
        Slant = 1 
</PRE>

а если вариантом bold, то строку
<PRE>
        Weight = 1 
</PRE>

Если это вариант одновременно bold <EM>И</EM> italic, мы добавляем обе строки.
В нашем примере мы должны добавить только строку
<PRE>
        Slant = 1 
</PRE>
</LI>
<LI>Далее мы добавляем строку вида:
<PRE>
        ScreenName = "-paradise-baskerville-medium-i-normal--0-0-0-0-p-0-iso8859-1"
</PRE>

Screen name - это имя, которое X-сервер использует для фонта.
Можно получить список имен фонтов, содержащих подстроку ``bask'', 
по команде
<PRE>
        xlsfonts|grep -i bask
</PRE>
</LI>
<LI>Теперь мы добавляем строку, которая задает имя принтерного фонта: 
<br> PostScriptPrinterName = Baskerville-Normal-Italic</LI>
<LI>Далее необходимо указать местоположение файла метрик фонта и 
файла контуров (the outline file)
<PRE>
        MetricsFile = /usr/share/fonts/misc/baskvli.afm
        Type1FontFileName = /usr/share/fonts/misc/baskvli.pfb
</PRE>

Если Вы добавляете фонт TrueType, Вы можете использовать 
<CODE>ttf2pt1 </CODE> для того, чтобы сгенерировать <CODE>afm</CODE>-файл :
<PRE>
                ttf2pt1 -A foo.ttf - &gt; foo.afm
                
</PRE>

(или установить пакет ttfutils и использовать <CODE>ttf2afm</CODE>). 

Затем Вы используете что-то вроде:
<PRE>
        MetricsFile = /usr/share/fonts/misc/foo.afm
</PRE>

<EM>НЕ</EM> включайте директиву <CODE>Type1FontFileName</CODE> --  пусть 
ghostscript позаботится об этом.</LI>
</OL>
<P>Все ! В результате после добавления целого семейства фонтов Вы должны 
получить что-то такое:
<PRE>
        FontRecord = Baskerville-Normal
        Family = Baskerville
        ScreenName = "-paradise-baskerville-medium-r-normal--0-0-0-0-p-0-iso8859-1"
        PostScriptPrintName = Baskerville-Normal
        MetricsFile = /usr/share/fonts/misc/baskvl.afm
        Type1FontFileName = /usr/share/fonts/misc/baskvl.pfb

        FontRecord = Baskerville-Normal-Italic
        Family = Baskerville
        Slant = 1
        ScreenName = "-paradise-baskerville-medium-i-normal--0-0-0-0-p-0-iso8859-1"
        PostScriptPrintName = Baskerville-Normal-Italic
        MetricsFile = /usr/share/fonts/misc/baskvli.afm
        Type1FontFileName = /usr/share/fonts/misc/baskvli.pfb

        FontRecord = Baskerville-Bold
        Family = Baskerville
        Weight = 1
        ScreenName = "-paradise-baskerville-bold-r-normal--0-0-0-0-p-0-iso8859-1"
        PostScriptPrintName = Baskerville-Bold
        MetricsFile = /usr/share/fonts/misc/baskvlb.afm
        Type1FontFileName = /usr/share/fonts/misc/baskvlb.pfb     

        FontRecord = Baskerville-Bold-Italic
        Family = Baskerville
        Weight = 1
        Slant = 1
        ScreenName = "-paradise-baskerville-bold-i-normal--0-0-0-0-p-0-iso8859-1"
        PostScriptPrintName = Baskerville-Bold-Italic
        MetricsFile = /usr/share/fonts/misc/baskvlbi.afm
        Type1FontFileName = /usr/share/fonts/misc/baskvlbi.pfb     
</PRE>
<P>
<P>С помощью конфигурационного файла можно сделать большее. В самом 
конфигурационном файле содержится <EM>глоссарий</EM>, в котором объясняется 
формат этого файла.

<H2><A NAME="ss7.3">7.3 Star Office</A>
</H2>

<P>Мы здесь рассматриваем только Star Office 5.0. Процедура для Star Office 
5.1 аналогична, но утилита называется <CODE>spadmin</CODE>, а не 
<CODE>psetup</CODE>. Стоит упомянуть, что 
<A HREF="http://www.mindspring.com/~john_mcl/adding_fonts.html">страница Джона 
Мак-Лафлина</A> (John McLaughlin)  является великолепным источником 
информации по этому вопросу и что написанное ниже во многом основано на 
его материалах. 

<P>Поработав как со Star Office 5.0, так и с 5.1, я обнаружил, что 
в Star Office 5.1 легче добавить новые фонты. Мне не удалось 
добавить true type фонты в Star Office 5.0, в Star Office 5.1 это оказалось 
немного проще.

<H3>Сделайте сначала резервную копию Вашей конфигурации !</H3>

<P>Неплохо до начала редактирования сделать резервную копию 
Вашей конфигурации, чтобы ненароком не испортить ее окончательно. 
Модификация фонтов окажет влияние на несколько файлов в <CODE>xp3</CODE>.
Вы обязательно должны сделать резервную копию файла <CODE>xp3/psstd.fonts</CODE>. 
Я рекомендую пойти дальше и сделать резервную копию всего каталога 
<CODE>xp3</CODE>. Вы можете для этого перейти в каталог Star Office и 
выполнить команду
<PRE>
        tar cvzf xp3.tgz xp3
        
</PRE>
Для того, чтобы впоследствии восстановить файлы из резервной копии, 
удалите каталог <CODE>xp3</CODE> и распакуйте архив: 
<PRE>
        rm -rf xp3
        tar xvzf xp3.tgz
        
</PRE>

<H3>Добавление фонтов Type1 к Star Office</H3>

<P>Добавление фонтов Type1 к Star Office осуществляется относительно просто. 
Если Вы хотите использовать в Star Office 5.0 имеющиеся фонты TrueType, 
лучше всего конвертировать их в формат Type1, а затем воспользоваться изложенной 
здесь процедурой.
Если Вы используете Star Office 5.1, Вы можете воспользоваться процедурой 
инсталляции фонтов TrueType (хотя это немного сложнее). 
Во-первых, как и всегда, надо сделать фонты доступными для X и  
ghostscript. После того, как это сделано, фонт должен быть установлен в 
Star Office, для чего используется утилита <CODE>psetup</CODE>. 
Процедура следующая:
<OL>
<LI>Как root запустите psetup (или spadmin, если у Вас Star Office 5.1)</LI>
<LI>Нажмите кнопку ``add fonts''. </LI>
<LI>После этого нажмите кнопку "initialize font paths". При этом список всех 
фонтов, имеющихся в каталогах из перечня каталогов фонтов X Window, выводится 
в отдельном окне.
</LI>
<LI>Выберите каталог, содержащий фонт, который Вы хотите установить (он должен быть 
в выведенном списке), и нажмите "OK". </LI>
<LI>Щелкните по кнопке "convert all font metrics".</LI>
</OL>

Это все! Вы можете выйти из программы. Когда Вы перезапустите Star Office, 
Вы будете иметь возможность использовать новые фонты.

<H3>Добавление TrueType фонтов к Star Office</H3>

<P>Добавление к Star Office фонтов TrueType не так тривиально, но возможно. 
После долгой работы и многих часов разглядывания 
<A HREF="http://www.mindspring.com/~john_mcl/adding_fonts.html">страницы Джона 
Мак-Лафлина</A> (John McLaughlin) я, наконец, добился того, что они заработали 
в Star Office 5.1. Замечу, что они все же не работают с версией 5.0. Следующие 
рекомендации применимы, если Вы печатаете через ghostscript:
<UL>
<LI>Сделайте фонты доступными для X.</LI>
<LI>Сделайте фонты доступными для ghostscript.</LI>
<LI>Вы должны иметь <CODE>afm</CODE>-файлы для фонтов, которые Вы хотите добавить.
Используйте  
<PRE>
        ttf2pt1 -A foo.ttf - &gt; foo.afm
</PRE>

чтобы создать <CODE>afm</CODE>-файлы. 
</LI>
<LI>
Другой способ состоит в том, чтобы скачать пакет
<A HREF="http://pegasus.rutgers.edu/~elflord/font_howto/ttfutils-0.2.tar.gz">ttfutils</A>
и использовать утилиту <CODE>ttf2afm</CODE>. Преимущество этого способа 
в том, что Вы сможете конвертировать за один раз несколько файлов, например
<PRE>
        ttf2afm *.ttf
        
</PRE>
</LI>
<LI>Star Office требуются файлы <CODE>pfb</CODE>, соответствующие каждому 
<CODE>ttf</CODE>-файлу. Вы можете их создать с помощью команды
<PRE>
        touch foo.pfb
</PRE>

Star Office использует эти файлы только для печати. И, включив фонт в файл PPD, 
Вы обманываете Star Office, заставляя его считать, что фонты имеются 
в Вашем принтере (хотя в действительности они в подсистеме вывода изображений 
ghostscript - ghostscript's rendering system). Тем самым Вы обходите необходимость 
использовать эти файлы. Кажется для Star Office требуется, чтобы существовали 
только файлы <CODE>pfb</CODE>, чтобы установить фонт.
</LI>
<LI>Теперь Вы можете запустить <CODE>spadmin</CODE> и установить фонт(ы).</LI>
<LI>    
Теперь добавьте фонты к файлу PPD, соответствующему конфигурации Вашего 
принтера. Имя, которое Вы используете для фонта, должно совпадать с именем, 
используемым для него Star Office, а <EM>НЕ</EM> именем фонта в ghostscript. 
Например, если фонт называется <CODE>foobar.ttf</CODE>, а соответствующий 
<CODE>afm</CODE>-файл имеет имя <CODE>foobar.afm</CODE>, Вы должны использовать 
имя "foobar" для фонта в PPD-файле. Запись должна выглядеть примерно так:
<PRE>
*Font cloistrk: Standard "(001.002)" Standard ROM
                
</PRE>
</LI>
</UL>
<P>С другой стороны, если Вы не используете при печати ghostscript, 
Вы должны действовать другим образом. В этом случае, не надо пытаться заставить 
Star Office думать, что Ваш принтер имеет фонты, ибо фактически в ROM принтера 
фонтов <EM>НЕТ</EM>, так что хотя <CODE>gv</CODE> будет корректно отображать 
postscript-файлы, Ваш принтер не способен будет распечатать их. 
Если у Вас postscript-принтер, главные различия в следующем:
<UL>
<LI>Не редактируйте PPD-файл.</LI>
<LI>Вместо того, чтобы с помощью <CODE>touch foo.pfb</CODE> создать пустые 
<CODE>pfb</CODE>-файлы. Вы должны иметь <CODE>pfb</CODE>-файлы 
postscript-фонта типа Type42. Фонт Type42 - это в действительности "TrueType фонт для принтера". 
Вы не замечаете фонтов Type42, даже если используете их, потому что 
большинство приложений используют их прозрачно. Для создания файлов фонтов 
Type42 используйте утилиту
<A HREF="ftp://ftp.dcs.ed.ac.uk/pub/jek/programs/ttfps.tar.gz">ttfps</A>.
<PRE>
        ttfps foo.ttf foo.pfb
</PRE>
</LI>
</UL>
<P>
<P>Существует несколько подводных камней. Иногда Star Office может не 
выбрать экранный фонт, который Вы хотите. Поэтому стоит проверить
<CODE>xp3/psstd.fonts</CODE> и, возможно, отредактировать его, 
чтобы убедиться, что Star Office действительно использует экранный фонт, 
который Вы имели в виду. Кроме того, Star Office не может корректно 
обрабатывать проблемы с конфигурацией. Если с конфигурацией что-то не 
в порядке, то вполне возможно, что текстовый процессор даже не запустится. 
Именно поэтому мы рекомендовали Вам сделать резервную копию 
каталога <CODE>xp3</CODE>.

<H3>То, что скрыто от глаз</H3>

<P>Если Вы хотите установить в Star Office фонты TrueType, Вам, возможно,  
необходимо узнать, как Star Office с ними работает. Когда Вы запускаете 
<CODE>spadmin</CODE> или <CODE>psetup</CODE>, происходит следующее:
<UL>
<LI>Star Office создает символические ссылки на <CODE>pfb</CODE>-файлы 
контуров в Вашем каталоге <CODE>xp3/pssoftfonts</CODE>.</LI>
<LI>Файл <CODE>afm</CODE> копируется в каталог <CODE>xp3/fontmetrics/afm/</CODE></LI>
<LI>В файл <CODE>xp3/psstd.fonts</CODE> добавляется одна запись. Этот 
файл хранит имена всех экранных фонтов, используемых 
Star Office (в частности, в нем задаются имена файлов контуров для 
экранных фонтов).
</LI>
</UL>
<P>Вот почему нужно создать резервную копию всего каталога <CODE>xp3</CODE> - 
только в этом случае можно будет легко вернуть  Star Office  к чистой 
конфигурации.

<H2><A NAME="ss7.4">7.4 Word Perfect</A>
</H2>

<P>По этому вопросу пока ничего нет. 
<A HREF="http://www.rodsbooks.com/wpfonts/">Web-страница Рода Смита</A> 
(Rod Smith) представляет собой хороший источник информации по 
установке фонтов в Word Perfect.
<HR>
<A HREF="Font-HOWTO-8.html">Далее</A>
<A HREF="Font-HOWTO-6.html">Назад</A>
<A HREF="Font-HOWTO.html#toc7">Оглавление</A>
</BODY>
</HTML>
