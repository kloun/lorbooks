<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux 2.4 Packet Filtering HOWTO: Как пакеты проходят фильтры</TITLE>
 <LINK HREF="packet-filtering-HOWTO-7.html" REL=next>
 <LINK HREF="packet-filtering-HOWTO-5.html" REL=previous>
 <LINK HREF="packet-filtering-HOWTO.html#toc6" REL=contents>
</HEAD>
<BODY>
<A HREF="packet-filtering-HOWTO-7.html">Next</A>
<A HREF="packet-filtering-HOWTO-5.html">Previous</A>
<A HREF="packet-filtering-HOWTO.html#toc6">Contents</A>
<HR>
<H2><A NAME="s6">6. Как пакеты проходят фильтры</A></H2>

<P>Ядро запускается с тремя списками правил в таблице фильтра пакетов;
эти списки называются <B>firewall chains</B> или просто
<B>chains</B> (цепочки).  Три цепочки называются так: <B>INPUT</B>,
<B>OUTPUT</B> и <B>FORWARD</B>.
<P>
<P><B>Это сильно отличается от того как работали ядра серий 2.0 и 2.2</B>
<P>
<P>Для фанатов ASCII-графики, цепочки устроены примерно так:
<PRE>
                          _____
Входящий                 /     \         Исходящий
       -->[Routing ]--->|FORWARD|------->
          [Decision]     \_____/        ^
               |                        |
               v                      ____
              ___                    /    \
             /   \                  |OUTPUT|
            |INPUT|                  \____/
             \___/                      ^
               |                        |
                --> локальные процессы -
</PRE>
<P>
<P>Три круга представляют три цепочки. Когда пакет приходит в определенный круг, цепочка исследуется
для того, чтобы определить, что делать с пакетом в дальнейшем. Если цепь говорит
что надо сбросить (DROP) пакет, пакет разрушается, если цепь разрешает прохождение
пакета (ACCEPT), пакет проходит к следующему шагу по диаграмме.
<P>
<P>Цепочка - это набор определенных <B>правил</B>.  Каждое правило говорит "если заголовок пакета выглядит так, значит надо делать с пакетом то-то". Если
правило не совпадает с пакетом, пакет переходит к следующему правилу в данной цепочке. Наконец,
если в цепочке не осталось больше правил совсем, ядро проверяет установленный <B>policy</B> 
(правило действующее по умолчанию для всей цепочки) 
для данной цепочки, чтобы решить что делать с пакетом дальше. В защищенных системах, policy обычно 
говорит ядру - разрушить пакет (DROP).
<P>
<OL>
<LI>Когда пакет приходит (скажем, через Ethernet карту) ядро сперва просматривает адрес назначения
пакета: это называется "маршрутизацией".
</LI>
<LI>Если пакет предназначен для этой машины, пакет проходит через диаграмму в цепочку INPUT. 
Если это так то любой процесс ожидающий данный пакет получит его.
</LI>
<LI>Иначе, если в ядре отключена возможность маршрутизации, или если ядро не знает как этот пакет
маршрутизировать, пакет разрушается. Если маршрутизация разрешена, и пакет предназначен для другого
сетевого интерфейса (если вы имеете его), пакет идет по нашей диаграмме прямо в цепочку FORWARD. 
если он разрешен (ACCEPT), он будет маршрутизирован.
</LI>
<LI>Наконец, программа работающая на самой машине может посылать пакеты. Такие пакеты будут проходить
через цепочку OUTPUT: если цепочка разрешает (ACCEPT) их, значит пакет продолжает свой путь на 
интерфейс для которого он предназначен.</LI>
</OL>
<P>
<HR>
<A HREF="packet-filtering-HOWTO-7.html">Next</A>
<A HREF="packet-filtering-HOWTO-5.html">Previous</A>
<A HREF="packet-filtering-HOWTO.html#toc6">Contents</A>
</BODY>
</HTML>
