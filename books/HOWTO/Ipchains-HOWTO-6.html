<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux IPCHAINS-HOWTO: Общие проблемы</TITLE>
 <LINK HREF="Ipchains-HOWTO-7.html" REL=next>
 <LINK HREF="Ipchains-HOWTO-5.html" REL=previous>
 <LINK HREF="Ipchains-HOWTO.html#toc6" REL=contents>
</HEAD>
<BODY>
<A HREF="Ipchains-HOWTO-7.html">Next</A>
<A HREF="Ipchains-HOWTO-5.html">Previous</A>
<A HREF="Ipchains-HOWTO.html#toc6">Contents</A>
<HR>
<H2><A NAME="s6">6. Общие проблемы</A></H2>

<P>
<P>
<H2><A NAME="ss6.1">6.1 ipchains -L замирает!</A>
</H2>

<P>Вы вероятно блокируете DNS; это будет приводить к таймаутам.
<P>Пробуйте использовать опцию "-n" (numeric) для ipchains, который подавляет 
преобразование имен.
<P>
<P>
<H2><A NAME="ss6.2">6.2 Маскарадинг/форвардинг не работают!</A>
</H2>

<P>Удостоверьтесь, что форвардинг пакетов разрешен (в последних версиях ядра, он 
не блокируется по умолчанию, что означает, что пакеты не приходят в цепочку
"forward"). Вы можете отменить этот (от root), введя команду
<PRE>
        # echo 1 > /proc/sys/net/ipv4/ip_forward
        #
</PRE>

Если это у вас сработает, то вы можете поместть эту строку куда-нибудь в ваши
загрузочные сценарии, чтобы она выполнялась при загрузке; firewalling должен
устанавливаться прежде, чем выполнится эта команда.
<P>
<P>
<P>
<H2><A NAME="ss6.3">6.3 -j REDIR не работает!</A>
</H2>

<P>Вы должны разрешить форвардинг пакетов (см. выше) для того, чтобы 
переназначение работало; иначе код маршрутизации отбрасывает пакет. Так, если 
вы используете только перенаправление, и вообще не используете форвардинг, то
вы должны знать об этом.
<P>Обратите внимание, что REDIR (находящийся во цепочке input) не вохдействует на
соединения из локального процесса.
<P>
<P>
<H2><A NAME="ss6.4">6.4 Уайлдкарты интерфейсов не работают!</A>
</H2>

<P>В версиях ядра 2.1.102 и 2.1.103 имелась ошибка (и некоторых старых моих
патчах), из-за которой не работали команды ipchains, в которых используется
уайлдкарты интерфейсов (например, -i ppp +).
<P>Это исправлено в последних ядрах, и в сети есть патч для ядра 2.0.34. Вы 
можете также установить его вручную на исходники ядра, заменив строку 63 или 
около того в include/linux/ip_fw.h:
<PRE>
      #define IP_FW_F_MASK    0x002F  /* All possible flag bits mask   */
</PRE>

Здесь должно стоять ``0x003F". Исправьте это, и пересоберите ядро.
<P>
<P>
<H2><A NAME="ss6.5">6.5 TOS не работает!</A>
</H2>

<P>Это было моей ошибкой: установка поля Type of Service фактически не 
устанавливала Type of Service в ядрах версий 2.1.102 - 2.1.111. Эта проблема 
была исправлена в 2.1.112.
<P>
<P>
<H2><A NAME="ss6.6">6.6 ipautofw and ipportfw не работают!</A>
</H2>

<P>Для 2.0.x это так; у меня нет времени на создание и поддержку 
гигантского патча для ipchains и ipautofw/ipportfw.
<P>Для 2.1.x скачайте ipmasqadm Juan Ciarlante'а с 
<A HREF="http://juanjox.linuxhq.com/">http://juanjox.linuxhq.com/</A>
и используйте его точно так же, как вы использовали бы ipautofw или ipportfw, 
за исключением того, что вместо ipportfw вы печатаете ipmasqadm portfw, а 
вместо ipautofw печатаете ipmasqadm autofw.
<P>
<P>
<H2><A NAME="ss6.7">6.7 xosview падает!!</A>
</H2>

<P>Возьмите версию 1.6.0 или выше, которым для ядер 2.1.x не требуются никаких
правил firewall. Эта ошибка автора, кажется, снова появилась в версии 1.6.1
(это не моя ошибка!).
<P>
<P>
<H2><A NAME="ss6.8">6.8 Segmentation Fault при `-j REDIRECT'!</A>
</H2>

<P>Это была ошибка в ipchains версии 1.3.3. Пожалуйста обновите.
<P>
<P>
<H2><A NAME="ss6.9">6.9 Я не могу установить таймауты маскарадинга!</A>
</H2>

<P>Это было так (для ядер 2.1.x) до 2.1.123. В 2.1.124 попытка установить таймаут
для маскарадинга вызывает зависание ядра (изменить return на ret = в строке
1328 net/ipv4/ip_fw.c). В 2.1.125 все прекрасно работает.
<P>
<P>
<H2><A NAME="ss6.10">6.10 Я хочу файерволлить IPX!</A>
</H2>

<P>Этим, как мне кажется, занимаются другие. К сожалению, мой код относится только 
к IP. On the good side, all the hooks are there to firewall IPX!
Вам только надо написать код; я счастлив буду помочь там, где возможно.
<P>
<HR>
<A HREF="Ipchains-HOWTO-7.html">Next</A>
<A HREF="Ipchains-HOWTO-5.html">Previous</A>
<A HREF="Ipchains-HOWTO.html#toc6">Contents</A>
</BODY>
</HTML>
