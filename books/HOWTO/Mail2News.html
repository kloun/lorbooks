<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Mail2News Mini-Howto</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Mail2News Mini-Howto</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Bek Oberin</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;    bekj@netizen.com.au
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
>    Перевод: <A
HREF="mailto:ave@asp-linux.com"
TARGET="_top"
>Александр Ермолаев</A
>,
    <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>v1.1, август 2000г.<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>Этот документ описывает, как настроить ваш сервер новостей и программу
mail2news. </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Mail2News.html#AEN17"
>Copyright and such</A
></DT
><DT
>2. <A
HREF="Mail2News.html#AEN21"
>Авторские права</A
></DT
><DT
>3. <A
HREF="Mail2News.html#AEN30"
>Введение</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="Mail2News.html#AEN36"
>Как приобрести mail2news</A
></DT
></DL
></DD
><DT
>4. <A
HREF="Mail2News.html#AEN41"
>Как это работает</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="Mail2News.html#AEN44"
>Почта, получаемая по списку рассылки</A
></DT
><DT
>4.2. <A
HREF="Mail2News.html#AEN48"
>Сообщения приходящие в местную группу новостей</A
></DT
></DL
></DD
><DT
>5. <A
HREF="Mail2News.html#AEN52"
>Настройка mail2news</A
></DT
><DT
>6. <A
HREF="Mail2News.html#AEN67"
>Procmail</A
></DT
><DT
>7. <A
HREF="Mail2News.html#AEN77"
>Настройка групп новостей и сервера новостей (innd)</A
></DT
><DT
>8. <A
HREF="Mail2News.html#AEN89"
>Если вам не удалось это сделать...</A
></DT
><DT
>9. <A
HREF="Mail2News.html#AEN92"
>Будущее</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN17"
>1. Copyright and such</A
></H1
><P
>The copyright of this document is retained by the author. Permission
is granted to distribute the document by electronic means and on CDs
provided that it is kept entirely in its original format. Permission
is also granted to print a copy of this document for personal use.</P
><P
>The republishing of this document in part or in whole without the
permission of the copyright holder by any means other than as noted
above is prohibited.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN21"
>2. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но так или иначе автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
>, или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN30"
>3. Введение</A
></H1
><P
>Почему иногда бывает нужно выкладывать новости, на которые вы подписались в
местную группу новостей?</P
><P
>Потому что, другие тоже могут на них подписаться, и, в результате получится,
что все будут качать одно и то же. А при подписке вашего сайта на новости
(или что-то другое), вы можете предоставить доступ к этим новостям всем
пользователям сайта или при помощи системы безопасности, наоборот, ограничить
доступ к ним некоторым пользователям.</P
><P
>При прочтении всей почты, при помощи программы для чтения новостей
вы можете поставить приоритеты и игнорирование. При этом вы сохраняете свой 
ящик более доступным для важных и срочных сообщений. </P
><P
>Это mini-HOWTO описывает создание скрипта для 'mail2news'.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN36"
>3.1. Как приобрести mail2news</A
></H2
><P
>Вы можете скачать архив mail2news вместе со скриптом и этим HOWTO с </P
><P
>&#13;<PRE
CLASS="PROGRAMLISTING"
>http://www.netizen.com.au/~bekj/code/mail2news/</PRE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN41"
>4. Как это работает</A
></H1
><P
>Гораздо проще понять, как это работает, можно проследив путь сообщения со
списка новостей в локальную группу новостей и другой вариант, при котором
сообщение сначала попадает в локальную группу новостей, а затем рассылается
пользователям.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN44"
>4.1. Почта, получаемая по списку рассылки</A
></H2
><P
>Когда сообщение из списка рассылки поступает на вашу машину, procmail
показывает, к какой группе новостей оно принадлежит, и передает его в
управление mail2news.</P
><P
>Скрипт mail2news обрабатывает это сообщение, прилагает к нему заголовок
и затем, при помощи rnews или inews, отсылает его в местную группу новостей.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN48"
>4.2. Сообщения приходящие в местную группу новостей</A
></H2
><P
>Местная группа новостей является модерируемой (сообщения кем-то
фильтруются), что позволяет воспользоваться преимуществами innd. Любое
сообщение, посланное в местную группу новостей, не сразу попадают в группу.
Они посылаются сначала модератору группы.</P
><P
>Если мы заменим модератора группы новостей на список рассылки, то все
местные сообщения в группу новостей будут автоматически выкладываться в
группу новостей демоном innd.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN52"
>5. Настройка mail2news</A
></H1
><P
>Скопируйте скрипт mail2news в удобное место. Лучше в 
/usr/local/bin.</P
><P
>Теперь вам нужно его отредактировать следующим способом:</P
><P
>&#13;<P
></P
><UL
><LI
><P
>удостоверьтесь, что в начале скрипта у вас идет ссылка на местную программу 
Perl.  Вы можеет выяснить где находится Perl, написав в командной строке
'whereis perl' или 'which perl'.  Если вы не смогли ее найти, то посмотрите в
 /usr/bin/perl это самое удобное место для размещения:


<PRE
CLASS="PROGRAMLISTING"
>#!/usr/bin/perl
# укажите реальное расположение perl</PRE
>

&#13;</P
></LI
><LI
><P
>Отредактируйте нижеследующую часть в соответствии с местонахождением
почтовой программы (я использую rnews, inews тоже будет работать) и хоста с
новостями:


<PRE
CLASS="PROGRAMLISTING"
># $inews = "/usr/bin/inews";
# $iopts = "-h -o \"mail2news gateway\"";
$inews = "/usr/bin/rnews";
$iopts = "";
$postinghost = "your.news.server";   # points at your news server</PRE
>
&#13;</P
></LI
><LI
><P
>Удостоверьтесь, что скрипт запускаем:


<PRE
CLASS="PROGRAMLISTING"
>chmod 755 /usr/local/bin/mail2news</PRE
>&#13;</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN67"
>6. Procmail</A
></H1
><P
>Файл настройки procmail находится в <TT
CLASS="FILENAME"
>/.procmailrc</TT
>.  Если у вас нет
файла procmailrc, то создайте его.</P
><P
>Сделайте запись для каждого списка рассылки которые поступают на ваш
локальный сервер новостей. Обычно это срабатывает, кроме случаев, когда все
рассылается с использованием Bcc (невидимые копии).</P
><P
>Например, если ваш список рассылки 'jokes@netizen.com.au' и вы хотите чтобы
группа новостей называлась 'lists.jokes', то ваша запись будет выглядеть
следующим образом:</P
><P
>&#13;<PRE
CLASS="PROGRAMLISTING"
>:0
* TOjokes@netizen.com.au
|/usr/local/bin/mail2news lists.jokes</PRE
>&#13;</P
><P
>Заметьте, что между 'TO' и адресом во второй строке нет пробела.</P
><P
>Вам понадобится поместить пустую строку между строками для каждой группы
новостей. Сделайте столько записей, сколько вам понадобится, используя 3
строки для каждой группы, но изменяя адрес и группы название новостей.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN77"
>7. Настройка групп новостей и сервера новостей (innd)</A
></H1
><P
>Создайте группы новостей на вашем сервере используя ctlinnd. Помните, что
это местные группы новостей, поэтому дайте им определенные названия, для
того, чтобы их в последствии можно было фильтровать.</P
><P
>Так же innd должен быть "уведомлен" о том, что группа модерируется (при
помощи ctlinnd). Помните, что innd очень придирчиво относится к правам
владения файлом и доступу к нему, поэтому вам необходимо обращаться с innd
как пользователю новостей. Указание на то что группа модерируется, делается
указанием ключа m в команде newgroup.</P
><P
>&#13;<PRE
CLASS="PROGRAMLISTING"
>ctlinnd newgroup lists.jokes m</PRE
>&#13;</P
><P
>Ключ m указывает innd, что группа модерируется.</P
><P
>Отредактируйте файл newsfeeds так, чтобы имена групп не повторялись.</P
><P
>Например, если ваш список рассылки называется local.site.group, то вам
лучше добавить во второе поле входящего (и возможно исходящего) потока
строку !local*.</P
><P
>Теперь для того чтобы сообщения пользователей посылаются автоматически
демоном innd, отредактируйте /etc/news/moderators путем включения строки в
которой указан адрес списка рассылки модератора.</P
><P
>&#13;<PRE
CLASS="PROGRAMLISTING"
>lists.jokes:jokes@netizen.com.au</PRE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN89"
>8. Если вам не удалось это сделать...</A
></H1
><P
> 
Если у вас это не работает, то вам придется проследить весь путь сообщений,
чтобы узнать, где находится ошибка. Полезными вещами окажутся журналы писем
и новостей.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN92"
>9. Будущее</A
></H1
><P
>Существует одна проблема с письмами, посланными таким способом - у них
будет заголовок группы новостей. Эта проблема в принципе не доставляет
много неприятностей. Было бы неплохо, если бы существовала программа,
которая их перехватывает и исправляет заголовки до того, как сообщения
отосланы.&#13;</P
></DIV
></DIV
></BODY
></HTML
>