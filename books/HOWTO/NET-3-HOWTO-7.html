<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Сетевая поддержка в Линуксе, Linux NET-3-HOWTO.: Использование распространенного сетевого оборудования.</TITLE>
 <LINK HREF="NET-3-HOWTO-8.html" REL=next>
 <LINK HREF="NET-3-HOWTO-6.html" REL=previous>
 <LINK HREF="NET-3-HOWTO.html#toc7" REL=contents>
</HEAD>
<BODY>
<A HREF="NET-3-HOWTO-8.html">Следующий</A>
<A HREF="NET-3-HOWTO-6.html">Предыдущий</A>
<A HREF="NET-3-HOWTO.html#toc7">Содержание</A>
<HR>
<H2><A NAME="s7">7. Использование распространенного сетевого оборудования.</A></H2>

<H2><A NAME="ss7.1">7.1 ISDN</A>
</H2>

<P>"Цифровая сеть интегрированных услуг" (Integrated Services Digital Network
(ISDN)) -- набор стандартов, определяющих коммутируемую цифровую сеть
общего назначения. "Вызов" ISDN создает синхронное соединение точка-точка. ISDN обычно работает на скоростных соединениях, разбитых на
некоторое количество "каналов". Существуют 2 типа каналов -- каналы
типа 'B', через которые передаются пользовательские данные и каналы
типа 'D', служащие для передачи управляющей информации. В Австралии,
например, ISDN работает, в частности, через каналы с пропускной
способностью 2Мбит/с, разбитого на 30 B-каналов с пропускной
способностью 64Кбит/с каждый и один 64Кбит/с D-канал. Вы можете
использовать любое количество каналов в любых сочетаниях. Например,
Вы можете установит 30 соединений 64-килобитных соединений с тридцатью
различными точками назначения, либо 15 128-килобитных соединений
(по два канала на каждое соединение) или использовать имеющиеся каналы
не полностью. Канал можно использовать как для исходящих, так и для
входящих соединений. Изначально ISDN предлагалось как средство для
телекоммуникационных компаний, которое позволило использовать единый
цифровой формат передачи для телефонных соединений, передачи данных
без дополнительных настроек.
<P>Существует несколько способов подключить Вашу машину к ISDN. Первый --
использовать устройство, называемое "Терминальным Адаптером"
(Terminal Adaptor). Это устройство подключается ко входу, установленному
Вашим поставщиком ISDN и эмулирует несколько последовательных интерфейсов.
Один из этих интерфейсов используется для передачи управляющей
информации и установления соединений, а остальные -- для передачи данных
после того, как соединения будут установлены. В этом случае Линукс будет
работать с этими интерфейсами (портами терминального адаптера) как с
обычными последовательными устройствами. Второй способ -- включение
поддержки ISDN в ядро -- позволяет установить ISDN-карту в Вашу машину,
после чего ядро будет самостоятельно заниматься установлением соединений
и работой по ISDN-протоколам.
<P><B>Опции компиляции ядра</B>:
<BLOCKQUOTE><CODE>
<PRE>
        ISDN subsystem  --->
                &lt;*> ISDN support
                [ ] Support synchronous PPP
                [ ] Support audio via ISDN
                &lt; > ICN 2B and 4B support
                &lt; > PCBIT-D support
                &lt; > Teles/NICCY1016PC/Creatix support
        
</PRE>
</CODE></BLOCKQUOTE>

<P>Реализация ISDN в Линуксе включает в себя поддержку нескольких ISDN-карт. Они перечислены в конфигурации ядра:

<UL>
<LI>ICN 2B и 4B</LI>
<LI>Octal PCBIT-D</LI>
<LI>ISDN-карты Teles и совместимые с ними.</LI>
</UL>

<P>Для настройки некоторых из этих карт надо получить у их производителя
специальные программы настройки.
<P>Подробная информация о настройке ISDN в Линуксе содержится в каталоге
<CODE>/usr/src/linux/Documentation/isdn/</CODE> и <EM>isdn4linux-FAQ</EM>,
доступном c 
<A HREF="http://www.lrz-muenchen.de/~ui161ab/www/isdn/">www.lrz-muenchen.de</A>.
(Включите опцию "english" для получения версии этого документа на английском
языке, вместо немецкого.)
<P><B>Замечание касательно PPP</B>. Протоколы семейства PPP работают как по
асинхронным, так и по синхронным каналам. Обычная версия демона <EM>pppd</EM>,
входящая в большинство дистрибутивов Линукса, поддерживает только
асинхронный режим работы. Для использования PPP поверх ISDN Вам
потребуется специальная версия pppd. О том, где взять эту версию, Вы
можете прочесть в упомянутой выше документации.
<H2><A NAME="ss7.2">7.2 Протокол PLIP в версиях ядра 2.0.*</A>
</H2>

<P>Устройствам, работающим по протоколу PLIP присваиваются имена `<CODE>plip0</CODE>',
`<CODE>plip1</CODE> и т.д.
<P><B>Опции компиляции ядра</B>:
<BLOCKQUOTE><CODE>
<PRE>
        Network device support  --->
            &lt;*> PLIP (parallel port) support
        
</PRE>
</CODE></BLOCKQUOTE>
                            
<P>Протокол <EM>plip</EM> (Parallel line IP) -- аналое протокола SLIP, но работающий
через параллельные порты Вашей машины (соответствующая разводка кабеля приведена
далее в этом документе). Так же как и SLIP, он создает соединение типа
<EM>точка-точка</EM>, но обеспечивает более высокую скорость соединения. Кроме того,
даже самые обычные принтерные порты можно использовать вместо относительно
дорогих карт на основе 16550AFN. Протокол PLIP довольно интенсивно использует
процессор по сравнению с последовательным интерфейсом, так что более
предпочтительной будет покупка недорогих ethernet-карт, но он вполне пригоден
для использования, когда подобной возможности нет. Обычно на хорошо работающем
PLIP-соединении можно достичь скорости 20 килобайт в секунду.
<P>PLIP-устройство работает с такой же аппаратурой, что и драйвер параллельного
порта, поэтому если Вы хотите их использовать одновременно, Вы должны будете
откомпилировать их в виде модулей. После этого Вы сможете указать этим драйверам,
какие порты должен использовать каждый из них. За подробностями о том, как
компилировать драйвера в виде модулей, обратитесь к ``Mudules mini-HOWTO''.
<P>К сожалению, на некоторых переносных компьютерах PLIP работать не будет,
так как они на них не поддерживаются некоторые используемые plip-интерфейсом
комбинации сигналов (эти сигналы не используются принтерами).
<P>Реализация протокола PLIP в Линуксе совместима с драйвером <EM>Crynwyr Packet
Driver PLIP</EM>, так что Вы сможете устанавливать plip-соединение между машиной
под Линуксом и DOS-машиной и запускать на них любое сетевое программное
обеспечение, использующее протокол tcp/ip.
<P>В ядрах версий 2.0.* ядро устанавливает следующее соответствие между
plip-устройствами и парами (порт,irq):

<BLOCKQUOTE><CODE>
<PRE>
        устройство  порт   IRQ
        ----------  -----  ---
        plip0       0x3bc  5
        plip1       0x378  7
        plip2       0x278  2
        
</PRE>
</CODE></BLOCKQUOTE>

<P>Если Ваш параллельный порт не подходит ни под одну из этих конфигураций,
Вы можете использовать команду параметр `<CODE>irq</CODE>' программы <EM>ifconfig</EM>.
Убедитесь, что Вы разрешили использование этих IRQ в ROM-BIOS. Другой способ --
использовать программу <EM>insmod</EM> с опциями ``<CODE>io=</CODE>'' и ``<CODE>irq=</CODE>''.
Например:

<BLOCKQUOTE><CODE>
<PRE>
        root# insmod plip.o io=0x288 irq=5
        
</PRE>
</CODE></BLOCKQUOTE>

<P>Работа PLIP зависит от двух параметров задающих величины ожидания. Значения
по умолчанию для этих параметров вполне подойдут в большинстве случаев,
необходимость увеличивать их возникает только на очень медленных машинах. При
этом увеличивать их следует на <B>другой</B> машине, соединенной с медленной.
Для изменения этих задержек существует программа <EM>plipconfig</EM>, избавляющая
от необходимости перекомпилировать ядро. Она входит во многие дистрибутивы
Линукса.
<P>Для настройки plip-интерфейса нужно выполнить следующие команды (или добавить
их в стартовые скрипты):

<BLOCKQUOTE><CODE>
<PRE>
        root# /sbin/ifconfig plip1 localplip pointopoint remoteplip
        root# /sbin/route add remoteplip plip1
        
</PRE>
</CODE></BLOCKQUOTE>

<P>В этом примере используется параллельный порт по адресу 0x378;
<EM>localplip</EM> и <EM>remoteplip</EM> -- имена или IP-адреса машин, соединенных
plip-соединением. Их можно хранить в файле <CODE>/etc/hosts</CODE>:

<BLOCKQUOTE><CODE>
<PRE>
        # для интерфейса plip
        192.168.3.1   localplip
        192.168.3.2   remoteplip
        
</PRE>
</CODE></BLOCKQUOTE>

<P>Параметр <EM>pointopoint</EM> имеет тот же смысл, что и для протокола SLIP --
он задает IP-адрес машины на другом конце соединения `точка-точка'.
<P>Вы можете использовать plip-интерфейс так, как если бы это был интерфейс SLIP,
за исключением того, что Вы не сможете (и необходимости в этом не возникнет)
использовать программы <EM>dip</EM> и <EM>slattach</EM> применительно к этому
интерфейсу.
<P>Дальнейшая информация содержится в ``PLIP mini-HOWTO''.
<H2><A NAME="ss7.3">7.3 Протокол PLIP в версиях ядра 2.2.*</A>
</H2>

<P>В процессе разработки версий ядра 2.1.* настройка интерфейса PLIP была
несколько изменена.
<P><B>Опции компиляции ядра</B>:
<BLOCKQUOTE><CODE>
<PRE>
        General setup  --->
            [*] Parallel port support
        Network device support  --->
            &lt;*> PLIP (parallel port) support
        
</PRE>
</CODE></BLOCKQUOTE>
                            
<P>Новая реализация plip работает так же, как и старая (используйте те же
самые команды <EM>ifconfig</EM> и <EM>route</EM>), однако инициализация устройства
будет происходить несколько иначе
<P>``Первое'' plip-устройство всегда получает имя ``plip0'', аналогично тому,
как это происходит с ethernet-картами. Реально используемый этим устройством
параллельный порт может быть любым из доступных системе параллельных портов
(информация о них содержится в каталоге <CODE>/proc/parport</CODE>. Например, если
у Вас в машине только один параллельный порт, этот каталог будет содержать
единственный подкаталог <CODE>/proc/parport/0</CODE>).
<P>Если ядро не смогло самостоятельно определить номер irq, используемый
портом, запуск ``<CODE>insmod plip</CODE>'' будет безуспешным. В этом случае
запишите нужный номер irq в файл <CODE>/proc/parport/0/irq</CODE> и запустите
<EM>insmod</EM> еще раз.
<P>Полная информация о работе с параллельными портами содержится в файле
<CODE>Documentation/parport.txt</CODE>, входящем в исходные тексты ядра.
<H2><A NAME="ss7.4">7.4 PPP</A>
</H2>

<P>Устройствам PPP ядро присваивает имена `<CODE>ppp0</CODE>', `<CODE>ppp1</CODE> и т.д.
Устройства нумеруются по очереди, первое созданное устройство получает имя
<CODE>ppp0</CODE>.
<P><B>Опции компиляции ядра</B>:
<BLOCKQUOTE><CODE>
<PRE>
        Networking options  --->
            &lt;*> PPP (point-to-point) support
        
</PRE>
</CODE></BLOCKQUOTE>

<P>Подробности о настройке PPP приведены в 
<A HREF="PPP-HOWTO.html">PPP-HOWTO</A>.
<H3>Поддержка постоянного ppp-соединения с помощью <EM>pppd</EM>.</H3>

<P>Если у Вас (полу-) постоянное подключение к интернет, и Вы хотите, чтобы Ваша
машина автоматически восстанавливала его при необходимости -- воспользуйтесь
программой <EM>pppd</EM>.
<P>Настройте ppp так, чтобы пользователь <CODE>root</CODE> мог запускать его командой
<BLOCKQUOTE><CODE>
<PRE>
root# pppd
</PRE>
</CODE></BLOCKQUOTE>
<P>В файле <CODE>/etc/ppp/options</CODE> <B>обязательно</B> должна присутствовать
опция `<CODE>-detach</CODE>'. После этого добавьте строчку
<BLOCKQUOTE><CODE>
<PRE>
pd:23:respawn:/usr/sbin/pppd
</PRE>
</CODE></BLOCKQUOTE>

в файл <CODE>/etc/inittab</CODE> (после строк запуска демонов <EM>getty</EM>).
Теперь процесс init будет перезапускать <EM>pppd</EM>, если тот ``умрет''.
<H2><A NAME="ss7.5">7.5 SLIP-клиент</A>
</H2>

<P>Устройствам SLIP ядро присваивает имена `<CODE>sl0</CODE>', `<CODE>sl1</CODE> и т.д.
Устройства нумеруются по очереди, первое созданное устройство получает имя
<CODE>sl0</CODE>.
<P><B>Опции компиляции ядра</B>:
<BLOCKQUOTE><CODE>
<PRE>
        Network device support  --->
            [*] Network device support
            &lt;*> SLIP (serial line) support
            [ ]  CSLIP compressed headers
            [ ]  Keepalive and linefill
            [ ]  Six bit SLIP encapsulation
        
</PRE>
</CODE></BLOCKQUOTE>

<P>SLIP (Serial Line Internet Protocol, Протокол интернет-соединений по
последовательным линиям) позволяет использовать для передачи tcp/ip
последовательные линии, будь то телефонная линия с подключенным модемом или
какая-нибудь выделенная линия. Для использования протокола SLIP Вам необходим
доступ к SLIP-серверу. Такие сервера доступны во многих учебных и коммерческих
учреждениях.
p>
Протокол SLIP использует для передачи IP-пакетов последовательный порт. Для
этого он должен иметь доступ к соответствующему последовательному устройству.
Для того, чтобы установить соответствие между slip-интерфейсами и
последовательными портами используется механизм  <EM>ioctl-вызовов</EM> (i/o
control). Настройка выполняется с помощью программ <EM>dip</EM> и
<EM>slattach</EM>.
<H3>dip</H3>

<P><EM>dip</EM> (Dialup IP) -- весьма интеллектуальная программа, позволяющая
устанавливать скорость работы последовательного порта, управлять модемом,
автоматически регистрироваться на удаленной машине после соединения,
принимать сообщения от SLIP-сервера и извлекать из них информацию о выделенном
IP-адресе и выполнять необходимые ioctl-вызовы для переключения
последовательного порта в SLIP-режим. Программа <EM>dip</EM> позволяет
самостоятельно писать скрипты для автоматизации подключения к удаленной машине.
<P>Вы можете получить эту программу с
<A HREF="ftp://sunsite.unc.edu/pub/Linux/system/Network/serial/dip/dip337o-uri.tgz">sunsite.unc.edu</A>.
<P>Для установки выполните следующие команды:

<BLOCKQUOTE><CODE>
<PRE>
        user% tar xvzf dip337o-uri.tgz
        user% cd dip-3.3.7o
        user% vi Makefile
        root# make install
       
</PRE>
</CODE></BLOCKQUOTE>

<P>В файле <CODE>Makefile</CODE> предполагается, что у Вас на машине заведена
группа <EM>uucp</EM>, но Вы можете при необходимости изменить ее на
<EM>dip</EM> или <EM>SLIP</EM>.
<H3>slattach</H3>

<P>В противоположность <EM>dip</EM>, программа <EM>slattach</EM> достаточно
проста и легка в использовании, но не имеет всех возможностей <EM>dip</EM>.
Эта программа не поддерживает скриптов, все что она делает -- это
настраивает последовательный порт. Предполагается, что Вы знаете все необходимые
параметры Вашего соединения и Вы уже установили последовательное соединение
с сервером перед тем как запустить <EM>slattach</EM>. Эта программа идеально
подходит в случае постоянного подключения к серверу по выделенной линии.
<H3>В каких случаях использовать какую программу?</H3>

<P>Советуем Вам использовать программу <EM>dip</EM> если Вы соединяетесь с
сервером с помощью модема по телефонной линии или у Вас другой тип
непостоянного соединения. В случае постоянного соединения по выделенной
линии (не требуется специальных действий для того, чтобы установить
последовательное соединение) используйте программу <EM>slattach</EM>.
Второй вариант подробно описан в разделе `Постоянное SLIP-соединение'.
<P>Настройка slip-интерфейса во многом похожа на настройку ethernet
(СМ. раздел `Ethernet'), однако есть несколько важных отличий.
<P>Во-первых, в slip-соединении участвуют только 2 машины. В отличие от
ethernet-сети, которая доступна все время, slip-соединение может
потребоваться специальным образом восстанавливать в ходе работы.
<P>Если Вы используете <EM>dip</EM>, slip-соединение устанавливается не в
момент загрузки, а несколько позже, когда Вам потребуется реально использовать
это соединение (эту процедуру можно автоматизировать). Если Вы используете
<EM>slattach</EM>, Вам потребуется добавить блок установки соединения в
файл <EM>rc.inet1</EM>. Подробности этого следуют ниже.
<P>SLIP-сервера делятся на 2 типа -- сервера с динамическим выделением
адресов (динамические сервера) и сервера со статическим выделением адресов
(статические сервера). Почти любой SLIP-сервер предложит Вам ввести имя
регистрации и пароль для установки соединения. Программа <EM>dip</EM>
производит регистрацию автоматически.
<H3>Сеансовое соединение, Статический SLIP-сервер и DIP.</H3>

<P>Статический SLIP-сервер выделяет Вам один и тот же IP-адрес при любом
соединении. Каждый раз, подключаясь к серверу, Вы настраиваете
slip-интерфейс на использование этого адреса. Статический SLIP-сервер
ответит на Ваш модемный вызов, предложит ввести имя регистрации и пароль,
а затем будет маршрутизировать IP-пакеты, адресованные на Ваш адрес
через созданный slip-интерфейс. В этом случае Вы можете добавить
соответствующие строчки в файлы <CODE>/etc/hosts</CODE>, <CODE>rc.inet2</CODE>,
<CODE>host.conf</CODE>, <CODE>resolv.conf</CODE>, <CODE>/etc/HOSTNAME</CODE> и
<CODE>rc.local</CODE>. Обратите внимание, что редактировать файл <CODE>rc.inet1</CODE>
не нужно -- настройка интерфейса будет целиком произведена программой
<EM>dip</EM>. Все что Вам нужно указать ей всю необходимую информацию о
Вашем последовательном порте.
<P>Можете перейти к разделу `Использование программы Dip' для того, чтобы
настроить <EM>dip</EM>.
<H3>Сеансовое соединение, Динамический SLIP-сервер и DIP.</H3>

<P>Динамический SLIP-сервер выделяет Вам при каждом соединении случайный
IP-адрес из набора доступных. Это означает, что нет никакой гарантии, что
данный момент времени Ваша машина имеет некоторый фиксированный IP-адрес,
и что адрес, который Вы использовали будет использован кем-то другим после
того как Вы прервали соединение. Администратор SLIP-сервера выделяет набор
адресов, и при каждой регистрации сервер находит первый неиспользованный
адрес, регистрирует пользователя, выделяет ему этот адрес и посылает
сообщение, содержащее этот адрес.
<P>Настройка для работы с таким типом сервера отличается только тем, что
Вам нужно получить от сервера IP-адрес и настроить slip-интерфейс в
соответствии с этим.
<P>Как и в предыдущем случае, программа <EM>dip</EM> выполнит все необходимые
действия, последние версии самостоятельно извлекают IP-адрес и настраивают
slip-интерфейс.
<P>Можете перейти к разделу `Использование программы Dip' для того, чтобы
настроить <EM>dip</EM>.
<H3>Использование программы DIP.</H3>

<P>Как уже было сказано ранее <EM>dip</EM> -- мощная программа, которая может
упростить и автоматизировать процесс соединения со SLIP-сервером,
регистрации на нем и настройки slip-интерфейса с помощью программ
<EM>ifconfig</EM> и <EM>route</EM>.
<P>Для использования <EM>dip</EM> пишется `dip-скрипт' -- набор команд,
понимаемых <EM>dip</EM>. Эти команды указывают как выполнять все необходимые
для установки соединения процедуры. Для того, чтобы понять основную идею,
можете взглянуть на файл <CODE>sample.dip</CODE>, идущий в комплекте с программой
<EM>dip</EM>. <EM>dip</EM> имеет множество опций, с которыми можно ознакомится
на man-странице, файле README и файлах-примерах из пакета <EM>dip</EM>.

p>Вы могли заметить, что в скрипте <CODE>sample.dip</CODE> предполагается, что Вы
соединяетесь со статическим SLIP-сервером, и выделенный Вам IP-адрес известен
заранее. Для динамических SLIP-серверов в последних версиях программы <EM>dip</EM>
предусмотрена возможность автоматически считывать и использовать выделенный
динамически IP-адрес. Приводящийся ниже пример -- модифицированный файл
<CODE>sample.dip</CODE> из пакета <EM>dip337j-uri.tgz</EM>. Он может послужить
хорошей отправной точкой. Можете скопировать его в <CODE>/etc/dipscript</CODE>
и отредактировать в соответствии с Вашей конфигурацией.

<BLOCKQUOTE><CODE>
<PRE>

#
# sample.dip    Dialup IP connection support program.
#
#               Этот файл иллюстрирует использование программы DIP.
#       Он был опробован на динамических серверах типа Annex, если Вы
#       используете статический сервер, используйте файл sample.dip из
#       пакета dip337-uri.tgz .
#
#
# Version:      @(#)sample.dip  1.40    07/20/93
#
# Author:       Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG>
#

main:
# Установка имени и адреса машины-сервера.
# В данном примере это 'xs4all.hacktic.nl' (== 193.78.33.42)
get $remote xs4all.hacktic.nl
# Установка маски на интерфейсе sl0 в 255.255.255.0
netmask 255.255.255.0
# Выбор последовательного порта и скорости соединения.
port cua02
speed 38400

# Сброс модема.
# Иногда приводит к проблемам!
reset

# "Стандартные" предопределенные значения переменной "errlevel":
#  0 - OK
#  1 - CONNECT
#  2 - ERROR
#
# Можете изменить их в функции "addchat()"

# Подготовка к дозвонке.
send ATQ0V1E1X4\r
wait OK 2
if $errlvl != 0 goto modem_trouble
dial 555-1234567
if $errlvl != 1 goto modem_trouble

# Соединение установлено.  Регистрация.
login:
sleep 2
wait ogin: 20
if $errlvl != 0 goto login_trouble
send MYLOGIN\n
wait ord: 20
if $errlvl != 0 goto password_error
send MYPASSWD\n
loggedin:

# Регистрация завершена.
wait SOMEPROMPT 30
if $errlvl != 0 goto prompt_error

# Перевести сервер в режим SLIP
send SLIP\n
wait SLIP 30
if $errlvl != 0 goto prompt_error

# Получение IP-адрес от сервера.
#   Здесь предполагается, что после перехода в режим SLIP сервер сообщает
#   выделенный IP-адрес
get $locip remote 30
if $errlvl != 0 goto prompt_error

# Установка параметров протокола SLIP.
get $mtu 296
# Выполнить "route add -net default xs4all.hacktic.nl"
default

# Завершение
done:
print CONNECTED $locip ---> $rmtip
mode CSLIP
goto exit

prompt_error:
print TIME-OUT waiting for sliplogin to fire up...
goto error

login_trouble:
print Trouble waiting for the Login: prompt...
goto error

password:error:
print Trouble waiting for the Password: prompt...
goto error

modem_trouble:
print Trouble occurred with the modem...
error:
print CONNECT FAILED to $remote
quit

exit:
exit
</PRE>
</CODE></BLOCKQUOTE>

<P>В приведенном примере предполагается, что вы соединяетесь с динамическим
SLIP-сервером. Если Вы используете статический сервер, используйте файл
<CODE>sample.dip</CODE> из пакета <EM>dip337-uri.tgz</EM>.
<P>Когда <EM>dip</EM> обрабатывает команду <EM>get $local</EM>, он ищет
в полученных данных строку, которая выглядит как IP-адрес, то есть числа,
разделенные символами `.'. Эта возможность была внесена специально для работы
с динамическими SLIP-серверами. Она дает возможность автоматизировать процесс
настройки на неизвестный заранее адрес.
<P>В приведенном примере маршрутизация по умолчанию производится через
slip-соединение, если для Вашей конфигурации это не подходит, уберите команду
default из скрипта. Если Вы запустите программу <EM>ifconfig</EM> после
окончания работы скрипта, Вы обнаружите устройство <EM>sl0</EM>. Это Ваш
slip-интерфейс. При необходимости Вы можете его перенастроить с помощью
программ <EM>ifconfig</EM> и <EM>route</EM> после того как программа
<EM>dip</EM> завершится.
<P>Программа <EM>dip</EM> позволяет выбрать много разных протоколов работы с
помощью команды <CODE>mode</CODE>, наиболее распространенный пример --
протокол сжатия данных <EM>cSLIP</EM>. Обе машины, участвующие в
slip-соединении должны установить одинаковый протокол работы.
<P>Приведенный пример достаточно надежен и корректно обработает большинство
возможных ошибок при соединении. Более подробная информация содержится
на man-странице программы <EM>dip</EM>. Кроме того, Вы можете написать
скрипт который будет пытаться перезванивать несколько раз в течении
заданного периода времени или даже перебирать по очереди доступные
SLIP-сервера, если их несколько.
<H3>Постоянное SLIP-соединение по выделенной линии и программа slattach.</H3>

<P>Если у вас есть выделенная линия или прямой кабель между двумя машинами, или
какой-либо другой тип постоянного последовательного соединения, у Вас нет
необходимости вникать во все сложности использования программы <EM>dip</EM>.
Очень простая в использовании программа <EM>slattach</EM> позволит Вам
настроить slip-соединение.
<P>Поскольку речь идет о постоянном соединении, Вам потребуется добавить несколько
команд в файл <CODE>rc.inet1</CODE>. Фактически, все что Вам нужно сделать -- это
настроить скорость работы последовательного интерфейса и перевести его в режим
SLIP. Именно для этого и предназначена программа <EM>slattach</EM>.
Добавьте следующие строки в файл <CODE>rc.inet1</CODE>:

<BLOCKQUOTE><CODE>
<PRE>
        #
        # Установка статического slip-соединения по выделенной линии
        #
        # настройка /dev/cua0 на скорость 19.2kbps и протокол cslip
        /sbin/slattach -p cslip -s 19200 /dev/cua0 &amp;
        /sbin/ifconfig sl0 IPA.IPA.IPA.IPA pointopoint IPR.IPR.IPR.IPR up
        #
        
</PRE>
</CODE></BLOCKQUOTE>


Где:

<DL>
<P>
<DT><B>IPA.IPA.IPA.IPA</B><DD><P>Ваш IP-адрес.
<P>
<DT><B>IPR.IPR.IPR.IPR</B><DD><P>IP-адрес машины на другом конце соединения.
</DL>

<P>Программа <EM>slattach</EM> выделяет первый неиспользуемый slip-интерфейс
для работы через указанное последовательное устройство, начиная с <EM>sl0</EM>.
Таким образом, первый вызов <EM>slattach</EM> связывает указанное
устройство с интерфейсом <EM>sl0</EM>, второй вызов -- с интерфейсом <EM>sl0</EM>,
и т.д.
<P><EM>slattach</EM> позволяет указывать разные протоколы соединения с помощью
опции <CODE>-p</CODE>. Как правило это протоколы <EM>SLIP</EM> или <EM>cSLIP</EM>,
в зависимости от того, используете ли Вы сжатие данных или нет. Внимание! Обе
связывающиеся машины должны использовать один и тот же протокол.
<H2><A NAME="ss7.6">7.6 SLIP-сервер.</A>
</H2>

<P>Если у Вас есть подключенная к сети машина, через которую Вы хотите подключатся
с других машин по последовательным линиям, Вы должны настроить эту машину как
сервер. Если Вы выбрали в качестве протокола SLIP у Вас есть три варианта
такой настройки. Автор предпочитает пользоваться первым -- программой
<EM>sliplogin</EM>, самой легкой в настойке и освоении, но будут описаны и
другие, так что Вы можете самостоятельно сделать выбор.
<H3>SLIP-сервер на базе программы <EM>sliplogin</EM>.</H3>

<P><EM>sliplogin</EM> -- программа, которую Вы можете использовать вместо командного
интерпретатора для пользователей, которые подключаются к Вашему серверу по
протоколу SLIP. Она позволяет Вашей машине быть как статическим (пользователю
всегда выделяется фиксированный IP-адрес), так и динамическим (пользователь
получает при регистрации первый свободный IP-адрес из заданного набора)
SLIP-сервером. <EM>sliplogin</EM> преобразует терминал в slip-соединение.
<P>Пользователь регистрируется так же как и при локальной регистрации, вводя
имя регистрации и пароль, но вместо обычного командного интерпретатора
запускается <EM>sliplogin</EM>. Она ищет в файле <CODE>/etc/slip.hosts</CODE>
строку, соответствующую введенному имени регистрации. Если такая строка
находится, <EM>sliplogin</EM> настраивает последовательную линию на режим
8 бит без стоп-битов и переводит ее в режим SLIP. После этого запускается
скрипт, который настраивает slip-интерфейс на использование нужного IP-адреса,
маски и настраивает маршрутизацию. Этот скрипт обычно называется
<CODE>/etc/slip.login</CODE>, но как и в случае с <EM>getty</EM>, Вы можете для
некоторых пользователей создать специальные инициализационные скрипты с именами
<CODE>/etc/slip.login.loginname</CODE>, которые запустятся при регистрации этого
пользователя.
<P>Для полной настройки программы <EM>sliplogin</EM> Вам потребуется отредактировать
4 (иногда 5) файла. Это файлы:

<UL>
<LI><CODE>/etc/passwd</CODE>, для создания пользователей.</LI>
<LI><CODE>/etc/slip.hosts</CODE>, содержащий информацию, специфичную для каждого
из slip-пользователей.</LI>
<LI><CODE>/etc/slip.login</CODE>, настраивающий маршрутизацию для пользователя
после регистрации.</LI>
<LI><CODE>/etc/slip.tty</CODE>, этот файл нужен только в случае динамического
SLIP-сервера. Он содержит список допустимых IP-адресов</LI>
<LI><CODE>/etc/slip.logout</CODE> -- содержащий команды, которые надо выполнить
после отключения пользователя.</LI>
</UL>

<H3>Где взять <EM>sliplogin</EM></H3>

<P>Пакет <EM>sliplogin</EM> входит во многие дистрибутивы, поэтому он уже может
быть установлен на Вашей машине. Если это не так, Вы можете получить его с
<A HREF="ftp://sunsite.unc.edu/pub/linux/system/Network/serial/sliplogin-2.1.1.tar.gz">sunsite.unc.edu</A>. В состав пакета входят исходные тексты, откомпилированные
программы и man-страница.
<P>Для того, чтобы доступ к <EM>sliplogin</EM> имели только нужные пользователи,
добавьте в файл <CODE>/etc/group</CODE> подобную строку:

<BLOCKQUOTE><CODE>
<PRE>
 ..
slip::13:radio,fred
 ..
</PRE>
</CODE></BLOCKQUOTE>

<P>Когда Вы устанавливаете пакет <EM>sliplogin</EM>, группой-владельцем программы
<EM>sliplogin</EM> устанавливается группа <CODE>slip</CODE>, и только пользователи из этой
группы могут запускать <EM>sliplogin</EM>. В приведенном примере запускать
<EM>sliplogin</EM> смогут только пользователи <CODE>radio</CODE> и <CODE>fred</CODE>.
<P>Для установки пакета используйте следующие команды:

<BLOCKQUOTE><CODE>
<PRE>
user% cd /usr/src
user% gzip -dc .../sliplogin-2.1.1.tar.gz | tar xvf -
user% cd sliplogin-2.1.1
user% &lt;..отредактируйте файл Makefile если Вы не используете механизм теневых паролей ..>
root# make install
</PRE>
</CODE></BLOCKQUOTE>

<P>Если Вы хотите перекомпилировать программу перед установкой, добавьте
команду <CODE>make clean</CODE> перед <CODE>make install</CODE>. Если Вы хотите установить
<EM>sliplogin</EM> не в каталог /sbin, а в какой-либо другой, отредактируйте
правило <EM>install</EM> в файле <CODE>Makefile</CODE>.
<P>Дополнительная информация содержится в файле <CODE>README</CODE>, входящем в состав
пакета.
<H3>Настройка файла <CODE>/etc/passwd</CODE> для работы со SLIP.</H3>

<P>Как правило, Вам потребуется завести в файле <CODE>/etc/passwd</CODE>
специальных пользователей, для тех, кто использует Вашу машину в качестве
SLIP-сервера. Повсеместно используется следующее правило присвоения имен:
имя пользователя получается из заглавной 'S' и имени машины. Например,
если с Вашим сервером соединяется машина <CODE>radio</CODE>, то в файле
<CODE>/etc/passwd</CODE> будет запись следующего вида:

<BLOCKQUOTE><CODE>
<PRE>
Sradio:FvKurok73:1427:1:radio SLIP login:/tmp:/sbin/sliplogin
</PRE>
</CODE></BLOCKQUOTE>


В целом не очень важно, как будет называться пользователь, главное чтобы
имена не создавали путаницы.
<P>Замечание: Для этих пользователей не нужно создавать ``домашние каталоги'',
в качестве такого каталога можно указать <CODE>/tmp</CODE>. Обратите внимание,
что в качестве командного интерпретатора используется <EM>sliplogin</EM>.
<H3>Файл <CODE>/etc/slip.hosts</CODE></H3>

<P><EM>sliplogin</EM> ищет в этом файле информацию, которая относится к
зарегистрировавшемуся пользователю. В этом файле указывается IP-адрес
и маска, которые будут присвоены пользователю после регистрации. Например,
информация для машины <CODE>radio</CODE>, которая получает статический IP-адрес
и машины <CODE>albert</CODE>, которая получает динамический IP-адрес может выглядеть
так:

<BLOCKQUOTE><CODE>
<PRE>
#
Sradio   44.136.8.99   44.136.8.100  255.255.255.0  normal      -1
Salbert  44.136.8.99   DYNAMIC       255.255.255.0  compressed  60
#
</PRE>
</CODE></BLOCKQUOTE>


Строки в файле <CODE>/etc/slip.hosts</CODE> делятся на следующие поля:

<OL>
<LI>имя регистрации пользователя.</LI>
<LI>IP-адрес сервера, т.е. этой машины.</LI>
<LI>IP-адрес, который надо присвоить пользователю. Если это поле имеет
значение <CODE>DYNAMIC</CODE> то IP-адрес будет выделен на основе информации из
файла <CODE>/etc/slip.tty</CODE> (СМ. ниже). <B>Внимание!</B>
Вы должны использовать версию sliplogin не менее 1.3 для того чтобы пользоваться
этой возможностью.</LI>
<LI>маска, присваиваемая пользователю в десятичной записи. Например
255.255.255.0 для маски сети класса C.</LI>
<LI>Режим протокола SLIP при работе с этим пользователем. Допустимые значения
"<CODE>normal</CODE>", "<CODE>compressed</CODE>" и некоторые другие.</LI>
<LI>Временная задержка, в течении которой программа будет ожидать данных.
Если в течении этого периода не будет передано или получено ни одного IP-пакета
соединение будет автоматически разорвано. Если Вы не хотите, чтобы это
происходило, задайте отрицательное значение этого параметра.</LI>
<LI>дополнительные параметры.</LI>
</OL>

<P>Замечание: В полях 2 и 3 Вы можете использовать IP-адреса, так и имена.
Если Вы используйте имена, убедитесь что эти имена удается преобразовать в
IP-адреса, иначе регистрация не выполнится. Для проверки попробуйте
запустить telnet на машину с нужным именем, если Вы увидите сообщение вида
`<EM>Trying nnn.nnn.nnn...</EM>' то преобразование было успешным -- Ваша машина
смогла определить IP-адрес для этой машины. Иначе Вы получите сообщение
`<EM>Unknown host</EM>' -- в этом случае задайте IP-адрес явно или проверьте
настройки системы преобразования имен (СМ. раздел <CODE>Система преобразования имен</CODE>).
<P>Чаще всего используются режимы SLIP

<DL>
<P>
<DT><B>normal</B><DD><P>SLIP без сжатия данных.
<P>
<DT><B>compressed</B><DD><P>сжатие заголовков пакетов (cSLIP)
</DL>


Эти два режима взаимоисключающие -- Вы не можете использовать их одновременно.
Остальные опции описаны на man-странице.
<H3>Файл <CODE>/etc/slip.login</CODE>.</H3>

<P>Если <EM>sliplogin</EM> нашел в файле <CODE>/etc/slip.hosts</CODE> подходящую
запись, он пытается выполнить скрипт <CODE>/etc/slip.login</CODE>. Этот скрипт
настраивает slip-интерфейс на сервере.
<P>Пример файла <CODE>/etc/slip.login</CODE>, включенный в пакет <EM>sliplogin</EM>
выглядит так:

<BLOCKQUOTE><CODE>
<PRE>
#!/bin/sh -
#
#       @(#)slip.login  5.1 (Berkeley) 7/1/90
#
# инициализационный скрипт для SLIP-сервера. Параметры:
#     $1               $2       $3    $4, $5, $6 ...
#   имя_интерфейса  скорость    pid   параметры из файла slip.host
#
/sbin/ifconfig $1 $5 pointopoint $6 mtu 1500 -trailers up
/sbin/route add $6
arp -s $6 &lt;hw_addr> pub
exit 0
#
</PRE>
</CODE></BLOCKQUOTE>


Этот скрипт использует программы <EM>ifconfig</EM> и <EM>route</EM> для
настройки slip-интерфейса, точно так же, как это делает программа
<EM>slattach</EM>.
<P>Кроме того последняя команда скрипта создает ARP-запись, для того, чтобы
машины в локальной сети сервера могли соединятся с удаленной машиной.
В поле <CODE>&lt;hw_addr></CODE> вы должны указать аппаратный адрес
ethernet-карты на сервере. Если сервер не подключен к локальной сети,
эту команду можно опустить.
<H3>Файл <CODE>/etc/slip.logout</CODE>.</H3>

<P>Когда последовательное соединение завершается, нужно вернуть slip-устройсво
в исходное состояние, так чтобы следующие slip-пользователи могли нормально
регистрироваться. Для этого используется файл <CODE>/etc/slip.logout</CODE>.
Это скрипт, вызывающийся с теми же параметрами, что и <CODE>/etc/slip.login</CODE>.

<BLOCKQUOTE><CODE>
<PRE>
        #!/bin/sh -
        #
        #               slip.logout
        #
        /sbin/ifconfig $1 down
        arp -d $6
        exit 0
        #
        
</PRE>
</CODE></BLOCKQUOTE>


В данном примере он дезактивирует интерфейс и удаляет arp-запись. Если сервер
не подключен к локальной сети, запуск <EM>arp</EM> можно опустить.
<H3>Файл <CODE>/etc/slip.tty</CODE>.</H3>

<P>Если Ваш сервер поддерживает динамическое выделение адресов и некоторые из
записей в файле <CODE>/etc/slip.hosts</CODE> имеют значение <CODE>DYNAMIC</CODE>
в поле IP-адреса, то Вы должны создать файл <CODE>/etc/slip.tty</CODE>,
содержащий список адресов для каждого из портов.
<P>Файл <CODE>/etc/slip.tty</CODE> содержит список устройств <EM>tty</EM>,
настроенных на работу по протоколу SLIP и IP-адреса, которые надо присваивать
пользователю при соединении через эти устройства.

Пример такого файла:
<BLOCKQUOTE><CODE>
<PRE>
# slip.tty    список соответствий tty -> IP-адрес
# формат: /dev/tty?? xxx.xxx.xxx.xxx
#
/dev/ttyS0      192.168.0.100
/dev/ttyS1      192.168.0.101
#
</PRE>
</CODE></BLOCKQUOTE>

<P>Этот файл указывает что при соединении через устройство <CODE>/dev/ttyS0</CODE>
для пользователей с полем <CODE>DYNAMIC</CODE> в файле <CODE>/etc/slip.hosts</CODE>
будет присвоен адрес <CODE>192.168.0.100</CODE>.
<P>При такой системе Вам достаточно выделить по одному адресу для каждого
последовательного порта, при этом количество потраченных адресов будет
минимальным.
<H3>SLIP-сервер на базе программы <EM>dip</EM>.</H3>

<P>Часть приведенной в этом разделе информации взята с man-страницы программы
<EM>dip</EM>, на которой вкратце описано ее использование в качестве
slip-сервера. Кроме того эта информация относится к версии
<EM>dip337o-uri.tgz</EM> пакета <EM>dip</EM>, в других версиях возможны
изменения.
<P>В <EM>dip</EM> есть ``входной'' режим работы, при котором автоматически
отыскивается запись в файле <CODE>/etc/diphosts</CODE> о пользователе,
который запустил <EM>dip</EM>, и в соответствии с ней настраивается
интерфейс и соединение переводится в режим SLIP. Чтобы запустить <EM>dip</EM>
в таком режиме, нужно выполнить команду <EM>diplogin</EM>. Чтобы использовать
<EM>dip</EM> в качестве SLIP-сервера, нужно создать пользователей, у которых
в качестве командного интерпретатора указан <EM>diplogin</EM>.
<P>Сначала Вы должны создать ссылку:

<BLOCKQUOTE><CODE>
<PRE>
# ln -sf /usr/sbin/dip /usr/sbin/diplogin
</PRE>
</CODE></BLOCKQUOTE>

<P>После этого добавьте записи в файлы <CODE>/etc/passwd</CODE> и
<CODE>/etc/diphosts</CODE>. Чтобы использовать <EM>dip</EM> в качестве
SLIP-сервера создайте пользователей с командным интерпретатором
<EM>diplogin</EM>. Обычно имена этих пользователей делают начинающимися
на заглавное `S', например `Sfredm'. Строка в файле <CODE>/etc/passwd</CODE>
для такого пользователя будет выглядеть так:

<BLOCKQUOTE><CODE>
<PRE>
Sfredm:ij/SMxiTlGVCo:1004:10:Fred:/tmp:/usr/sbin/diplogin
^^         ^^        ^^  ^^   ^^   ^^   ^^
|          |         |   |    |    |    \__ командный интерпретатор diplogin
|          |         |   |    |    \_______ Домашний каталог
|          |         |   |    \____________ Полное имя
|          |         |   \_________________ ID группы
|          |         \_____________________ ID пользователя
|          \_______________________________ Зашифрованный пароль
\__________________________________________ имя пользователя
</PRE>
</CODE></BLOCKQUOTE>

<P>После того, как программа <EM>login</EM> успешно зарегистрирует
такого пользователя будет выполнена программа <EM>diplogin</EM>.
<EM>dip</EM> при таком запуске переходит во ``входной'' режим, и вызывает
функцию <EM>getuid()</EM>, чтобы определить текущего пользователя. После
этого в файле <CODE>/etc/diphosts</CODE> ищется первая подходящая строка с
нужным именем пользователя или <EM>tty</EM> устройством и <EM>dip</EM>
выполняет все нужные настройки. Помещая запись о пользователе в файл
<CODE>diphosts</CODE> Вы создаете для него специальную конфигурацию
для остальных пользователей будет выбрана конфигурация по умолчанию.
Таким образом вы можете создавать пользователей со статическим или
динамическим адресом.

<EM>dip</EM> автоматически создает arp-запись при работе во ``входном''
режиме, так что Вам не нужно беспокоится создании и удалении этих записей
вручную.
<H3>Файл <CODE>/etc/diphosts</CODE>.</H3>

<P>Файл <CODE>/etc/diphosts</CODE> используется программой <EM>dip</EM>. В этом файле
хранятся настройки для удаленных машин. Это могут быть машины, которые
используют Вашу машину в качестве сервера или машины, которые Вы используете
в качестве сервера. Формат этого файла следующий:

<BLOCKQUOTE><CODE>
<PRE>
 ..
Suwalt::145.71.34.1:145.71.34.2:255.255.255.0:SLIP uwalt:CSLIP,1006
ttyS1::145.71.34.3:145.71.34.2:255.255.255.0:Dynamic ttyS1:CSLIP,296
 ..
</PRE>
</CODE></BLOCKQUOTE>


Каждая строка состоит из нескольких полей:

<OL>
<LI><CODE>имя пользователя</CODE>: имя, возвращаемое getpwuid(getuid()) или имя tty.</LI>
<LI><CODE>не используется</CODE>: для совместимости с passwd</LI>
<LI><CODE>Удаленный адрес</CODE>: IP-адрес удаленной машины или ее имя</LI>
<LI><CODE>Local Address</CODE>: IP-адрес этой машины или ее имя</LI>
<LI><CODE>Маска</CODE>: IP-маска в десятичной записи</LI>
<LI><CODE>Комментарий</CODE>: можете вносить сюда свои примечания.</LI>
<LI><CODE>протокол</CODE>: Slip, CSlip и др.</LI>
<LI><CODE>MTU</CODE>: десятичное число</LI>
</OL>


Пример такой строки:

<BLOCKQUOTE><CODE>
<PRE>
Sfredm::145.71.34.1:145.71.34.2:255.255.255.0:SLIP uwalt:SLIP,296
</PRE>
</CODE></BLOCKQUOTE>


Эта строка определяет соединение с машиной по адресу 145.71.34.1 по
протоколу SLIP с mtu 296.

Или:

<BLOCKQUOTE><CODE>
<PRE>
Sfredm::145.71.34.1:145.71.34.2:255.255.255.0:SLIP uwalt:CSLIP,1006
</PRE>
</CODE></BLOCKQUOTE>


Эта строка определяет соединение с машиной по адресу 145.71.34.2 по
протоколу cSLIP с mtu 1006.
<P>Все пользователи, которым адрес выделяется статически, должны иметь свои
строчки в файле <CODE>/etc/diphosts</CODE>. Если Вы хотите, чтобы адрес
присваивался динамически -- создайте запись для <CODE>tty</CODE>-устройства
и не создавайте записи для этого пользователя. Обязательно создайте по
одной записи для каждого <CODE>tty</CODE>-устройства, которое используется для
доступа по протоколу SLIP, чтобы пользователь всегда получил настроенное
соединение независимо от того, по какой линии он дозвонился.
<P>Когда пользователь устанавливает соединение, ему предлагают ввести имя
и пароль как при обычной локальной регистрации. Пользователь должен
ввести slip-имя и пароль. Если регистрация проходит успешно, пользователю
будет достаточно переключится в slip-режим. При этом соединение со стороны
сервера будет настроено в соответствии с информацией из файла <CODE>diphosts</CODE>.
<H3>SLIP-сервер на базе пакета <EM>dSLIP</EM>.</H3>

<P>Матт Дилон (Matt Dillon <CODE>&lt;dillon@apollo.west.oic.com></CODE>)
написал пакет, который позволяет Вашей машине быть slip-сервером и
slip-клиентом. Этот пакет состоит из множества маленьких программ
и скриптов, управляющих slip-соединением. Для нормальной работы пакета
Вы должны установить пакет <EM>tcsh</EM>. В состав <EM>dSLIP</EM> включена
программа <EM>expect</EM>, и Вам возможно потребуется небольшой опыт работы
с этой программой для того, чтобы настроить пакет под свои нужды. Это
несложно, так что не пугайтесь.
<P>Файл README содержит очень хорошие инструкции по установке пакета, так что
нет смысла повторять их здесь.
<P>Пакет <EM>dSLIP</EM> можно получить с домашнего сайта
<A HREF="ftp://apollo.west.oic.com/pub/linux/dillon_src/dSLIP203.tgz">apollo.west.oic.com</A> или с
<A HREF="ftp://sunsite.unc.edu/pub/Linux/system/Network/serial/dSLIP203.tgz">sunsite.unc.edu</A>.

Прочтите файл <CODE>README</CODE>, создайте нужные записи в файлах
<CODE>/etc/passwd</CODE> и <CODE>etc/group</CODE> и выполните команду
<CODE>make install</CODE>.
<HR>
<A HREF="NET-3-HOWTO-8.html">Следующий</A>
<A HREF="NET-3-HOWTO-6.html">Предыдущий</A>
<A HREF="NET-3-HOWTO.html#toc7">Содержание</A>
</BODY>
</HTML>
