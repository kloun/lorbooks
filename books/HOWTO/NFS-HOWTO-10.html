<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>NFS HOWTO: NFS в Linux 2.2 </TITLE>
 <LINK HREF="NFS-HOWTO-11.html" REL=next>
 <LINK HREF="NFS-HOWTO-9.html" REL=previous>
 <LINK HREF="NFS-HOWTO.html#toc10" REL=contents>
</HEAD>
<BODY>
<A HREF="NFS-HOWTO-11.html">Следующий</A>
<A HREF="NFS-HOWTO-9.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc10">Содержание</A>
<HR>
<H2><A NAME="linuxtwotwo"></A> <A NAME="s10">10. NFS в Linux 2.2 </A></H2>

<P>Как я написал, Linux 2.2.12 является текущей версией ядра и для
использования NFS в нем может быть нужно будет выполнить немного рутинной
работы. Или не нужно.
<P>
<P>Каким будет статус NFS в Linux 2.4 я не знаю.
<P>
<P>Большим новшеством в  Linux 2.2 является поддержка демона nfs в ядре,
который называется knfsd. Этот способ реализации nfsd имеет некоторые
преимущества, главный из которых&nbsp;-- скорость работы. Машина с Linux
2.2 и knfsd является солидным сервером nfs.  Вы все равно можете
использовать старый nfsd с Linux 2.2, и также существует несколько
преимуществ, в основном простота.
<P>
<P>Если вы используете исходные тексты ядра или двоичные пакеты, созданные
кем-то типа RedHat (6.0 и поздние), SuSE (6.1 или более поздние) или
каким-то другим профессиональным системным интегратором, то скорее всего
они будут поставляться с полной интеграцией "knfsd" в ядро и вы не должны
будете беспокоится. В большинстве случаев. До тех пор пока вы не заходите
скомпилировать ядро сами. Если вы используете обычное ядро Linux 2.2  (по
крайней мере 2.2.12), то knfsd не будет работать.
<P>
<P>Для того, чтобы самому заставить это работать вам необходимо взять пакет 
knfsd сделанный H.J. Lus. Этот пакет является набором заплаток и
необходимых утилит для ядер серии 2.2, которые  Lu сопровождает в свое
свободное время. Вы можете взять его с вашего локального зеркала сервера
ядра, или с основного сервера, по адресу 
<A HREF="ftp://ftp.kernel.org/pub/linux/devel/gcc/">ftp.kernel.org:/pub/linux/devel/gcc/</A>. <B>Он не предназначается для 
всеобщего использования</B>. Если этот пакет вам непонятен, то не пытайтесь
использовать его сами. Подождите пока пакеты с ядром не выпустит ваш
любимый системный интегратор (например, Red Hat, SuSE или ...).
<P>
<P>Также, пожалуйста не посылайте мне вопросы об этом пакете, я не могу
помочь вам. У меня нет ни одного сервера с работающим  knfsd. Если вы нашли 
ошибку или пропуск в документации, то пожалуйста напишите мне, я исправлю
этот документ и выпущу его снова.
<P>
<P>Все еще читаете?  Ok. H.J.Lu посылает сообщения о новых версиях своего
пакета в список рассылки linux-kernel. Другие сообщения, относящиеся к NFS
в версии ядра 2.2 также посылаются туда. Читайте их.
<P>
<P>Существует одна интересная вещь, которую необходимо сказать о пакете
knfsd. Он анонсирует, что использует NFS версии 3. Однако он не
поддерживает эту версию. Существует опция, которую вы можете использовать
для того, чтобы запретить пакету анонсирование NFS3, или на клиентах
необходимо указать опцию "<CODE>vers=2</CODE>" среди других опций монтирования.
<P>
<H2><A NAME="ss10.1">10.1 Клиент</A>
</H2>

<P>Клиент очень прост. Для того, чтобы получить правильное блокирование вам 
необходимо иметь <CODE>statd</CODE> (из пакета knfsd) скомпилированным,
установленным и запещуееным из загрузочных скриптов. Сделайте это. Для
работы statd необходим каталог <CODE>/var/lib/nfs</CODE>, иначе он просто
прекратит работу без каких либо сообщений об ошибках, так что необходимо
создать каталог до запуска программы.
<P>
<P>Когда statd уже запущен вы можете использовать программу <CODE>testlk</CODE> (в
каталоге <CODE>tools/locktest</CODE>) для тестирования того, что блокировка
файлов работает на файловых системах смонтированных по NFS. Она должна
работать нормально. Если программа сообщает <EM>No locks available
(Блокировки не доступны)</EM>, то statd не работает.
<P>
<P>В действительности вы также можете полностью избежать блокировок
(заметьте, что я не рекомендую вам делать это), используя параметр
"<CODE>nolock</CODE>" в списке опций монтирования.
<P>
<P>Насколько я знаю--это все, что необходимо для работы клиентов.
<P>
<P>Если у вас Sparc или Alpha NFS-сервер, то вы обнаружите, что nfs-клиент
в Linux 2.2 совершенное не работает. Скорость передачи данных на и с
сервера настолько плоха, что это трудно представить. Это хуже даже чем под
Linux 2.0.  Намного хуже. Но для этой проблемы существует
исправление. Серия ядер 2.2 Alan Cox (которые являются более
экспериментальными, чем нормальные ядра 2.2, сопровождаемые Linus) включают
заплатку, которая позволяет Linux 2.2 увеличить производительность при
работе с серверами Alpha и Sparc. Если вы хотите использовать ядра
исправленные Alan Cox, то вы должны читать список рассылки linux-kernel, и
вы должны узнать где можно найти необходимые заплатки. Основным сервером
для этой заплатки является сервер 
<A HREF="http://www.uio.no/~trondmy/src/">http://www.uio.no/~trondmy/src/</A>, в случае, если вы хотите
попробовать применить его к нормальному ядру серии 2.2. Эта заплатка скорее
всего не будет входит в состав Linux 2.4, поскольку требует сделать
слишком много изменений в течении текущего цикла разработки. Ждите
появления Linux 2.5.
<P>
<P><CODE>trondmy</CODE> также имеет заплатки для того, чтобы Linux использовал NFS
версии 3, они также позволят вам использовать tcp как транспортный
механизм, вместо UDP. NFSv3 очень хорош для сетей с большим количеством
переходов, а также для сетей где потери пакетов не равны нулю или где время 
ожидание очень высокое.
<P>
<P>Вы должны читать список рассылки linux-kernel, если вы собираетесь
использовать эти заплатки, поскольку время от времени в них находят
какую-нибудь неприятные ошибки. Ошибки, которые портят ваши файлы. Так что
пожалуйста будьте <B>осторожны</B>.
<P>
<H2><A NAME="ss10.2">10.2 Сервер</A>
</H2>

<P>Демон nfs-сервера в Linux 2.2 и более поздних называется
"<CODE>knfsd</CODE>".  Он сложен в установке. Вы можете настроить его сами или
поставить то, что вам предлагают  SuSE, Red Hat и другие в виде пакетов
ядра серии 2.2. Извините. Хотя вы все равно можете использовать старый nfsd
в Linux 2.2. Он медленен, но легок в установке.
<P>
<HR>
<A HREF="NFS-HOWTO-11.html">Следующий</A>
<A HREF="NFS-HOWTO-9.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc10">Содержание</A>
</BODY>
</HTML>
