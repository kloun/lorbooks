<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>PPP HOWTO: Установка PPP соединения вручную</TITLE>
 <LINK HREF="PPP-HOWTO-15.html" REL=next>
 <LINK HREF="PPP-HOWTO-13.html" REL=previous>
 <LINK HREF="PPP-HOWTO.html#toc14" REL=contents>
</HEAD>
<BODY>
<A HREF="PPP-HOWTO-15.html">Next</A>
<A HREF="PPP-HOWTO-13.html">Previous</A>
<A HREF="PPP-HOWTO.html#toc14">Contents</A>
<HR>
<H2><A NAME="s14">14. Установка PPP соединения вручную</A></H2>

<P>Теперь, когда вы создали ваши файлы /etc/ppp/options и /etc/resolv.conf (и, в 
случае необходимости, файл /etc/ppp/pap|chap-secrets), вы можете проверить 
установки, устанавливая PPP соединение вручную. (Как только мы настроим  
соединение вручную, то мы сможем автоматизировать процесс).
<P>Чтобы сделать это, ваша коммуникационная программа должна уметь завершать свою
работу БЕЗ сброса модема. Minicom может делать это - ALT Q (или в старых 
версиях minicom CTRL Q)
<P>Удостоверьтесь, что вы зарегистрировались как root.
<P>Запустите вашу коммуникационную программу (типа minicom), позвоните на PPP 
сервер и зарегистрируйтесь как обычно. Если вы должны выдать команду, чтобы 
запустить PPP на сервере, введите ее. Теперь вы увидите мусор, который вы 
видели прежде.
<P>Если вы используете pap или chap, то вы увидите мусор сразу после содинения с 
удаленной системой, без приглашений к регистрации (хотя это бывает не на всех 
серверах, попробуйте нажать enter и посмотрите, не появится ли мусор).
<P>Теперь выйдите из коммуникационной программы без сброса модема 
(ALT Q или CTL Q в minicom) и в командной строке Linux (от root) напечатайте
<PRE>
______________________________________________________________________

pppd -d -detach /dev/ttySx 38400 &amp;
______________________________________________________________________
</PRE>
<P>-d опция включает отладку - все подробности установки ppp соединения будут 
записываться в ваш системный лог - что очень пригодится, если у вас появятся
проблемы.
<P>Лампочки на вашем модеме должны теперь вспыхивать, поскольку PPP соединение 
установливается. Это будет продолжаться короткое время, пока PPP соединения 
не будет установлено.
<P>В этой точке вы можете посмотреть интерфейс PPP, дав команду
<PRE>
______________________________________________________________________

ifconfig

______________________________________________________________________
</PRE>
<P>Кроме устройств ethernet и loopback вы должны увидеть еще кое-что вроде:
<PRE>
  ______________________________________________________________________
  ppp0     Link encap:Point-Point Protocol
           inet addr:10.144.153.104  P-t-P:10.144.153.51 Mask:255.255.255.0
           UP POINTOPOINT RUNNING  MTU:552  Metric:1
           RX packets:0 errors:0 dropped:0 overruns:0
           TX packets:0 errors:0 dropped:0 overruns:0
  ______________________________________________________________________
</PRE>

Где
<UL>
<LI>  inet addr:10.144.153.10 IP адрес вашего конца соединения.
</LI>
<LI>  P-t-P:10.144.153.5  IP адрес СЕРВЕРА.</LI>
</UL>

(Естественно, ifconfig будет сообщать не эти IP адреса, а те, которые 
используются вашим PPP сервером.)
<P>Обратите внимание: ifconfig также сообщает вам, что связь UP (активна) и 
RUNNING (работает)!
<P>Если вы не видите никаких ppp устройств или кое-что вроде
<PRE>
  ______________________________________________________________________
  ppp0     Link encap:Point-Point Protocol
           inet addr:0.0.0.0  P-t-P:0.0.0.0  Mask:0.0.0.0
           POINTOPOINT  MTU:1500  Metric:1
           RX packets:0 errors:0 dropped:0 overruns:0
           TX packets:0 errors:0 dropped:0 overruns:0
  ______________________________________________________________________
</PRE>
<P>Ваше PPP соединение не было создано...см. раздел по отладке ниже!
<P>Также вы должны увидеть маршрут к удаленному хосту (и другим внешним хостам). 
Чтобы сделать это, дайте команду
<PRE>
  ______________________________________________________________________

  route -n
  ______________________________________________________________________
</PRE>
<P>Вы должны увидеть что-то вроде:
<PRE>
  ______________________________________________________________________
  Kernel routing table
  Destination     Gateway         Genmask         Flags MSS    Window Use Iface
  10.144.153.3    *               255.255.255.255 UH    1500   0        1 ppp0
  127.0.0.0       *               255.0.0.0       U     3584   0       11 lo
  10.0.0.0        *               255.0.0.0       U     1500   0       35 eth0
  default         10.144.153.3    *               UG    1500   0        5 ppp0
  ______________________________________________________________________
</PRE>
<P>Обратите внимание, что мы имеем ДВЕ записи, указывающие на наш интерфейс ppp.
<P>Первая - ХОСТОВЫЙ маршрут (обозначенный флажком H) и это позволяет нам видеть 
хост, с которым мы соединены - но ничего больше.
<P>Вторая - маршрут, заданный по умолчанию (установленный опцией pppd 
defaultroute. Это - маршрут, который говорит, чтобы наш Linux PC посылал 
любые пакеты, НЕ предназначенные для локальной сети(ей) ethernet - для которой 
мы имеем свои сетевые маршруты - на PPP сервер непосредственно. Далее PPP сервер 
отвечает за маршрутизацию наших пакетов в Интернет и маршрутизацию ответных 
пакетов обратно к нам.
<P>Если вы не видите таблицу маршрутизации с двумя записями, значит что-то 
неправильно. В частности, если ваш syslog показывает сообщение, сообщающее вам,
что pppd не заменяет существующий заданный по умолчанию маршрут, то вы имеете 
заданный по умолчанию маршрут, указывающий на ваш ethernet интерфейс - который 
ДОЛЖЕН быть заменен в соответствии с указанным сетевым маршрутом: ВЫ МОЖЕТЕ 
ИМЕТЬ ТОЛЬКО ОДИН ЗАДАННЫЙ ПО УМОЛЧАНИЮ МАРШРУТ!!!
<P>Вы должны будете исследовать ваши файлы инициализации системы, чтобы выяснить, 
где устанавливается этот заданный по умолчанию маршрут (используется команда
route add default...). Измените эту команду на что-нибудь типа route add net....
<P>Теперь проверьте связь 'пингуя' сервер по IP адресу как сообщено в результате
выполнения команды ifconfig, то есть.
<PRE>
______________________________________________________________________

ping 10.144.153.51

______________________________________________________________________
</PRE>
<P>Вы должны получить что-то вроде
<PRE>
  ______________________________________________________________________
  PING 10.144.153.51 (10.144.153.51): 56 data bytes
  64 bytes from 10.144.153.51: icmp_seq=0 ttl=255 time=328.3 ms
  64 bytes from 10.144.153.51: icmp_seq=1 ttl=255 time=190.5 ms
  64 bytes from 10.144.153.51: icmp_seq=2 ttl=255 time=187.5 ms
  64 bytes from 10.144.153.51: icmp_seq=3 ttl=255 time=170.7 ms
  ______________________________________________________________________
</PRE>
<P>Эта распечатка будет продолжаться до бесконечности - остановите ее нажатием 
CTRL C, и в этой точке вы получите более подробную информацию:
<PRE>
  ______________________________________________________________________
  --- 10.144.153.51 ping statistics ---
  4 packets transmitted, 4 packets received, 0% packet loss
  round-trip min/avg/max = 170.7/219.2/328.3 ms
  ______________________________________________________________________
</PRE>
<P>Итак, все хорошо.
<P>Теперь попробуйте пинговать хост по имени (не имени PPP сервера непосредственно,
а хоста в другом месте, про который вы ЗНАЕТЕ, что он наверняка работает). 
Например
<PRE>
______________________________________________________________________

ping sunsite.unc.edu
______________________________________________________________________
</PRE>
<P>При этом появится небольшая пауза, поскольку Linux получает IP адрес по 
заданному FQDN, который вы 'пингуете' от DNS, который вы определили в файле
/etc/resolv.conf - так что не волнуйтесь (но вы будете видеть мигание лампочек
вашего модема). Короче, вы получите распечатку типа
<PRE>
  ______________________________________________________________________
   PING sunsite.unc.edu (152.2.254.81): 56 data bytes
  64 bytes from 152.2.254.81: icmp_seq=0 ttl=254 time=190.1 ms
  64 bytes from 152.2.254.81: icmp_seq=1 ttl=254 time=180.6 ms
  64 bytes from 152.2.254.81: icmp_seq=2 ttl=254 time=169.8 ms
  64 bytes from 152.2.254.81: icmp_seq=3 ttl=254 time=170.6 ms
  64 bytes from 152.2.254.81: icmp_seq=4 ttl=254 time=170.6 ms
  ______________________________________________________________________
</PRE>
<P>Снова, остановите вывод, нажимая CTRL C, и получите статистику ...
<PRE>
  ______________________________________________________________________
  --- sunsite.unc.edu ping statistics ---
  5 packets transmitted, 5 packets received, 0% packet loss
  round-trip min/avg/max = 169.8/176.3/190.1 ms
  ______________________________________________________________________
</PRE>
<P>Если вы не получаете ответа, попробуйте попинговать IP адрес DNS сервера вашего 
ISP. Если вы получаете результат от него, то похоже, что у вас проблема
с файлом /etc/resolv.conf .
<P>Если это не работает, то у вас проблема с маршрутизацией, или у вашего ISP  
проблема с маршрутизацией пакетов обратно к вам. Проверьте вашу таблицу 
маршрутизации как показано выше и если она в порядке, войдите в контакт с вашим 
ISP. Хороший тест ISP - использовать для соединения другую операционную систему.
Если вы можете выбраться дальше вашего ISP, тогда проблема - на вашем конце.
<P>Если все работает, закройте соединение, напечатав
<PRE>
______________________________________________________________________

ppp-off
______________________________________________________________________
</PRE>
<P>После короткой паузы, модем должен повесить трубку.
<P>Если это не работает, или выключите ваш модем или запустите вашу 
коммуникационную программу и прервите модем вводом +++, и затем, получив ответ
модема - OK, "положите трубку" командой ATH0.
<P>Возможно вам также понадобиться очистить файл блокировки, созданный pppd
<PRE>
______________________________________________________________________

rm -f /var/lock/LCK..ttySx
______________________________________________________________________
</PRE>
<P>
<HR>
<A HREF="PPP-HOWTO-15.html">Next</A>
<A HREF="PPP-HOWTO-13.html">Previous</A>
<A HREF="PPP-HOWTO.html#toc14">Contents</A>
</BODY>
</HTML>
