<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Мини-Howto: Автоматическое подключение файловых систем</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Мини-Howto: Автоматическое подключение файловых систем</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
></A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;    don@sabotage.org
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
> Перевод: <A
HREF="mailto:denm@asp-linux.com"
TARGET="_top"
>Денис Дементьев</A
>,
 <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>версия 0.4, 17 апреля 1999<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN13"
></A
><P
></P
><P
>В этом документе дается описание пакета autofs, предназначенного для
автоматического подключения файловых систем, его настройка,
некоторые возможные проблемы и способы их решения.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Automount.html#AEN15"
>Введение</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="Automount.html#AEN17"
>Автоматическое подключение файловых систем - что это такое, и для чего это необходимо</A
></DT
><DT
>1.2. <A
HREF="Automount.html#AEN20"
>Виды автоподключения</A
></DT
></DL
></DD
><DT
>2. <A
HREF="Automount.html#AEN25"
>Установка</A
></DT
><DT
>3. <A
HREF="Automount.html#AEN29"
>Настройка</A
></DT
><DT
>4. <A
HREF="Automount.html#AEN38"
>Долгое ожидание отключения</A
></DT
><DT
>5. <A
HREF="Automount.html#AEN44"
>Вопросы</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="Automount.html#AEN46"
>Я не вижу точку подключения, например, /auto/floppy.</A
></DT
><DT
>5.2. <A
HREF="Automount.html#AEN50"
>Как мне увидеть, что подключено?</A
></DT
><DT
>5.3. <A
HREF="Automount.html#AEN55"
>Я вставил диск Win95 ("vfat"), а он определился как диск с обычным
FAT.</A
></DT
><DT
>5.4. <A
HREF="Automount.html#AEN60"
>Моя файловая система <TT
CLASS="LITERAL"
>/auto/grumblesmurf</TT
> подключена, и <TT
CLASS="LITERAL"
>kill -SIGUSR1</TT
> не отключает ее.</A
></DT
><DT
>5.5. <A
HREF="Automount.html#AEN65"
>Что будет, если я сделаю / каталогом автоподключения</A
></DT
><DT
>5.6. <A
HREF="Automount.html#AEN68"
>Может ли быть у меня два файла с описанием точек подключения,
ссылающихся на один каталог?</A
></DT
><DT
>5.7. <A
HREF="Automount.html#AEN71"
>Я использую SuSE 6.0, и мне необходимо <TT
CLASS="LITERAL"
>---timeout</TT
> вместо <TT
CLASS="LITERAL"
>--timeout</TT
></A
></DT
><DT
>5.8. <A
HREF="Automount.html#AEN76"
>Как мне установить права и владельца на файловую систему (например,
FAT)?</A
></DT
><DT
>5.9. <A
HREF="Automount.html#AEN79"
>Кого благодарить за autofs?</A
></DT
><DT
>5.10. <A
HREF="Automount.html#AEN82"
>Где я могу узнать еще что нибудь об автоподключении?</A
></DT
></DL
></DD
><DT
>6. <A
HREF="Automount.html#AEN88"
>Авторские права</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN15"
>1. Введение</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>1.1. Автоматическое подключение файловых систем - что это такое, и для чего это необходимо</A
></H2
><P
>Автоподключение - это процесс автоматического подключения (и
   отключения) файловых систем. Файловая система автоматически 
   (от)подключается при обращении к ней. Особенно полезным это может
   оказаться в больших сетях, а также при наличии файловых систем,
   ссылающихся на другие машины (особенно при отсутствии постоянного
   сетевого соединения).  Кроме того, очень полезным может быть
   автоподключение съемных устройств.
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN20"
>1.2. Виды автоподключения</A
></H2
><P
>В Linux имеется два типа автоподключения: <I
CLASS="EMPHASIS"
>AMD</I
> и <I
CLASS="EMPHASIS"
>autofs</I
>. AMD - это   
автоподключающий демон, работающий подобно SunOS AMD. Он не является   
частью ядра, для которого не обязательно знать, как работает   
   автоподключение. Если вы производите подключение NFS тома в систему, то   
   демон AMD перенаправляет траффик автоматически подключенной файловой системы   
   через систему NFS. Autofs - новая система, работающая с помощью   
   ядра; это означает, что код ядра, отвечающий за работу с файловыми
   системами, знает, где расположены точки подключения в файловой
   системе, и система автоподключения узнает их с помощью этого кода. В
   этом документе описывается только autofs.     </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN25"
>2. Установка</A
></H1
><P
>Ядро должно быть собрано с поддержкой autofs. В версии 2.0.хх
   поддержка autofs является экспериментальной, но работает стабильно.
   Начиная с версии 2.2.хх, поддержка autofs переведена в разряд
   стандартных возможностей.&#13;</P
><P
>Программа автоподключения и ее конфигурационные файлы
   необходимы для работы; самый простой способ - установить пакет из
   дистрибутива RedHat. Программа автоподключения должна запускаться rc
   скриптом из каталога /etc/rc.d/init.d. rpm устанавливает этот скрипт,
   но необходимо удостовериться в том, что он запускается либо создав  
   ссылку на него из каталога rc?.d, либо воспользовавшись панелью
   управления RedHat. Не-rpm дистрибутивы также должны сделать это. И не
   старайтесь разобраться, что этот скрипт делает - если вы читаете этот
   документ, то, скорее всего, вам это ни к чему.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN29"
>3. Настройка</A
></H1
><P
>Установка RPM не представляет проблем, однако настройка, если вы не
   сталкивались с ней ранее, может вызвать вопросы.</P
><P
>В каталоге /etc есть два файла: <TT
CLASS="LITERAL"
>auto.master</TT
> и <TT
CLASS="LITERAL"
>auto.misc</TT
>. Мой
   auto.master выглядит так:
/auto   /etc/auto.misc  --timeout 60</P
><P
>   Первая опция это не точка подключения, а каталог, в котором будут
   находиться точки подключения, перечисленные в файле, указанном во 
   второй опции. Третья опция указывает, что через 60 секунд после
   обращения будет произведена попытка отключения файловой системы.
   Само собой, что если файловая система используется, то она не будет
   отключена.
 </P
><P
>auto.misc - это файл, описывающий точки подключения. Он может иметь
   любое имя; этот назван auto.misc потому, что изначально он описывал
   каталог /misc. В файле auto.master могут быть указаны несколько
   файлов, описывающих точки подключения. Мой auto.misc выглядит так:
kernel          -ro,soft,intr           ftp.kernel.org:/pub/linux
cd              -fstype=iso9660,ro      :/dev/cdrom
zip             -fstype=auto            :/dev/hdd4
floppy          -fstype=vfat            :/dev/fd0</P
><P
>   Первая колонка ("ключ") - это точка подключения. В данном случае это
   будет /auto/floppy, /auto/zip и т.п. Вторая колонка - опции
   подключения; подробности смотрите в руководстве по подключению
   (man mount). Третья колонка указывает на устройство, где находится
   подключаемая файловая система. Строка "kernel" описывает подключение
   NFS. ":" в остальных строках сообщает, что это локальное устройство.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN38"
>4. Долгое ожидание отключения</A
></H1
><P
>   Многим пользователям, которым приходилось ждать отключения
   файловой системы флоппи-диска, могло показаться, что 60-секундная
   задержка - это просто вечность. Может лучше синхронизировать (sync)
   диски, извлечь дискету несмотря на то, что файловая система не
   отключена, и никто ничего не заметит? Позвольте мне предложить
   более безопасные способы. Прежде всего вы можете уменьшить задержку.
   Но отключать фаловые системы, к примеру, каждые 15 секунд, очень
   неэффективно. Если у вас есть на то права, можно просто дать
   команду umount. Кроме того, можно дать команду программе
   автоподключения на отключение файловой системы. Если вы дадите
   (командой kill) сигнал <TT
CLASS="LITERAL"
>SIGUSR1</TT
> процессу autofs, он отключит все,
   что только сможет. Но подождите рисовать кнопки отключения в
   ваших менеджерах окон - тут есть маленькая проблема.&#13;</P
><P
>Процесс autofs выполняется root-ом, и будет воспринимать сигналы только
   от него. Один из самых больших плюсов использования автоподключения
   - это то, что вы можете подключать и отключать файловые системы,
   *не имея* прав root. Можно написать C программу, выполняющую всю
   грязную работу, и поставить ей флаг suid. Другой вариант -
   использовать sudo, чтобы разрешить пользователям посылать нужный
   сигнал с помощью kill. Единственная проблема в этом случае -
   невозможность использования ` для обработки команд (что вам придется
   делать для определения PID). Вам необходимо будет поставить программу
   killall, что позволит вам следующее: (благодарю за совет)

<PRE
CLASS="SCREEN"
>ALL     ALL=NOPASSWD:/usr/bin/killall -USR1 automount</PRE
>

   Иначе вам придется разрешить пользователям посылать сигнал
   SIGUSR1 всем процессам, что может привести к нежелательным эффектам;
   например? выходу из xemacs.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN44"
>5. Вопросы</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN46"
>5.1. Я не вижу точку подключения, например, /auto/floppy.</A
></H2
><P
>   Если автоподключение настроено правильно, точка подключения будет
   там, где должна быть, хотя ее не будет видно, если она не
   используется. Если вы используете для просмотра каталогов графическую
   утилиту, то, возможно, придется указать имя вручную; большинство
   программ пробуют то, что вы им указываете, и устройство подключается.
   К сожалению, невозможность выбрать что-либо из доступных, но
   невидимых точек подключения является, наверное, самым большим
   недостатком autofs.&#13;</P
><P
>Один из способов справиться с этим - создать символьные ссылки
   (symbolic links) на каталоги, появляющиеся при автоподключении. Это
   решит проблему с сообщениями программ об отсутствии каталога (при
   отключенной файловой системе), но бездумный просмотр содержимого
   каталогов будет вызывать подключение файловых систем.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN50"
>5.2. Как мне увидеть, что подключено?</A
></H2
><P
>Команда <TT
CLASS="LITERAL"
>df</TT
>.Команда <TT
CLASS="LITERAL"
>mount</TT
> без ключей сделает то же, и, к тому же, покажет
   опции подключения.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN55"
>5.3. Я вставил диск Win95 ("vfat"), а он определился как диск с обычным
FAT.</A
></H2
><P
>Это проблема не связана с автоподключением. При использовании типа
   файловой системы "auto" проверка на тип msdos производится раньше
   проверки на тип vfat. VFAT - это длинные имена Win95 и WinNT,
   врезанные в файловую систему FAT/MSDOS.</P
><P
>По словам одного из авторов утилиты mount, она является лишь
   промежуточным звеном между пользователем и системным вызовом,
   требующим явного указания типа файлового системы. Поэтому определение
   типа файловой системы - задача пользователя. Рассматривается вопрос о
   написании версии утилиты mount, которая проверяла бы тип подключаемой
   файловой системы в определенном порядке, взятом из списка, а не
   использовала "эвристический" алгоритм. Некоторые пользователи не
   включают поддержку файловой системы msdos в ядро, что предотвращает
   проверку на тип msdos до проверки на тип vfat. Это решение подходит
   для большинства пользователей. Мало кому действительно нужна файловая
   система msdos, но случалось, когда она была просто
   необходима, а под рукой ее не было, что весьма расстраивало меня.</P
><P
>   Я уверен, что если кто-либо захочет связаться с автором(ами) mount,
   то его отзывы будут только приветствоваться. Ну а пока что, кроме
   случаев с исключением поддержки msdos, вы не можете
   подключать vfat, сохраняя возможность автоопределения остальных
   типов файловых систем. Надеюсь, когда-нибудь появится такая возможность
   настройки, и можно будет создавать точки подключения с различными
   типами файловых систем.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN60"
>5.4. Моя файловая система <TT
CLASS="LITERAL"
>/auto/grumblesmurf</TT
> подключена, и <TT
CLASS="LITERAL"
>kill -SIGUSR1</TT
> не отключает ее.</A
></H2
><P
>   Она чем-то используется. Даже Root не сможет отключить ее. Если
   вы тот, кто вызвал ее подключение (например, рядом нет никого, кто
   мог бы сделать это), поищите shell, который, возможно, находится в
   этом каталоге. Если таких нет, то поищите что-нибудь еще, что могло,
   так сказать, подставить невидимую ногу между дверью и косяком. Если
   ваши поиски не дали никакого результата, то попробуйте утилиту fuser.
 </P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN65"
>5.5. Что будет, если я сделаю / каталогом автоподключения</A
></H2
><P
>   Ой-ой-ой-ой. У вас практически нет шансов, что все будет работать
   нормально. Я вас предупредил. Если вам нужен /grumblesmurf, то я
   советую использовать символьную ссылку. Так намного
   безопаснее.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN68"
>5.6. Может ли быть у меня два файла с описанием точек подключения,
ссылающихся на один каталог?</A
></H2
><P
>   Насколько я знаю, нет. Попробуйте использовать один файл с различными
   опциями для различных точек подключения.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN71"
>5.7. Я использую SuSE 6.0, и мне необходимо <TT
CLASS="LITERAL"
>---timeout</TT
> вместо <TT
CLASS="LITERAL"
>--timeout</TT
></A
></H2
><P
>Э-э. Ладно, я буду иметь это ввиду. Другое решение проблемы
   "таймаут не работает" ("timeout no working") - добавить ключ
   -t в скрипт autofs.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN76"
>5.8. Как мне установить права и владельца на файловую систему (например,
FAT)?</A
></H2
><P
>Посмотрите документацию (man page) на mount на предмет ключей,
   устанавливающих uid и umask. К сожалению, для файловой системы FAT
   отсутствует ключ, устанавливающий mode. Посоветуйтесь с людьми,
   отвечающими за подключение.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN79"
>5.9. Кого благодарить за autofs?</A
></H2
><P
>   Не меня. Мне не приходилось что-либо делать. Я просто хотел привлечь
   всеобщее внимание к той работе, что была проделана над autofs, и к
   тому, как легко его использовать. В сравнении с AMD, autofs очень
   хорошо документирован, за что я очень благодарен его разработчикам.
   Везде стоит copyright Transmeta, так что, к сожалению, я не могу
   привести список разработчиков. Однако, предполагаю, что Peter Anvin
   приложил свою руку к большой части этой работы. Кроме того, Peter 
   прочитал лекцию на тему autofs на linuxworldexpo 3 марта 1999.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN82"
>5.10. Где я могу узнать еще что нибудь об автоподключении?</A
></H2
><P
>   Учебник по autofs есть на <A
HREF=" http://www.linuxhq.com/lg/issue24/nielsen.html"
TARGET="_top"
>http://www.linuxhq.com/lg/issue24/nielsen.html</A
>.
Смотрите также
   am-utils на <A
HREF="http://www.cs.columbia.edu/~ezk/am-utils"
TARGET="_top"
>http://www.cs.columbia.edu/~ezk/am-utils</A
></P
><P
>   (Спасибо за эти URL)</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN88"
>6. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO,
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
></DIV
></BODY
></HTML
>