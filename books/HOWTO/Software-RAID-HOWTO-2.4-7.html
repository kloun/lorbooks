<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>The Software-RAID HOWTO: Производительность</TITLE>
 <LINK HREF="Software-RAID-HOWTO-2.4-8.html" REL=next>
 <LINK HREF="Software-RAID-HOWTO-2.4-6.html" REL=previous>
 <LINK HREF="Software-RAID-HOWTO-2.4.html#toc7" REL=contents>
</HEAD>
<BODY>
<A HREF="Software-RAID-HOWTO-2.4-8.html">Next</A>
<A HREF="Software-RAID-HOWTO-2.4-6.html">Previous</A>
<A HREF="Software-RAID-HOWTO-2.4.html#toc7">Contents</A>
<HR>
<H2><A NAME="s7">7. Производительность</A></H2>

<P>Эта секция содержит несколько бенчмарков из реальных систем, использующих 
программный RAID.
<P>Бенчмарки производились программой <CODE>bonnie</CODE>, и всегда с файлами
в два или более раза большими объема физической памяти (RAM) в машине.
<P>В приведенных бенчмарках измерялась <EM>только</EM> пропускная способность 
записи и чтения одного большого файла. 
Это полезная информация, если интересует максимальная пропускная способность
ввода/вывода для длинных блоков данных.
Однако, эти цифры мало говорят нам о производительности, при использовании 
массива для спула новостей, web-сервера, и т.д. 
Всегда помните, эти цифры - результат запуска ``синтетического'' теста. 
Несколько реальных программ делают то же, что и 
<CODE>bonnie</CODE>, и хотя хорошо смотреть на эти цифры, они не являются
основными индикаторами  реальной производительности. 
<P>Сейчас, у меня есть результаты с моей собственной машины. Конфигурация такова:
<UL>
<LI>Dual Pentium Pro 150 MHz</LI>
<LI>256 MB RAM (60 MHz EDO)</LI>
<LI>Три IBM UltraStar 9ES 4.5 GB, SCSI U2W</LI>
<LI>Adaptec 2940U2W</LI>
<LI>Один IBM UltraStar 9ES 4.5 GB, SCSI UW</LI>
<LI>Adaptec 2940 UW</LI>
<LI>Ядро 2.2.7 с RAID патчами</LI>
</UL>
<P>Три U2W диска повешены на U2W контроллер, и UW диск на UW контроллер.
<P>Представляется невозможным передавать более 30 Мб/с по шинам SCSI
на этой системе, используя RAID или нет. Как я думаю, это из-за
слишком старой системы, скорости памяти и ограничений
того, что можно послать через SCSI контроллеры.
<P>
<H2><A NAME="ss7.1">7.1 RAID-0</A>
</H2>

<P><B>Чтение</B> это - <B>Последовательный блочный ввод</B>, и <B>Запись</B>
это - <B>Последовательный блочный вывод</B>. Размер файла во всех тестах - 
1Гб. Тести были проведены в однопользовательском режиме. Драйвер SCSI 
был сконфигурирован для не использования очереди помеченных комманд.
<P>
<CENTER><TABLE BORDER><TR><TD>
<BR>
Размер куска </TD><TD> Размер блока </TD><TD> Чтение Кб/с </TD><TD> Запись Кб/с </TD></TR><TR><TD>
</TD></TR><TR><TD>
4k </TD><TD> 1k </TD><TD> 19712 </TD><TD> 18035 </TD></TR><TR><TD>
4k </TD><TD> 4k </TD><TD> 34048 </TD><TD> 27061 </TD></TR><TR><TD>
8k </TD><TD> 1k </TD><TD> 19301 </TD><TD> 18091 </TD></TR><TR><TD>
8k </TD><TD> 4k </TD><TD> 33920 </TD><TD> 27118 </TD></TR><TR><TD>
16k </TD><TD> 1k </TD><TD> 19330 </TD><TD> 18179 </TD></TR><TR><TD>
16k </TD><TD> 2k </TD><TD> 28161 </TD><TD> 23682 </TD></TR><TR><TD>
16k </TD><TD> 4k </TD><TD> 33990 </TD><TD> 27229 </TD></TR><TR><TD>
32k </TD><TD> 1k </TD><TD> 19251 </TD><TD> 18194 </TD></TR><TR><TD>
32k </TD><TD> 4k </TD><TD> 34071 </TD><TD> 26976

</TD></TR></TABLE></CENTER>
<P>Отсюда видно, что размер куска в RAID не имеет значения. Однако, 
размер блока ext2fs должен быть как можно более большим, 
как 4KB (т.е. размер страницы) на IA-32.
<P>
<H2><A NAME="ss7.2">7.2 RAID-0 с TCQ</A>
</H2>

<P>Тут, драйвер SCSI был сконфигурирован для использования очереди помеченных 
комманд (TCQ), с глубиной очереди - 8. Все остальное как и в предыдущем случае.
<P>
<CENTER><TABLE BORDER><TR><TD>
<BR>
Размер куска </TD><TD> Размер блока </TD><TD> Чтение Кб/с </TD><TD> Запись Кб/с </TD></TR><TR><TD>
</TD></TR><TR><TD>
32k </TD><TD> 4k </TD><TD> 33617 </TD><TD> 27215

</TD></TR></TABLE></CENTER>
<P>Сдесь больше не производилось тестов. Как видно TCQ немного увеличивает 
производительность записи, но на самом деле здесь совсем не большая разница.
<P>
<H2><A NAME="ss7.3">7.3 RAID-5</A>
</H2>

<P>Массив был сконфигурирован в режим RAID-5, и были сделаны подобные тесты.
<P>
<CENTER><TABLE BORDER><TR><TD>
<BR>
Размер куска </TD><TD> Размер блока </TD><TD> Чтение Кб/с </TD><TD> Запись Кб/с </TD></TR><TR><TD>
</TD></TR><TR><TD>
8k </TD><TD> 1k </TD><TD> 11090 </TD><TD> 6874 </TD></TR><TR><TD>
8k </TD><TD> 4k </TD><TD> 13474 </TD><TD> 12229 </TD></TR><TR><TD>
32k </TD><TD> 1k </TD><TD> 11442 </TD><TD> 8291 </TD></TR><TR><TD>
32k </TD><TD> 2k </TD><TD> 16089 </TD><TD> 10926 </TD></TR><TR><TD>
32k </TD><TD> 4k </TD><TD> 18724 </TD><TD> 12627

</TD></TR></TABLE></CENTER>
<P>Сейчас, и размер куска и размер блока действительно дают различие.
<P>
<H2><A NAME="ss7.4">7.4 RAID-10</A>
</H2>

<P>RAID-10 это- ``зеркало stripes'', или, массив RAID-1 двух массивов RAID-0. 
Размер куска - размер кусков в обоих, и в RAID-1 и в двух RAID-0 массивах. 
Я не проводил тестов с различающимися этими размерами кусков, 
хотя это должна быть вполне правильная установка.
<P>
<CENTER><TABLE BORDER><TR><TD>
<BR>
Размер куска </TD><TD> Размер блока </TD><TD> Чтение Кб/с </TD><TD> Запись Кб/с </TD></TR><TR><TD>
</TD></TR><TR><TD>
32k </TD><TD> 1k </TD><TD> 13753 </TD><TD> 11580 </TD></TR><TR><TD>
32k </TD><TD> 4k </TD><TD> 23432 </TD><TD> 22249

</TD></TR></TABLE></CENTER>
<P>Больше тестов не производилось. Размер файла был 900Мб, так как 
четыре раздела заняли по 500 Мб, так что не осталось места для
1Гб файла в этой конфигурации (RAID-1 на двух 1000Мб массивах).
<P>
<P>
<HR>
<A HREF="Software-RAID-HOWTO-2.4-8.html">Next</A>
<A HREF="Software-RAID-HOWTO-2.4-6.html">Previous</A>
<A HREF="Software-RAID-HOWTO-2.4.html#toc7">Contents</A>
</BODY>
</HTML>
