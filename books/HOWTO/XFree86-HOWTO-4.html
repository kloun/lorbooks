<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>The Linux XFree86 HOWTO: Настройка XFree86</TITLE>
 <LINK HREF="XFree86-HOWTO-5.html" REL=next>
 <LINK HREF="XFree86-HOWTO-3.html" REL=previous>
 <LINK HREF="XFree86-HOWTO.html#toc4" REL=contents>
</HEAD>
<BODY>
<A HREF="XFree86-HOWTO-5.html">Next</A>
<A HREF="XFree86-HOWTO-3.html">Previous</A>
<A HREF="XFree86-HOWTO.html#toc4">Contents</A>
<HR>
<H2><A NAME="s4">4. Настройка XFree86</A></H2>

<H2><A NAME="ss4.1">4.1 Нормальная настройка</A>
</H2>

<P>Настройка XFree86 для правильного использования мыши, клавиатуры,
монитора и видеокарты является чем-то вроде черной магии, требующей долгого
ручного исправления сложного файла настройки. Теперь это не так; выпуск
недавних версий сделал этот процесс практически тривиальным. Сильно
упрощает этот процесс то, что больше нет отдельных серверов для различных
типов видеокарт, а есть лишь модули, загружаемые общим сервером. Все что
вам нужно сделать для настройки&nbsp;---это запустить программу
<CODE>XF86Setup</CODE>.
<P>Эта программа зависит от того факта, что все новые персональные компьютеры
наших дней оборудованы мониторами умеющими работать в режиме EGA/VGA.
Программа запускает VGA16-сервер использует его для запуска X в режиме
наименьшего разрешения 640x480. Затем запускается интерактивная программа,
которая проводит вас через набор панелей настройки---мышь, клавиатура,
видеокарта, монитор и `другое' (разные настройки сервера). Весь процесс
достаточно безболезненный.
<P>(Если вы используете Red Hat Linux, то вы можете найти другую программу,
названную <CODE>xf86config</CODE>. Она работает почти как <CODE>XF86Setup</CODE>, но не
использует X-интерфейс и VGA16-сервер).
<P>Одну небольшую особенность необходимо вам помнить, если вы подобно
большинству людей используете персональный компьютер, то ваша клавиатура в
XF86Setup называется `Generic 102-key PC (intl)', вместо клавиатуры по
умолчанию`Generic 101-key PC'. Если вы выберете клавиатуру по умолчанию
(101), то клавиши справа на клавиатуре (цифровые и другие) могут прекратить
работать.
<P>Если вы не уверены в том какой тип монитора вы используете, то вы можете
попробовать перечисленные типы по очереди. Попробуйте их начиная с верха и
опускаясь вниз (перечисленные вверху работают на меньшей частоте (dot-clock
speeds) и менее требовательны к оборудованию). Вернитесь назад если вы
получили мусор или сильно искаженную картинку). Небольшие искажения
(картинка немного больше, немного меньше или расположена не в центре) не
являются проблемой; у вас есть шанс откорректировать их с помощью точной
настройки режима.
<P>И когда программа запустит <CODE>xvidtune</CODE> для того, чтобы попробовать
имеющиеся видеорежимы, не пугайтесь первоначального сообщения. Современные
многочастотные мониторы (в отличии от их предшественников с фиксированной
частотой) не так подвержены поломкам данным способом.
<P>XF86Config может предполагать, что устройством мыши является
/dev/mouse. Если вы обнаружили, что мышь не работает, то вам
может быть необходимо создать ссылку /dev/mouse на то
устройство /dev/ca[01] к которому подключена мышь. Если вы
обнаружили, что XFree86 выдает вам сообщение об ошибке "mouse busy (мышь
занята)" при запущенной программе <CODE>gpm</CODE>, то вам нужно будет создать
ссылку на устройство /dev/ttyS[01], а не на то, которое было
указано выше.
<P>Процесс настройки производится путем выбора серверного модуля,
соответствующего общему типу вашей видеокарты и настройке <CODE>XF86Config</CODE>,
который сервер будет считывать при запуске для получения специфических
параметров для вашей установки. Расположение файла <CODE>XF86Config</CODE> может
быть разным, в зависимости от вашей операционной системы, но одним из мест
где вы его можете найти является каталог <CODE>/etc/X11</CODE>.
<P>В более старых версиях, <CODE>XF86Setup</CODE> делает команду `X' ссылкой прямо на
выбранный сервер. В недавних версиях, вместо этого, `X' является ссылкой на
программу с установленным set-user-id, которая называется Xwrapper.
Основная идея заключается в том, что вещи для которых необходим
установленный setuid пользователя root содержатся в Xwrapper, так что
сервер не запускается с установленным setuid root.
<P>
<H2><A NAME="ss4.2">4.2 Устранение неисправностей</A>
</H2>

<P>Иногда что-нибудь может быть не совсем правильно, когда вы первый раз
запускаете X-сервер. Почти всегда это вызывается проблемой в вашем файле
настройки. Обычно значения частоты (timing) монитора не заданы, или частота
(dot clock) видеокарты установлены неправильно. Небольшие проблемы могут
быть исправлены с помощью программы <CODE>xvidtune</CODE>; экран заполненный
мусором означает, что вам необходимо вернуться к XF86Setup и выбрать
монитор с меньшими возможностями.
<P>Если дисплей мелькает, или края расплывчаты, то это точный показатель того,
что значения частоты (timing) монитора или значение частоты (dot clock)
неправильны. Также убедитесь, что вы точно указали набор микросхем вашей
видеокарты, также как и остальные опции для раздела <CODE>Device</CODE> файла
<CODE>XF86Config</CODE>.  Будьте абсолютно уверены, что вы используете
правильный X-сервер и что файл <CODE>/usr/X11R6/bin/X</CODE> является
символьной ссылкой на этот сервер.
<P>Если все это сбивается, попробуйте запустить X в ``голом'' виде; для этого
используйте такую команду:
<P>
<BLOCKQUOTE><CODE>
<PRE>
X > /tmp/x.out 2>&amp;1 
</PRE>
</CODE></BLOCKQUOTE>
<P>Затем вы можете завершить выполнение X-сервера (используя комбинацию клавиш
<CODE>ctrl-alt-backspace</CODE>) и просмотреть содержимое файла
<CODE>/tmp/x.out</CODE>.X-сервер выдаст вам любые предупреждения---например,
если ваша видеокарта не имеет частоты (dot clock) соответствующей режиму,
поддерживаемому монитором.
<P>Помните, что вы можете использовать комбинации клавиш <CODE>ctrl-alt-numeric
+</CODE> и <CODE>ctrl-alt-numeric -</CODE> для переключения между видеорежимами,
перечисленными в строке <CODE>Modes</CODE> раздела <CODE>Screen</CODE> в файле
<CODE>XF86Config</CODE>. Если более высокое разрешение выглядит неправильно, то
попробуйте переключиться в режим с меньшим разрешением. Это позволит вам
понять, что по крайней мере эта часть настройки X работает правильно.
<P>Также проверьте ручки вертикального и горизонтального размера/положения на
вашем мониторе. Во многих случаях необходимо регулировать их при запуске
X. Например, если изображение выглядит немного сдвинутым на одну сторону,
то обычно вы сможете исправить это используя управление монитором.
<P>Группа новостей USENET <CODE>comp.windows.x.i386unix</CODE> предназначена для
обсуждения XFree86, также как и <CODE>comp.os.linux.x</CODE>. Хорошей идеей
будет посмотреть статьи посылаемые в эти группы и относящиеся к настройке
вашего видео---вы можете найти кого-нибудь у кого такие же проблемы.
<P>
<H2><A NAME="ss4.3">4.3 Дополнительная настройка</A>
</H2>

<P>Вам будет необходимо вручную исправить настройку X для того, чтобы
добиться оптимальной производительности, если ваш монитор поддерживает
разрешение 1600x1200--самое высокое разрешение, поддерживаемое программой
XF86Setup равно 1280x1024.
<P>Если вы хотите вручную править вашу конфигурацию видеосистемы по этой или
другой причине, то смотрите XFree86 Video Timings HOWTO, 
<A HREF="http://metalab.unc.edu/LDP/HOWTO/XFree86-Video-Timings-HOWTO.html">http://metalab.unc.edu/LDP/HOWTO/XFree86-Video-Timings-HOWTO.html</A>.
(Это HTML-версия поставляемого с XFree86 файла `Videomodes.doc').
<P>
<H2><A NAME="ss4.4">4.4 Использование 16-битного цвета</A>
</H2>

<P>По умолчанию X использует 8-битную глубину цвета, дающую 256 цветов. Для
того, чтобы обойти это ограничение много приложений выделяют свои
собственные таблицы цветов (colormaps), приводящие в результате в внезапным
сменам цветов при перемещении курсора между двумя окнами, в каждом из
которых имеется своя таблица цветов. Таким способом работает WWW-броузер
Arena.
<P>Если вы хотите использовать мощные графические приложения, то 256 цветов
может быть недостаточно. Вам может быть необходимо использовать 16-битную
цветовую глубину (65536 цветов). Но будьте осторожны---не все приложения
поддерживают 16-битные цвета.
<P>Вы можете использовать 16-битные цвета с 65K разных цветов просто запуская X 
с помощью команды
<P>
<HR>
<PRE>
    startx -- -bpp 16
</PRE>
<HR>
<P>или поместив
<P>
<HR>
<PRE>
    exec X :0 -bpp 16
</PRE>
<HR>
<P>в ваш файл .xserverrc. Однако для того, чтобы это работало вам необходимо
иметь раздел 
<HR>
<PRE>
screen
</PRE>
<HR>
 в файле XF86Config со значением
<P>
<HR>
<PRE>
    DefaultColorDepth 16
</PRE>
<HR>
<P>Если вы используете xdm, то вам может быть необходимо изменить файл 
Xservers, которые вероятно расположен в каталоге 
/etc/X11/xdm/. Типичная конфигурация имеет только одну
незакомментированую строку, выглядящую примерно так
<P>
<HR>
<PRE>
      :0 local /usr/X11R6/bin/X
</PRE>
<HR>
<P>Добавьте 
<HR>
<PRE>
-bpp 16
</PRE>
<HR>
 к опциям запуска:
<P>
<HR>
<PRE>
      :0 local /usr/X11R6/bin/X -bpp 16
</PRE>
<HR>
<P>Вам также надо будет добавить к разделу 'screen' вашей конфигурации X часть 
Display с параметром Depth равным 16. В общем вы можете просто скопировать
раздел 8-bit Display и изменить поле Depth.
<P>Большее количество цветов заставляет вашу карту передавать больше данных за
то же самое время. Если ваша карта не справляется, то либо разрешение, либо
частота обновления должна быть уменьшена. По умолчанию XFree уменьшает
разрешение. Если вы хотите сохранить разрешение и уменьшить частоту
обновления, то вы должны вставить новую строку Modeline в ваш файл
XF86Config, которая определяет разрешение с более низкой частотой
обновления. Например измените старое значение
<P>
<BLOCKQUOTE><CODE>
<PRE>
Modeline "1024x768"  75  1024 1048 1184 1328 768 771 777 806 -hsync -vsync
</PRE>
</CODE></BLOCKQUOTE>
<P>на
<P>
<BLOCKQUOTE><CODE>
<PRE>
Modeline "1024x768"  65  1024 1032 1176 1344 768 771 777 806 -hsync -vsync.
</PRE>
</CODE></BLOCKQUOTE>
<P>Магические числа 75 и 65---это соответствующие частоты часов, которые вам
выдаст X в вашем файле .X.err. Посмотрите файл 'monitors' в документации по
XFree86 для строки Modelines подходящей для максимальной частоты часов
вашей видеокарты, которая может работать с 16-битным цветом.
<P>
<HR>
<A HREF="XFree86-HOWTO-5.html">Next</A>
<A HREF="XFree86-HOWTO-3.html">Previous</A>
<A HREF="XFree86-HOWTO.html#toc4">Contents</A>
</BODY>
</HTML>
