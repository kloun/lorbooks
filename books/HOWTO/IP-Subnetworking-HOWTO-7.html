<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>  IP Sub-networking Mini-Howto: Маршрутизация</TITLE>
 <LINK HREF="IP-Subnetworking-HOWTO-6.html" REL=previous>
 <LINK HREF="IP-Subnetworking-HOWTO.html#toc7" REL=contents>
</HEAD>
<BODY>
Next
<A HREF="IP-Subnetworking-HOWTO-6.html">Previous</A>
<A HREF="IP-Subnetworking-HOWTO.html#toc7">Contents</A>
<HR>
<H2><A NAME="s7">7. Маршрутизация</A></H2>

<P>Если вы используете Linux PC с двумя сетевыми интерфейсами для
маршрутизации двух (или более) подсетей, вы должны иметь включенным
IP Forwarding в вашем ядре. Сделайте
<P>
<BLOCKQUOTE><CODE>
<PRE>
          cat /proc/ksyms | grep ip_forward
</PRE>
</CODE></BLOCKQUOTE>
<P>Вы должны получить в ответ что-то вроде...
<P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  00141364 ip_forward_Rf71ac834
</PRE>
</CODE></BLOCKQUOTE>
<P>Если этого нет, то IP-Forwarding в вашем ядре не включен и вам потребуется
перекомпилировать и установить ядро заново.
<P>Ради этого примера, давайте предположим, что вы должны разбить вашу IP 
сеть класса C с адресом 192.168.1.0 на 4 подсети (по 62 IP адреса
интерфейса/хоста каждая). Причем две из этих подсетей образуют вместе 
большую единую сеть, что дает три сети. Тогда:-
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Сеть            Широковещательный  Сетевая маска       Хосты
  192.168.1.0     192.168.1.63       255.255.255.192     62
  192.168.1.64    192.168.1.127      255.255.255.192     62
  182.168.1.128   192.168.1.255      255.255.255.126     124 (см. прим.)
</PRE>
</CODE></BLOCKQUOTE>

<B>Примечание</B>: причина, по которой последняя сеть имеет только 124 используемых 
сетевых адреса (а не 126 как следует из задания сетевой маски) в том, что
она в действительности 'суперсеть' из двух подсетей. Хосты двух других сетей
будут интерпретировать 192.168.1.192 как сетевой адрес 'несуществующей' 
подсети. Также они будут считать 192.168.1.191 широковещательным адресом
из 'несуществующей' подсети.
<P>Итак, если вы используете 192.168.1.191 или 192 как адреса хостов в третьей
сети, тогда машины в двух меньших сетях не смогут взаимодействовать с ними.
<P>Этот пример демонстрирует важный принцип в подсетях - используемые адреса
определяются НАИМЕНЬШЕЙ подсетью в том же адресном пространстве.
<P>
<H2><A NAME="ss7.1">7.1 Таблицы маршрутизации</A>
</H2>

<P>Давайте предположим, что компьютер с запущенным Linux работает как 
маршрутизатор для этой сети. Имеется три сетевых интерфейса в локальной
сети и возможно четвертый интерфейс в Интернет (который должен быть 
маршрутом по умолчанию).
<P>Давайте предположим, что компьютер с Linux использует наименьший доступный
IP адрес в каждой подсети на его интерфейсе в этой подсети. Надо настроить
эти сетевые интерфейсы так:
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Интерфейс       IP адрес        Сетевая маска
  eth0            192.168.1.1     255.255.255.192
  eth1            192.168.1.65    255.255.255.192
  eth2            192.168.1.129   255.255.255.128
</PRE>
</CODE></BLOCKQUOTE>
<P>Должна быть установлена такая маршрутизация:
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Destination     Gateway         Genmask         Iface
  192.168.1.0     0.0.0.0         255.255.255.192 eth0
  192.168.1.64    0.0.0.0         255.255.255.192 eth1
  192.168.1.128   0.0.0.0         255.255.255.128 eth2
</PRE>
</CODE></BLOCKQUOTE>
<P>В каждой из подсетей хосты должны быть настроены с их собственным IP адресом
и сетевой маской (соответственно своей сети). Каждый хост должен считать 
Linux PC шлюзом/маршрутизатором, указав тот IP адрес компьютера с Linux, 
который смотрит в его подсеть.
<P>Robert Hart Melbourne, Australia March 1997.
<P>
<HR>
Next
<A HREF="IP-Subnetworking-HOWTO-6.html">Previous</A>
<A HREF="IP-Subnetworking-HOWTO.html#toc7">Contents</A>
</BODY>
</HTML>
