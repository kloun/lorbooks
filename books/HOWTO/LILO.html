<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Lilo mini-Howto</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Lilo mini-Howto</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Miroslav Skoric</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.skoric@eunet.yu<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
>    Перевод: <A
HREF="mailto:sam@asp-linux.com"
TARGET="_top"
>Станислав Рогин</A
>,
    <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>История изменений</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Издание v3.00</TD
><TD
ALIGN="LEFT"
>24 July 2000</TD
><TD
ALIGN="LEFT"
>Под редакцией: ms</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN19"
></A
><P
></P
><P
>LILO - это наиболее распространенная версия загрузчика Linux
(<I
CLASS="EMPHASIS"
>Li</I
>nux <I
CLASS="EMPHASIS"
>Lo</I
>ader)
для x86-процессоров; Я буду называть его Lilo, вместо LILO в этом документе,
потому что мне не нравятся заглавные буквы. Этот файл описывает несколько
стандартных конфигураций Lilo. Этот документ может рассматриваться как
дополнение к Руководству Пользователя Lilo. Я думаю, что примеры будут
достаточно информативны, даже если ваши настройки мало похожи на мои. Я
надеюсь, мои труды уберегут вас от проблем. Lilo достаточно хорошо
документирован, и если вдруг кого-то заинтерисуют детали, то читайте файлы в
каталоге /usr/doc/lilo*</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="LILO.html#AEN26"
>Авторские права</A
></DT
><DT
>2. <A
HREF="LILO.html#AEN35"
>Введение</A
></DT
><DT
>3. <A
HREF="LILO.html#AEN57"
>Дополнительная информация и стандартная установка</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="LILO.html#AEN65"
>Куда мне установить Lilo?</A
></DT
><DT
>3.2. <A
HREF="LILO.html#AEN78"
>Как я должен настроить мои IDE-диски?</A
></DT
><DT
>3.3. <A
HREF="LILO.html#AEN86"
>Что можно делать в момент загрузки?</A
></DT
><DT
>3.4. <A
HREF="LILO.html#AEN109"
>Как мне убрать Lilo?</A
></DT
></DL
></DD
><DT
>4. <A
HREF="LILO.html#AEN135"
>Простая конфигурация</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="LILO.html#AEN142"
>Как справиться с большими ядрами</A
></DT
><DT
>4.2. <A
HREF="LILO.html#AEN146"
>Другие источники информации</A
></DT
><DT
>4.3. <A
HREF="LILO.html#AEN150"
>Как загрузить Windows NT из меню Lilo</A
></DT
></DL
></DD
><DT
>5. <A
HREF="LILO.html#AEN163"
>Настройка <TT
CLASS="LITERAL"
>hdc</TT
> для загрузки, как <TT
CLASS="LITERAL"
>hda</TT
>, и использование опции <TT
CLASS="LITERAL"
>bios=</TT
></A
></DT
><DT
>6. <A
HREF="LILO.html#AEN196"
>Использование Lilo, когда BIOS не видит корневой раздел</A
></DT
><DT
>7. <A
HREF="LILO.html#AEN206"
>Использование Lilo, когда BIOS не видит загрузить корневой раздел</A
></DT
><DT
>8. <A
HREF="LILO.html#AEN222"
>Загрузка с аварийного флоппи-диска</A
></DT
></DL
></DIV
><P
>Эта версия Lilo mini-HOWTO основана на работе
Cameron Spitzer (<TT
CLASS="LITERAL"
>cls@truffula.sj.ca.us</TT
>)
и
Alessandro Rubini (<TT
CLASS="LITERAL"
>rubini@linux.it</TT
>).</P
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN26"
>1. Авторские права</A
></H1
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но так или иначе автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
>, или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN35"
>2. Введение</A
></H1
><P
>По той причине, что документация в исходных текстах Lilo (та, что
находится в каталоге <TT
CLASS="FILENAME"
>/usr/doc/lilo</TT
>-версия)
очень сложна для понимания, у
многих пользователей возникают некоторые проблемы при написании
собственного файла <TT
CLASS="FILENAME"
>/etc/lilo.conf</TT
>.
Этот документ предназначен для того,
чтобы поддержать их и дать минимальную информацию, а также привести 5
примеров инсталляции Lilo:</P
><P
>&#13;<P
></P
><UL
><LI
><P
>Первый пример: классическая инсталляция "Linux и что-то еще".</P
></LI
><LI
><P
>Следующий пример покажет, как установить Lilo на винчестер, подключенный к
<TT
CLASS="LITERAL"
>/dev/hdc</TT
>, который загрузится как
<TT
CLASS="LITERAL"
>/dev/hda</TT
>.
Это обычно бывает нужно, когда
вы устанавливаете новый Linux на вашей уже работающей машине. В нем также
описано, как загружаться со SCSI-дисков, когда ваш BIOS достаточно
современен.</P
></LI
><LI
><P
>Третий пример показывает, как загрузить Linux, чей корневой раздел
не доступен BIOS.</P
></LI
><LI
><P
>Следующий пример используется для больших дисков, с которыми проблемы и у
BIOS-а и у DOS-а (этот пример уже немного устарел).</P
></LI
><LI
><P
>Последний пример показывает, как восстановить поврежденный диск, если
повреждение было нанесено путем установки другой операционной системы.</P
></LI
></UL
>&#13;</P
><P
>Автор последних трех примеров - Cameron, <TT
CLASS="LITERAL"
>cls@truffula.sj.ca.us</TT
>&#62;, он и
писал оригинал документа. Alessandro <TT
CLASS="LITERAL"
>rubini@linux.it</TT
>&#62;
сопроводитель
документа на текущий момент, не запускает на своей машине ничего кроме
Linux, поэтому он не может ни проверить, ни дополнить примеры сам. Надеюсь
не надо напоминать, что любые отзывы принимаются с радостью.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN57"
>3. Дополнительная информация и стандартная установка</A
></H1
><P
>Когда Lilo загружает систему, он использует вызовы BIOS для загрузки ядра
Linux с диска (IDE, флоппи или что-либо еще). Таким образом, ядро должно
находиться в некотором месте на диске, доступном BIOS.</P
><P
>Во время загрузки ядра Lilo не имеет возможности читать данные файловой
системы, поэтому все, что вы напишете в файле <TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
>
преобразовывается во время инсталляции (в момент исполнения команды
<TT
CLASS="LITERAL"
>/sbin/lilo</TT
>). Время инсталляции - это то время, когда программа строит
таблицы, содержащие список секторов, в которых находятся файлы для загрузки
операционной системы. Как следствие этого, все эти файлы должны находиться
на разделе, доступном BIOS (обычно все эти файлы находятся в каталоге
<TT
CLASS="LITERAL"
>/boot</TT
>, то есть только корневая файловая система вашего Linux-а должна быть
доступна BIOS).
Вы должны переинсталлировать загрузчик (то есть запускать <I
CLASS="EMPHASIS"
>/sbin/lilo</I
>) каждый
раз, когда изменяете настройку Lilo. Когда вы пересобираете ядро и
перезаписываете старый образ ядра, вы должны переустанавливать Lilo.</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN65"
>3.1. Куда мне установить Lilo?</A
></H2
><P
>Директива <TT
CLASS="LITERAL"
>boot=</TT
> в файле <TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
>
указывает Lilo, где должен
находиться его главный загрузчик (primary boot loader). В общем случае, вы
можете выбрать либо главный загрузочный сектор (master boot record)
(<TT
CLASS="LITERAL"
>/dev/hda</TT
>) или загрузочный сектор корневого раздела вашего Linux-а (это
обычно <TT
CLASS="LITERAL"
>/dev/hda1</TT
> или <TT
CLASS="LITERAL"
>/dev/hda2</TT
>).</P
><P
>Если у вас есть другая операционная система на вашем жестком диске, вам
лучше установить Lilo в загрузочный сектор вашей корневой файловой системы
вместо MBR. В этом случае вы должны пометить ваш корневой раздел, как
"загружаемый" ("bootable"), используя команду "a" в программе <I
CLASS="EMPHASIS"
>fdisk</I
> или
команду "b" в программе <I
CLASS="EMPHASIS"
>cfdisk</I
>. Если вы не измените свой MBR, вам будет
проще убрать свой Linux и Lilo, если это понадобится.</P
><P
>Конечно всегда можно избежать "правил" подобных вышеупомянутому.
Вы можете установить Lilo в MBR, даже если у вас установлена другая система.
Например, если вы установили Windows NT 4.0, как первую операционную систему
на вашей машине, тогда загрузчик NT будет записан в MBR, т.о. ваш NT
должен был загружаться без проблем.
После установки Linux и выбора - установить Lilo в MBR, Lilo перепишет
загрузчик NT.
В следующий раз при загрузке машины вы не сможете загрузить NT.
Но нет никаких проблем.
Вы просто должны отредактировать ваш <TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
>
и добавить новую запись для NT.
В следующий раз, перезагрузив систему, вы увидите в Lilo
запись для меню.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN78"
>3.2. Как я должен настроить мои IDE-диски?</A
></H2
><P
>Я лично не использую настройки LBA и LARGE в BIOS-е (но у меня на машине
только Linux); это одни из самых ужасных изобретений, вызванное
неэффективностью мира PC. Такое решение требует, чтобы ядро находилось на
первых 1024 цилиндрах винчестера, но это не проблема, потому что вы
разбиваете диск на разделы, и выделяете под корневой раздел небольшое
пространство (что вы и
должны всегда делать в любом случае).</P
><P
>Если на вашем диске есть другая операционная система, то вам наверно нельзя
будет изменить настройки BIOS, иначе эта ОС перестанет работать. Все
последние версии Lilo понимают настройки LBA и LARGE.</P
><P
>Заметьте, что ключевое слово "<TT
CLASS="LITERAL"
>linear</TT
>" в файле <TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
> может помочь
решить проблемы геометрии винчестера. Эта команда инструктирует Lilo
использовать линейные адреса секторов, вместо троек сектор/головка/цилиндр.
Преобразование из линейных в трехмерные адреса во время загрузки немного
замедляет этот процесс, но он становится менее уязвим с точки зрения
проблем геометрии.</P
><P
>Если у вас более, чем один винчестер, и некоторые из них используются
только Linux-ом, и не включаются в процесс загрузки, вы можете сказать BIOS,
что их нет. Ваша система будет загружаться быстрее, а Linux автоматически
определит их наличие при загрузке. Я часто меняю винчестеры в моих
компьютерах, не никогда не трогаю конфигурацию BIOS.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN86"
>3.3. Что можно делать в момент загрузки?</A
></H2
><P
>Когда вы видите приглашение Lilo, вы можете нажать &lt;Tab&gt; для того, чтобы
увидеть список возможных вариантов. Если Lilo не настроен на интерактивный
режим, то нажмите и держите &lt;Alt&gt; или &lt;Shift&gt; до появления сообщения
"LILO".</P
><P
>Если вы выберете загрузку ядра Linux, вы можете добавить аргументы в
командной строке после имени системы, которую вы выберете. У ядра достаточно
аргументов командной строки. Все они описаны в документе
"BootPrompt-HOWTO", автор Paul Gortmaker, я не буду пересказывать его
работу здесь. Но некоторые аргументы достаточно важны, и их необходимо здесь
описать:</P
><P
>&#13;<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>root=</TT
>: вы можете указать Linux подключить
корневой раздел, отличный от того, что написано в
<TT
CLASS="LITERAL"
>lilo.conf</TT
>.
Например, в моей системе, есть
маленький раздел, в котором находится минимальная установка Linux, и я смогу
загрузить систему, даже если, по ошибке,
полностью испорчу основной корневой раздел.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>init=</TT
>: ядра Linux версии 1.3.43 и новее могут исполнить команду, отличную
от запуска  <TT
CLASS="LITERAL"
>/sbin/init</TT
>,
в соответствии с тем, что написано в командной
строке. Если у вас возникают проблемы в процессе загрузки, вы можете получить
доступ к чистой системе, набрав в командной строке <TT
CLASS="LITERAL"
>init=/bin/sh</TT
> (когда вы
получите приглашение оболочки (shell prompt) вам скорее всего понадобится
подключить диски: попробуйте "<TT
CLASS="LITERAL"
>mount -w -n -o remount /; mount -a</TT
>", и
не забудьте сделать "<TT
CLASS="LITERAL"
>umount -a</TT
>" перед выключением компьютера).</P
></LI
><LI
><P
>Число: введя ядру в командной строке число, вы заставляете <I
CLASS="EMPHASIS"
>init</I
> запуститься
на специфическом рабочем уровне (run-level) (по умолчанию обычно это бывают
3 или 2, в соответствии с тем, какой у вас дистрибутив). Прочтите
документацию по команде <I
CLASS="EMPHASIS"
>init</I
>, изучите файлы <TT
CLASS="LITERAL"
>/etc/inittab</TT
> и <TT
CLASS="LITERAL"
>/etc/rc*.d</TT
> для
дальнейших экспериментов.</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN109"
>3.4. Как мне убрать Lilo?</A
></H2
><P
>Когда Lilo перезаписывает загрузочный сектор, он оставляет резервную копию
в файле <TT
CLASS="LITERAL"
>/boot/boot.</TT
><I
CLASS="EMPHASIS"
>xxyy</I
>, где  <I
CLASS="EMPHASIS"
>xxyy</I
> -
главное и зависимое число устройства
(major and minor numbers), в шестнадцатеричном виде. Вы можете увидеть
главное и зависимое число вашего диска или раздела, набрав  команду "<TT
CLASS="LITERAL"
>ls -l /dev/</TT
><I
CLASS="EMPHASIS"
>device</I
>".
Например, первый сектор устройства <TT
CLASS="LITERAL"
>/dev/hda</TT
> (главное число -
3, зависимое - 0) будет записано в файл <TT
CLASS="LITERAL"
>/boot/boot.0300</TT
>, установка Lilo на
<TT
CLASS="LITERAL"
>/dev/fd0</TT
> создает файл <TT
CLASS="LITERAL"
>/boot/boot.0200</TT
> и установка на устройство <TT
CLASS="LITERAL"
>/dev/sdb3</TT
>
(главное число - 8, зависимое - 19) создаст файл <TT
CLASS="LITERAL"
>/boot/boot.0813</TT
>. Заметьте,
что Lilo не создаст резервную копию, если файл уже существует, поэтому вам
не надо беспокоиться о сохранности этой копии при переустановке Lilo
(например, после сборки нового ядра). Резервные копии в каталоге <TT
CLASS="LITERAL"
>/boot/</TT
>
всегда отражают общую ситуацию до установки Lilo.</P
><P
>Если вам надо деинсталлировать Lilo (например, в очень неудачном случае -
деинсталляции Linux), вам достаточно восстановить исходный загрузочный
сектор. Если Lilo установлен в <TT
CLASS="LITERAL"
>/dev/hda</TT
>,
просто наберите "<TT
CLASS="LITERAL"
>dd if=/boot/boot.0300 of=/dev/hda bs=446 count=1</TT
>"
(Я лично делаю "<TT
CLASS="LITERAL"
>cat /boot/boot.0300 &#62; /dev/hda</TT
>", но это не совсем безопасно, так как это
восстановит и стандартную таблицу разделов, которую вы могли изменить со
времени сохранения загрузочного сектора). Эта команда значительно проще,
чем "<TT
CLASS="LITERAL"
>fdisk /mbr</TT
>" из DOS-а: она позволяет вам начисто удалить Linux  с диска
без загрузки чего-либо, кроме Linux-а. После удаления Lilo не забудьте
запустить команду <I
CLASS="EMPHASIS"
>fdisk</I
> Linux-а для удаления всех Linux-разделов
(<I
CLASS="EMPHASIS"
>fdisk</I
> в DOS-е не удаляет не-DOS разделы)
(<I
CLASS="EMPHASIS"
>Примечание переводчика: Это не верно для
так называемого DOS 7.0, встроенного в Windows 95/98</I
>).</P
><P
>Если вы установили Lilo в корневой раздел (например, в <TT
CLASS="LITERAL"
>/dev/hda2</TT
>), ничего
особенного не надо делать для деинсталляции Lilo. Просто уберите с диска
все Linux-разделы при помощи <I
CLASS="EMPHASIS"
>fdisk</I
>. Вы также должны пометить DOS-раздел
загружаемым (bootable).</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN135"
>4. Простая конфигурация</A
></H1
><P
>Многие установки Lilo используют файл, подобный приведенному ниже:</P
><P
><PRE
CLASS="SCREEN"
>boot = /dev/hda   # или ваш корневой раздел
delay = 10        # задержка, в десятых долях секунды для возможности ввода команд
vga = 0           # необязательный параметр используйте "vga=1" для разрешения 80x50
#linear           # используйте ключевое слово "linear" в случае проблем с геометрией диска.

image = /boot/vmlinux  # ваш файл zImage
  root = /dev/hda1     # ваш корневой раздел
  label = Linux        # или любое приятное вам название
  read-only            # подключить(mount) в режиме только чтение

other = /dev/hda4   # ваш dos-раздел (если есть)
  table = /dev/hda  # текущая таблица разделов (partition table)
  label = dos       # или любое другое неприятное вам название</PRE
></P
><P
>У вас может быть несколько секций "image" и "other" - столько, сколько
захотите. Не очень распространенная ситуация - иметь несколько образов
ядер, настроенных в файле <I
CLASS="EMPHASIS"
>lilo.conf</I
>, если только вы не занимаетесь
разработкой частей ядра (kernel development).</P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN142"
>4.1. Как справиться с большими ядрами</A
></H2
><P
>Если вы собираете "zImage"-ядро, и оно больше половины мегабайта
(достаточно частое явление для ядер версии 2.1), то вам нужно собрать
вместо zImage, большой zImage ("<TT
CLASS="LITERAL"
>make bzImage</TT
>") при помощи команды: "make
bzImage". Для загрузки большого ядра не надо ничего дополнительно делать,
но у вас должна быть версия Lilo18 или более новая . Если у вас
старая версия, обновите (upgrade) пакет Lilo.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN146"
>4.2. Другие источники информации</A
></H2
><P
>В дополнение к документации по Lilo существует набор мини-HOWTO,
которые вам могут пригодиться. Все они имеют название
"Linux+<I
CLASS="EMPHASIS"
>что-то еще</I
>OS",
для нескольких операционных систем. В них описывается сосуществование
Linux и других операционных систем.
Например, "NT OS Loader + Linux mini-HOWTO" (автор Bernd Reichert)
описывает, как добавить запись для Linux в существующее меню
загрузки NT.
Также документ "Multiboot-with-LILO"
описывает, как различные виды Windows могут сосуществовать с Linux.
Здесь мы будем говорить о том, как добавить запись для Windows NT в
существующее меню Lilo.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN150"
>4.3. Как загрузить Windows NT из меню Lilo</A
></H2
><P
>Здесь я предлагаю вам способ, как можно добавить пункты в меню Lilo для
того, чтобы загрузить Linux или NT:</P
><P
><P
></P
><UL
><LI
><P
>Прежде всего я предложил бы установить свежий дистрибутив
Windows NT 4.0 на ваш жесткий диск.
Я предполагаю, что вы уже сделали резервную копию важных данных,
тогда установка NT должна пройти без проблем.
Во времы установки NT, инсталлятор не спросит вас, где разместить
загрузчик NT. Он будет помещен в MBR (Главная загрузочная запись) на
вашем жестком диске.
Имеется возможность восстановить предыдущее содержимое
MBR (например от предыдущего содержимого Lilo).
Я предложил бы вам (до инсталляции NT) загрузить
компьютер с дискеты DOS, имеющей программу FDISK.
В командной строке a:\ введите: fdisk /mbr и снова перезагрузите
компьютер (без дискеты).</P
></LI
><LI
><P
>После успешной установки NT, вы увидите, что система использует
целый жесткий диск или определенный раздел жесткого диска
(в зависимости от того, что вы выбрали в процессе установки).
Т.е. рекомендуется 'сжать' раздел, где находится NT, чтобы освободить
некоторое пространство на диске.
На этом свободном пространстве вы установите Linux.
После того, как ваш NT сконфигурирован и запускается,
вы должны загрузить компьютер, используя дискету с
утилитой Partition Magic.
Это графическая утилита позволяет видеть все разделы на всех
жестких дисках, которые у вас имеются.
Вы сможете изменить разделы, не потеряв данные.
Первое - сделайте ваши существующие разделы меньшего размера,
т.о. вы получите некоторое свободное место на диске для других
целей.
Хотя я вам советую сделать резервную копию до того, как вы
будете делать любые изменения разделов, я обычно делаю 'сжатие'
разделов NT, когда NT установлена не полностью (т.е. если
появится необходимость, то повторный запуск установки не вызовет
проблем).
Partition Magic (или другая подобная утилита) будет 'сжимать'
ваши данные на NT разделе (NTFS или FAT) в начало или в конец
раздела. Вы можете сами выбрать, где размещать данные - в начале
или в конце диска (я предпочитаю, чтобы данные NT раздела
были в начале, т.ч. в конце диска будет свободное пространство).
После 'сжатия' вы можете перезагрузить систему (NT), чтобы
проверить результат: используйте для этого
Проводник Windows или Disk Administrator.</P
></LI
><LI
><P
>Пока все хорошо. Следующий шаг - установка Linux.
Возмите ваш дистрибутив RedHat (я надеюсь, что с другими пакетами
подобно), поместите установочный диск в устройство и перезагрузите
компьютер.
Когда вы выберите тип установки (Gnome или KDE
Workstation, Custom и т.п.) можно выбрать
запланированные заранее компоненты для установки, но я рекомендую
сначала установить Workstation.
Это лучше, т.к. установка Linux будет автоматически искать
свободное пространство на (первом) жестком диске, сделайте
все разделы необходимые Linux, отформатируйте их должным образом
и выберите большинство опций по умолчанию, так установка
пройдет лучше (позже, если вы хотите, вы можете или добавить
отсутствующие компоненты, или переустановить Linux, выбрав Custom).
Lilo запишется в MBR.</P
></LI
><LI
><P
>После окончания установки Linux, вы  должны перезагрузить компьютер
и после перезагрузки вы увидите только Lilo, с единственным
пунктом "Linux" в меню загрузки (или может быть больше, чем один пункт,
в случае, когда у вас многопроцессорная система).
Но не паникуйте! Ваш Windows NT находится там, где вы его установили.
Вам будет необходимо найти и отредактировать файл /etc/lilo.conf.
Сначала, когда вы откроете этот файл, вы увидите только одну (или больше)
записей для загрузки Linux.
Вы должны точно знать расположение (читай: раздел), где установлен
Windows NT, т.о. вы должны добавить соответствующую запись в
файл /etc/lilo.conf.
После того, как вы это сделаете, перезапустите Lilo, и при следующей
перезагрузке вы увидите обе записи 'linux' и 'nt' в меню Lilo.</P
></LI
></UL
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN163"
>5. Настройка <TT
CLASS="LITERAL"
>hdc</TT
> для загрузки, как <TT
CLASS="LITERAL"
>hda</TT
>, и использование опции <TT
CLASS="LITERAL"
>bios=</TT
></A
></H1
><P
>Lilo позволяет установить ядро на одно устройство и заставить BIOS читать
его с другого устройства. Например, я часто устанавливаю Linux на диск,
подключенный к <TT
CLASS="LITERAL"
>hdc</TT
> (главный диск на вторичном IDE-контроллере) и
загрузиться с него, как с системы на другом компьютере. Я
скопировал инсталляционный диск на маленький раздел, поэтому могу
запустить команду <B
CLASS="COMMAND"
>chroot</B
> на виртуальной консоли для установки Lilo на
<TT
CLASS="LITERAL"
>hdc</TT
>,
пока я занимаюсь чем-то другим.</P
><P
>Файл <TT
CLASS="FILENAME"
>lilo.conf</TT
>, который я использую для инсталляции Lilo выглядит примерно так:</P
><P
><PRE
CLASS="SCREEN"
># Этот файл должен использоваться для системы, видящей этот диск как /dev/hdc
boot = /dev/hdc   # перезаписать MBR на hdc
disk = /dev/hdc   # Указать, как hdc будет выглядеть в системе:
   bios = 0x80    #  BIOS увидит его, как первый диск
delay = 0
vga = 0

image = /boot/vmlinux  # это уже на /dev/hdc1
  root = /dev/hda1     # но во время загрузки это будет hda1
  label = Linux
  read-only</PRE
></P
><P
>Этот конфигурационный файл должен читаться Lilo, запускаемым с <TT
CLASS="LITERAL"
>/dev/hdc1</TT
>.
Таблицы Lilo, которые будут записаны в загрузочный сектор (/dev/hdc),
должны описывать файлы в каталоге <TT
CLASS="FILENAME"
>/boot</TT
> (который в свою очередь находится
на <TT
CLASS="LITERAL"
>hdc</TT
>); эти файлы будут доступны при доступе к <TT
CLASS="LITERAL"
>hda</TT
>, когда диск будет
загружен в виде отдельной системы.</P
><P
>Я назвал этот файл <TT
CLASS="FILENAME"
>/mnt/etc/lilo.conf.hdc</TT
> (<TT
CLASS="FILENAME"
>/mnt</TT
> - это место, куда был
подключен диск <TT
CLASS="LITERAL"
>hdc</TT
> во время инсталляции). Я устанавливаю Lilo командой
"<B
CLASS="COMMAND"
>cd /mnt; chroot . sbin/lilo -C /etc/lilo.conf.hdc</B
>". Читайте документацию по
<B
CLASS="COMMAND"
>chroot</B
>, если эта команда вам не понятна.</P
><P
>Директива "<TT
CLASS="LITERAL"
>bios=</TT
>" в файле <TT
CLASS="FILENAME"
>lilo.conf</TT
> нужна для того, чтобы указать Lilo, что
думает о ваших устройствах Lilo. Вызовы BIOS определяют флоппи-диски и
жесткие диски номерами: 0x00 и 0x01 означают флоппи-дисководы, 0x80 и более
означают винчестеры (старые версии BIOS могли работать только с двумя
дисками). Поэтому "<TT
CLASS="LITERAL"
>bios = 0x80</TT
>" в предыдущем примере означает
"использовать 0x80 в вызовах BIOS при доступе к <TT
CLASS="FILENAME"
>/dev/hdc</TT
>".</P
><P
>Эта директива Lilo может быть применима и в другой ситуации: когда,
например, ваш BIOS имеет возможность загружаться со SCSI-дисков вместо IDE.
Когда есть и IDE-, и SCSI-устройства, Lilo не может определить, к которому
будет относиться цифра 0x80, потому что пользователь выбирает порядок в
конфигурационных меню BIOS, и они не доступны во время работы Linux.</P
><P
>По умолчанию Lilo считает, что IDE-диски идут первыми, поэтому, в противном
случае, в файле <TT
CLASS="FILENAME"
>/etc/lilo.conf</TT
> должно находиться примерно следующее:</P
><P
>disk = /dev/sda
  bios = 0x80</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN196"
>6. Использование Lilo, когда BIOS не видит корневой раздел</A
></H1
><P
>У меня два IDE-диска, и один SCSI. SCSI-диск не виден из BIOS. Загрузчик
Linux, Lilo, использует вызовы BIOS и может видеть только те диски, которые
видит BIOS. Мой глупый AMI BIOS может загрузиться только с "A:" или "C:"
Моя корневая файловая система находится на SCSI-диске.</P
><P
>Решение состоит в том, чтобы держать ядро, файл таблиц (map file) и
цепочный загрузчик (chain loader) в Linux-разделе на первом IDE-диске.
Заметьте, что необязательно в этом случае иметь ядро на корневом разделе.</P
><P
>Второй раздел на моем первом IDE-диске (<TT
CLASS="FILENAME"
>/dev/hda2</TT
>, Linux-раздел для
загрузки системы) подключен к <TT
CLASS="LITERAL"
>/u2</TT
>. Вот файл <TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
>, который я
использовал.</P
><P
><PRE
CLASS="SCREEN"
>#  Установка Lilo на MBR
#  первого IDE-диска.
#
boot = /dev/hda
#  /sbin/lilo (установщик) копирует загрузочную запись Lilo
#  из следующего файла в месторасположение MBR.
install = /u2/etc/lilo/boot.b
#
#  Я написал сложное загрузочное меню.  Lilo найдет его здесь.
message = /u2/etc/lilo/message
#  Установщик создаст следующий файл. Он подскажет
#  загрузчику, где находятся блоки ядра.
map = /u2/etc/lilo/map
compact
prompt
#  Ожидать 10 секунд, затем загрузить ядро версии 1.2.1 по умолчанию.
timeout = 100
#  Ядро можно скопировать туда, где его увидит BIOS командой:
#      cp -p /usr/src/linux/arch/i386/boot/zImage /u2/z1.2.1
image = /u2/z1.2.1
        label = 1.2.1
#  Lilo указывает ядру - подключить первый раздел на SCSI
#  в качестве корневого. Для этого BIOS не обязательно должен его видеть.
        root = /dev/sda1
#  Этот раздел будет проверен и переподключен (remount) в скрипте /etc/rc.d/rc.S
        read-only
#  Я оставил старое ядро Slackware на случай, если я соберу нерабочее ядро
#  Кстати, мне это пригодилось
image = /u2/z1.0.9
        label = 1.0.9
        root = /dev/sda1
        read-only
#  Мой раздел с DR-DOS 6.
other = /dev/hda1
        loader=/u2/etc/lilo/chain.b
        label = dos
        alias = m</PRE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN206"
>7. Использование Lilo, когда BIOS не видит загрузить корневой раздел</A
></H1
><P
>У меня на работе в системе установлен IDE-диск размером 1Гб. BIOS может
видеть только первые 504 Мб этого диска. (Здесь Мб означает 2**10 байт, а
не 10**6.) Поэтому у меня MS-DOS на 350 Мб разделе <TT
CLASS="LITERAL"
>/dev/hda1</TT
> и мой корневой
раздел Linux размером 120 Мб - <TT
CLASS="LITERAL"
>/dev/hda2</TT
>.</P
><P
>MS-DOS не смог установиться правильно, когда диск был чистый. У Novell DOS
7 была та же проблема. К счастью для меня, "Аксессуары от IBM" были
неполными - забыли положить дискету с программой "OnTrack" в коробку с
винчестером. Винчестер должен был поставляться с продуктом под названием
"OnTrack Disk Manager." Если у вас только MSDOS, я думаю, вам он
понадобится.</P
><P
>Поэтому я создал таблицу разделов при помощи команды fdisk в Linux-е.
MSDOS-6.2 отказался от инсталляции в <TT
CLASS="LITERAL"
>/dev/hda1</TT
>. Он сказал что-то типа "Эта
версия MS-DOS только для новых установок, а на вашем компьютере уже есть
MS-DOS, поэтому получите версию обновления (upgrade release) от вашего
дилера." А на самом деле диск был новый.</P
><P
>Какая неудача! Поэтому я снова запустил fdisk в Linux-е снова и удалил
раздел 1. Удовлетворенная этим MS-DOS 6.2 создала такой же в точности
раздел, который я только что удалил и туда себя установила. MS-DOS 6.2
также записала свой MBR на диск, но он не загружался.</P
><P
>К счастью, у меня было ядро Slackware на флоппи (созданное программой
установки дистрибутива Slackware), поэтому я загрузил Linux и
перезаписал Lilo поверх сломанного MBR MS-DOS-а. И все заработало. Вот файл
<TT
CLASS="FILENAME"
>/etc/lilo.conf</TT
>, который я использовал:</P
><P
><PRE
CLASS="SCREEN"
>boot = /dev/hda
map = /lilo-map
delay = 100
ramdisk = 0             # Отключить электронный диск (ramdisk) в ядре Slackware
timeout = 100
prompt
disk = /dev/hda         # BIOS видит только первые 500 Мб.
   bios = 0x80          # выбрать первый IDE.
   sectors = 63         # возьмите количество секторов из руководства по диску.
   heads = 16
   cylinders = 2100
image = /vmlinuz
  append = "hd=2100,16,63"
  root = /dev/hda2
  label = linux
  read-only
  vga = extended
other = /dev/hda1
  label = msdos
  table = /dev/hda
  loader = /boot/chain.b</PRE
></P
><P
>После того, как я это все установил, я выяснил, что раздел, содержащий
файлы zImage, boot.b, map, chain.b и файлы сообщений, может иметь
файловую систему msdos, если только она не испорчена "Stacker"-ом
или "Doublespace"-ом. Поэтому мой раздел DOS на <TT
CLASS="LITERAL"
>/dev/hda1</TT
> мог стать
размером 500 Мб.</P
><P
>Я также выяснил, что система "OnTrack" записала бы таблицу разделов немного
в другое место, чем обычно, и, возможно, для совместимости изменила
IDE-драйвер Linux-а. Но установка этого "OnTrack" сделала бы невозможной
загрузку со стандартного ядра, входящего в поставку Slackware. Кстати,
потом IBM прислал мне дискету с "OnTrack". Я позвонил в службу поддержки
OnTrack. Они сказали мне, что Linux - плохая система, потому что не
использует BIOS. Я выкинул их дискету.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN222"
>8. Загрузка с аварийного флоппи-диска</A
></H1
><P
>Затем, я установил Windows-95 в моем офисе. Она напрочь затерла мой
прекрасный MBR Lilo, но оставила мои разделы с Linux в покое. Ядра долго
загружаются с флоппи, поэтому я поработал над настройками, чтобы флоппи мог
загружать ядро с IDE-диска.</P
><P
>Я сделал этот флоппи примерно так:</P
><P
><PRE
CLASS="SCREEN"
>  fdformat /dev/fd0H1440      #  отформатировать диск
  mkfs -t minix /dev/fd0 1440 #  создать файловую систему minix
  mount /dev/fd0 /mnt         #  подключить диск к стандартной временной точке
  cp -p /boot/chain.b /mnt    #  скопировать цепочный загрузчик (chain loader) на диск
  lilo -C /etc/lilo.flop      #  установить Lilo и его таблицы на дискету.
  umount /mnt</PRE
></P
><P
>Заметьте, что дискета <I
CLASS="EMPHASIS"
>должна быть подключена к системе во время запуска
инсталлятора Lilo</I
>, чтобы Lilo мог правильно построить свои таблицы.</P
><P
>Ниже приведен файл <TT
CLASS="FILENAME"
>/etc/lilo.flop</TT
>. Он почти такой же, как и предыдущий:</P
><P
><PRE
CLASS="SCREEN"
>#  Создает флоппи, который может загружать ядра с IDE.
boot = /dev/fd0
map = /mnt/lilo-map
delay = 100
ramdisk = 0
timeout = 100
prompt
disk = /dev/hda     # 1 Гб IDE, BIOS видит только первые 500 Мб.
   bios=0x80
   sectors = 63
   heads = 16
   cylinders = 2100
image = /vmlinuz
  append = "hd=2100,16,63"
  root = /dev/hda2
  label = linux
  read-only
  vga = extended
other = /dev/hda1
  label = msdos
  table = /dev/hda
  loader = /mnt/chain.b</PRE
></P
><P
>И последнее. Мне понадобилась MS-DOS 6.2 в моей офисной системе, но я не
хотел трогать первый диск. Я установил SCSI-контроллер и диск, создал там
файловую систему msdos при помощи команды mkdosfs, и  Windows-95 увидел его
как "D:". Но, конечно, MSDOS не мог загрузиться с D:. Это не проблема, когда
у вас есть Lilo. Я добавил следующее в файл <TT
CLASS="FILENAME"
>lilo.conf</TT
> из Примера 2.</P
><P
><PRE
CLASS="SCREEN"
>other = /dev/sda1
  label = d6.2
  table = /dev/sda
  loader = /boot/any_d.b</PRE
></P
><P
>С этим дополнением MSDOS-6.2 работает и думает, что он на диске C:, а Windows-95 - на D:.</P
></DIV
></DIV
></BODY
></HTML
>