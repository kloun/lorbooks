<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux Kernel HOWTO: Как настраивать ядро</TITLE>
 <LINK HREF="Kernel-HOWTO-4.html" REL=next>
 <LINK HREF="Kernel-HOWTO-2.html" REL=previous>
 <LINK HREF="Kernel-HOWTO.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="Kernel-HOWTO-4.html">Следующий</A>
<A HREF="Kernel-HOWTO-2.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc3">Содержание</A>
<HR>
<H2><A NAME="s3">3. Как настраивать ядро</A></H2>

<H2><A NAME="ss3.1">3.1 Получение исходных текстов</A>
</H2>

<P>Вы можете получить исходные тексты с помощью анонимного ftp с
<CODE>ftp.funet.fi</CODE> в директории <CODE>/pub/Linux/PEOPLE/Linus</CODE>, с его
зеркала, или с другого сервера. Они обычно обозначены как
<CODE>linux-x.y.z.tar.gz</CODE>, где <CODE>x.y.z</CODE> номер версии. Более новые
(лучшие?) версии и заплатки (patches) обычно находятся в поддиректориях,
таких как `<CODE>v1.1</CODE>' и `<CODE>v1.2</CODE>'. Самый большой номер имеет
последняя версия и обычно является ``тестовой версией'', это значит, что
если вы нелегко плохо чувствуете себя с альфа или бета версиями, то вы
должны использовать стабильную версию.
<P>
<P>Я <I>настоятельно</I> рекомендую вам использовать сервера-зеркала
вместо использования ftp.funet.fi. Здесь приведен короткий список
серверов-зеркал и других серверов:
<P>
<PRE>
USA:         sunsite.unc.edu:/pub/Linux/kernel
USA:         tsx-11.mit.edu:/pub/linux/sources/system
UK:          sunsite.doc.ic.ac.uk:/pub/unix/Linux/sunsite.unc-mirror/kernel
Austria:     ftp.univie.ac.at:/systems/linux/sunsite/kernel
Germany:     ftp.Germany.EU.net:/pub/os/Linux/Local.EUnet/Kernel/Linus
Germany:     sunsite.informatik.rwth-aachen.de:/pub/Linux/PEOPLE/Linus
France:      ftp.ibp.fr:/pub/linux/sources/system/patches
Australia:   sunsite.anu.edu.au:/pub/linux/kernel
</PRE>
<P>В общем зеркало сервера <CODE>sunsite.unc.edu</CODE> является хорошим местом,
где можно взять исходные тексты ядра. Файл <CODE>/pub/Linux/MIRRORS</CODE>
содержит список известных серверов-зеркал. Если у вас нет доступа к ftp, то 
список систем BBS, которые распространяют linux периодически посылается в
группу comp.os.linux.announce; постарайтесь получить его. 
<P>
<P>Если вы ищете общую информацию о Linux и его дистрибутивах, то
посмотрите на <CODE>http://www.linux.org</CODE>.
<P>
<H2><A NAME="ss3.2">3.2 Распаковка исходных текстов</A>
</H2>

<P>Войдите в систему как администратор или выполните команду <CODE>su</CODE>, и 
перейдите в директорию <CODE>/usr/src</CODE>.Если вы устанавливали исходные
тексты ядра при установке linux (как делает большинство), то том у вас уже
есть директория названная `<CODE>linux</CODE>', которая содержит полное дерево
устаревших исходных текстов. Если у вас есть свободное дисковое
пространство, то вы можете сохранить эту директорию. Хорошая идея&nbsp;--
определить какая версия ядра запущена и соответственно переименовать
директорию. Команда `<CODE>uname -r</CODE>' выдает номер текущей версии
ядра. Поэтому, если команда `<CODE>uname -r</CODE>' выдала `<CODE>1.0.9</CODE>', то 
вы должны переименовать (с помощью `<CODE>mv</CODE>') `<CODE>linux</CODE>' в
`<CODE>linux-1.0.9</CODE>'. Если вы не чувствуете, что поступаете опрометчиво,
то просто сотрите всю директорию. В любом случае убедитесь, что никакой
директории `<CODE>linux</CODE>' в <CODE>/usr/src</CODE> до распаковки полного
исходного кода ядра. 
<P>
<P>Теперь распакуйте в <CODE>/usr/src</CODE> исходные тексты, пользуясь
командой `<CODE>tar zxpvf linux-x.y.z.tar.gz</CODE>' (если вы получили просто
файл <CODE>.tar</CODE> без расширения <CODE>.gz</CODE> на конце, то работает
команда `<CODE>tar xpvf linux-x.y.z.tar</CODE>'). Содержимое архива будет
распаковано. После окончания процесса, будет существовать новая директория
`<CODE>linux</CODE>' в <CODE>/usr/src</CODE>. Перейдите <CODE>linux</CODE> и посмотрите 
файл <CODE>README</CODE>. Там будет раздел с заголовком `<CODE>INSTALLING the
kernel (Установка ядра)</CODE>'. Выполните соответствующие инструкции&nbsp;-- 
символические ссылки должны быть на своем месте, удалите старые <CODE>.o</CODE>
файлы, и т.п.
<P>
<H2><A NAME="ss3.3">3.3 Настройка ядра</A>
</H2>

<P><B>Замечание</B>: Некоторое из этого являются повторенниями/пояснениями
подобного раздела  файла <CODE>README</CODE> поставляемого Linus.
<P>
<P>Команда `<CODE>make config</CODE>' выполненная в  <CODE>/usr/src/linux</CODE>
запускает скрипт настройки, которая задает вам много вопросов. Она требует
наличия bash, так что проверьте что bash находятся в <CODE>/bin/bash</CODE>,
<CODE>/bin/sh</CODE>, или <CODE>$BASH</CODE>.
<P>
<P>Существуют некоторые альтернативы команде `<CODE>make config</CODE>' и вы
можете найти их более удобными и легкими для использования. Те, кто
работает в X могут попробовать `<CODE>make xconfig</CODE>', если у вас
установлен Tk  (`click-o-rama' - Nat). `<CODE>make menuconfig</CODE>'&nbsp;--
это для тех, у кого установлен (n)curses и предпочитает текстовые меню. Эти 
интерфейсы имеют одно явное преимущество: если вы сделали неправильный выбор 
в течении настройки, то очень легко вернуться и исправить ее. 
<P>
<P>Теперь вы готовы отвечать на вопросы, обычно ответы выглядят как
`<CODE>y</CODE>' (да) или `<CODE>n</CODE>' (нет). Драйвера устройств обычно имеют
опцию `<CODE>m</CODE>'. Это означает ``module (модуль)'', обозначая, что
система будет компилировать этот драйвер, но не вставит его прямо в ядро, а 
сделает загружаемым модулем. Более комично эта опция описывается как
``maybe (может быть)''. Некоторые более ясные и некритичные опции здесь не
описаны; смотрите раздел ``Другие опции настройки'' для их краткого
описания. 
<P>
<P>В версиях 2.0.x и более поздних, существует опция `?', которая
обеспечивает краткое описание параметра настройки. Эта информация скорее
всего наиболее свежая. 
<P>
<H3>Эмуляция математических функций ядром</H3>

<P>Если у вас нет математического сопроцессора (у вас голый 386 или 486SX),
то вы должны ответить `<CODE>y</CODE>' на этот вопрос. Если у вас есть
сопроцессор и  вы все равно ответили `<CODE>y</CODE>', то не
беспокойтесь&nbsp;-- сопроцессор все рано будет использоваться, а эмуляция
будет проигнорирована. Единственное следствие этого в том, что ядро будет
больше (расход ОЗУ). Я упоминал о том, что эмуляция очень медлена; хотя это 
не очень часто влияет, но все равно вспомните это, если столкнетесь с
малой производительностью системы X-windos.
<P>
<H3>Поддержка обычных (MFM/RLL) дисков и дисков/cdrom IDE</H3>

<P>Вам вероятно необходима эта поддержка; это означает, что ядро будет
поддерживать стандартные жесткие диски PC, которые имеет большинство
людей. Этот драйвер не включает поддержку SCSI дисков; их выбор идет далее
в настройке.
<P>
<P>Затем у вас спросят о драйверах ``old disk-only (только старых дисков)'' и ``new
IDE (новых IDE)''. Вы захотите выбрать один из них; основное отличие в том, 
что старые диски поддерживают только два диска на одном интерфейсе, а новые 
поддерживают вторичный (secondary) интерфейс и накопители IDE/ATAPI
cdrom. Новый драйвер на 4k больше старого и также предположительно
``улучшен'', убирая некоторое количество ошибок, он может улучшить
производительность вашего диска, особенно если у вас новое оборудование
(типа EIDE).
<P>
<H3>Поддержка сети</H3>

<P>В принципе вы должны ответить `<CODE>y</CODE>', если ваша машина подключена
к сети, такой как internet, или вы хотите использовать SLIP, PPP, term и
т.п. для dial up доступа к internet. Однако много пакетов (таких как
оконная система X) требует поддержку сети, даже если вы не подключены ни к
какой сети, вы должны сказать `<CODE>y</CODE>'. Позже у вас спросят, хотите ли
вы поддержку TCP/IP; далее скажите `<CODE>y</CODE>', если вы абсолютно уверены
в своем выборе.
<P>
<H3>Ограничить память до менее 16MB</H3>

<P>Существуют работающие с ошибками контролеры DMA на машинах с процессором 
386, которые имеют проблемы с адресацией больше 16 Мб ОЗУ; вы можете
ответить `<CODE>y</CODE>' в случае (редком) если у вас такой контроллер.
<P>
<H3>System V IPC</H3>

<P>Одно из лучших определений IPC (Interprocess Communication,
Межпроцессного сообщения) данов в глоссарии книги по Perl. Не удивительно,
что некоторые программисты на Perl используют этот механизм чтобы позволить 
процессу общаться с другими процессами, так же как и другие пакеты (самый
заметный из них это DOOM), так что ответ <CODE>n</CODE> не является хорошей
идеей, пока вы не будете точно уверены в том, что вы делаете.
<P>
<H3>Тип процессора (386, 486, Pentium, PPro)</H3>

<P>(в старых ядрах: используйте флаг -m486 для оптимизации для процессора
486)
<P>
<P>Традиционно, это делает некоторую оптимизацию для выбранного процессора;
ядра работают быстрее, но ядро может быть несколько больше. В новых ядрах,
это однако больше не является правдой, так что вы должны ввести процессор
для которого вы компилируете ядро. Ядро для ``386'' будет работать на всех
машинах. 
<P>
<H3>Поддержка SCSI</H3>

<P>Если у вас есть устройства SCSI, то ответьте `<CODE>y</CODE>'. У вас
запросят дополнительную информацию, такую как поддержку CD-ROM, дисков, и
какой тип адаптера SCSI у вас имеется. Смотрите SCSI-HOWTO для
дополнительной информации.
<P>
<H3>Поддержка сетевых устройств</H3>

<P>Если у вас есть сетевая карта, или вы хотите использовать SLIP, PPP, или 
адаптер параллельного порта для подключения к Internet, то ответьте
`<CODE>y</CODE>'. Скрипт настройки запросит у вас тип карты и какие протоколы
вы хотите использовать. 
<P>
<H3>Файловые системы</H3>

<P>Затем настроечный скрипт запросит у вас поддержку для каких файловых
систем вы хотите иметь в своей системе:
<P>
<P>Стандартная (minix) - Более новые дистрибутивы не создают файловые
системы minix, и много людей не используют ее, но все равно хорошая идея
настроить ее. Некоторые программы с ``дисками для восстановления (rescue
disk)'' используют ее и все еще много гибких дисков могут использовать
файловую систему minix, поскольку файловая система minix менее мучительная
для использования на гибких дисках. 
<P>
<P>Extended fs - это была первая версия расширенной файловой системы,
которая сейчас не является широко используемой. Если вы не знаете
точно, что она вам нужна и сомневаетесь, то скорее всего она вам не нужна. 
<P>
<P>Second extended - эта файловая система широко используется в новых
дистрибутивах. У вас скорее всего она есть и вам нужно ответить `<CODE>y</CODE>'.
<P>
<P>файловая система xiafs - одно время она не была необычно, но во время
написания этого документа я не знал никого использующего эту файловую
систему. 
<P>
<P>msdos - если вы хотите использовать разделы вашего жесткого диска с
MS-DOS, или монтировать гибкие диски, отформатированные под MS-DOS, то
ответьте `<CODE>y</CODE>'.
<P>
<P>umsdos - эта файловая система расширяет возможности файловой системы
MS-DOS обычными Unix-подобными возможностями, такими как длинные имена. Это 
не является полезным для людей (таких как я), кто ``не работает в DOS.''
<P>
<P>/proc - одна из величайших вещей со времен изобретения порошкового
молока (я так предполагаю, идея была бесстыдно украдена у Bell Labs). Она
не создает файловую систему proc на диске; она является интерфейсом
в виде файловой системы к ядру и процессам. Много программ, выдающих список 
процессов (таких как `<CODE>ps</CODE>') используют ее. Как нибудь попробуйте
выполнить `<CODE>cat /proc/meminfo</CODE>' или `<CODE>cat
/proc/devices</CODE>'. Некоторые командные процессоры (в частности rc)
используют <CODE>/proc/self/fd</CODE>  (известный как <CODE>/dev/fd</CODE> в
других системах) для ввода/вывода. Вы должны почти всегда ответить
`<CODE>y</CODE>' на этот вопрос; много важных утилит для linux зависят от этого 
выбора.
<P>
<P>NFS - если ваша машина работает в сети и вы хотите использовать файловые 
системы находящиеся на других машинах с помощью NFS, то ответьте `<CODE>y</CODE>'.
<P>
<P>ISO9660 - имеется на большинстве CD-ROM. Если у вас есть привод CD-ROM
и вы хотите использовать его в Linux, то ответьте `<CODE>y</CODE>'.
<P>
<P>OS/2 HPFS - во время написания работает как файловая система только для
чтения для OS/2 HPFS.
<P>
<P>System V и Coherent - для разделов машин с System V и Coherent (это
другие варианты Unix для PC).
<P>
<H3>Но я не знаю какие файловые системы мне нужны!</H3>

<P>Хорошо, наберите команду `<CODE>mount</CODE>'. Ее вывод будет выглядеть
примерно так:
<P>
<BLOCKQUOTE><CODE>
<PRE>
    blah# mount
    /dev/hda1 on / type ext2 (defaults)
    /dev/hda3 on /usr type ext2 (defaults)
    none on /proc type proc (defaults)
    /dev/fd0 on /mnt type msdos (defaults)
</PRE>
</CODE></BLOCKQUOTE>
<P>Посмотрите на каждую строку; слово идущее за словом  `<CODE>type (тип)</CODE>'
является типом файловой системы. В моем примере мои файловые системы
<CODE>/</CODE> и <CODE>/usr</CODE> являются файловыми системами типа second
extended, я использую <CODE>/proc</CODE>, и есть гибкий диск смонтированный
используя файловую систему msdos.
<P>
<P>Вы можете попробовать выполнить `<CODE>cat /proc/filesystems</CODE>', если у 
вас в настоящее время разрешено использование <CODE>/proc</CODE>; эта команда
перечислит файловые системы, поддержку которых имеет ваше ядро.
<P>
<P>Настройка редко используемых, не критических файловых систем может
вызвать раздувание вашего ядра; смотрите раздел о модулях чтобы избежать
этого и раздел ``Ловушки'' о том, почему раздувшееся ядро
является нежелательным. 
<P>
<H3>Символьные устройства</H3>

<P>В этом разделе вы выбираете драйвера для вашего принтера (параллельного
принтера), шинной мыши, мыши для PS/2 (многие notebook используют протокол
мыши PS/2 для своих встроенных трекболов), некоторые ленточные накопители и
другие такие же ``символьные'' устройства. Ответьте `<CODE>y</CODE>' где
необходимо. 
<P>
<P>Замечание: Selection это программа, которая позволяет вам использовать
мышь вне системы X window для вырезания и вставки между виртуальными
консолями. Она работает довольно хорошо, если у вас мышь для
последовательного порта, потому-что она хорошо работает с X, но вам
необходимо выполнить некоторые действия, для того чтобы работали другие
типы мышей. Поддержка Selection одно время была опцией настройки, но сейчас 
она является стандартом. 
<P>
<P>Замечание 2: Сейчас Selection считается устаревшей. Имя новой программы
``gpm''. Она может делать более фантастические вещи, такие как трансляцию
протокола мыши, работать с несколькими мышами, ..
<P>
<H3>Звуковые карты</H3>

<P>если вы чувствуете огромное желание слышать рявканье <CODE>biff</CODE>, то
ответьте `<CODE>y</CODE>', и далее другая программа настройки будет
скомпилирована и будет задавать вам вопросы о вашей звуковой
карте. (Примечание о настройке звуковой карты: когда программа спросит у
вас устанавливать ли полную версию драйвера, то ответьте `<CODE>n</CODE>' и
сохраните некоторое количество памяти в ядре выбором только необходимых
возможностей драйвера). Я сильно рекомендую вам посмотреть в Sound-HOWTO
для более детальной информации о поддержке звука, если у вас есть звуковая
карта. 
<P>
<H3>Другие опции настройки</H3>

<P>Не все опции настройки перечислены здесь потому-что они слишком часто
меняются или являются очевидными (например, поддержка 3Com 3C509 для
компиляции драйвера для данной карты ethernet). Существует довольно полный
список всех опций (плюс способ поместить их в скрипт <CODE>Configure</CODE>),
который собран Axel Boldt (<CODE>axel@uni-paderborn.de</CODE>) по следующему
адресу: 
<P>
<P>
<PRE>
     http://math-www.uni-paderborn.de/~axel/config_help.html
</PRE>

или через анонимный FTP по адресу:
<P>
<PRE>
     ftp://sunsite.unc.edu/pub/Linux/kernel/config/krnl_cnfg_hlp.x.yz.tgz
</PRE>
<P>где <CODE>x.yz</CODE> это номер версии.
<P>
<P>Для последних ядер (2.0.x и более поздних), этот список был интегрирован 
в дерево исходных текстов. 
<P>
<H3>Работа над ядром (Kernel hacking)</H3>

<P>Из Linus README:
<P>
<BLOCKQUOTE>
действие опции настройки ``kernel hacking''  обычно проявляется в более
большом или медленном ядре (или оба симптома), и может даже сделать
ядро менее стабильным из-за настройки некоторых подпрограмм на попытку
активно сломать плохой код, чтобы найти проблемы с ядром
(kmalloc()). Таким образом вам скорее всего надо ответить `n' на этот
вопрос для ``production'' ядер. 
</BLOCKQUOTE>
<P>
<H2><A NAME="ss3.4">3.4 Что теперь? (Makefile)</A>
</H2>

<P>После того как <CODE>make config</CODE> выдаст сообщение о том, что ваше
ядро было настроено, вы можете ``проверить (настроить) основной
<CODE>Makefile</CODE> для дополнительных настроек'', и т.п.
<P>
<P>Теперь вы можете посмотреть в <CODE>Makefile</CODE>. Вам вероятно не
понадобится изменять его, но вы не повредите его если посмотрите. Вы можете 
также изменить опции в нем с помощью команды `<CODE>rdev</CODE>' после того как 
поместите ядро на его место.
<P>
<HR>
<A HREF="Kernel-HOWTO-4.html">Следующий</A>
<A HREF="Kernel-HOWTO-2.html">Предыдущий</A>
<A HREF="Kernel-HOWTO.html#toc3">Содержание</A>
</BODY>
</HTML>
