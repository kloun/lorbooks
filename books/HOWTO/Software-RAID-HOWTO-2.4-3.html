<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>The Software-RAID HOWTO: Аппаратные решения</TITLE>
 <LINK HREF="Software-RAID-HOWTO-2.4-4.html" REL=next>
 <LINK HREF="Software-RAID-HOWTO-2.4-2.html" REL=previous>
 <LINK HREF="Software-RAID-HOWTO-2.4.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="Software-RAID-HOWTO-2.4-4.html">Next</A>
<A HREF="Software-RAID-HOWTO-2.4-2.html">Previous</A>
<A HREF="Software-RAID-HOWTO-2.4.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Аппаратные решения</A></H2>

<P>Эта секция имеет отношение к некоторым аппаратным особенностям запуска
программного RAID.
<P>
<H2><A NAME="ss3.1">3.1 Конфигурирование IDE </A>
</H2>

<P>В самом деле возможно запустить RAID на IDE дисках. Также может быть достигнута 
превосходная производительность. Фактически, сегодняшние цены на IDE устройства
и контроллеры делают IDE заслуживающим раздумий, при создании новой
RAID системы.
<UL>
<LI><B>Физическая стабильность:</B> IDE устройства традиционно 
более низкого качества, чем SCSI устройства. Даже сейчас, гарантия
на IDE устройства - типично один год, когда на SCSI часто три или пять.
Однако неправильно будет сказать, что IDE диски по определению плохо сделаны,
Вы должны осознавать, что IDE диски <EM>некоторых</EM> производителей 
<EM>могут</EM> отказывать более часто, чем подобные SCSI диски. Однако, другие 
производители используют одинаковые механические части для обоих, SCSI и IDE 
устройств. Это все сводится к одному:
Все диски отказывают, рано или поздно, и вы должны быть готовы к этому.</LI>
<LI><B>Целостность данных:</B> Раньше, в IDE не было способа гарантировать,
что данные посланные по IDE шине будут данными, фактически записанными на диск.
Это потому, что не хватало проверки четности, проверки контрольных сумм, и т.п.
Со стандартом Ultra-DMA, IDE теперь могут делать проверку контрольных сумм
данных, которые они получили, и таким образом стало очень неправдоподобно 
исказить данные.</LI>
<LI><B>Производительность:</B> Я не собираюсь детально обсуждать здесь
производительность IDE. Коротко, история такова:
<UL>
<LI>IDE устройства быстрые (12 Мб/с и выше)</LI>
<LI>IDE создают большую нагрузку на CPU, чем SCSI (но кого это интересует?)</LI>
<LI>Используйте <B>один</B> IDE диск на IDE шине, slave диски портят
производительность</LI>
</UL>
</LI>
<LI><B>Отказоустойчивость:</B> ДрайверIDE обычно устойчив и переносит отказ
IDE диска. RAID уровень пометит диск как отказавший, и если Вы работаете 
с RAID уровня 1 или выше, машина должна хорошо работать, до тех пор
пока Вы ее не остановите на ремонт.</LI>
</UL>
<P><B>Очень</B> важно, чтобы Вы использовали <B>один</B> IDE диск
на IDE шине. Два диска не только разрушают производительность, но 
отказ диска - часто гарантирует отказ шины, и, таким образом,
отказывают все устройства на этой шине.  При отказоустойчивом 
RAID (RAID уровней 1,4,5), отказ одного может быть обработан, 
но отказ двух дисков (два диска на одной шине отказывают из-за
отказа одного диска) приведут массив в неиспользуемое состояние.
Также, при отказе master диска на шине, slave или
IDE контроллер может быть сбит с толку. Одна шина - один диск, это правило.
<P>Существуют дешевые PCI IDE контроллеры. Вы часто можете получить две или
четыре шины за $80. Учитывая значительно более низкую цену IDE
по сравнению со SCSI дисками, я бы сказал, что IDE дисковые массивы могут быть
в самом деле хорошим решением, если оно реализуется относительно небольшим 
(возможно около 8) количеством дисков, которые можно подключить к типичной 
системе (если, конечно, у Вас достаточно PCI слотов для этих IDE контроллеров).
<P>У IDE есть небольшая проблема с кабелями при применении в больших
массивах. Даже если У вас достаточно PCI слотов, маловероятно, что Вы сможете
поставить более 8 дисков в систему и запустить ее без искажений данных
при передаче (из-за слишком длинных IDE кабелей).
<P>
<P>
<H2><A NAME="ss3.2">3.2 Горячая замена</A>
</H2>

<P>Некоторое время это была горячая тема списка рассылки linux-kernel. Хотя 
горячая замена дисков поддерживается в некоторой степени, она все еще
нечто не очень простое.
<P>
<H3>Диски IDE с горячей заменой</H3>

<P><B>Не делайте !</B> IDE совсем не работает с горячей заменой. Конечно, у вас
может работать, если ваш IDE драйвер скомпилирован как модуль (возможно
только в 2.2 серии ядер), и вы пере-загружаете его после замены диска. Но Вы 
можете запросто сжечь IDE контроллер, и Вы будете блокированы на значительно 
большее время, чем, если бы Вы заменили диск на выключенной машине.
<P>Главная проблема, исключая выбросы электричества, которые могут разрушить 
вашу аппаратуру, - шина IDE должны быть пересканирована после замены дисков. 
Текущий IDE драйвер так не умеет. Если новый диск на 
100% идентичен старому (геометрией и т.п.), он <EM>может</EM>
работать без пере-сканирования шины, но на самом деле, Вы ходите по краю обрыва.
<P>
<H3>Диски SCSI с горячей заменой</H3>

<P>Обычная SCSI аппаратура не позволяет горячей замены. Однако, это <B>может</B>
работать. Если Ваш SCSI драйвер поддерживает пере-сканирование шины, и удаление
и добавление устройств, Вы можете делать горячую замену. Однако, на обычной 
SCSI шине Вы не должны отключать устройства, пока система включена. 
Но опять же, это может сработать (и вы можете закончить сгоревшей аппаратурой).
<P>Уровень SCSI <B>должен</B> пережить смерть диска, но пока не все драйвера
SCSI могут так делать. Если Ваш SCSI драйвер падает при отказе диска,
ваша система упадет с ним, и горячая замена реально не возможна.
<P>
<H3>Горячая замена с SCA</H3>

<P>Со SCA, возможна горячая замена устройств. Однако, у меня нет аппаратуры
на которой можно это попробовать, и я не слышал, чтобы кто-то пробовал, так что
реально я не могу дать никаких рекомендаций, как это сделать.
<P>Если Вы хотите поиграть с этим, Вы, в любом случае, должны знать о внутренностях
SCSI и RAID. Таким образом я не собираюсь писать здесь что-либо, что  
я не  проверил, вместо этого я могу дать несколько нитей к размышлению:
<UL>
<LI>grep на предмет <B>remove-single-device</B> в
<B>linux/drivers/scsi/scsi.c</B></LI>
<LI>Взгляните на <B>raidhotremove</B> и <B>raidhotadd</B></LI>
</UL>
<P>Не все SCSI драйвера поддерживают добавление и удаление устройств. В серии
2.2 ядер, по крайней мере Adaptec 2940 и Symbios
NCR53c8xx драйвера, кажется, поддерживаю это, другие - не известно. Я буду
благодарен, если кто-то даст сюда дополнительные факты ...
<P>
<P>
<P>
<HR>
<A HREF="Software-RAID-HOWTO-2.4-4.html">Next</A>
<A HREF="Software-RAID-HOWTO-2.4-2.html">Previous</A>
<A HREF="Software-RAID-HOWTO-2.4.html#toc3">Contents</A>
</BODY>
</HTML>
