<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>NFS HOWTO: Установка сервера NFS</TITLE>
 <LINK HREF="NFS-HOWTO-4.html" REL=next>
 <LINK HREF="NFS-HOWTO-2.html" REL=previous>
 <LINK HREF="NFS-HOWTO.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="NFS-HOWTO-4.html">Следующий</A>
<A HREF="NFS-HOWTO-2.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc3">Содержание</A>
<HR>
<H2><A NAME="nfs-server"></A> <A NAME="s3">3. Установка сервера NFS</A></H2>

<H2><A NAME="ss3.1">3.1 Непременные условия</A>
</H2>

<P>До того, как вы продолжите читать этот документ вам будет
необходимо успешно выполнять операцию telnet между машинами, которые вы
будете использовать как сервер и клиент. Если что-то не работает,
вам нужно прочитать NET-3 HOWTO и правильно настроить работу сети.
<P>
<H2><A NAME="ss3.2">3.2 Первый шаг</A>
</H2>

<P>До того, как мы сможем сделать что-нибудь нам необходимо настроить
сервер NFS. Если вы являетесь частью сети факультета или университета, то у
вас вероятно есть несколько настроенных серверов NFS. Конечно, если они
позволят вам получить доступ к ним и если вы читаете этот документ чтобы
получить доступ к одному из них, то вам можно не читать это раздел и вы
можете просто пропустить его до раздела 
<A HREF="NFS-HOWTO-4.html#nfs-client">Установка клиента NFS</A><P>
<P>Если вас нужно настроить не-Linux машину как сервер, то вам нужно
прочитать руководство по нужной системе, чтобы определить как разрешить
работу сервера NFS и экспортировать файловую систему через NFS. Описание
того, как это сделать на разных платформах вынесено в отдельный
раздел. После того, как вы определили все, что вам нужно вы можете
продолжать чтение следующего раздела этого документа. Или читайте дальше
этот раздел, поскольку для некоторых вещей, о которых я буду говорить не
важно какой тип машины вы используете как сервер.
<P>
<P>Если вы торопитесь, то пожалуйста посмотрите 
<A HREF="NFS-HOWTO-10.html#linuxtwotwo">раздел Linux 2.2</A> до того, как вы продолжите читать это.
<P>
<P>То, о чем вы читали, потребует от вас настройки нескольких программ.
<P>
<H2><A NAME="portmapper"></A> <A NAME="ss3.3">3.3 Portmapper</A>
</H2>

<P>Portmapper на Linux называется либо <CODE>portmap</CODE> либо
<CODE>rpc.portmap</CODE>. Справочная страница на моей системе говорит, что это
"Преобразователь номеров портов DARPA в вызовы соответствующих программ
RPC".  Это первая дыра в безопасности, которую вы откроете читая этот
документ. Описание того, как закрыть одну из таких дыр находится в 
<A HREF="NFS-HOWTO-6.html#nfs-security">разделе по безопасности</A>, который я советую вам
обязательно прочитать.
<P>
<P>Запустите portmapper. Он называется либо <CODE>portmap</CODE>, либо
<CODE>rpc.portmap</CODE> и должен находиться в директории <CODE>/usr/sbin</CODE> (на
некоторых машинах он называется <CODE>rpcbind</CODE>). Вы можете запустить его
сейчас вручную, но он должен запускаться при каждом запуске вашей машины,
так что вам необходимо создать/отредактировать rc-скрипты. Содержание ваших
rc-скриптов объясняется более подробно в справочной странице <CODE>init</CODE>. Они
обычно находятся в директориях <CODE>/etc/rc.d</CODE>, <CODE>/etc/init.d</CODE> или
<CODE>/etc/rc.d/init.d</CODE>. Если там есть скрипт, названный <CODE>inet</CODE>, то
его мы и будем редактировать. Но то, что в нем необходимо написать или что
необходимо сделать еще, находится вне области рассмотрения этого
документа. Запустите portmap, и проверьте, что он запущен с помощью команды
<CODE>ps aux</CODE> и затем <CODE>rpcinfo -p</CODE>.  Это сделано? Хорошо.
<P>
<P>Одна вещь. Удаленный доступ к вашей программе portmapper определяется
содержимым ваших файлов <CODE>/etc/hosts.allow</CODE> и
<CODE>/etc/hosts.deny</CODE>. Если <CODE>rpcinfo -p</CODE> не работает, но ваш
portmapper запущен, то пожалуйста провереьте указанные файлы. Смотрите 
<A HREF="NFS-HOWTO-6.html#nfs-security">раздел о безопасности</A> для детального описания
этих файлов.
<P>
<P>
<H2><A NAME="nfsd"></A> <A NAME="ss3.4">3.4 Mountd и nfsd</A>
</H2>

<P>Следующие программы, которые нам нужно запустить далее&nbsp;-- это
mountd и nfsd. Но сначала мы отредактируем другой файл. Это файл
<CODE>/etc/exports</CODE>. Допустим я хочу, чтобы файловая система
<CODE>/mn/eris/local</CODE>, которая находится на машине <CODE>eris</CODE> была
доступна для машины названной <CODE>apollon</CODE>. Тогда я должен поместить в файл
<CODE>/etc/exports</CODE> на машине eris следующие строки:
<P>
<HR>
<PRE>
/mn/eris/local  apollon(rw)
</PRE>
<HR>
<P>Вышеприведенные строки дают машине apollon право на чтение/запись в каталог 
<CODE>/mn/eris/local</CODE>. Вместо <CODE>rw</CODE> мы можем сказать <CODE>ro</CODE>,
что означает достп только для чтения (если вы ничего не поместите, то по
умолчанию будет доступ только для чтения. Существуют другие опции, которые вы
можете задать здесь, и я позже рассмотрю некоторые из них, относящиеся к проблеме
к безопасности. Они все перечислены в справочной странице
<CODE>exports</CODE>, которую вы должны прочитать по крайней мере раз в
жизни. Существуют также лучшие способы, чем перечисление всех машин
в файле exports. Вы например можете использовать сетевые группы,
если у вас используется система NIS (или NYS) (NIS также известен как YP), и
всегда использовать шаблоны (wild cards) доменов и подсетей IP как списки
машин, которым разрешено что-то монтировать. Но вы должны учитывать, кто
может получить доступ к серверу неавторизованным способом, если вы
используете такую всеобъемлющую авторизацию.
<P><B>Замечание: Этот файл exports не имеет такой же синтаксис, который
используют другие системы Unix.</B> В этом документе есть отдельный раздел о
файлах <CODE>exports</CODE> других Unix-систем.
<P>
<P>Сейчас мы готовы к запуску программ mountd (она также может называться
<CODE>rpc.mountd</CODE>) и nfsd (который может назван <CODE>rpc.nfsd</CODE>).  Обе эти
программы читают данные из файла exports.
<P>
<P>Если вы отредактировали файл <CODE>/etc/exports</CODE>, то вы должны быть
уверены, что nfsd и mountd знают о том, что файл изменен.  Традиционный способ
сделать это&nbsp;-- это запустить программу <CODE>exportfs</CODE>. Во многих
дистрибутивах Linux программа exportfs отсутствует. Если это так, то вы
можете создать такой скрипт на вашей машине:
<P>
<HR>
<PRE>
#!/bin/sh
killall -HUP /usr/sbin/rpc.mountd
killall -HUP /usr/sbin/rpc.nfsd
echo re-exported file systems
</PRE>
<HR>
<P>
<P>Сохраните его в файле, скажем <CODE>/usr/sbin/exportfs</CODE>, и не забудьте
выполнить над ним команду <CODE>chmod a+rx</CODE>. Сейчас, после того как, вы
изменили ваш файл exports, вы должны запустить программу exportfs, имея
права администратора.
<P>
<P>Теперь вы должны проверить, что mountd и nfsd запущены
правильно. Сначала это делается с помощью команды <CODE>rpcinfo -p</CODE>. Вывод
программы должен показать что-то похожее на следующее:
<P>
<HR>
<PRE>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    745  mountd
    100005    1   tcp    747  mountd
    100003    2   udp   2049  nfs
    100003    2   tcp   2049  nfs
</PRE>
<HR>
<P>
<P>Как вы видите portmapper анонсировал свои сервисы, и что mountd и nfsd
запущены.
<P>
<P>Если вы получили сообщение <CODE>rpcinfo: can't contact portmapper: RPC:
Remote system error - Connection refused</CODE>,
<CODE>RPC_PROG_NOT_REGISTERED</CODE> или что-то подобное вместо этого, то
значит portmapper не запущен. Или у вас может быть что-то записано в файлах 
<CODE>/etc/hosts.{allow,deny}</CODE> что запрещает программе portmapper
отвечать, пожалуйста посмотрите 
<A HREF="NFS-HOWTO-6.html#nfs-security">раздел о безопасности</A> для подробного описания этих файлов. Если вы получили сообщение
<CODE>No remote programs registered.</CODE>, то либо portmapper не хочет
говорить с вами, либо что-то не в порядке. Завершите выполнение nfsd,
mountd и portmapper и попытайтесь выполнить заново стартовую
последовательность.
<P>
<P>После проверки того, что portmapper объявил сервисы, вы также можете
выполнить проверку работы с помощью команды ps. Portmapper будет продолжать
объявлять свои сервисы даже после того как программы расширяющие его
возможности завершили работу. Так что проверка с помощью ps может быть
необходимой, если вам кажется, что что-то не работает.
<P>
<P>Конечно вам будет нужно исправить ваши системные rc-файлы для запуска
mountd и nfsd при загрузке. Очень вероятно, что эти скрипты уже существуют
на вашей машине, и вам будет нужно только раскомментировать нужный раздел
или активизировать скрипт на нужном уровне запуска.
<P>
<P>Справочные страницы, которые вы должны уже изучить: portmap, mountd,
nfsd и exports.
<P>
<P>Если вы сделали все как я сказал, то вы должны были установить все
необходимое для работы сервера NFS.
<P>
<HR>
<A HREF="NFS-HOWTO-4.html">Следующий</A>
<A HREF="NFS-HOWTO-2.html">Предыдущий</A>
<A HREF="NFS-HOWTO.html#toc3">Содержание</A>
</BODY>
</HTML>
