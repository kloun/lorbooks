<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Печать в Linux HOWTO (Linux Printing HOWTO) : Устройства печати в ядре Linux</TITLE>
 <LINK HREF="Printing-HOWTO-4.html" REL=next>
 <LINK HREF="Printing-HOWTO-2.html" REL=previous>
 <LINK HREF="Printing-HOWTO.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="Printing-HOWTO-4.html">Следующий</A>
<A HREF="Printing-HOWTO-2.html">Предыдущий</A>
<A HREF="Printing-HOWTO.html#toc3">Содержание</A>
<HR>
<H2><A NAME="s3">3. Устройства печати в ядре Linux</A>      </H2>

<P>Существует два полностью отличающихся драйвера устройства для
параллельного порта; что вы используете, зависит от версии ядра
(которую вы можете узнать с помощью команды <CODE>uname
-a</CODE>). Драйвер изменен в Linux версии 2.1.33.
<P>
<P>Несколько деталей одинаковы для обоих типов драйвера. Скорее
всего, много людей обнаружат, что Linux не обнаруживает параллельного
порта, до тех пор пока они не запретят "Plug and Play" в их PC
BIOS. (это не является сюрпризом; отслеживание данных о PnP не-PCI
устройствах в Windows и где-нибудь еще могут быть чем-то вроде
бедствия). 
<P>
<H2><A NAME="ss3.1">3.1 Устройство lp  (ядра &lt;=2.1.32)</A>
        </H2>

<P>Ядро Linux (&lt;=2.1.32), предполагает, что вы вкомпилировали в
ядро или загрузили модуль устройства lp (вывод команды <CODE>cat
/proc/devices</CODE> должен включать устройство lp, если оно
загружено), обеспечивая одно или больше устройств:
<EM>/dev/lp0</EM>, <EM>/dev/lp1</EM>, и <EM>/dev/lp2</EM>.  Они не
присваиваются динамически, каждое соответствует специфическому
адресу ввода/вывода вашего оборудования. Это означает, что ваш
первый принтер может быть <EM>lp0</EM> или <EM>lp1</EM> в зависимости от
вашего оборудования. Просто попробуйте оба.
<P>
<P>Некоторые пользователи сообщили, что их двунаправленные lp порты
не определяются, если они использовали старые однонаправленные
кабеля. Проверьте, что вы используете нужный кабель.
<P>
<P>Некоторые люди не могут запустить драйвера plip и lp в одно и
тоже время на любом заданном порту (в любом случае под 2.0). Однако
вы можете загрузить тот или иной драйвер вручную или с помощью
kerneld для версий 2.x (и позже 1.3.x) в заданное время. При
правильной установке прерываний и подобных вещей, вы по идее можете
запустить plip на одном порту, а lp на другом. Некоторые люди
делали это редактированием исходного текста драйверов; я с
нетерпением ожидаю сообщение о том, что кто-то сделал это только с
помощью правильной командной строки.
<P>
<P>Существует маленькая утилита, названная <CODE>
<A HREF="http://www.picante.com/~gtaylor/pht/man/tunelp.8.html">tunelp</A></CODE>, предназначенная для того, чтобы вы, как
администратор, могли настроить для устройств lp Linux 2.0
используемые прерывания, скорость опроса и прочие опции.
<P>
<P>Если драйвер встроен в ядро, то ядро может воспринимать опцию
<CODE>lp=</CODE> для установки прерываний и адресов ввода/вывода:
<P>
<BLOCKQUOTE><CODE>
<PRE>
Когда драйвер lp встроен в ядро, вы можете использовать командную
строку LILO/LOADLIN для установки адресов портов и прерываний,
которые будет использовать драйвер.

Синтаксис:      lp=port0[,irq0[,port1[,irq1[,port2[,irq2]]]]]

Например:   lp=0x378,0   or   lp=0x278,5,0x378,7 **

Заметим, что если вы используете это свойство, вы должны указать
*все* порты, которые вы хотите учитывать, значений по умолчанию не
существует. Вы можете запретить встроенные драйвер с помощью опции
lp=0.
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Когда драйвер загружен как модуль, то возможно указать адреса
ввода/вывода и прерывания в командной строке программы insmod (или
в файле <EM>/etc/conf.modules</EM>, при использовании kerneld)
используя обычный синтаксис. Параметры следующие:
<CODE>io=port0,port1,port2</CODE> и <CODE>irq=irq0,irq1,irq2</CODE>.  Прочитайте
справочную страницу для команды <EM>
<A HREF="http://www.picante.com/~gtaylor/pht/man/insmod.1.html">insmod</A></EM> для более детальной информации об этом.
<P>
<P>**Для тех из вас, кто (подобно мне) никогда не может найти
номера стандартных портов когда это нужно, я привел два примера
выше. Номер другого порта (для <EM>lp0</EM>) равен 0x3bc.  У меня нет
никаких идей о том какое прерывание обычно используется. 
<P>
<P>Исходный код для драйвера параллельного порта Linux 2.0
находится в файле /usr/src/linux/drivers/char/lp.c.
<P>
<H2><A NAME="ss3.2">3.2 Устройство parport (ядра &gt;= 2.1.33)</A>
        </H2>

<P>Начиная с ядра 2.1.33 (и доступно как заплатка к ядру 2.0.30),
устройство lp является просто клиентом нового устройства
parport. Добавление устройства parport исправляет некоторое
количество проблем, которые были из-за старого устройства lp - оно
может разделять порты с другими устройствами, оно динамически
присваивает доступные параллельные порты номерам устройств, вместо
использования фиксированных соотношений между адресами ввода/вывода 
и номером порта, и так далее.
<P>
<P>Введение устройства parport позволило создать целую группу новых 
драйверов параллельного порта для устройств подобных дискам Zip,
Backpack CD-ROM и дискам, и так далее. Некоторые из них доступны в
ядрах версии 2.0; посмотрите в интернете.
<P>
<P>Главное отличие, которое вы отметите, в том, что ядра,
основанные на parport динамически присваивают устройства lp для
параллельных портов. Так что, то что было lp1 в Linux 2.0 может
оказаться lp0 в Linux 2.2. Убедитесь, что вы проверили это если вы
делаете обновление с ядра, работающего с драйвером lp на ядро с
драйвером parport.
<P>
<P>Кажется, что основные проблемы с этим устройством проистекают от 
неправильной его настройки:
<P>
<DL>
<DT><B>Дистрибутив</B><DD><P>Некоторые дистрибутивы Linux  продаются с
неправильно настроенными /etc/modules.conf (или
/etc/conf.modules), так что драйвер не загружается когда вам это
нужно. При использовании недавних версий modutils, правильные
строки в modules.conf должны выглядеть так:
<P>
<PRE>
  alias /dev/printers lp             # only for devfs?
  alias /dev/lp*      lp             # only for devfs?
  alias parport_lowlevel parport_pc  # missing in Red Hat 6.0-6.1
 
</PRE>
<P>
<DT><B>BIOS</B><DD><P>Много BIOS для персональных компьютеров представляют
параллельный порт как устройство Plug-and-Play. Это только
добавляет ненужную сложность к великолепному простому устройству, 
которое почти всегда присутствует; отключите PnP настройки для
вашего параллельного порта (который называется "LPT1" во многих
BIOSах) в том случае если ваш параллельный порт не определяется
драйвером Linux. Правильные настройки часто называются "legacy",
"ISA", или "0x378", но скорее всего не "disabled".
<P>
</DL>
<P>
<P>Вы также можете прочитать файл 
<A HREF="http://www.cyberelk.demon.co.uk/parport/parport.txt">Documentation/parport.txt</A> в исходных текстах ядра, или
посмотреть на 
<A HREF="http://www.cyberelk.demon.co.uk/parport.html">сервере  parport</A>.
<P>
<P>
<H2><A NAME="ss3.3">3.3 Последовательные устройства</A>
        </H2>

<P>Последовательные устройства под Linux называются подобно
<EM>/dev/ttyS1</EM>. Утилита <CODE>
<A HREF="http://www.picante.com/~gtaylor/pht/man/stty.1.html">stty</A></CODE> позволит вам интерактивно просмотреть или
установить параметры последовательного порта <CODE>
<A HREF="http://www.picante.com/~gtaylor/pht/man/setserial.8.html">setserial</A></CODE>
позволит вам контролировать некоторые расширенные атрибуты и
настроить IRQ и адреса ввода/вывода для нестандартных
портов. Дополнительные обсуждения последовательных портов в Linux
вы можете найти в 
<A HREF="http://metalab.unc.edu/mdw/HOWTO/Serial-HOWTO.html">Serial-HOWTO</A>.
<P>
<P>При использовании медленных последовательных принтеров с
контролем потока, вы можете обнаружить, что некоторые из ваших
заданий оборваны. Это может быть из-за последовательного порта, чье 
действие по умолчанию&nbsp;-- удалить любые не переданные символы
из своего буфера через 30 секунд после того как устройство
закрыто. Буфер может содержать до 4096 символов, и если ваш принтер 
использует контроль потока и медлен настолько, что не может принять 
все данные из буфера за 30 секунд после того как программа печати
закрыла последовательный порт, то конец содержимого буфера будет
потерян. Если команда <CODE>cat file &gt; /dev/ttyS2</CODE> делает
полный печатный вывод для коротких файлов, но обрезает длинные
файлы, то у вас может быть такая проблема. 
<P>
<P>30-ти секундный интервал может быть выровнен с помощью опции
"closing_wait" командной строки программы setserial (версии 2.12 и
поздних). Последовательные порты машины обычно инициализируются
вызовом setserial в загрузочном файле rc.serial. Вызов для
последовательного порта принтера может быть модифицирован для
установки параметра closing_wait вместе с установкой других
параметров.
<P>
<P>
<HR>
<A HREF="Printing-HOWTO-4.html">Следующий</A>
<A HREF="Printing-HOWTO-2.html">Предыдущий</A>
<A HREF="Printing-HOWTO.html#toc3">Содержание</A>
</BODY>
</HTML>
