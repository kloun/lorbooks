<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>MS Outlook to Unix Mailbox Conversion mini HOWTO: Конвертирование с использованием IMAP</TITLE>
 <LINK HREF="Outlook-to-Unix-Mailbox-2.html" REL=previous>
 <LINK HREF="Outlook-to-Unix-Mailbox.html#toc3" REL=contents>
</HEAD>
<BODY>
Next
<A HREF="Outlook-to-Unix-Mailbox-2.html">Previous</A>
<A HREF="Outlook-to-Unix-Mailbox.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Конвертирование с использованием IMAP</A></H2>

<H2><A NAME="ss3.1">3.1 Подготовка</A>
</H2>

<P>
<P>Прежде всего, убедитесь в том, что Вы хотите действовать этим способом. В частности,
раздел 2 объясняет способы использования Netscape Mail под Windows, чтобы
осуществить это конвертирование. Это легче, по сравнению с использованием данного способа.
<P>Если Вы действительно решили воспользоваться данным способом, необходимо убедиться,
что Ваша копия Outlook может общаться с IMAP-серверами. Когда автор начинал писать
данный HOWTO, он предполагал, что Outlook - везде Outlook. Однако нет. Если Вы
используете Outlook в режиме Corporate/Workgroups (который общается с Exchange)
вместо режима Internet (который общается с POP/IMAP-серверами), Вам следует
поменять режим.
<P>Выполняя проверку происходящего процесса, загляните в Outlook-меню
"Tools"/"Сервис" и посмотрите наличие в нем пункта "Accounts"/"Учетные записи".
Если таковой существует, всё в порядке. После этого можно перейти к разделу 3.2. 
В противном случае, наберитесь терпения и читайте дальше.
<P>Смена режима - дело нетривиальное, но отзывчивый читатель (Matt Huyck)
сослался на следующую инструкцию, которая выглядит достаточно необычно (автор не
выполнял этого):
<P>Выберите "Options..."/"Параметры..." из меню "Tools"/"Сервис", а 
затем перейдите к вкладке "Mail Services"/"Доставка почты" в появившемся 
в результате диалоговом окне "Options"/"Параметры".
В нижней части этой вкладки находится кнопка с надписью "Reconfigure Mail
Support..."/"Изменить конфигурацию почтовых служб...".
Задержите дыхание и нажмите на неё. Появится новое окно с
надписью "Outlook 2000 Startup"/"Начальная настройка Outlook 2000"
в титульной строке и с заголовком "E-mail Service Options"/"Режим работы с почтой". 
В нем находится пара необходимых кнопок-переключателей:
"Internet Only"/"Только Интернет" и "Corporate or Workgroup"/"Корпоративная 
или для рабочих групп". Выберите "Internet Only"/"Только Интернет".
и нажмите "Next >"/"Далее >". После этого появится достаточно длинное сообщение,
которое необходимо внимательно прочесть, так как Вы планируете
сделать значительное (но обратимое) изменение конфигурации клиента
Exchange. Если Вы ещё не потеряли сознание, можете прекратить задержку
дыхания. Несмотря на отсутствие явного упоминания об этом, следует убедиться в наличии у
Вас копии установочного CD Microsoft Office, прежде чем нажать
"Yes"/"Да". Нажмите "Yes"/"Да" и позвольте Outlook выполнить свои 
действия в течение нескольких секунд, пока он совсем не закроется. Повторно запустите 
Outlook. После этого Вам может быть предложeно вставить установочный
CD. По завершении процесса переконфигурирования можно перейти к п. 3.2.
данного HOWTO.
<P>Для возврата в Вашу первоначальную конфигурацию следуйте тем же самым
указаниям и, безусловно, нажмите *другую* кнопку-переключатель.
<P>Существует ещё одна особенность, если Вы использовали Exchange. Согласно
указанному в п. 3.4., "оригинальная строка 'From '" не сохраняется.
Однако пользователям Exchange не совсем соответствует замечание
"К счастью, Вам, на самом деле, не требуется эта информация". Недостающий
заголовок "From" - единственный, в котором содержится идентификация
отправителя в сообщениях, посылаемых по внутреннему Exchange-серверу,
т.е. в сообщениях, которые никогда не проходят через гейт в Интернет.
Автор предварительно сохранил свои заголовки "From", скопировав
почтовые папки в текстовой файл с помощью команды
"Import and Export..."/"Импорт и экспорт..." в меню "File"/"Файл".
Он планирует создать один Perl-/Grep-код, который вставит
указанные заголовки "From" в его линуксовые mbox-файлы. Если автор достигнет, 
чтобы это работало, он обязательно сообщит об этом читателям.
<P>
<H2><A NAME="ss3.2">3.2 3.2 Установите IMAP-сервер (временно!) на свою Linux-машину</A>
</H2>

<P>Утилиты установки варьируются от дистрибутива к дистрибутиву, поэтому
в качестве примера он будет использовать RedHat 7.0. Прежде всего, следует 
установить необходимый пакет, который обычно называется "imap".
<BLOCKQUOTE><CODE>
<PRE>
 cd /home/redhat-7.0-cd/RedHat/RPMS
 rpm -i imap*
</PRE>
</CODE></BLOCKQUOTE>
<P>В связи с тем, что автор установил "workstation", ему также было необходимо
установить пакет xinetd; rpm выдал сообщение об ошибке, которое
попросило автора выполнить это. Как и ожидалось, он находился на втором CD RedHat 7.0.
Пользователи Debian, использующие "apt-get", не должны беспокоиться об этом.
<P>
<P>Далее, необходимо активизировать imap-сервер. Обычно, это задаётся строкой в
файле <CODE>/etc/inetd.conf</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
 #imap    stream  tcp     nowait  root    /usr/sbin/tcpd        /usr/sbin/imapd
</PRE>
</CODE></BLOCKQUOTE>
<P>Вышеприведённая строка закомментирована; удалите стоящий впереди знак # . В
системах Red Hat 7.0 и более поздних с xinetd вместо этого отредактируйте
<CODE>/etc/xinetd.d/imap</CODE> и измените "disable=yes" на "disable=no".
<P>
<P>Затем перезапустите inetd или xinetd, выполнив
<BLOCKQUOTE><CODE>
<PRE>
 /etc/rc.d/init.d/inetd restart
</PRE>
</CODE></BLOCKQUOTE>
<P>или
<BLOCKQUOTE><CODE>
<PRE>
 /etc/rc.d/init.d/xinetd restart
</PRE>
</CODE></BLOCKQUOTE>
.
<P>Если ничего не получится, перезагрузитесь.
<P>
<P>Безусловно, Вам не следует оставлять IMAP-сервер включённым на протяжении длительного времени.
Этот сервер работает из-под root. В прошлом, он содержал ошибки
безопасности. По этой причине, не следует оставлять его активным до тех пор,
пока не появится необходимость использовать его постоянно. Мы дезактивируем этот
сервер в п. 4.
<P>
<P>Чтобы подключить Outlook к этому IMAP-серверу, необходимо знать имя
или IP-адрес Linux-машины.
<P>
<H2><A NAME="ss3.3">3.3 Подключение Вашего клиента Outlook к серверу</A>
</H2>

<P>Чтобы скопировать всю нашу почту на сервер, следует сообщить нашему
клиенту Outlook об этом новом сервере. Выберите "Accounts..."/"Учетные 
записи..." в меню "Tools"/"Сервис", а затем добавьте ("Add"/"Добавить") 
новую учётную запись "Mail..."/"Почта...". Наиболее важными моментами являются
следующие: чтобы сервер использовал IMAP для скачивания на него почты; 
чтобы сервер входящих сообщений являлся именем или IP-адресом Вашей Linux-машины
с шага 1, а имя пользователя и пароль должны являться Вашими именем и паролем 
на Linux-машине. (Как обычно, неудачной идеей считается использование root'овой 
учётной записи для этой цели.)
<P>
<P>Нажав "Finish"/"Готово", сделайте данную учётную запись используемой
по умолчанию, выделив её и нажав "Set as Default"/"Использовать по 
умолчанию". Outlook должен соединиться с Вашим IMAP-сервером, а имя
Вашего IMAP-сервера должно появиться в конце Вашего списка папок. Кликните 
по нему; должна появиться папк Inbox. (Необходимо помнить, что если на Вашей 
Linux-машине не существует папки /var/mail/&lt;ваше пользовательское имя&gt;,
перетащить хотя бы одно сообщение в свой INBOX будет невозможно. Кроме того, Вас будет 
сбивать с толку сообщение об ошибке. Хотя это не то, что мы планируем выполнить.)
<P>
<H2><A NAME="ss3.4">3.4 Скопируйте всю Вашу почту</A>
</H2>

<P>С этого момента можно перетаскивать (drag and drop) целые
почтовые папки из Outlook на имя Вашего IMAP-сервера. Это действие
будет копировать почту, включая все вложения, на Linux-машину. К
сожалению, в результате этого папки также будут удаляться из Outlook.
Чтобы скопировать данные, не удаляя их, кликните на имя папки правой
кнопкой мыши и выберите опцию "Copy"/"Копировать". Для указания, куда
копировать, кликните на Ваш Linux-сервер внизу списка.
<P>
<P>Однако всё не так просто. Outlook поддерживает папки,
содержащие папки, в которых также имеются сообщения. Линуксовый IMAP-сервер
этого не поддерживает, папкой в нём является либо обычный файл, содержащий
сообщения, либо каталог, содержащий подкаталоги и файлы. Таким образом, если
у Вас в Outlook имеются папки, содержащие как сообщения, так и подпапки,
будет невозможно скопировать на линуксовый IMAP-сервер всё дерево в целом.
Другое несоответствие линуксового IMAP-сервера заключается в том, что необходимо
заранее сообщить ему, будет ли новая папка содержать подпапки или сообщения.
Это выполняется добавлением слэша (<CODE>/</CODE>) в конец имени папки во время ее создания.
Этот слэш исчезнет после того, как папка будет создана.
<P>
<P>Таким образом, чтобы скопировать дерево папок на линуксовый IMAP-сервер,
прежде всего, потребуется создать на линуксовом IMAP-сервере точную копию структуры
Ваших существующих папок. В процессе выполнения этих действий следует обращать внимание,
какая из существующих папок содержит как подпапки, так и сообщения.
Необходимо будет переместить эти сообщения куда-либо ещё. После создания
всего дерева можно копировать или перемещать группы папок на линуксовый
IMAP-сервер.
<P>
<P>Последнее несоответствие, которое следует отметить, заключается в следующем:
в линуксовом IMAP-сервере не допускаются папки со слэшами (/) в
своих именах. Необходимо будет переименовать такие папки, прежде чем
копировать или перемещать их.
<P>
<P>На Linux-машине папки появляются в виде файлов и каталогов в Вашем домашнем
каталоге. Форматом таких файлов является обычный почтовый формат Unix, который
большая часть почтовых средств Unix/Linux либо непосредственно использует, либо
может конвертировать в/из. Файлы с вложениями должны иметь вложения MIME;
там также имеется одно дополнительное сообщение на папку, которое представляет
собой один (бесполезный) заголовок.
<P>
<P>(Часть данных, которая не сохраняется: оригинальная строка
"From", содержащая адрес отправителя электронной почты. К счастью, Вам 
не требуется данная информация.)
<P>
<H2><A NAME="ss3.5">3.5 Удалите IMAP с Вашей Linux-машины</A>
</H2>

<P>Как только Вы переместите всю свою почту, удалите IMAP-сервер с Вашей
Linux-машины из соображений безопасности, отмеченных ранее. Это включает
те же 2 шага, которые были осуществлены Вами для установки сервера.
<OL>
<LI> Удалите RPM:
<BLOCKQUOTE><CODE>
<PRE>
  rpm -e imap
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI> Удалите строку в <CODE>/etc/inetd.conf</CODE> или в <CODE>/etc/xinetd.d/imap</CODE></LI>
<LI> Перезапустите inetd или xinetd; либо перезагрузитесь.</LI>
</OL>
<P>
<P>Вас можно поздравить! Вы сделали ещё один шаг к свободному от Microsoft образу жизни.
<P>
<HR>
Next
<A HREF="Outlook-to-Unix-Mailbox-2.html">Previous</A>
<A HREF="Outlook-to-Unix-Mailbox.html#toc3">Contents</A>
</BODY>
</HTML>
