<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>LDAP Linux HOWTO: Настройка LDAP сервера</TITLE>
 <LINK HREF="LDAP-HOWTO-4.html" REL=next>
 <LINK HREF="LDAP-HOWTO-2.html" REL=previous>
 <LINK HREF="LDAP-HOWTO.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="LDAP-HOWTO-4.html">Next</A>
<A HREF="LDAP-HOWTO-2.html">Previous</A>
<A HREF="LDAP-HOWTO.html#toc3">Contents</A>
<HR>
<H2><A NAME="3"></A> <A NAME="s3">3. Настройка LDAP сервера</A></H2>

<P>Как только дистрибутив собран и инсталирован, Вы готовы настраивать его для использования на Вашем компьютере. Все настройки параметров времени выполнения серевера slapd производятся в файле slapd.conf, инсталированного в директории prefix, которую Вы указали при выполнении конфигурационного скрита, или по умолчанию в /usr/local/etc/openldap.
<P>В этой директории Вы также найдете следующие файлы <I>slapd.oc.conf</I> и <I>slapd.at.conf</I>, которые включаются в slapd.conf файл (см. параметр include в 
<A HREF="LDAP-HOWTO-3.html#3.2">разделе 3.2</A>) и которые содержат определения объектных классов и атрибутов для LDAP, соответственно. Далее последует описание общего формата конфигурационного файла, а за ним детальное описание каждого параметра в этом файле.
<P>
<H2><A NAME="ss3.1">3.1 Формат конфигурационного файла</A>
</H2>

<P>Файл slapd.conf содержит серию глобальных параметров, которые применяются к серверу slapd вцелом (включая все типы баз дынных), за которой следуют (а могут и вообще отсутствовать) определения специфичные для конкретной базы данных.
<P>Глобальные параметры могут быть переопределены в специфичной секции (для параметров, которые встречаются в файле slapd.conf несколько раз, последнее из опреледений имеет силу действия). Пустые и закомментированные - начинающиеся с символа ``#'',- строки игнорируются. Если строка начинается с пробела, она рассматривается как продолжение предыдущей строки. Общий формат файла slapd.conf следующий:
<BLOCKQUOTE><CODE>
<PRE>
     # comment - these options apply to every database 
     &lt;global config options&gt; 
     # first database definition &amp; config options 
     database &lt;backend 1 type&gt; 
     &lt;config options specific to backend 1&gt; 
     # second database definition &amp; config options 
     database &lt;backend 2 type&gt; 
     &lt;config options specific to backend 2&gt; 
     # subsequent database definitions &amp; config options 
     ... 
</PRE>
</CODE></BLOCKQUOTE>
<P>Аргументы конфигурационной строки разделяются пробелами. Если аргумент содержит пробел, он должен быть заключен в кавычки "как здесь". Если аргумент содержит кавычки или обратную косую черту `\', этим символам должен предшествовать символ обратной косой черты `\' (например, `\\d').
<P>Дистрибутив содержит пример конфигурационного файла, который можно использовать как рабочий. Также предоставляется файл slapd.at.conf, который содержит много определений наиболее часто используемых атрибутов, и файл slapd.oc.conf с определениями часто используемых объектных классов.
<P>
<H2><A NAME="3.2"></A> <A NAME="ss3.2">3.2 Глобальные Параметры</A>
</H2>

<P>Параметры описываемые в этом разделе применяются ко всем базам данных, если не будут где-то специально переопределены в секции определений конкретной базы. Аргументы параметра, которые должны быть заполнены реальными значениями, показаны в скобках &lt;&gt;.
<P>
<BLOCKQUOTE><CODE>
<PRE>
access to &lt;what&gt; [ by &lt;who&gt; &lt;accesslevel&gt; ]+ 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр предоставляет доступ (определенный уровнем &lt;accesslevel&gt;) для оперирования записями и/или атрибутами (определено в &lt;what&gt;) для одного или более клиентов (определено в &lt;who&gt;). Более детальное описание смотри в разделе "Примеры Управления Доступом". 
<P>
<BLOCKQUOTE><CODE>
<PRE>
attribute &lt;name&gt; [&lt;name2&gt;] { bin | ces | cis | tel | dn } 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр ассоциирует синтиксис с именем атрибута. По умолчанию атрибут имеет синтаксис cis. Атрибут может иметь необязательное альтернативное имя. Существуют следующие возможные синтаксисы и их описание:
<P>bin : двоичные данные 
ces : чувствительная к регистру строка (регистр учитывается при сравнении строк) 
cis : нечувствительная к регистру строка (регистр не учитывается при сравнении строк) 
tel : строка телефонного номера (как cis, плюс пробелы и тире `-' игнорируются при сравнении) 
dn  : выделенное имя 
<P>
<BLOCKQUOTE><CODE>
<PRE>
defaultaccess { none | compare | search | read | write } 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет доступ по умолчанию, который предоставляется всем клиентам, не удовлетворяющим ни одному другому правилу доступа (смотрите ниже "Примеры Управления Доступом"). Имейте в виду, что более высокий уровень доступа включает все более ограниченные уровни доступа (например, доступ на запись, разрешает чтение, поиск и сравнение.
<P>По умолчанию:
defaultaccess read
<P>
<BLOCKQUOTE><CODE>
<PRE>
include &lt;filename&gt;
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет, что slapd должен прочитать дополнительную информацию из обозначенного файла, до того как продолжит вычитывать текущий файл. Включаемый файл должен иметь формат конфигурационного файла slapd. Вы можете использовать этот параметр для включения определений объектный классов и атрибутов Вашей базы данных. Дистрибутив LDAP поставляется с файлами slapd.oc.conf и slapd.at.conf.
Примечание: Будьте осторожны при использовании этого параметра, поскольку ни ограничений на количество включений, ни проверок на циклическое включение не существует.
<P>
<BLOCKQUOTE><CODE>
<PRE>
loglevel &lt;integer&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет уровень журнального протоколирования отладочной информации и оперативной статистики (на данный момент ведется протоколирование в syslogd(8)). Чтобы это работало, Вы должны собрать slapd с включенным флагом DLDAP_DEBUG (по умолчанию работают только два уровня протоколирования). Уровни протоколирования кумулятивны (т.е. последуюющие включают предыдущие). Чтобы узнать, какая информация соответствует определенному уровню, запустите slapd с ключом ?, или изучите нижеприведенную таблицу. Допустимые значения уровня &lt;integer&gt; следующие:
<BLOCKQUOTE><CODE>
<PRE>
1 трассировка вызова функций 
2 обработка отладочных пакетов 
4 детальная отладочная трассировка 
8 управление соединениями 
16 протоколирование входящих и исходящих пакетов 
32 обработка фильтра поиска 
64 обработка конфигурационного файла 
128 обработка параметров доступа 
256 протокол статистики соединения/обработка/результаты 
512 протокол статистики отсылаемых записей
1024 протокол взаимодействия с shell 
2048 протокол отладочной информации парсера различных елементов 
</PRE>
</CODE></BLOCKQUOTE>
<P>Например: 
loglevel 255
<P>Это приведет к протоколированию огромного количества отладочной информации.
<P>По умолчанию:
loglevel 256 
<P>
<BLOCKQUOTE><CODE>
<PRE>
objectclass &lt;name&gt; 
[ requires &lt;attrs&gt; ] 
[ allows &lt;attrs&gt; ] 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет схему правил для данного объектного класса. Используется совместно с параметром schemacheck.
<P>
<BLOCKQUOTE><CODE>
<PRE>
referral &lt;url&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет ссылку для выдачи клиенту, если slapd не может найти локальную базу для обработки запроса.
<P>Например:
referral ldap://ldap.itd.umich.edu
<P>Здесь нелокальные запросы будут передаваться на LDAP сервер Мичиганского Университа. Умные клиенты могут повторить запрос на этот сервер, но имейте в виду, что большинство таких клиентов могут обработать только простые LDAP URLы, содержащие только сервер и, иногда, выделенное имя. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
schemacheck { on | off } 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр включает и выключает проверку схемы. Если проверка схемы включена, то все добавляемые или изменяемые записи будут проверяться на соответствие правилам схемы, задаваемым их объектным классом(ами), как определено в соответствующем параметре(ах). Если проверка схемы выключена, то все это не проводится.
<P>По умолчанию:
schemacheck off 
<P>
<BLOCKQUOTE><CODE>
<PRE>
sizelimit &lt;integer&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет максимальное количество статей возвращаемых после операции поиска.
<P>По умолчанию:
sizelimit 500
<P>
<BLOCKQUOTE><CODE>
<PRE>
srvtab &lt;filename&gt;
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет файл srvtab, в котором slapd может найти ключи kerberos, необходимые при аутентификации клиентов. Этот параметр имеет значение, только когда для целей аутентифакации используется kerberos, что должно быть специально определено перед компиляцией сервера, включением соответствующий флагов в файле Make-common.
<P>По умолчанию:
srvtab /etc/srvtab 
<P>
<BLOCKQUOTE><CODE>
<PRE>
timelimit &lt;integer&gt;
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет максимальное количество секунд (реального времени), которые slapd потратит отвечая на запрос поиска. Если запрос не закончится за это время, буде возвращен результат, сообщающий о превышении временного лимита.
<P>По умолчанию:
timelimit 3600
<P>
<H2><A NAME="ss3.3">3.3 Общие Параметры Баз Данных</A>
</H2>

<P>Параметры из этой секции действуют только на те базы, в которых они определены. Они поддерживаются всеми типами баз.
<P>
<BLOCKQUOTE><CODE>
<PRE>
database &lt;databasetype&gt;
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр обозначает начало определения нового экземпляра базы данных. Аргумент &lt;databasetype&gt; должен быть одним из ldbm, shell, или passwd, в зависимости от того, какая из них будет обслуживать базу сервера.
<P>Например:
database ldbm 
<P>обозначает начало определения нового экземпляра базы данных под управлением LDBM.
<P>
<BLOCKQUOTE><CODE>
<PRE>
lastmod { on | off } 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет поддерживает ли автоматически slapd заполнение в записи атрибутов modifiersName, modifyTimestamp, creatorsName, и createTimestamp.
<P>По умолчанию:
lastmod off 
<P>
<BLOCKQUOTE><CODE>
<PRE>
readonly { on | off } 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр переводит базу данных в режим "только чтение". Любая попытка изменить базу данных вернет ошибку "unwilling to perform".
<P>По умолчанию:
readonly off
<P>
<BLOCKQUOTE><CODE>
<PRE>
replica host=&lt;hostname&gt;[:&lt;port&gt;] 
"binddn=&lt;DN&gt;" 
bindmethod={ simple | kerberos } 
[credentials=&lt;password&gt;] 
[srvtab=&lt;filename&gt;] 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет дублирующих сервер для этой базы данных. Аргумент host= определяет сервер и, опционально, порт, по которому может быть найден подчиненный экземпляр slapd. В качестве  &lt;hostname&gt; можно использовать как доменный так и IP адрес. Если &lt;port&gt; не указан, используется стандартный номер порта для LDAP (389). Аргумент binddn задает DN в качестве привязки для обновления подчиненных slapd. Это должен быть DN с правами доступа чтение/запись для базы данных подчиненного slapd, обычно задается как "rootdn" в конфигурационном файле подчиненного slapd. Он также должен соответствовать параметру updatedn в конфигурационном файле подчиненного slapd. Поскольку DN обычно включает пробелы, строка "binddn=&lt;DN&gt;" должна быть заключена в кавычки. Аргумент bindmethod может быть либо simple либо kerberos, в зависимости от того, какой тип аутентификации (простой по паролю или керберос) используется при соединении с подчиненным slapd. Простая аутентификация требует задания правильного пароля, керберос - правильного srvtab файла. Аргумент credentials=, который используется только при простой аутентификации, задает пароль для binddn на подчиненном slapd. Аргумент srvtab=, который используется только при керберос аутентификации, определяет файл, содержащий ключ керберос для подчиненного slapd. Если этот аргумент опущен, используется /etc/srvtab. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
replogfile &lt;filename&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет имя дублирующего журнального файла, в который slapd протоколирует изменения. Дублирующий журнал обычно записывается slapd и читается slurpd. Как правило, этот параметр используется только когда для дублирования базы данных используется slurpd. Однако, Вы также можете использовать его для генерации журнала транзакций. если slurpd не запущен. В этом случае Вам необходимо периодически урезать этот файл, в противном случае он будет расти неограниченно.
<P>
<BLOCKQUOTE><CODE>
<PRE>
rootdn &lt;dn&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет точку входа, которая не подпадает под контроль доступа или административные ограничения для управления этот базой данных.
<P>Например:
rootdn "cn=Manager, o=U of M, c=US"
<P>
<BLOCKQUOTE><CODE>
<PRE>
rootkrbname &lt;kerberosname&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет керберос имя для указанного выше DN, и действует всегда, независимо от того имеет ли указанный DN атрибут krbName или существует вообще. Этот параметр полезен при создании базы данных, а также когда для дублирования используется slurpd. 
<P>Например:
rootkrbname admin@umich.edu
<P>
<BLOCKQUOTE><CODE>
<PRE>
rootpw &lt;password&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет пароль для указанного выше DN, и действует всегда, независимо от того имеет ли указанный DN пароль или существует вообще. Этот параметр полезен при создании базы данных, а также когда для дублирования используется slurpd. Не задавайте пароль открытым текстом для этого параметра. Как минимум используйте crypto для шифрования (или запись с файла /etc/passwd). slapd поддерживает и другие типы шифрования. 
<P>Пример:
<BLOCKQUOTE><CODE>
<PRE>
rootpw secret 
rootpw {crypto}encrypted_password_here 
</PRE>
</CODE></BLOCKQUOTE>
<P>
<BLOCKQUOTE><CODE>
<PRE>
suffix &lt;dn suffix&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет DN суффикс запросов, которые будут пересылаться к этой базе данных. Может быть задано несколько суффиксов (в отдельных строках), но как минимум один необходим для каждой определяемой базы данных.
<P>Пример:
suffix "o=University of Michigan, c=US"
<P>т.е. запросы с DN, оканчивающимися на "o=University of Michigan, c=US" будум переданы данной базе данных.
Примечание: когда ищется база для обработки запроса, slapd просматривает определения суффиксов в том порядке, как они следуют в файле. Таким образом, если суффикс одной базы является префиксом другой, то первая должна быть определена в конфигурационном файле позже. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
updatedn &lt;dn&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр применим только для подчиненных slapd. Он определяет DN, по которому разрешено вносить изменения в дубликат (обычно это DN, с которым свызывается slurpd, когда вносятся изменения в дубликат).
<P>
<H2><A NAME="ss3.4">3.4 Параметры специфичные для LDBM</A>
</H2>

<P>Параметры в этой секции применяются только для LDBM баз данных. Поэтому они должны размещаться после строки "database ldbm" и до любой другой строки с параметром "database".
<P>
<BLOCKQUOTE><CODE>
<PRE>
cachesize &lt;integer&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет размер кеша (измеряемого количеством записей) в памяти, поддерживаемого данным экземпляром LDBM базы данных.
<P>По умолчанию:
cachesize 1000
<P>т.е. тысяча записей.
<P>
<BLOCKQUOTE><CODE>
<PRE>
dbcachesize &lt;integer&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет размер кеша в байтах, который ассоциируется с каждым открытым файлом индексов. Если это не поддерживается нижележащей базой, то параметр игнорируется безо всяких комментариев. Увеличениее значения этого парамтра приводит к использованию большего количества памяти, однако может значительно повысить производительность, особенно при изменениях в базе или во время построения индекса.
<P>По умолчанию:
dbcachesize 100000
<P>
<BLOCKQUOTE><CODE>
<PRE>
directory &lt;directory&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет директорию, в которой находятся файлы LDBM, содержащие базу данных и соответствующие индексы.
<P>По умолчанию:
directory /usr/tmp
<P>
<BLOCKQUOTE><CODE>
<PRE>
index {&lt;attrlist&gt; | default} [pres,eq,approx,sub,none] 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет поддерживаемые индексы для заданных атрибутов. Если задан только аргумент &lt;attrlist&gt;, поддерживаются все возможные индексы.
<P>Например:
<BLOCKQUOTE><CODE>
<PRE>
index cn 
index sn,uid eq,sub,approx 
index default none 
</PRE>
</CODE></BLOCKQUOTE>

Этот пример задает поддержку всех индексов для атрибута cn; индексы equality/совпадения/, substring/вхождения/, и approximate/подобия/ для атрибутов sn и uid; и отсутствие индексации для всех остальных атрибутов. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
mode &lt;integer&gt; 
</PRE>
</CODE></BLOCKQUOTE>

Этот параметр определяет режим доступа, который по умолчанию присваивается ново-созданному файлу индекса.
<P>По умолчанию:
mode 0600
<P>т.е. чтение/запись для владельца
<P>
<H2><A NAME="bla"></A> <A NAME="ss3.5">3.5 Примеры Управления Доступом</A>
</H2>

<P>Средства управления доступом, представленные в 
<A HREF="LDAP-HOWTO-3.html#3.2">разделе 3.2</A> довольно мощные. Этот раздел описывает несколько примеров их использования. Для начала, довольно простой пример:
<BLOCKQUOTE><CODE>
<PRE>
access to * by * read 
</PRE>
</CODE></BLOCKQUOTE>
<P>Эта директива предоставляет всем право чтения. Если она одна, то это то же, что и задание параметра defaultaccess:
<BLOCKQUOTE><CODE>
<PRE>
defaultaccess read 
</PRE>
</CODE></BLOCKQUOTE>
<P>Следующий пример показывает использование регулярных выражений для выбора записей по DN в двух директивах доступа, причем порядок записи имеет значение.
<BLOCKQUOTE><CODE>
<PRE>
access to dn=".*, o=U of M, c=US" 
by * search 
access to dn=".*, c=US" 
by * read 
</PRE>
</CODE></BLOCKQUOTE>
<P>Разрешается чтение записей в поддереве c=US, за исключением записей в поддереве "o=University of Michigan, c=US", для которых разрешен поиск. Если бы порядок этих директив был обратным, то специфика U-M директивы никогда бы не проявилась, поскольку все U-M статьи также и c=US статьи (т.е. подобные фильтры должны следовать в порядке от более специфичного к более общему, прим. перев.).
<P>Следующий пример опять показывает важность порядка записи, как обоих директив доступа так и операторов "by". Он также показывает использование аргумента выбора атрибута /attr/, для предоставления доступа к определенному атрибуту, и задание различных клиентов &lt;who&gt;.
<BLOCKQUOTE><CODE>
<PRE>
access to dn=".*, o=U of M, c=US" attr=homePhone 
by self write 
by dn=".*, o=U of M, c=US" search 
by domain=.*\.umich\.edu read 
by * compare 
access to dn=".*, o=U of M, c=US" 
by self write 
by dn=".*, o=U of M, c=US" search 
by * none 
</PRE>
</CODE></BLOCKQUOTE>
<P>Этот пример применяется к записям в поддереве "o=U of M, c=US". Для всех аттрибутов, за исключением homePhone, сама запись имеет право модификации, другие U-M статьи могут использовать их для поиска, все остальные не имеют доступа. Атрибут homePhone доступен для модификации самой записью, для поиска - другими U-M записями, для чтения - клиентам с домена umich.edu, и для сравнения для всех остальных.
<P>Иногда полезно позволить специфичному DN добавлять себя или удалять с атрибута. Например, если бы Вы хотели создать группу, при этом разрешая пользователям только добавлять и удалять свои собственные DN в атрибут member, Вы бы использовали директиву доступа подобно следующей:
<BLOCKQUOTE><CODE>
<PRE>
access to attr=member,entry 
by dnattr=member selfwrite 
</PRE>
</CODE></BLOCKQUOTE>
<P>Аргумент dnattr &lt;who&gt; указывает на то, что доступ применяется к записям, обозначенным в атрибуте member. Аргумент selfwrite говорит о том, что такие member(ы) могут добавлять или удалять только свои собственные DN в/из атрибута, но не другие значения. Добавление атрбута entry необходимо, поскольку доступ к какому-либо атрибуту записи невозможен, при отстутствии доступа к записи вцелом.
<P>Заметьте, что конструкция attr=member в операторе &lt;what&gt; является сокращенной формой оператора "dn=* attr=member" (т.е. выборка всех записей с аттрибутом member).
<P>
<HR>
<A HREF="LDAP-HOWTO-4.html">Next</A>
<A HREF="LDAP-HOWTO-2.html">Previous</A>
<A HREF="LDAP-HOWTO.html#toc3">Contents</A>
</BODY>
</HTML>
