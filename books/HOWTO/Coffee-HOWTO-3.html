<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>COFFEE-HOWTO: Программное обеспечение</TITLE>
 <LINK HREF="Coffee-HOWTO-4.html" REL=next>
 <LINK HREF="Coffee-HOWTO-2.html" REL=previous>
 <LINK HREF="Coffee-HOWTO.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="Coffee-HOWTO-4.html">Next</A>
<A HREF="Coffee-HOWTO-2.html">Previous</A>
<A HREF="Coffee-HOWTO.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Программное обеспечение</A></H2>

<P>
<H2><A NAME="ss3.1">3.1 Программное обеспечение</A>
</H2>

<P>Вы должны будете создать выполнимую программу, которая работает примерно так:
<UL>
<LI> Получает разрешение использовать адресное пространство ввода-вывода, вызывая 
ядро, командой ioperm: например ioperm (BASE, range ,1);
</LI>
<LI> Выводит наружу требуемую команду, устанавливая напряжение 0-5V на параллельном 
порту, например, outb (1, BASE);
</LI>
<LI> Ждет в течение достаточного времени, чтобы кофе приготовился. Было бы хорошо, 
в это время контролировать командную строку.
</LI>
<LI> Затем она выключит кофеварку: outb (0, BASE);
</LI>
<LI> Перед окончанием должна отдать обратно параллельный порт командой ioperm 
(BASE, range, 0);</LI>
</UL>

Изменяет BASE = 0x3bc для /dev/lp0, 0x378 для /dev/lp1 и 0x278 для /dev/lp2, 
range=8.
<P>Был бы хорошо, если вы установили эту программу setuid, чтобы каждый мог попить 
кофе!
<P>
<P>
<H2><A NAME="ss3.2">3.2 Драйвер устройства</A>
</H2>

<P>Прочитайте kernel hacker's guide, напишите драйвер устройства (я думаю, 
он мог бы быть даже в пространстве пользователя). Пожалуйста, скомпилируйте его 
как модуль, чтобы мы не нуждались в компиляции ядра при каждой модификации. 
Затем напишите:
<PRE>
echo cappuccino >/dev/coffee
</PRE>

И вы получите горячую чашку кофе в течение 1 минуты. Не забудьте дать правильные 
права доступа на /dev/coffee, в зависимости от того, хотите ли вы, чтобы только 
root делал кофе или нет.
<P>Преимущество этого метода в том, что он поддерживает обратную связь от 
кофеварки, используя сигнал ACK параллельного порта, чтобы интеллектуальные 
кофеварки могли бы вырабатывать прерывание.
<P>Это будет вашей домашней работой.
<P>
<P>
<H2><A NAME="ss3.3">3.3 Соединение с Интернетом</A>
</H2>

<P>Если вы сделали C программу (см. выше), то для включения/выключения кофеварки вы 
должны написать простой сценарий CGI.
<P>Вы должны написать какую-нибудь симпатичную веб-страницу, объясняя, как делать 
кофе, и поместить ее на веб-сервер apache ...
<P>
<HR>
<A HREF="Coffee-HOWTO-4.html">Next</A>
<A HREF="Coffee-HOWTO-2.html">Previous</A>
<A HREF="Coffee-HOWTO.html#toc3">Contents</A>
</BODY>
</HTML>
