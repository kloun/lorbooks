<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Font HOWTO: Делаем фонты доступными для X-сервера</TITLE>
 <LINK HREF="Font-HOWTO-5.html" REL=next>
 <LINK HREF="Font-HOWTO-3.html" REL=previous>
 <LINK HREF="Font-HOWTO.html#toc4" REL=contents>
</HEAD>
<BODY>
<A HREF="Font-HOWTO-5.html">Далее</A>
<A HREF="Font-HOWTO-3.html">Назад</A>
<A HREF="Font-HOWTO.html#toc4">Оглавление</A>
<HR>
<H2><A NAME="xfonts"></A> <A NAME="s4">4. Как сделать фонты доступными для X-сервера</A></H2>

<P>Имеется несколько способов добавить фонты в X. Во-первых, XFree86
имеет <EM>font path</EM>, который есть просто список нескольких каталогов 
или <EM>фонт-серверов</EM>, в которых осуществляется поиск фонтов. Фонт-сервер - 
это просто фоновый процесс, который делает фонты доступными для XFree86. 
Преимущество фонт-сервера в том, что он может посылать шрифты на 
удаленный дисплей.
<P>Недавно фонт-сервер <b>xfs</b> (the ``X font server'') был доработан 
с целью обеспечения поддержки шрифтов TrueType и обеспечения 
возможности запуска его как отдельной программы. Доработанные версии поставляются с 
дистрибутивами, основанными на Red Hat, и включены в XFree86 3.9.17 
(новейшая версия на момент написания настоящего документа; программа будет включена 
и в состав XFree86 4.0).
<b>xfs</b> есть в действительности отдельный фонт-сервер, который входит 
в состав  XFree86. Его исходный код является частью дерева исходников XFree86.
Однако с недавних пор в дистрибутивы включается версия программы, которая 
может работать в режиме отдельно запускаемой программы. 
Отдельный фонт-сервер для X с поддержкой шрифтов TrueType (поддержка 
TrueType осуществляется отдельным фонт-сервером, который называется 
<b>xfsft</b>) - это, вероятно, самое удачное из доступных на 
сегодняшний день решений по управлению фонтами. Оно имеет следующие 
преимущества:
<UL>
<LI>Обеспечивается поддержка различных типов фонтов, включая Type1, TrueType
и растровые шрифты.</LI>
<LI>Обеспечивается доступ к шрифтам с удаленных дисплеев.</LI>
<LI>Существенно упрощается редактирование пути к шрифтам - Вы можете 
теперь делать это из командной строки с помощью утилиты <b>chkfontpath</b>, 
в то время как раньше надо было редактировать конфигурационные файлы. Это 
не только облегчает жизнь пользователей, но и упрощает создание пакетов ПО, 
а также их установку.
</LI>
</UL>
<P>
<P>Разные дистрибутивы имеют, естественно, разные конфигурации. Можно выделить 
три группы: 
<UL>
<LI>Дистрибутивы с отдельно поставляемым сервером <b>xfs</b>, доработанным с 
целью поддержки фонтов формата TrueType. Эта группа включает Red Hat и такие 
основанные на RedHat дистрибутивы, как Mandrake, TurboLinux и Independence. 
Для этой группы самая разумная стратегия состоит в установке как фонтов TrueType, 
так и фонтов Type1, используя <b>xfs</b> </LI>
<LI>Дистрибутивы, с отдельно поставляемым пакетом <b>xfs</b>, но без поддержки 
TrueType (напомню, что XFree86 поддерживает фонты TrueType начиная с версии 3.9.17 ). 
К этой группе относится Debian. В таком случае рекомендуется использовать <b>xfs</b> 
для установки фонтов Type1, а фонты TrueType устанавливать через <b>xfstt</b>. 
Пользователи Debian могут просмотреть 
<A HREF="http://www.dimensional.com/~bgiles/debian-tt.html">TrueType Fonts in 
Debian mini-HOWTO</A> для получения информации об установке фонтов TrueType 
в Debian.</LI>
<LI>Если у Вас нет пакета <b>xfs</b>, то Вам необходимо установить фонты 
Type1 путем добавления путей к ним в перечень путей к фонтам в XFree86 и 
использования xset. Для установки фонтов TrueType используйте <b>xfstt</b>.</LI>
</UL>

<H2><A NAME="fontpath"></A> <A NAME="ss4.1">4.1 Перечень каталогов фонтов (The font path)</A>
</H2>

<P>XFree86 ищет файлы фонтов, просматривая каталоги, включенные в Перечень 
каталогов фонтов (<EM>font path</EM>) - список директорий (или серверов, но 
об этом мы поговорим чуть позже), содержащих файлы фонтов. Когда приложение 
запрашивает фонт, соответствующий файл ищется в этих каталогах, в указанной 
последовательности, пока нужный фонт не будет найден. Чтобы сделать фонты 
доступными, необходимо задать этот перечень (font path). Вы можете добавить 
каталог в font path с помощью команды 

<A NAME="xset"></A> 
<PRE>
        xset fp+ directory
</PRE>

После того, как Вы это сделали, необходимо заставить X-сервер перечитать перечень 
каталогов с фонтами командой 
<PRE>
        xset fp rehash
</PRE>

Чтобы эти команды выполнялись автоматически, поместите их в Ваш файл 
<b>.xinitrc</b> (или в <b>.Xclients</b> или в <b>.xsession</b> -- это зависит 
от того, как Вы запускаете X-ы. Можно сделать два из этих файлов ссылками на 
третий, чтобы избежать путаницы). Другой способ подключения каталога к перечню 
каталогов фонтов состоит в редактировании файла XF86Config. Например, чтобы 
добавить каталог <b>/usr/share/fonts/myfonts</b> к перечню, добавьте в 
<b>XF86Config</b> такую строку:

<PRE>
                ...
                Section "Files"
                ...
                
                FontPath /usr/share/fonts/myfonts
                ...
                EndSection
                ...
</PRE>

Преимущество второго способа (редактирования XF86Config) состоит в том, что 
в результате изменения будут действовать во всей системе, т.е. фонты станут 
доступны всем пользователям.

<H2><A NAME="ss4.2">4.2 Установка фонтов Type1</A></H2>

<H3>Команда Type1inst</H3>

<P>Простейший способ сделать фонты Type1 доступными для X - это воспользоваться 
утилитой Type1inst. Это скрипт на языке perl, который автоматически создает файлы 
fonts.dir и fonts.scale, которые необходимы для того, чтобы X-ы могли использовать 
фонты. Просто перейдите в каталог с фонтами и запустите type1inst.
<PRE>
        cd directory
        type1inst
</PRE>

<H3>Если у Вас имеется пакет <b>xfs</b></H3>

<P>Тогда Вам остается только добавить имя каталога с фонтами к fontpath. 
Если пакет <A HREF="Font-HOWTO-4.html#xfs">xfs</A> у Вас уже запущен, Вы можете сделать 
это путем редактирования конфигурационного файла <b>xfs</b>.
<EM>Пользователи Redhat могут использовать команду 
<A HREF="Font-HOWTO-4.html#chkfontpath">chkfontpath</A>, следующим образом </EM>
<b>chkfontpath --add directory</b>.
<P>Теперь Ваши фонты должны быть доступны для X. Только запустите 
команду
<PRE>
        xset fp rehash
</PRE>

и X-сервер сможет найти новые фонты.
<P>
<H3>Если у Вас нет пакета <b>xfs</b></H3>

<P>В этом случае Вам необходимо добавить имя каталога, содержащего 
файлы Ваших новых фонтов, к перечню каталогов фонтов (font path) 
одним из способов, описанных выше.

<H2><A NAME="ss4.3">4.3 Фонты True Type</A>
</H2>

<P>Добавление фонтов TrueType немного сложнее, потому что Вы должны 
иметь фонт-сервер, который может обслуживать фонты TrueType. Существуют 
два фонт-сервера, способные делать это - <b>xfstt</b> и <b>xfs</b>.
<P><b>xfstt</b> - это фонт-сервер для фонтов TrueType. Хотя он 
легко конфигурируется и вполне работоспособен, однако кажется, что 
<b>xfs</b> становится более популярным. Главное преимущество <b>xfs</b> 
по сравнению с <b>xfstt</b> состоит в том, что он поддерживает как фонты 
Type1, так и фонты TrueType.
<H3>xfstt</H3>

<P>Чтобы запустить xfstt, надо скачать его и установить. Если Ваш 
дистрибутив основан на rpm, то соответствующий rpm-пакет с xfstt 
можно найти на http://independence.seul.org/. После установки нужно 
сделать следующее:
<OL>
<LI>    
установить фонты в соответствующий каталог (прочитайте 
документацию, которая поставляется с пакетом).</LI>
<LI>cd в этот каталог и запустить <b>xfstt --sync</b>. По этой команде 
сервер просмотрит каталог и создаст файл <b>fonts.dir</b>. </LI>
<LI>Теперь добавьте строку <b>unix/:7100</b> к Вашему перечню 
каталогов фонтов (font path).</LI>
</OL>

Фонты TrueType должны теперь отображаться и быть доступными для 
приложений типа GIMP и Netscape. Вполне вероятно, что Вы захотите, 
чтобы фонты TrueType становились доступны каждый раз, когда Вы 
запускаете систему. Проверьте сначала, включены ли в пакет инициализационные 
файлы (если Вы используете RPM, Вы можете воспользоваться командой 
<b>rpm -ql xfstt |grep init</b> и поискать в выводе команды файлы, которые 
имеют примерно такие имена: <b>/etc/rc.d/init.d/xfstt</b>). Если 
инициализационных скриптов нет, просто допишите в <b>/etc/rc.local</b> 
две строки следующего вида:
<PRE>
        /usr/X11R6/bin/xfstt --sync
        /usr/X11R6/bin/xfstt &amp;
</PRE>

<H2><A NAME="xfs"></A> <A NAME="ss4.4">4.4 Сервер фонтов xfs</A>
</H2>

<P>Некоторые из новейших дистрибутивов Линукса поставляются с сервером фонтов 
<b>xfs</b>, сконфигурированным как отдельно запускаемая программа. 
В частности, Redhat и все основанные на redhat дистрибутивы используют 
такую версию <b>xfs</b> со встроенной поддержкой фонтов TrueType.
Debian тоже поставляет <b>xfs</b>, но их версия не имеет встроенной 
поддержки true type.

<P>Запуск <b>xfs</b> как отдельной программы имеет несколько преимуществ, 
особенно если имеется встроенная поддержка фонтов TrueType. Главное 
преимущество состоит в том, что поскольку фонт-сервер не является 
более частью  X-сервера, появляется возможность предоставлять шрифты 
удаленным дисплеям. Кроме того, сильно упрощается модификация перечня 
каталогов фонтов (font path).

<H3>Перечень каталогов фонтов <b>xfs</b></H3>

<P>Как фонт-сервер, <b>xfs</b> имеет свой собственный перечень каталогов 
с фонтами (font path). Может возникнуть вопрос: а зачем он нужен и где 
его место в общей картине. Он работает следующим образом: Вы включаете 
ссылку на фонт-сервер <b>xfs</b> в перечень каталогов фонтов XFree86, 
добавляя в него следующую строку: <b>unix/:port</b>. После этого любой 
фонт, находящийся в одном из каталогов, включенных в перечень каталогов 
фонтов <b>xfs</b>, становится доступным для XFree86.
<P>Сам перечень каталогов фонтов <b>xfs</b> определяется в конфигурационном 
файле <b>xfs</b>. В Redhat это <b>/etc/X11/fs/config</b>, в Debian - 
<b>/etc/X11/xfs/config</b>. Пользователи Redhat не обязаны редактировать 
этот файл вручную, они могут воспользоваться утилитой <b>chkfontpath</b>.
Ее синтаксис очень прост:
<A NAME="chkfontpath"></A>  
<PRE>
        chkfontpath --add directory
</PRE>

Пользователи других дистрибутивов должны отредактировать этот файл примерно 
следующим образом:
<PRE>
        catalogue = /usr/X11R6/lib/X11/fonts/misc:unscaled,
        ...
        /usr/share/fonts/my_new_fonts/,
        ...
        /usr/share/fonts/some_other_directory
        # in 12 points, decipoints
        default-point-size = 120
        ...
</PRE>

В приведенном примере к перечню каталогов фонтов <b>xfs</b> добавлен каталог 
<b>/usr/share/fonts/my_new_fonts/</b>. <EM>Обратите внимание на то, что 
последняя строка в списке каталогов не содержит запятой в конце.</EM> 
Для того, чтобы сделанные изменения вступили в силу, нужно перезапустить 
сервер <b>xfs</b>. Неплохо вообще перезапустить сессию X после 
перезапуска <b>xfs</b>.

<H3>Установка фонтов для <b>xfs</b></H3>

<P>Для того, чтобы подготовить использование фонта через фонт-сервер <b>xfs</b>, 
Вы должны выполнить следующие шаги:
<UL>
<LI>Если xfs у Вас не установлен, установите его.</LI>
<LI>Поместите новые шрифты в каталог.</LI>
<LI>Если Вы устанавливаете фонты Type1, подготовьте этот каталог для 
сервера, для чего запустите в этом каталоге скрипт <b>type1inst</b>.</LI>
<LI>Если Вы устанавливаете фонты TrueType, ( <EM>помните, что не все 
дистрибутивы могут использовать фонты TrueType через xfs!</EM>), 
подготовьте новый каталог для сервера, для чего запустите 
команды:
<PRE>
        ttmkfdir -o fonts.scale
        mkfontdir
</PRE>
в каталоге, содержащем Ваши новые фонты.
<b>ttmkfdir</b> входит в состав пакета <EM>freetype</EM>.</LI>
<LI>Теперь Вы можете добавить новый каталог к перечню каталогов фонтов 
<b>xfs</b>. Пользователи дистрибутивов, основанных на Redhat, могут 
сделать это с помощью утилиты <b>chkfontpath</b>. В противном случае 
это можно сделать редактированием конфигурационного файла <b>xfs</b>. 
</LI>
<LI>Если <b>xfs</b> уже установлен в Вашей системе, Вы должны определить, 
какой порт использует эта программа. Это можно сделать следующим образом:
<PRE>
        ps ax | grep xfs
</PRE>
</LI>
<LI>Затем проверьте перечень каталогов фонтов XFree86: 
<PRE>
                xset -q
</PRE>
</LI>
<LI>Если перечень каталогов фонтов XFree86 содержит строку 
типа <b>unix:/<EM>port_number</EM></b>, где <EM>port_number</EM> 
совпадает с номером порта, используемым программой <b>xfs</b>, то сервер 
xfs у Вас установлен корректно. В противном случае, Вы должны добавить 
ссылку на него в перечень каталогов фонтов XFree86:
<PRE>
                xset fp+ unix/:port_number
                xset fp rehash
</PRE>

Чтобы это подключение выполнялось автоматически, отредактируйте Ваш 
файл <b>.xinitrc</b> так, как это было объяснено выше. Чтобы изменения 
действовали во всей системе, отредактируйте файл конфигурационный файл 
XF86Config (это либо <b>/etc/X11/XF86Config</b>, либо <b>/etc/XF86Config</b>, 
либо <b>/usr/X11R6/lib/X11/XF86Config</b>), добавив в него строку 
<b>FontPath "unix:/port_number"</b> в секцию "Files". Вот пример: 
<PRE>
                ...
                Section "Files"
                ...
                
                FontPath "unix/:-1" 
                ...
                EndSection
                ...
</PRE>
</LI>
<LI>Если <b>xfs</b> установлен корректно, Вы можете перестартовать его 
так:
<PRE>
                /etc/rc.d/init.d/xfs restart
</PRE>
</LI>
<LI>После того, как Вы перезапустили  <b>xfs</b>, перезапустите 
также X-сессию.</LI>
</UL>
<HR>
<A HREF="Font-HOWTO-5.html">Далее</A>
<A HREF="Font-HOWTO-3.html">Назад</A>
<A HREF="Font-HOWTO.html#toc4">Оглавление</A>
</BODY>
</HTML>
