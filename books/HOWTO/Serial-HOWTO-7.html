<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> The Linux Serial HOWTO : uugetty</TITLE>
 <LINK HREF="Serial-HOWTO-8.html" REL=next>
 <LINK HREF="Serial-HOWTO-6.html" REL=previous>
 <LINK HREF="Serial-HOWTO.html#toc7" REL=contents>
</HEAD>
<BODY>
<A HREF="Serial-HOWTO-8.html">Next</A>
<A HREF="Serial-HOWTO-6.html">Previous</A>
<A HREF="Serial-HOWTO.html#toc7">Contents</A>
<HR>
<H2><A NAME="s7">7. uugetty</A></H2>

<P> 
<H2><A NAME="ss7.1">7.1 Установка uugetty</A>
</H2>

<P> 
Удостоверьтесь, что ваше выходное и входное устройство для последовательного 
порта - ваш модем включен. Если у вас модем стоит на ttyS3, вам понадобяться 
устройства /dev/cua3 и /dev/ttyS3. Если у вас неправильные устройства, см. 
раздел ``Создание ttyS устройств в /dev" о том, как создать устройства, и 
создайте устройства. Если вы хотите звонить наружу вашим модемом в то 
время, как uugetty ожидает на порту регистрации в системе, то используйте 
устройство /dev/cuaN вместо устройства /dev/ttySN
<P> 
[Можно было бы обойтись и без cua, если программное обеспечение не требует их.]
<P> 
uugetty делает проверку важного файла блокировки. Подредактируйте 
/etc/gettydefs, чтобы включить в него запись для вашего модема. Когда вы 
завершите редактирование /etc/gettydefs, вы можете проверить правиьльность 
синтаксиса, сделав:
<BLOCKQUOTE><CODE>
<PRE>
 
      linux# getty -c /etc/gettydefs
</PRE>
</CODE></BLOCKQUOTE>
 
<P>
<H3>Современные модемы</H3>

<P> 
Если у вас модем со сжатием данных и скоростью 9600 бит\сек или более быстрый, 
вы можете блокировать ваш последовательный порт на одну скорость. Например:
<BLOCKQUOTE><CODE>
<PRE>
 
      # 115200 fixed speed
      F115200# B115200 CS8 # B115200 SANE -ISTRIP HUPCL #@S @L @B login: #F115200
</PRE>
</CODE></BLOCKQUOTE>
 
Если у вас ваш модем настроен на аппаратное управление потоком данных RTS/CTS, 
вы можете добавить в запись CRTSCTS:
<BLOCKQUOTE><CODE>
<PRE>
 
      # 115200 fixed speed with hardware flow control
      F115200# B115200 CS8 CRTSCTS # B115200 SANE -ISTRIP HUPCL CRTSCTS #@S @L @B login: #F115200
</PRE>
</CODE></BLOCKQUOTE>
 
<P>
<H3>Старые медленные модемы</H3>

<P> 
Если у вас медленный модем (меньше 9600 бит\сек), то вместо одной строки для 
одной скорости, вам потребуется несколько строк, чтобы попробовать ряд 
скоростей.
<P> 
Обратите внимание, что эти строки связаны друг другу последним "словом" в 
строке, типа #38400. Между каждой записью необходимо оставлять пустые строки.
<P>
<BLOCKQUOTE><CODE>
<PRE>
 
        # Modem entries
        115200# B115200 CS8 # B115200 SANE -ISTRIP HUPCL #@S @L @B login: #57600

        57600# B57600 CS8 # B57600 SANE -ISTRIP HUPCL #@S @L @B login: #38400

        38400# B38400 CS8 # B38400 SANE -ISTRIP HUPCL #@S @L @B login: #19200

        19200# B19200 CS8 # B19200 SANE -ISTRIP HUPCL #@S @L @B login: #9600

        9600# B9600 CS8 # B9600 SANE -ISTRIP HUPCL #@S @L @B login: #2400

        2400# B2400 CS8 # B2400 SANE -ISTRIP HUPCL #@S @L @B login: #115200
 vv
 
 
&lt;sect2>Сообщение при входе в систему
&lt;p> 
 Если хотите, вы можете заставить uugetty печатать интересные вещи при входе в 
 систему. В моих примерах, я ставлю имя системы, линию и текущую скорость 
 бит\сек. Вы можете добавить и другие вещи:
&lt;tscreen>&lt;verb> 
          @B    Текущая скорость (оценивается при определении значения @B ) 
                в бит/сек.
          @D    Текущая дата в формате MM/DD/YY.
          @L    Последовательная линия, с которой работает getty.
          @S    Имя системы.
          @T    Текщее время в формате HH:MM:SS (24-часовой).
          @U    Число работающих в данный момент пользователей. В качестве
                этого значения берется количество записей в файле /etc/utmp,
                которые имеют непустое поле ut_name.
          @V    Значение VERSION, как задано в файле defaults.
          Чтобы отобразить символ '@', используйте или '\@', или '@@'.
</PRE>
</CODE></BLOCKQUOTE>
 
<P>
<P>
<H2><A NAME="ss7.2">7.2 Настройка uugetty</A>
</H2>

<P> 
Имеется большое количество параметров, которые вы можете изменить для каждого 
имеющегося у вас порта.
<P> 
Они выполнены в виде отдельного настроечного файла для каждого порта. Файл 
/etc/conf.uugetty будет использоваться всеми процессами uugetty, а 
/etc/conf.uugetty.ttySN будет использоваться только этим одним портом. 
Пример файлов конфигурации по умолчанию, может быть найден в исходниках 
getty_ps, которые есть в большинстве Linux-дистрибутивах. Из-за экономии места
они здесь не приводятся. Обратите внимание, что, если вы используете 
старые версии getty (старее, чем 2.0.7e), или не используете FSSTND, то 
заданный по умолчанию файл будет /etc/default/uugetty.ttySN. Файл 
/etc/conf.uugetty.ttyS3 Грэга примерно такой:
<P>
<BLOCKQUOTE><CODE>
<PRE>
 
        # пример настроечного файла uugetty для Hayes-совместимых модемов
        # с разрешением входящих звонков
        #
        # проверка наличия lock файла... Если этот lock файл есть, то uugetty 
        # перезапускается так, чтобы модем был заново проинициализирован
        ALTLOCK=cua3
        ALTLINE=cua3
        # какой порт инициализировать
        INITLINE=cua3
        # время таймаута, после которого связь обрывается ...
        TIMEOUT=60
        # строка инициализации модема...
        # формат: &lt;ожидаемое> &lt;отправляемое> ... (чат-последовательность)
        INIT="" AT\r OK\r\n
        WAITFOR=RING
        CONNECT="" ATA\r CONNECT\s\A
        # эта строка устанавливает задержку перед выдачей сообщения при входе в 
        # систему
        DELAY=1
        #DEBUG=010
</PRE>
</CODE></BLOCKQUOTE>
 
<P>Добавьте следующую строку в ваш /etc/inittab, так, чтобы uugetty запускался
на вашем последовательном порту (заменив значения в соответствии с вашей 
системой - расположение файла конфигурации, порт, быстродействие и заданный по 
умолчанию тип терминала):
<BLOCKQUOTE><CODE>
<PRE>
 
      S3:456:respawn:/sbin/uugetty -d /etc/default/uugetty.ttyS3 ttyS3 F115200 vt100
</PRE>
</CODE></BLOCKQUOTE>
 
Рестарт init:
<BLOCKQUOTE><CODE>
<PRE>
 
      linux# init q
</PRE>
</CODE></BLOCKQUOTE>
 
Скорость в вашем /etc/inittab указывается самой высокой, которую поддерживает 
ваш модем.
<P> 
Теперь Linux будет следить за появлением запросов на соединение на вашем 
последовательном порту. Можно звонить с других машин и входить в вашу систему.
<P> 
uugetty имеет еще множество опций, см. полное описание в man по getty(1m). 
Среди прочего имеется возможность планирования и возможность обратного звонка.
<P>
<P>
<HR>
<A HREF="Serial-HOWTO-8.html">Next</A>
<A HREF="Serial-HOWTO-6.html">Previous</A>
<A HREF="Serial-HOWTO.html#toc7">Contents</A>
</BODY>
</HTML>
