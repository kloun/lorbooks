<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Firewall Piercing mini-HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Firewall Piercing mini-HOWTO</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Francois-Rene Rideau</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;     fare@tunes.org
    <br>
&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="CORPAUTHOR"
>  Перевод: <A
HREF="mailto:sam@asp-linux.com"
TARGET="_top"
>Станислав Рогин</A
>,
  <A
HREF="http://www.asplinux.com"
TARGET="_top"
>SWSoft Pte Ltd.</A
>
 </H3
></DIV
><P
CLASS="PUBDATE"
>v0.3b, 27 November 1998<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN15"
></A
><P
></P
><P
>В этом документе способ использования PPP поверх telnet, целью которого
является работа с сетью в обход firewall.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Содержание</B
></DT
><DT
>1. <A
HREF="Firewall-Piercing.html#AEN17"
>Разное</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="Firewall-Piercing.html#AEN19"
>ОТВЕТСТВЕННОСТЬ</A
></DT
><DT
>1.2. <A
HREF="Firewall-Piercing.html#AEN25"
>Legal Blurp</A
></DT
><DT
>1.3. <A
HREF="Firewall-Piercing.html#AEN29"
>Авторские права</A
></DT
><DT
>1.4. <A
HREF="Firewall-Piercing.html#AEN38"
>Благодарности</A
></DT
></DL
></DD
><DT
>2. <A
HREF="Firewall-Piercing.html#AEN42"
>Введение</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="Firewall-Piercing.html#AEN44"
>Вступительное слово</A
></DT
><DT
>2.2. <A
HREF="Firewall-Piercing.html#AEN49"
>Проблемы с безопасностью</A
></DT
><DT
>2.3. <A
HREF="Firewall-Piercing.html#AEN56"
>Другие требования</A
></DT
><DT
>2.4. <A
HREF="Firewall-Piercing.html#AEN60"
>Где взять необходимые программы?</A
></DT
></DL
></DD
><DT
>3. <A
HREF="Firewall-Piercing.html#AEN82"
>Понимание сути проблемы</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="Firewall-Piercing.html#AEN85"
>Называем все своими именами</A
></DT
><DT
>3.2. <A
HREF="Firewall-Piercing.html#AEN90"
>Проблема</A
></DT
><DT
>3.3. <A
HREF="Firewall-Piercing.html#AEN94"
>Дополнительные трудности</A
></DT
></DL
></DD
><DT
>4. <A
HREF="Firewall-Piercing.html#AEN100"
>Решение</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="Firewall-Piercing.html#AEN102"
>Суть</A
></DT
><DT
>4.2. <A
HREF="Firewall-Piercing.html#AEN107"
>fwprc</A
></DT
><DT
>4.3. <A
HREF="Firewall-Piercing.html#AEN119"
>.fwprcrc</A
></DT
></DL
></DD
><DT
>5. <A
HREF="Firewall-Piercing.html#AEN132"
>Обход с другой стороны</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="Firewall-Piercing.html#AEN134"
>Разумное обоснование</A
></DT
><DT
>5.2. <A
HREF="Firewall-Piercing.html#AEN144"
>Получение письма-триггера</A
></DT
></DL
></DD
><DT
>6. <A
HREF="Firewall-Piercing.html#AEN156"
>Дополнительная информация</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="Firewall-Piercing.html#AEN158"
>Другие настройки</A
></DT
><DT
>6.2. <A
HREF="Firewall-Piercing.html#AEN173"
>Поддержка этого документа</A
></DT
><DT
>6.3. <A
HREF="Firewall-Piercing.html#AEN178"
>Вторая копия ОЧЕНЬ ВАЖНОЙ ГЛАВЫ "ОТВЕТСТВЕННОСТЬ" -- это не шутка!!!</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN17"
>1. Разное</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN19"
>1.1. ОТВЕТСТВЕННОСТЬ</A
></H2
><P
><I
CLASS="EMPHASIS"
>ПОЖАЛУЙСТА, ВНИМАТЕЛЬНО ПРОЧТИТЕ ЭТУ ОЧЕНЬ ВАЖНУЮ ИНФОРМАЦИЮ !!! </I
></P
><P
><I
CLASS="EMPHASIS"
>Я снимаю всякую ответственность с себя за содержание этого документа. Если
его использование обернется против вас самих - это ваши проблемы. А не моя
вина. Если вы не осознаете риск сопряженный с выполнением этих инструкций,
не делайте этого. Если вы это сделаете и после этого кто-то проникнет в
сеть вашей компании и вы потеряете работу, а компания миллионы долларов, не
приходите ко мне со слезами.</I
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN25"
>1.2. Legal Blurp</A
></H2
><P
>Copyright &copy; 1998 by Francois-Rene Rideau.</P
><P
>This document is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License
as published by the Free Software Foundation;
either version 2 of the License, or (at your option) any later version.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN29"
>1.3. Авторские права</A
></H2
><P
>Авторские права на русский перевод этого текста принадлежат &copy; 2000 SWSoft Pte Ltd.
Все права зарезервированы.</P
><P
>Этот документ является частью проекта Linux HOWTO.</P
><P
>Авторские права на документы Linux HOWTO принадлежат их авторам, если явно
не указано иное. Документы Linux HOWTO, а также их переводы, могут
быть воспроизведены и распространены полностью или частично на любом
носителе, физическом или электронном, при условии сохранения этой заметки об
авторских правах на всех копиях. Коммерческое распространение разрешается и
поощряется; но, так или иначе, автор текста и автор перевода желали бы знать о
таких дистрибутивах.</P
><P
>Все переводы и производные работы, выполненные по документам Linux HOWTO
должны сопровождаться этой заметкой об авторских правах. Это делается в
целях предотвращения случаев наложения дополнительных ограничений на
распространение документов HOWTO. Исключения могут составить случаи
получения специального разрешения у координатора Linux HOWTO, с которым
можно связаться по адресу приведенному ниже.</P
><P
>Мы бы хотели распространить эту информацию по всем возможным каналам. Но
при этом сохранить авторские права и быть уведомленными о всех планах
распространения HOWTO. Если у вас возникли вопросы, пожалуйста, обратитесь
к координатору проекта Linux HOWTO по электронной почте:
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@metalab.unc.edu"
>linux-howto@metalab.unc.edu</A
>&#62;</TT
> или к координатору русского
перевода Linux HOWTO компании SWSoft Pte Ltd. по адресу
<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:linux-howto@asplinux.ru"
>linux-howto@asplinux.ru</A
>&#62;</TT
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN38"
>1.4. Благодарности</A
></H2
><P
>Даже несмотря на то, что я в этом документе переписал заново практически
все, кроме главы "Ответственность", я все-таки очень обязан Barak
Pearlmutter <A
HREF="mailto:bap@cs.unm.edu"
TARGET="_top"
>bap@cs.unm.edu</A
> за его Мини-HOWTO "Term-Firewall": я
думаю, что была необходимость написать мини-HOWTO об обходе firewall, а его
документ стал для этого причиной и основой.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN42"
>2. Введение</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>2.1. Вступительное слово</A
></H2
><P
>Не является секретом тот факт, что системные администраторы и пользователи
смотрят на вопросы безопасности и применения ограничений немного
по-разному. Достаточно часто по этой причине пользователь оказывается за
firewall, который он может и обойти, испытывая при этом некоторые
неудобства. В этом мини-HOWTO приводится описание простого способа
использования стандартных утилит работы с интернетом, в обход firewall, при
помощи IP-эмулятора, запущенного поверх telnet.</P
><P
>Идея создания данного документа была навеяна Мини-HOWTO "Term+Firewall",
автора Barak Pearlmutter <A
HREF="mailto:bap@cs.unm.edu"
TARGET="_top"
>bap@cs.unm.edu</A
>, описавшего старую, и более нигде
не применяемую программу, Term (кстати, великолепную для своих времен вещь).
Также эта идея была подкреплена наличием некоторых особенностей не совсем
стандартных telnet-ов.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN49"
>2.2. Проблемы с безопасностью</A
></H2
><P
>Конечно, если ваш системный администратор установил firewall, то у него
(нее) были на это причины - и вы могли подписать с ним контракт,
запрещающий вам обходить этот firewall. С другой стороны, если вам разрешен
telnet наружу (это главное условие для описанного здесь обхода firewall),
значит вам разрешен доступ к внешним компьютерам - а если у вас есть доступ
к внешним компьютерам, то вы можете выполнить то, что описано ниже.</P
><P
>Поэтому использование существующих прорех в firewall - это
всего лишь вопрос удобства использования стандартных утилит и протоколов -
это не использование специальных или модифицированных (и
перекомпилированных) программ, использующих несколько специализированных
прокси, неправильно или плохо настроенных, некомпетентным или
невнимательным системным администратором; это не установка большого
количества специализированных преобразователей, позволяющих работать вам с
интернетом через пути, разрешенные на firewall (например, через HTTP).</P
><P
>Более того, использование пользовательского IP-эмулятора (такого, как
SLiRP) должно оградить firewall от внешних атак, если конечно вы сами этого
не разрешите (или они очень умны и хитры, и root на внешней машине следит
за вами).</P
><P
>Вообще, описанный здесь обход firewall относительно безопасен. Однако,
многое зависит от конкретных обстоятельств, и я не даю никаких гарантий.
Многие вещи в Интернете сами по себе небезопасны, с этим обходом или без
него - подходите ко всему с должной мерой осторожности, если у вас нет
причин чувствовать себя безопасно. Если необходимо - используйте
шифрование, дополнительную авторизацию и т.п..</P
><P
>Если подытожить - не используйте эту информацию, если не знаете, что
делаете. Еще раз прочитайте главу "Ответственность".</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN56"
>2.3. Другие требования</A
></H2
><P
>Вы знаете, что делаете;  
Вы знаете, как установить сетевое соединение;  
У вас есть имя и пароль входа в две системы на обеих сторонах от firewall; 
Вы можете устанавливать telnet-соединение с одной системы на другую (или ssh-, или нечто подобное) ; 
Вы можете запустить IP-эмулятор в оболочках в обеих системах; 
У вас есть программы, умеющие использовать эмуляцию IP на обеих сторонах; 

Заметьте, что эмуляцию может использовать любая программа, так как
локальный эмулятор - это pppd, взаимодействующий с ядром Linux; другие
эмуляторы (например Term) требуют рекомпиляции и подключения
соответствующих библиотек.&#13;</P
><P
>pppd можно найти на любом уважающем себя ftp-сайте; там же обычно можно
найти и SLiRP. Если на удаленной машине у вас нет прав системного
администратора, то вы можете использовать SLiRP.&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN60"
>2.4. Где взять необходимые программы?</A
></H2
><P
>Многие из описанных здесь программ обычно входят в комплект вашего
дистрибутива, правда, возможно, не полностью или с некоторыми
ограничениями; во всяком случае, все пакеты, кроме двух последних, существуют
в формате rpm. Если вы хотите получить последнюю версию исходных текстов
или уже готовых программ (ведь может на одном из концов соединения быть
не-Linux), посетите следующие страницы:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>SLiRP</TT
> можно найти по адресу 

<A
HREF="http://blitzen.canberra.edu.au/slirp"
TARGET="_top"
>http://blitzen.canberra.edu.au/slirp</A
> и/или
<A
HREF="ftp://www.ibc.wustl.edu/pub/slirp_bin/"
TARGET="_top"
>ftp://www.ibc.wustl.edu/pub/slirp_bin/.</A
>.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>zsh</TT
> можно найти по адресу
<A
HREF="http://www.peak.org/zsh/"
TARGET="_top"
> http://www.peak.org/zsh/.</A
>&#13;</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>ppp</TT
> можно найти по адресу
<A
HREF="ftp://cs.anu.edu.au/pub/software/ppp/"
TARGET="_top"
>ftp://cs.anu.edu.au/pub/software/ppp/.</A
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>fwprc</TT
> и <TT
CLASS="LITERAL"
>cotty</TT
> можно найти по адресу
<A
HREF="http://www.tunes.org/~fare/files/fwprc/"
TARGET="_top"
>http://www.tunes.org/~fare/files/fwprc/</A
></P
></LI
></UL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN82"
>3. Понимание сути проблемы</A
></H1
><P
>Четкое понимание сути проблемы - большая половина ее решения. </P
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN85"
>3.1. Называем все своими именами</A
></H2
><P
>Если вы хотите, чтобы этот обходной путь работал для вас, вам придется
понять, КАК он работает, чтобы, если что-то сломается, вы знали где искать
неисправность.</P
><P
>Первый шаг на пути к пониманию проблемы - присвоить всему соответствующие
названия.</P
><P
>Итак "локальная" - это машина, которая устанавливает соединение, файлы на
ней тоже называются "локальными"; и наоборот - "удаленная" - это машина с
другой стороны соединения.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN90"
>3.2. Проблема</A
></H2
><P
>Наша цель - соединить между собой ввод и вывод локального IP-эмулятора,
соответственно, с выводом и вводом удаленного IP-эмулятора</P
><P
>Каналами связи между двумя эмуляторами могут быть либо устройства (обычно
pppd), либо "текущий терминал (tty)". Первый вариант, практически, невозможен
в telnet-соединениях. Второй должен быть достаточно хитрым, потому что,
когда вы запускаете локальный эмулятор из командной строки, он подключен к
текущему tty пользователя, а не к telnet-сессии; если мы захотим открыть
новую сессию (локальную или удаленную) на новом терминале, нам придется
синхронизировать запуск и соединение IP-эмуляторов, иначе мусор одного из
эмуляторов будет восприниматься как команды на другой стороне - это
приведет еще к большему мусору и т.п..&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN94"
>3.3. Дополнительные трудности</A
></H2
><P
>Чтобы все было хорошо, локальный эмулятор должен позволять создавать
IP-соединения на уровне ядра, то есть, быть pppd. Однако pppd достаточно
глуп - он позволяет создавать соединения только через /dev-устройства или
через текущий tty; это должно быть tty, а не парой потоков (pipe) (как все
было бы просто!). Он подходит для удаленной стороны - он может использовать
tty telnet-сессии; но вот для локальной машины он никак не подходит - он не
может запустить telnet-соединения; должен существовать какой-то обходной
путь.&#13;</P
><P
>Telnet работает <I
CLASS="EMPHASIS"
>почти</I
> правильно с парой потоков, хотя он
все-таки настаивает на выполнении ioctl с tty, с которым он
взаимодействует; использование telnet без tty тоже не совсем правильно,
потому что на медленных компьютерах соединение будет прерываться (fwprc 0.1
работал правильно на P/MMX 233, один из 6 раз на 6x86-P200+, и вообще не
работал на 486dx2/66).</P
><P
>[Примечание: Если я найду того негодяя (возможно он из фанатов MULTICS, да
и в UNIX должны были найтись пара недоумков, скопировавших глупую идею),
который изобрел принцип "tty"-устройств - запись и чтение производятся с
одним "псевдо"-файлом, вместо того, чтобы иметь одну чистую пару потоков -
Я его задушу!]&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN100"
>4. Решение</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN102"
>4.1. Суть</A
></H2
><P
>Программа обхода firewall <TT
CLASS="LITERAL"
>fwprc</TT
>
 будет использовать "tty-прокси", <TT
CLASS="LITERAL"
>cotty</TT
>,
который открывает два псевдо-tty устройства, выполняет команды на каждом из
устройств, а затем глупо копирует символы в обоих направлениях. Одной
командой будет telnet на удаленную машину, а другой - локальный pppd,
который после этого может открыть и контролировать telnet-соединение, при
помощи стандартного chat-скрипта.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN107"
>4.2. fwprc</A
></H2
><P
>Я написал очень хорошо документированный скрипт для обхода firewall -
<TT
CLASS="LITERAL"
>fwprc</TT
>,
 который есть на моем сайте
<A
HREF="http://www.tunes.org/~fare/files/fwprc/"
TARGET="_top"
> http://www.tunes.org/~fare/files/fwprc/</A
>,
там же можно взять и <TT
CLASS="LITERAL"
>cotty</TT
>(необходимый для <TT
CLASS="LITERAL"
>fwprc</TT
> версии 0.2 и новее). На
момент написания этого документа самые новые версии программ - это <TT
CLASS="LITERAL"
>fwprc</TT
>
0.3a и <TT
CLASS="LITERAL"
>cotty</TT
> 0.3a.</P
><P
>Название "fwprc" специально сделано нечитаемым и непроизносимым, чтобы
путать некомпетентных параноиков-сисадминов, которые сами по себе могут
быть причиной существования мучающего вас firewall (конечно, могут
существовать и нормальные firewall, и даже очень необходимые; безопасность
- это определяющий фактор правильной конфигурации). Но если вы прочтете это
название при администраторе вслух - ожидайте наихудшего из всех возможных
последствий .</P
><P
>КОНКУРС! КОНКУРС! Пошлите мне аудио-файл .au с записью того, как вы
произносите название "fwprc". Выиграет самый непонятный вариант, и имя его
создателя попадет на страницу fwprc версии 1.0!</P
><P
>Я проверил работу этой программы в нескольких вариантах, настраивая ее
через файлы конфигурации. Но, конечно, у вас она не заработает согласно закона
Мерфи. Пожалуйста, посылайте мне свои предложения и дополнения, чтобы
облегчить жизнь тем, кто встанет на этот нелегкий путь после вас.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN119"
>4.3. .fwprcrc</A
></H2
><P
>Работу <TT
CLASS="LITERAL"
>fwprc</TT
>
 можно настроить при помощи файла настройки <TT
CLASS="LITERAL"
>.fwprcrc</TT
>, который
должен быть на обеих сторонах firewall. Существует возможность использовать
несколько различных конфигураций (например, <I
CLASS="EMPHASIS"
>Я</I
> делаю так), и несколько из
них оставлены в качестве примера для читателя.</P
><P
>Для начала скопируйте соответствующую (предпоследнюю) секцию файла <TT
CLASS="LITERAL"
>fwprc</TT
> в
файл <TT
CLASS="LITERAL"
>.fwprcrc</TT
> в вашем домашнем каталоге. Затем замените в нем значения
переменных, чтобы они соответствовали вашим машинам. Затем скопируйте этот
файл на удаленную машину, и все проверьте.</P
><P
>По умолчанию локально используется pppd, а удаленно - slirp. Чтобы это
изменить, вы можете подправить соответствующую функцию в файле <TT
CLASS="LITERAL"
>.fwprcrc</TT
>
примерно так:

<PRE
CLASS="SCREEN"
>remote&lowbar;IP&lowbar;emu () &lcub; remote&lowbar;pppd &rcub;</PRE
>&#13;</P
><P
>Заметьте, что SLiRP безопаснее pppd, к нему проще получить доступ - он не
требует администраторских прав на удаленной машине. Другой его плюс - он
игнорирует все пакеты, которые идут не прямо с соединенной с ним машины
(этот плюс становится минусом, если вы хотите таким образом работать с
целой подсетью при помощи маскарадинга). Обычно стандартных функций SLiRP
достаточно, но все-таки некоторые минусы у него обнаружились (например,
управляемость при работе); конечно, это бесплатная программа - исправляйте
исходные тексты: вносите в них все, что вам необходимо.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN132"
>5. Обход с другой стороны</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN134"
>5.1. Разумное обоснование</A
></H2
><P
>Часто возникают такие ситуации, при которых telnet-соединение может быть
установлено только с одной стороны firewall; однако, некоторые способы
связи с другой стороны все-таки существуют (например e-mail). В этом случае,
обход firewall возможен - это делается при помощи некоторого
сообщения на "правильную" сторону firewall с указанием установить
telnet-соединение.</P
><P
><TT
CLASS="LITERAL"
>fwprc</TT
> включает в себя код, позволяющий это
сделать. Для этого, с удаленной стороны, должно придти письмо с PGP-аутентификацией;
все, что вам надо - запустить <TT
CLASS="LITERAL"
>fwprc</TT
> в качестве
фильтра <TT
CLASS="LITERAL"
>procmail(1)</TT
>, (подробные инструкции
есть внутри самого <TT
CLASS="LITERAL"
>fwprc</TT
>). Однако заметьте,
что вам придется запускать pppd с соответствующими правами - возможно,
придется писать свой su для того, чтобы стать root-ом. Инструкции приведены
в <TT
CLASS="LITERAL"
>fwprc</TT
>.</P
><P
>Более того, аутентифицированный триггер - это еще не безопасное соединение.
В этом случае я бы посоветовал вам использовать ssh (возможно поверх
telnet) для того, чтобы обезопасить себя. И еще, опасайтесь того, что может
произойти между приходом письма-триггера и установкой соединения при помощи
ssh. Я приветствую любые советы по поводу этого.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN144"
>5.2. Получение письма-триггера</A
></H2
><P
>Если ваша машина находится за firewall, то ваша почта может находиться на
центральном сервере, который, естественно, не делает фильтрование при
помощи <TT
CLASS="LITERAL"
>procmail(1)</TT
> и не позволяет установить telnet-соединение. Нет проблем!
Вы можете в этом случае использовать <TT
CLASS="LITERAL"
>fetchmail(1)</TT
>, запустив его в режиме
демона - он будет посылать и принимать почту в вашем Linux, (и/или вы
можете использовать cron для связи с сервером через равные промежутки
времени). <TT
CLASS="LITERAL"
>fetchmail(1)</TT
> будет посылать локальную почту через <TT
CLASS="LITERAL"
>sendmail(8)</TT
>, а он
в свою очередь должен быть настроен на использование для локальной доставки
<TT
CLASS="LITERAL"
>procmail(1)</TT
>. Заметьте, что если вы запустите <TT
CLASS="LITERAL"
>fetchmail(1)</TT
> в режиме демона,
вы не сможете параллельно запускать еще одну копию <TT
CLASS="LITERAL"
>fetchmail(1)</TT
> для приема
почты в определенное время - это аналогично запуску fwprc; конечно, вы
можете запускать демон <TT
CLASS="LITERAL"
>fetchmail(1)</TT
> от некоего псевдо-пользователя. Частый
запуск процедуры получения почты не даст ничего хорошего ни вашей машине,
ни серверу. Слишком редкий запуск приведет к большой задержке писем в пути
(а значит и задержке установки обратного соединения). Я запускаю свой
<TT
CLASS="LITERAL"
>fetchmail(1)</TT
> каждые две минуты.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H1
CLASS="SECT1"
><A
NAME="AEN156"
>6. Дополнительная информация</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN158"
>6.1. Другие настройки</A
></H2
><P
>На самом деле существуют разные firewall, а не только те, которые позволяют
вам устанавливать telnet-соединения. Но, в любом случае, пока может
существовать поток пакетов, идущий через firewall, будет и способ его
обойти. Вопрос лишь в сложности написания программы обхода.</P
><P
>Достаточно простой случай - когда вы можете запустить <TT
CLASS="LITERAL"
>ssh</TT
> на локальной машине и <TT
CLASS="LITERAL"
>pppd</TT
> на удаленной. Чисто теоретически, <TT
CLASS="LITERAL"
>cotty</TT
> версии 0.3a должен это поддерживать, но в
<TT
CLASS="LITERAL"
>fwprc</TT
> поддержки <TT
CLASS="LITERAL"
>ssh</TT
> нет. Возможно, вы реализуете эту поддержку
самостоятельно. Вы даже можете сделать это без firewall - таким образом вы
получите защищенную Виртуальную Частную сеть "VPN" (Virtual Private
Network). Подробнее читайте мини-HOWTO "VPN".</P
><P
>Если вы должны работать с 7-битной линией - используйте SLIP, вместо PPP. Я
никогда не тестировал подобный вариант - в этом просто нет необходимости,
почти все линии в наше время более-менее поддерживают 8 бит; но больших
трудностей быть не должно.</P
><P
>Если единственный путь через firewall - это WWW-прокси (обычно - это самый
минимум в сети, подключенной к Интернету), то еще не все потеряно. Вы
можете написать демона, который буферирует входящие и исходящие данные, и
посылает их по HTTP-соединениям, достигая тем самым некоторого подобия
протокола telnet-поверх-HTTP, над которым можно запустить fwprc. Возможно,
это будет не очень быстро и гибко, но для <TT
CLASS="LITERAL"
>fetchmail(1)</TT
>, <TT
CLASS="LITERAL"
>suck(1)</TT
> и им
подобным неинтерактивным программам этого хватит.</P
><P
>Если вам надо нечто более производительное, но не фильтруется нечто
очень дикое (запросы DNS, ICMP-пакеты, и т.п.), то у вас дела достаточно
плохи. Вам придется править в ядре работу с IP, используя (например)
систему работы с пакетами из проекта Fox. Вы сможете получить IP-по-HTTP,
IP-по-DNS, IP-по-ICMP, или нечто подобное - это все требует не только
достаточно сложного протокола обмена, но и работы с ядром OS - это
достаточно сложно.</P
><P
>Кстати, если вы будете обходить Firewall при помощи псевдо-HTTP демона, не
забудьте вложить в него пару-тройку веб-страниц, чтобы сбить с толку
противных подозрительных администраторов firewall.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN173"
>6.2. Поддержка этого документа</A
></H2
><P
>Я ощущал необходимость написать этот документ, но у меня не было
достаточно времени, поэтому этот мини-HOWTO получился достаточно сыроват.
Он таким и останется до тех пор, пока я не получу достаточно отзывов и
предложений, и из них пойму, что и где дописать. Я буду очень рад отзывам и
помощи. С радостью отдам в хорошие руки поддержку этого мини-HOWTO.</P
><P
>В любом случае, данный документ осветил некоторые проблемы, решением которых
может заняться человек, которому не жалко времени (или денег?), чтобы их
разрешить: в идеях нет ничего сложного, но вот детали могут достаточно
сложны.</P
><P
>Не стесняйтесь присылать мне свои вопросы, и, я надеюсь, решения проблем,
связанных с этим документом.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H2
CLASS="SECT2"
><A
NAME="AEN178"
>6.3. Вторая копия ОЧЕНЬ ВАЖНОЙ ГЛАВЫ "ОТВЕТСТВЕННОСТЬ" -- это не шутка!!!</A
></H2
><P
><SPAN
CLASS="QUOTE"
>"<I
CLASS="EMPHASIS"
> Я снимаю всякую ответственность с себя за содержание этого
документа. Если его использование обернется против вас самих - это ваши
проблемы. А не моя вина. Если вы не осознаете риск сопряженный с
выполнением этих инструкций, не делайте этого. Если все же сделаете, а после
этого кто-то проникнет в сеть вашей компании, вы потеряете работу,
компания - миллионы долларов, то не приходите ко мне со слезами.</I
>"</SPAN
></P
></DIV
></DIV
></DIV
></BODY
></HTML
>