<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>IPX в Linux HOWTO: Настройка вашей Linux-машины как клиента NCP</TITLE>
 <LINK HREF="IPX-HOWTO-10.html" REL=next>
 <LINK HREF="IPX-HOWTO-8.html" REL=previous>
 <LINK HREF="IPX-HOWTO.html#toc9" REL=contents>
</HEAD>
<BODY>
<A HREF="IPX-HOWTO-10.html">Следующий</A>
<A HREF="IPX-HOWTO-8.html">Предыдущий</A>
<A HREF="IPX-HOWTO.html#toc9">Содержание</A>
<HR>
<H2><A NAME="s9">9. Настройка вашей Linux-машины как клиента NCP</A>      </H2>

<P>Если вы пользователь сети со смешанной технологией, которая
включает протоколы IP и IPX, возможно что иногда вам захочется иметь
на вашей linux-системе доступ к данным, хранимым на файловом сервере
Novell в вашей сети.  Novell предлагает пакет NFS сервера для своих
серверов, который позволит вам организовать доступ, но если у вас
маленький сервер или вы имеете маленькое количество людей,
заинтересованных в доступе, может быть трудно оправдать цену
коммерческого пакета.
<P>
<P>Volker Lendecke <CODE>&lt;lendecke@namu01.gwdg.de></CODE> написал модуль
ядра Linux для файловой системы, которая поддерживает подмножество
Novell NCP, которая позволит вам монтировать тома Novell в файловую
систему Linux без других дополнительных продуктов для вашего
файлового сервера. Volker назвал пакет <EM>ncpfs</EM> и получил
необходимую информацию в основном из книги "Netzwerkprogrammierung in
C" Manfred Hill и Ralf Zessin (дополнительные детали о книге
находятся в файле README в пакете <EM>ncpfs</EM>).
<P>
<P>Это программное обеспечение заставляет Linux эмулировать обычную
рабочую станцию Novell для файловых сервисов. Оно также включает
маленькую утилиту печати, которая позволит вам печатать в очереди
печати Novell (это документировано позже в разделе Клиент
Печати). Пакет <EM>ncpfs</EM> будет работать с файловыми серверами Novell
версий 3.x и поздних, он не будет работать с Novell 2.x.  Клиент
<EM>ncpfs</EM> также будет работать с Novell-совместимыми продуктами, но
к сожалению некоторые продукты, объявленные как совместимые не
являются достаточно совместимыми. Для использования <EM>ncpfs</EM> с
файловыми серверами Novell 4.x, файловый сервер должен работать в
режиме эмуляции bindery. Поддержка NDS является недвним добавлением к
пакету <EM>ncpfs</EM> и находится в ранней стадии разработки и
дополнительно к этому может быть запрещено использовать этот пакет в
вашей стране, из-за использования патентованной технологии.
<P>
<H2><A NAME="ss9.1">9.1 Где взять <B><EM>ncpfs</EM></B>.</A>
        </H2>

<P>Последние версии пакета <EM>ncpfs</EM> были спроектированы, чтобы
компилироваться с ядром <CODE>1.2.13</CODE> или ядрами позже <CODE>1.3.71</CODE>
(это включает 2.x.x). Если вы не используете ядро ни в одной из
этих категорий, тогда вам необходимо обновить ядро. 
<A HREF="Kernel-HOWTO.html">Kernel-HOWTO</A> в деталях описывает
как сделать это.
<P>
<P>Вы можете получить пакет <EM>ncpfs</EM> pпо анонимному ftp с сервера
Volker по адресу: 
<A HREF="ftp://ftp.gwdg.de/pub/linux/misc/ncpfs/">ftp.gwdg.de</A>
или 
<A HREF="ftp://sunsite.unc.edu/pub/Linux/system/filesystems/ncpfs">sunsite.unc.edu</A> или других серверов-зеркал. Текущая версия
на время написания была: <CODE>ncpfs-2.0.11.tgz</CODE> или
<CODE>ncpfs-2.2.0.tgz</CODE>, которая добавила поддержку NDS.
<P>
<H2><A NAME="ss9.2">9.2 Построение <B><EM>ncpfs</EM></B> для ядра 1.2.13.</A>
        </H2>

<P>
<DL>
<DT><B>Скомпилируйте ядро с поддержкой Ethernet и
IPX</B><DD><P>Первое, что вам необходимо сделать&nbsp;-- убедиться
что ваше ядро построено с разрешенной поддержкой IPX. В ядре
версии <CODE>1.2.13</CODE> вам необходимо убедиться, что вы ответили
<CODE>Y</CODE> на вопрос: '<CODE>The IPX protocol</CODE>' как показано:
<P>
<PRE>
 ...
 ...
Assume subnets are local (CONFIG_INET_SNARL) [y] 
Disable NAGLE algorithm (normally enabled) (CONFIG_TCP_NAGLE_OFF) [n] 
The IPX protocol (CONFIG_IPX) [n] y
*
* SCSI support
 ...
 ...
</PRE>
<P>
<P>Вам также необходимо убедиться, что вы включили
соответствующий драйвер для вашей карты Ethernet. Если вы не
знаете как сделать это, вам необходимо прочитать документ 
<A HREF="http://www.linux.org.ru/books/HOWTO/Ethernet-HOWTO.html">Ethernet-HOWTO</A>.
<P>
<P>Вы можете продолжать компиляцию вашего ядра. Помните, что
необходимо запустить программу <EM>lilo</EM> для инсталляции ядра,
после завершения компиляции.
<P>
<DT><B>Разархивируйте программное обеспечение <EM>ncpfs</EM></B><DD><P>
<PRE>
# cd /usr/src
# tar xvfz ncpfs-2.0.11.tgz
# cd ncpfs
</PRE>
<P>
<DT><B>Проверьте Makefile</B><DD><P>Если вы намереваетесь использовать
<EM>kerneld</EM> для автозагрузки модуля ядра <EM>ncpfs</EM>, тогда вы
должны раскомментировать строку в <CODE>Makefile</CODE>, которая
ссылается на: <CODE>KERNELD</CODE>. Если вы не уверены, что знаете что
это означает вы должны прочитать 
<A HREF="Kernel-HOWTO.html">Kernel-HOWTO</A>, чтобы ознакомить себя с настройкой
модулей ядра.
<P>
<DT><B>Скомпилируйте пакет <EM>ncpfs</EM></B><DD><P>Программное
обеспечение должно быть скомпилировано просто без всякой
дополнительной настройки:
<P>
<PRE>
# make
</PRE>
<P>
<DT><B>Скопируйте утилиты IPX куда-нибудь, если их у вас еще
нет</B><DD><P>После того как команда <EM>make</EM> выполнится вы
должны найти все необходимые утилиты в директории
<CODE>ncpfs/bin</CODE>. Вы можете использовать: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
# make install
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>чтобы установить утилиты в выбранные Volker'ом
директории. Если вы работаете на системе использующей формат
ELF, то вам необходимо перезапустить <CODE>`ldconfig -v'</CODE> чтобы
убедиться, что разделяемые библиотеки можно найти.
<P>
<DT><B>Скопируйте модуль <EM>ncpfs.o</EM> куда необходимо</B><DD><P>Если вы компилировали для ядра <CODE>1.2.*</CODE>, то вы найдете файл
названный <CODE>ncpfs.o</CODE> в директории <CODE>ncpfs/bin</CODE> после
выполнения <EM>make</EM>. Это модуль ядра <EM>ncpfs</EM>. Вы
должны скопировать его куда необходимо. На моей системе
<EM>debian</EM> я скопировал его в директорию
<CODE>/lib/modules/1.2.13/fs</CODE> и добавил <CODE>ncpfs</CODE> в файл
<CODE>/etc/modules</CODE>, так что он будет автоматически загружен
во время загрузки системы. Если вы используете другой
дистрибутив Linux, то вы должны найти место где хранятся модули
ядра и скопировать скомпилированный модуль туда, или просто
скопировать модуль в вашу директорию <CODE>/etc</CODE>. Для
загрузки модуля вручную вам необходимо выполнить команду:
<P>
<PRE>
# insmod ncpfs.o
</PRE>
<P>
</DL>
<P>
<H2><A NAME="ss9.3">9.3 Построение <B><EM>ncpfs</EM></B> для ядер</A>
            1.3.71++/2.0.*.     </H2>

<P>Для последних версий <EM>ncpfs</EM> вы должны использовать ядро
<CODE>1.3.71</CODE> или более новое, это включает и ядра <CODE>2.0.*</CODE>. 
<P>
<P>Если вы намереваетесь использовать ядро версии <CODE>1.3.71</CODE> или
более новое, тогда исходный код <EM>ncpfs</EM> для ядра уже включен
в стандартный дистрибутив ядра. Вы должны только ответить <CODE>Y</CODE>
на:
<P>
<BLOCKQUOTE><CODE>
<PRE>
Networking options &nbsp;-->
    ...
    ...
    &lt;*> The IPX protocol
    ...
Filesystems &nbsp;-->
    ...
    ...
    &lt;*> NCP filesystem support (to mount NetWare volumes)
    ...
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Вам все равно необходимо следовать инструкциям по компиляции для
ядер <CODE>1.2.*</CODE>, так как вам нужно скомпилировать утилиты, но там
не будет файла модуля ядра.
<P>
<H2><A NAME="ss9.4">9.4 Настройка и использование <B><EM>ncpfs</EM></B>.</A>
        </H2>

<P>
<DL>
<DT><B>Настройка сетевого программного обеспечения
IPX</B><DD><P>Существует два способа настройки сетевого программного
обеспечения IPX. Вы можете вручную настроить всю информацию о
вашей сети IPX или можете позволить программному обеспечению
определить для себя некие разумные установки с помощью команды:
Существует два способа настройки: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ipx_configure --auto_interface=on --auto_primary=on
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Это должно быть разумным в большинстве случаев, но если это
у вас не работает, тогда прочитайте выше раздел 'Утилиты IPX'
для настройки вашего программного обеспечения вручную. Однако
были замечены проблемы при использовании этой команды в сети с
клиентами под Windows 95.
<P>
<DT><B>Проверка конфигурации</B><DD><P>После того как ваша сеть IPX
настроена вы сможете использовать команду <EM>slist</EM>, для
того чтобы увидеть список всех файловых серверов Novell в вашей
сети.
<P>
<PRE>
# slist
</PRE>
<P>
<P>Если комманда <CODE>slist</CODE> выдает сообщение подобное:
<CODE>ncp_connect: Invalid argument</CODE>, тогда скорее всего ваше
ядро не имеет поддержки IPX. Проверьте что вы действительно
загрузили соответствующее ядро. При загрузке вы должны видеть
сообщения о '<CODE>IPX</CODE>' и '<CODE>ncpfs</CODE>' в сообщениях
системы. Если комманда <EM>slist</EM> не показывает список
серверов, тогда вам необходимо использовать метод ручной
настройки сети.
<P>
<DT><B>Монтирование сервера или тома Novell(tm)</B><DD><P>Если ваше
сетевое программное обеспечение IPX работает нормально, то вы
можете сейчас смонтировать том файлового сервера Novell в
файловую систему Linux. Комманда <EM>ncpmount</EM> используется
для этих целей и требует, чтобы вы задали по крайней мере
следующую информацию:
<P>
<P>
<OL>
<LI>Имя файлового сервера </LI>
<LI>Идентификатор входа
файлового сервера. Если для него требуется пароль, то он
также необходим вам </LI>
<LI>Точка монтирования, т.е. куда вы
хотите примонтировать том. Это должна быть существующая
директория на вашей машине.</LI>
<LI>(по необходимости) директория на файловом сервере,
которую надо смонтировать. </LI>
</OL>
<P>
<P>Существует эквивалентная комманда <EM>ncpumount</EM> для
размонтирования смонтированных файловых систем NCP. Файловые
системы NCP будут отмонтироваться нормально, если ваша машине
будет выключаться корректно, так что вам нет необходимости
беспокоиться о размонтировании файловых систем вручную с
помощью команды <CODE>ncpumount</CODE> до выполнения команды
<CODE>halt</CODE> или <CODE>shutdown</CODE>. 
<P>
<P>Пример команды для монтирования файлового сервера
<CODE>ACCT_FS01</CODE>, с идентификационным именем <CODE>guest</CODE> без
пароля, в директорию <CODE>/mnt/Accounts</CODE> должен выглядеть
подобным образом: 
<P>
<PRE>
# ncpmount -S ACCT_FS01 /mnt/Accounts -U guest -n
</PRE>
<P>
<P>Заметим, что использование опции <CODE>-n</CODE> указывает. что для
входа в систему пароль не требуется. Та же самая процедура с
указанием пароля <CODE>secret</CODE> должна выглядеть так:
<P>
<PRE>
# ncpmount -S ACCT_FS01 /mnt/Accounts -U guest -P secret
</PRE>
<P>
<P>Если вы не укажете ни опцию <CODE>-n</CODE> ни опцию <CODE>-P</CODE> у вас
запросят пароль.
<P>
<DT><B>Проверка монтирования</B><DD><P>Если монтирование было
успешным, то вы обнаружите том доступным с идентификатором
пользователя (userid) для которого производился вход в
систему. Вы также можете пересечь структуру директорий и найти
другие файлы. В качестве альтернативы вы можете использовать
опцию <CODE>-V</CODE> для монтирования отдельного тома.
<P>
<P>Так как NCP не обеспечивает значения uid или gid владельцев
фалов, все файлы будут иметь разрешения и владельца присвоенных
значениям точки монтирования, учтите это при при разделении
смонтированного тома между пользователями Linux. 
<P>
<DT><B>Настройка автоматического выполнения
монтирований</B><DD><P>Если вы имеете нужду в постоянно
смонтированных томах ncp, тогда вы захотите настроить
вышеприведенные команды в ваши <EM>rc</EM>-файлы, так что все
будет выполняться автоматически во время загрузки. Если ваш
дистрибутив не обеспечивает некоторый способ настройки IPX, как
в debian, тогда я рекомендую поместить эти команды в ваш файл
<CODE>/etc/rc.local</CODE>, если он у вас есть. Вы можете
использовать что-то подобное: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
#
# Start the ncp filesystem
/sbin/insmod /lib/modules/1.2.13/fs/ncpfs.o

# configure the IPX network
ipx_configure --auto_interface=on --auto_primary=on

# guest login to the Accounting fileserver
ncpmount -S ACCT_FS01 /mnt/Accounts -U guest -n

#
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Существует другой способ настройки монтирований NCP&nbsp;--
это делается путем создания файла
<CODE>$HOME/.nwclient</CODE>. Этот файл содержит детальную
информацию о временных или специфических для пользователя
монтирований томов NCP, которые будут выполняться
регулярно. Это позволит вам хранить информацию о монтировании,
так что вы можете делать их заново не указывая все параметры
при каждом монтировании.
<P>
<P>Формат этого файла довольно простой:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Первая запись - запись 'сервера по умолчанию' и она используется
# когда вы не указываете сервер явно.
#
# Пользователь TERRY входит на файловый сервер DOCS_FS01 с паролем 'password'
DOCS_FS01/TERRY password
#
# Гостевой вход на файловый сервер ACCT_FS01 без пароля
ACCT_FS01/GUEST -
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Для активизации этих монтирований вы можете использовать
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ ncpmount /home/terry/docs
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>для монтирования: DOCS_FS01 с идентификатором TERRY в
директорию /home/terry/docs. Заметим, что эта
запись была выбрана потому что сервер не был указан в команде
монтирования. Если будет использоваться следующая команда:
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ ncpmount -S ACCT_FS01 /home/terry/docs
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>тогда том для пользователя GUEST на сервере ACCT_FS01 должен
будет быть смонтирован.
<P>
<P><B>Замечание:</B> чтобы этот механизм работал, вам
необходимо чтобы разрешение на файл
<CODE>$HOME/.nwclient</CODE> было равно <CODE>0600</CODE>, так что
вы для этого должны использовать команду:
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ chmod 0600 $HOME/.nwclient
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Если пользователям не являющимися администратором разрешено
использовать этот механизм, тогда команда <EM>ncpmount</EM>
должна быть с установленным Set Userid Root, так что вы должны
дать этой команде такое разрешение:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# chmod 4755 ncpmount
</PRE>
</CODE></BLOCKQUOTE>
<P>
<DT><B>Попробуйте утилиту <EM>nsend</EM></B><DD><P>утилита для посылки
сообщений пользователям Novell также включена в этот пакет, она
называется <EM>nsend</EM> и используется как показано: 
<P>
<PRE>
# nsend rod hello there
</PRE>
<P>
<P>должна послать сообщение "hello there" пользователю
вошедшему под именем "rod" на ваш "основной" файловый сервер
(первая запись в вашем файле <CODE>.nwclient</CODE>. Вы можете указать
другой файловый сервер, используя тот же самый синтаксис как
для команды <EM>ncpmount</EM>. 
<P>
</DL>
<P>
<HR>
<A HREF="IPX-HOWTO-10.html">Следующий</A>
<A HREF="IPX-HOWTO-8.html">Предыдущий</A>
<A HREF="IPX-HOWTO.html#toc9">Содержание</A>
</BODY>
</HTML>
