<title>Настройка ядра ОС Linux</title>
<h1>3 <a name="s3"> Настройка ядра ОС Linux </h1>
<p> <a href="tcpiptune.html#toc3"> Содержимое этого раздела</a></p>

<h2>3.1 <A Name="ss3.1"> Начальные установки </h2>

<p>Как правило во всех дистрибутивах ОС Linux ядро собрано так,
что оно не работает как router (маршрутизатор пакетов)
между разными сетями, не поддерживает механизм защиты (firewall)
маршрутизируемых пакетов и подсчета статистики.
Кроме того выбранное вами первоначальное ядро
может не содержать необходимых драйверов для поддержки сетевых
плат и содержит набор драйверов не нужных Вам для работы.</p>
<p>Поэтому Вам необходимо будет
собрать новое ядро, включив в него необходимые функции
и драйвера для работы в качестве gateway.</p>
<p>Для сборки ядра Вам необходимо установить в систему исходные тексты ядра
(дискеты K в Slackware v 3.0.0, или дискеты D в предыдущих версиях
Slackware).</p>
<p>После установки перейдите в каталог
<i>/usr/src/linux</i>
и запустите команду
<blockquote><code>
<pre>
make config
</pre>
</code></blockquote>
</p>
<p>Установите необходимые параметры в секциях
<b>General Setup</b>
,
<b>IDE Drivers</b>
.
Ответьте
<code>y</code>
на вопрос
<blockquote><code>
<pre>
Networking support (CONFIG_NET)
</pre>
</code></blockquote>
.
В секции
<b>Loadable module support</b>
ответьте
<code>y</code>,
если вы собираетесь динамически подключать драйверы
(в том случае, когда конфигурация машины может измениться,
или вы собираетесь использовать это ядро сразу на нескольких машинах),
или
<code>n</code>, если вы заранее знаете набор драйверов
которые Вы собираетесь использовать в системе.</p>
<p></p>
<p></p>

<h2>3.2 <A Name="ss3.2"> Включение возможностей маршрутизации пакетов, защиты сети (screening router) и подсчета IP-статистики (account) </h2>

<p>В секции
<b>Networking options</b>
Ответьте утвердительно на следующие вопросы:
<blockquote><code>
<pre>
TCP/IP networking (CONFIG_INET) [y]
IP forwarding/gatewaying (CONFIG_IP_FORWARD) [y]
IP multicasting (CONFIG_IP_MULTICAST) [y]
IP firewalling (CONFIG_IP_FIREWALL) [y]
IP accounting (CONFIG_IP_ACCT) [y]
</pre>
</code></blockquote>

Ответы на остальные вопросы этой секции можете
оставить прежними.</p>
<p></p>

<h2>3.3 <A Name="ss3.3"> Настройка сетевых драйверов </h2>

<p>В секции
<b>Network device support</b>
ответьте
<code>y</code>
на вопрос
<blockquote><code>
<pre>
Network device support? (CONFIG_NETDEVICES)
</pre>
</code></blockquote>
.
Если вы установили режим динамически загружаемых драйверов (св. выше)
, то на остальные вопросы данной секции вы можете отвечать
<code>n</code>. В этом случае вы должны произвести динамическую
загрузку драйвера при выходе системы в мультирежим
с помощью команды
<b>insmod</b>
в файле
<i>/etc/rc.d/rc.inet1</i>.
Исключение составляют несколько драйверов сетевых плат (например
драйвер платы NE2000). Чтобы проверить, является ли
драйвер динамически загружаемым, перейдите в директорий
<i>/usr/src/linux/drivers/net</i>, найдите исходный файл
требуемого драйвера и поищите строку
<blockquote><code>
<pre>
#ifdef MODULE
</pre>
</code></blockquote>

Если данная строка в файле есть, то драйвер данного устройства
можно загружать динамически.</p>
<p>Если вы не установили режима динамически загружаемых драйверов
или Ваш драйвер сетевой платы не является динамически загружаемым,
то Вам необходимо включить его (их) во время генерации системы.</p>
<p>Минимально необходимый набор драйверов:
<ul>
<li>Для серийной (модемной) линии Вам надо включить либо
SLIP, CSLIP драйверы либо PPP драйвер. Тип драйвера уточните
у Вашего IP-провайдера.</li>
<li>Для локальной (ethernet) сети один из сетевых драйверов
(часть драйверов находится в подпунктах
<p><b>Do you want to be offered ALPHA test drivers (CONFIG_NET_ALPHA)</b></p>
<p><b>Other ISA cards (CONFIG_NET_ISA)</b>.</p>
</li>
</ul>
</p>
<p></p>

<h2>3.4 <A Name="ss3.4"> Сборка ядра </h2>

<p>После ответа на все вопросы запустите команды:
<blockquote><code>
<pre>
make dep
make clean
make zImage
</pre>
</code></blockquote>
</p>
<p>Если Вы установили режим динамически загружаемых драйверов,
то запустите команды сборки и установки этих драйверов:
<blockquote><code>
<pre>
make modules
make modules_install
</pre>
</code></blockquote>

Динамически загружаемые драйвера поместятся в каталог
<i>/lib/modules/<номер_ядра></i>.</p>
<p></p>
<p>После сборки ядра перепишите его в корневой катагог
под любым удобным для Вас именем (например: linuxroute) :
<blockquote><code>
<pre>
mv arch/i386/boot/zImage /linuxroute
</pre>
</code></blockquote>

включите это ядро в состав загружаемых ядер (файл <i>/etc/lilo.conf</i>)
и вызовите команду <b>lilo</b>
(см. документацию на команду lilo).</p>
<p>После этого перезагрузите машину
и попробуйте загрузить новое ядро.
Если все прошло успешно - переходите к настройке
программного обеспечения.</p>
<p></p>
<p></p>

<p><a href="tcpiptune-4.html"> След. </a> Глава, <a href="tcpiptune-2.html"> Пред. </a> Глава</p><p>Содержимое <a href="tcpiptune.html#toc3">этой главы</a>,
 Главное <a href="tcpiptune.html#toc">оглавление</a></p>
<p><a href="tcpiptune.html"> Начало </a> документа,
 <a href="tcpiptune-3.html#0"> Начало этой главы</a></p>

</BODY>
</HTML>
