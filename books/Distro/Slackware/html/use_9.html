 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html LANG=ru>
<meta name="GENERATOR" content="TtH 2.89">
<table width="100%"  CELLSPACING="1" CELLPADDING="1" >
<tr>
<td align="left"><a href="use_8.html">Предыдущий</a></td>
<td align="center"><a href="index.html">Содержание</a></td>
<td align="right"><a href="use_10.html">Следующий</a></td>
</table>
<hr />
<p>
 <h2><a name="tth_sEc5.9">
5.9</a>&nbsp;&nbsp;Управление пакетами Slackware</h2><a name="packages">
</a>

<p>
Пакет программ это упакованный набор связанных программ, которые готовы для
установки. Когда вы скачиваете архив исходных текстов программ, вам надо
конфигурировать, компилировать и установить всё вручную. С пакетом программ
это уже было проделано за вас. Всё, что вам надо сделать, это установить
пакет. Другое очень удобное преимущество пакетов в том, что их можно очень легко
удалить или обновить, если вы пожелаете. Slackware поставляется со всеми
необходимыми пакетами для управления пакетами. Вы можете устанавливать, удалять,
обновлять, создавать и проверять пакеты очень легко.

<p>
     <h3><a name="tth_sEc5.9.1">
5.9.1</a>&nbsp;&nbsp;Обзор формата пакетов</h3>

<p>
Перед тем, как приступить к изучению утилит, вам надо ознакомиться с форматом
пакетов Slackware. Пакет, это всего навсего <b>tar</b> архив, сжатый при помощи
<b>gzip</b>. Пакет устроен таким образом, что он может быть развёрнут в корневом
каталоге файловой системы.

<p>
Здесь приведена вымышленная программа и пример её пакета:

<p>

<table>
<tr><td>./                           </td></tr>
<tr><td>usr/                         </td></tr>
<tr><td>usr/bin/                     </td></tr>
<tr><td>usr/bin/makehejaz            </td></tr>
<tr><td>usr/doc/                     </td></tr>
<tr><td>usr/doc/makehejaz-1.0/       </td></tr>
<tr><td>usr/doc/makehejaz-1.0/COPYING</td></tr>
<tr><td>usr/doc/makehejaz-1.0/README </td></tr>
<tr><td>usr/man/                     </td></tr>
<tr><td>usr/man/man1                 </td></tr>
<tr><td>usr/man/man1/makehejaz.1.gz  </td></tr>
<tr><td>install/                     </td></tr>
<tr><td>install/doinst.sh
</td></tr></table>


<p>
Система управления пакетами развернёт этот файл в корневом каталоге, чтобы
установить его. Будет сделана соответствующая запись в базе данных пакетов,
включающая содержание этого пакета, чтобы он мог быть обновлён или удалён позже.

<p>
Обратите внимание на под-каталог <tt>install/</tt>. Это специальный
каталог, который может содержать скрипт, который будет выполнен после
копирования файлов. Скрипт называется <tt>doinst.sh</tt>. Если система обработки
пакета найдёт такой скрипт, он будет выполнен после установки пакета.

<p>
Другой сценарий может быть использован в пакете, но мы обсудим это более
детально в подразделе&nbsp;<a href="use_9.html#makepkg">5.9.3</a>.

<p>
     <h3><a name="tth_sEc5.9.2">
5.9.2</a>&nbsp;&nbsp;Утилиты пакетов</h3>

<p>
Есть четыре основных утилиты для управления пакетами. Они могут устанавливать,
удалять и обновлять пакеты.

<p>

<h4><b>pkgtool</b></h4>

<p>
<b>pkgtool</b>(8) это управляемая меню программа, позволяющая установку и
удаление пакетов. Основное меню выглядит вот так:

<p>
<br /><table align="left" border="1"><tr><td width="0" align="center">
<a href="../gifs/pkgtool.gif">Figure</a></td></tr></table><!--hbox-->

<p>
Установка может быть произведена из текущего каталога, другого каталога, или с
флоппи дисков. Просто выберите метод, который вы хотите использовать и <b>pkgtool</b>
просмотрит выбранное вами расположение, на факт наличия действительных
пакетов для установки.

<p>
Вы так же можете просмотреть список пакетов, который будет выглядеть вот так:

<p>
<br /><table align="left" border="1"><tr><td width="0" align="center">
<a href="../gifs/pkgtool.view.gif">Figure</a></td></tr></table><!--hbox-->

<p>
Если вы хотите удалить пакеты, выберите remove опцию, и вы увидите список всех
установленных пакетов, с возможностью выбора нескольких из них для удаления.
Пометьте те, которые вы хотите удалить, и нажмите <b>OK</b>. <b>
pkgtool</b> удалит их.

<p>
Некоторые пользователи предпочитают эту команду утилитам командной строки.
Тем не менее, следует отметить, что утилиты командной строки предоставляют
гораздо больше опций. Так же, возможность обновлять пакеты реализована
только, как утилита командной строки.

<p>

<h4><b>installpkg</b></h4>

<p>
<b>installpkg</b>(8) обеспечивает установку новых для вашей системы
пакетов. Синтаксис таков:

<p>

<table>
<tr><td><tt># </tt><b>[ROOT=&lt;path&#62;] installpkg [option] &lt;package name&#62;...</b>
</td></tr></table>


<p>
<b>installpkg</b> имеет три опции. Только одна из них может использована при
вызове программы.

<p>

<p>
<a name="tth_tAb5.6">
</a>
<table>
<tr><td><b>Опция</b> </td><td><b>Действие</b></td></tr>
<tr><td><b>-m</b> </td><td>Производит <b>makepkg</b> операцию с текущим каталогом.</td></tr>
<tr><td><b>-warn</b> </td><td>Показывает, что случится, если вы установите пакет. </td></tr>
<tr><td></td><td>Это довольно полезно, так как вы видите в точности, </td></tr>
<tr><td></td><td>что случится при установке пакета.</td></tr>
<tr><td><b>-r</b> </td><td>Установит рекурсивно все пакеты из текущего каталога. </td></tr>
<tr><td></td><td>&lt;package name&#62; может так же быть маской имён.
</td></tr></table>


<center>Table 5.6: Опции <b>installpkg</b></center>

<p>
Если вы указали переменную окружения ROOT, до выполнения <b>installpkg</b>,
то путь, указанный в переменной будет использован вместо корневого каталога.
Это полезно для настройки новых дисков для вашего корневого каталога. Они
обычно будут смонтированы к <tt>/mnt</tt> или что-то другое, отличное
от <tt>/</tt>.

<p>
База данных установленных пакетов есть не что иное, как набор файлов,
расположенных в <tt>/var/log/packages</tt>. Для каждого из пакетов там
создаётся текстовый файл. Если в пакете есть после-установочный скрипт, он
записывается в <tt>/var/log/scripts/&lt;packagename&#62;</tt>.

<p>
Вы можете указать несколько пакетов, или даже использовать шаблоны для имён
пакетов. Обратите внимание, что <b>installpkg</b> не скажет вам, если вы
переписываете уже установленный пакет. Она просто установит новый пакет
поверх старого. Если вы хотите быть уверенны, чтобы файлы от старого пакета
были удалены из вашей системы, воспользуйтесь <b>upgradepkg</b>.

<p>

<h4><b>removepkg</b></h4>

<p>
<b>removepkg</b>(8) обеспечивает удаление пакетов, уже установленных в
вашей системе. Синтаксис таков:

<p>

<table>
<tr><td><tt># </tt><b>[ROOT=&lt;path&#62;] removepkg [option] &lt;package name&#62;...</b>
</td></tr></table>


<p>
Для <b>removepkg</b> есть четыре опции. Только одна из них может быть
использована при вызове программы.

<p>

<p>
<a name="tth_tAb5.7">
</a>
<table>
<tr><td><b>Опция</b> </td><td><b>Действие</b></td></tr>
<tr><td><b>-copy</b> </td><td>Пакет будет скопирован в резервный каталог. Это создаст дерево</td></tr>
<tr><td></td><td>каталогов оригинального пакета, без удаления его.</td></tr>
<tr><td><b>-keep</b> </td><td>Сохраняет временные файлы, которые создаются при удалении.</td></tr>
<tr><td></td><td>Полезно только для тестирования правильности работы.</td></tr>
<tr><td><b>-preserve</b> </td><td>Пакет удаляется из системы, но в то же время, его копия</td></tr>
<tr><td></td><td>сохраняется в резервный каталог.</td></tr>
<tr><td><b>-warn</b> </td><td>Показывает, что произойдёт, если вы удалите пакет.
</td></tr></table>


<center>Table 5.7: Опции <b>removepkg</b></center>

<p>
Если вы указали переменную окружения ROOT, до выполнения <b>removepkg</b>,
то путь, указанный в переменной будет использован вместо корневого каталога.
Это полезно для настройки новых дисков для вашего корневого каталога. Они
обычно будут смонтированы к <tt>/mnt</tt> или что-то другое, отличное
от <tt>/</tt>.

<p>
<b>removepkg</b> просматривает так же и остальные пакеты, и удаляет только файлы,
являющиеся уникальными для удаляемого пакета. Программа так же просмотрит
пост-установочный скрипт пакета, и удалит все символические ссылки, которые
были созданы им.

<p>
Во время процесса удаления отображается статус. После удаления, база данных
пакета перемещается в <tt>/var/log/removed_packages</tt>, а пост-установочный
скрипт, в <tt>/var/log/removed_scripts</tt>.

<p>
Как и в случае с <b>installpkg</b>, вы можете указывать несколько пакетов, или
использовать шаблоны для имён пакетов.

<p>

<h4><b>upgradepkg</b></h4>

<p>
<b>upgradepkg</b>(8) обновит пакет, уже присутствующий в вашей системе.Синтаксис
программы таков:

<p>

<table>
<tr><td><tt># </tt><b>[ROOT=&lt;path&#62;] upgradepkg &lt;package name&#62;...</b>
</td></tr></table>


<p>
или

<p>

<table>
<tr><td><tt># </tt><b>[ROOT=&lt;path&#62;] upgradepkg \</b></td></tr>
<tr><td><b>&lt;old package name&#62;%&lt;new package name&#62;</b>
</td></tr></table>


<p>
<b>upgradepkg</b> вначале устанавливает новый пакет, а затем удаляет старый
пакет, таким образом, файлы от старого пакета не будут мёртвым грузом висеть в
ваших каталогах. Если имя обновляемого пакета изменилось, воспользуйтесь
вторым вариантом обращения к программе, указав имя старого
пакета (который установлен в системе) и после знака процента имя нового
пакета (который вы устанавливаете) .

<p>
Если вы указали переменную окружения ROOT, до выполнения <b>removepkg</b>,
то путь, указанный в переменной будет использован вместо корневого каталога.
Это полезно для настройки новых дисков для вашего корневого каталога. Они
обычно будут смонтированы к <tt>/mnt</tt> или что-то другое, отличное
от <tt>/</tt>.

<p>
<b>upgradepkg</b> не безупречна. Вам всегда следует создавать копии ваших
конфигурационных файлов. Если они будут переписаны, у вас всё ещё будет
копия оригиналов.

<p>
Как и с <b>installpkg</b> и <b>removepkg</b>, вы можете указать несколько
пакетов, или использовать шаблоны для имён пакетов.

<p>

<h4><b>rpm2tgz/rpm2targz</b></h4>

<p>
Red Hat Package Manager это популярный сегодня тип системы пакетов. Многие
производители программ предоставляют свои программы в RPM формате. Так как
это не наш родной формат, мы не рекомендуем нашим пользователям использовать их.
Тем не менее, некоторые вещи доступны только в RPM (даже исходники).

<p>
Мы предоставляем программы, которая конвертирует RPM пакеты в наш
родной  <tt>.tgz</tt> формат<a href="footnotes.html#tthFtNtACI" name="tthFrefACI"><sup>28</sup></a>. Это позволит вам распаковать пакет
(скажем, при помощи <b>explodepkg </b>) в временный каталог и исследовать
содержимое.

<p>
Программа <b>rpm2tgz</b> создаст Slackware пакет с <tt>.tgz</tt>
расширением, а <b>rpm2targz</b> создаст архив с <tt>.tar.gz</tt> расширением.

<p>
     <h3><a name="tth_sEc5.9.3">
5.9.3</a>&nbsp;&nbsp;Создание пакетов</h3>

<p>
Создание Slackware пакетов может быть, как простым, так и сложным. Нет
специфического метода создания пакетов. Единственное требование это то, что
пакет должен быть <b>tar</b> <b>gziped</b> файл, и если нужен после-установочный
скрипт, он должен быть в каталоге <tt>/install/doinst.sh</tt>.

<p>
Если вы заинтересованы в создании пакетов для вашей системы, или для сети,
которую вы обслуживаете, вам следует посмотреть на различные build
скрипты в дереве каталогов исходников Slackware. Есть несколько методов,
которые мы используем для создания пакетов.

<p>

<h4><b>explodepkg </b></h4>

<p>
<b>explodepkg </b>(8) проделает то же, что <b>installpkg</b>
делает при распаковке пакета, но на самом деле не установит сам пакет, и не
произведёт никаких изменений в базе данных пакетов. Она просто развернёт
содержимое пакета в текущий каталог.

<p>
Если вы посмотрите На дерево каталогов исходников Slackware, вы увидите, как
мы используем эту команду для ''структурных'' пакетов. Эти пакеты содержат
скелет того, как конечный пакет будет выглядеть. Они хранят все необходимые
имена файлов (нулевой длины), права доступа и принадлежности. build скрипт
проделает cat с содержанием пакета из исходного каталога в build
каталог пакета.

<p>

<h4><b>makepkg</b></h4><a name="makepkg">
</a>

<p>
<b>makepkg</b>(8) запакует текущий каталог в формат Slackware package. Она найдёт
все символьные ссылки в дереве и добавит блоки их создания в пост-установочный
скрипт пакета. Так же программа выдаст сообщение, если обнаружит файлы нулевой
длины в дереве пакета.

<p>
Эта программа обычно выполняется после того, как вы создали дерево вашего пакета.

<p>
     <h3><a name="tth_sEc5.9.4">
5.9.4</a>&nbsp;&nbsp;Создание tags и tagfiles (для программы установки)</h3><a name="tags">
</a>

<p>
Программа установки Slackware производит установку пакетов программ в вашу
систему. Существуют так же файлы, которые говорят программе установки,
какие из файлов должны быть установлены, какие из них необязательны, и какие по
умолчанию должны быть выбраны программой установки.

<p>
<tt>tagfile</tt> находится в каталоге первой серии программ и называется
<tt>tagfile</tt>. Он перечисляет пакеты различных дисков и их статус. Статус
может быть:

<p>

<p>
<a name="tth_tAb5.8">
</a>
<table>
<tr><td><b>Опция</b> </td><td><b>Действие</b></td></tr>
<tr><td>ADD  </td><td>Пакет необходим для нормальной работы системы</td></tr>
<tr><td>SKP  </td><td>Пакет будет автоматически пропущен</td></tr>
<tr><td>REC  </td><td>Пакет не является необходимым, но рекомендован</td></tr>
<tr><td>OPT  </td><td>Пакет необязателен
</td></tr></table>


<center>Table 5.8: Опции статуса <tt>tagfile</tt></center>

<p>
Формат прост:

<p>

<table>
<tr><td>&lt;package name&#62;: &lt;status&#62;
</td></tr></table>


<p>
Один пакет на строчку. Оригинальные <tt>tagfiles</tt> для каждого раздела
программ хранятся в <tt>tagfile.org</tt>. Так что если вы запутались со своими,
вы можете восстановить оригинальные.

<p>
Многие администраторы предпочитают писать свои собственные <tt>tagfiles</tt>
и затем при установке просто нажимают ''full''. Программа установки прочтёт
<tt>tagfiles</tt> и произведёт установку в соответствии с их содержанием.Если
вы используете REC или OPT, то появится окно диалога, которое спросит, следует
ли устанавливать этот отдельный пакет. Поэтому рекомендуется использовать ADD и
SKP, если вы пишите <tt>tagfiles</tt> для автоматизированной установки.

<p>
Просто убедитесь, что ваши <tt>tagfiles</tt> будут расположены в тех же
местах, что и оригинальные. Или вы можете так же выбрать ''указать специфический
путь к пользовательскому <tt>tagfile</tt>''.

<p>
     <h3><a name="tth_sEc5.9.5">
5.9.5</a>&nbsp;&nbsp;Итог</h3>

<p>
Теперь вы должны быть знакомы с идеей пакетов программ и как они используются
в Slackware. Вы должны быть знакомы с различными утилитами управления
пакетами и знать, как использовать их. Наиболее важные моменты этого раздела,
это установка, удаление и обновление пакетов. Это и есть наиболее частое
применение утилит пакетов. Так же вы должны иметь хоть общее
представление о том, как создаются и проверяются пакеты.

<hr />
<table width="100%"  CELLSPACING="1" CELLPADDING="1" >
<tr>
<td align="left"><a href="use_8.html">Предыдущий</a></td>
<td align="center"><a href="index.html">Содержание</a></td>
<td align="right"><a href="use_10.html">Следующий</a></td>
</table>
<hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 2.89.<br />On 24 Apr 2001, 16:43.</small>
</html>