 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html LANG=ru>
<meta name="GENERATOR" content="TtH 2.89">
<table width="100%"  CELLSPACING="1" CELLPADDING="1" >
<tr>
<td align="left"><a href="use_7.html">Предыдущий</a></td>
<td align="center"><a href="index.html">Содержание</a></td>
<td align="right"><a href="use_9.html">Следующий</a></td>
</table>
<hr />
<p>
 <h2><a name="tth_sEc5.8">
5.8</a>&nbsp;&nbsp;<b>vi</b></h2><a name="vi">
</a>

<p>
<b>vi</b>(1) это стандартный текстовый редактор Unix, который используется в
основном системными администраторами. Есть несколько версий (клонов) <b>vi</b>:
<b>vi</b>, <b>elvis</b>, <b>vile</b>, и <b>vim</b>. Один из них есть практически в
любой версии Unix, и Linux. Все эти версии включают идентичный основной
набор команд, так что изучив основные команды одного из клонов, вам будет
легко перейти к использованию другого.

<p>
<b>vi</b> включает множество мощных вспомогательных инструментов, включая
подсветку синтаксиса, форматирование кода, мощный поиск-замена механизм, макросы
и многое другое. Эти инструменты делают программу особенно привлекательной для
программистов, вэб разработчиков и т.д. Системные администраторы оценят
возможный автоматизм и интегрированность с оболочкой.

<p>
В Slackware Linux, версия <b>vi</b> по умолчанию, это <b>elvis</b>. Другие
доступные версии, такие как <b>vim</b> и <b>gvim</b>, доступны, если вы установили
соответствующие пакеты. <b>gvim</b> это X Window версия <b>vim</b>, с панелями
инструментов, всплывающими меню и диалогами.

<p>
     <h3><a name="tth_sEc5.8.1">
5.8.1</a>&nbsp;&nbsp;Запуск <b>vi</b></h3>

<p>
<b>vi</b> может быть запущен из командной строки множеством различных способов:

<p>

<table>
<tr><td><tt>$ </tt><b>vi</b>
</td></tr></table>


<p>
<br /><table align="left" border="1"><tr><td width="0" align="center">
<a href="../gifs/vim.splitedit.gif">Figure</a></td></tr></table><!--hbox-->

<p>
Такая команда запустит <b>vi</b> с пустым буфером. Вы увидите почти пустой экран.
Программа сейчас в ''командном режиме'' и ожидает, пока вы сделаете что -либо.
Для обзора различных режимов работы редактора смотрите подраздел&nbsp;<a href="use_8.html#vimod">5.8.2</a>. Чтобы выйти из <b>vi</b> напечатайте:

<p>

<table>
<tr><td><b>:q</b>
</td></tr></table>


<p>
Если вы ничего не изменяли в открытом файле, это приведёт к выходу из
программы. Если же вы изменили что либо, программа скажет вам, что
содержимое файла было изменено и подскажет вам, что напечатать, чтобы
выйти, проигнорировав все изменения.

<p>
Вы можете так же открыть при помощи <b>vi</b> уже существующий файл. Например,
чтобы открыть <tt>/etc/resolv.conf</tt>, вам надо выполнить:

<p>

<table>
<tr><td><tt>$ </tt><b>vi /etc/resolv.conf</b>
</td></tr></table>


<p>
Так же, <b>vi</b> может открыть файл с указанной строчки. Например, вы можете
запустить <b>vi</b> со строки 47 <tt>/usr/src/linux/init/main.c</tt>, выполнив
такую команду:

<p>

<table>
<tr><td><b>vi +47 /usr/src/linux/init/main.c</b>
</td></tr></table>


<p>
<b>vi</b> выведет на экран указанный файл, и установит курсор на указанную
строку. В случае, если номер строки больше номера последней строки файла, <b>
vi</b> поместит курсор на последнюю строку. Это очень удобно для программистов,
так как они могут открыть файл со строки, в которой была обнаружена ошибка,
и таким образом, отпадает необходимость поиска строки вручную.

<p>
     <h3><a name="tth_sEc5.8.2">
5.8.2</a>&nbsp;&nbsp;Режимы <b>vi</b></h3><a name="vimod">
</a>

<p>
<b>vi</b> оперирует в разных режимах, которые используются для выполнения
различных задач. Когда вы только запустили <b>vi</b>, вы попадаете в командный
режим. Отсюда вы можете выполнять разные команды для манипулирования текстом,
перемещаться внутри файла, сохранить, выйти и это ещё не всё. Для изменения
текста используется режим вставки (insert). Вы можете переключаться в различные
режимы, при помощи комбинаций клавиш, которые описаны ниже.

<p>

<h4>Командный режим</h4>

<p>
Вначале вы попадаете в командный режим. Из этого режима вы не можете напрямую
вводить текст, или редактировать уже существующий текст. Но вы можете
манипулировать текстом, искать, выйти, сохранить, загружать другие
файлы, ... Это всего лишь обзор командного режима. Для рассмотрения
разных команд, сотрите подраздел&nbsp;<a href="use_8.html#vikeys">5.8.7</a>.

<p>
Вероятно, наиболее часто используемая команда командного режима, это переход в
режим вставки. Нажмите <b>i</b> и вы попадёте в режим вставки. Курсор изменит
свою форму и ''- INSERT -'' высветится в нижней части экрана (в клонах
программы это не произойдёт). В этом режиме вы можете вводить текст, и он будет
отображаться на экране. Чтобы вернуться в командный режим, нажмите <b>Esc</b>
кнопку.

<p>
Командный режим так же удобен для перемещения внутри файла. На некоторых
системах вы можете использовать стрелки для перемещения. В других системах вам
придётся воспользоваться более традиционными ''hjkl''. Вот список того, как
эти кнопки используются для перемещений:

<p>

<table>
<tr><td><b>h</b> </td><td>перейти влево на один символ</td></tr>
<tr><td><b>j</b> </td><td>перейти вниз на один символ</td></tr>
<tr><td><b>k</b> </td><td>перейти вверх на один символ</td></tr>
<tr><td><b>l</b> </td><td>перейти вправо на один символ</td></tr></table>


<p>
Просто нажмите на соответствующую букву, для перемещения необходимом
направлении. Как будет показано позже, эти команды могут использованы в
комбинации с числом, для более эффективного перемещения.

<p>
Многие команды, используемые в командном режиме начинаются с двоеточия.
Например, для выхода используется <b>:q</b>, как уже упоминалось выше. Двоеточие
просто показывает, что это команда, в то время, как ''q'' говорит <b>vi</b> что
вы хотите покинуть программу. Другой тип команд представлен комбинацией числа
(необязательного) и буквы. Перед такими командами не надо указывать двоеточие,
они используются в основном для манипулирования текстом.

<p>
Для примера, чтобы удалить одну строку из файла, нажмите <b>dd</b>. Что приведёт
к удалению строки, на которой находится курсор. Выполнение команды <b>4dd</b>
укажет <b>vi</b> удалить строку, на которой находится курсор, и три строки
после неё. В общем, число указывает <b>vi</b>, сколько раз выполнить команду.

<p>
Вы можете комбинировать число с командами перемещения. Например, <b>10k</b>
переместит вас на 10 строк вверх по тексту.

<p>
Командный режим так же может быть использован для вырезания и вставки текста,
вставки текста, для считывания других файлов в текущий буфер. Копирование текста
осуществляется при помощи <b>y</b> кнопки (y от yank). Копирование текущей
строки выполняется нажатием <b>yy</b> и может быть использовано с предшествующим
числом, для копирования нескольких строк. Затем перейдёте к месту, куда хотите
вставить скопированный текст, и нажмите <b>p</b>. Текст будет вставлен в строку,
следующую за текущей.

<p>
Вырезание текста выполняется при помощи <b>dd</b> и <b>p</b> используется для
вставки вырезанного текста обратно в файл. Считывание текста с другого файла,
это довольно простая процедура. Просто наберите <b>:r</b>, пробел и имя файла,
содержащего текст, который вы хотите вставить. Содержимое файла будет
помещено в текущий буфер, со строки следующей за той, на которой
находится курсор. Более усовершенствованные клоны <b>vi</b> завершают имена
файла, на подобие того, как это работает в оболочке.

<p>
Последний вариант использования режима, который будет описан здесь, это
поиск. Режим команд позволяет выполнять как простой поиск, так и расширенный
поиск с заменой. В этом разделе будет описан только команда простого поиска.

<p>
Для поиска нажмите на кнопку <tt>/</tt> и введите текст, который вы хотите
найти. <b>vi</b> будет искать от того места, где находится курсор, в направлении
к концу файла, и остановится при нахождении первого совпадения. Заметьте, что не
точные совпадения так же заставят <b>vi</b> остановиться. Например, поиск
''the'' заставит <b>vi</b> остановиться на ''then'', ''therefore'' и т.д. Это
произойдёт потому, что все эти слова содержат ''the'', но только в начале.

<p>
После того, как <b>vi</b> нашёл первое совпадение, вы можете продолжить,
поиск следующего, простым нажатием <tt>/</tt> и ввод. Можно так же задавать поиск
в направлении от курсора, к началу файла, для этого вместо слэш вам надо
воспользоваться <b>?</b>. Например, для поиска в обратном направлении ''the'' вам
необходимо выполнить команду <b>?the</b>.

<p>

<h4>Режим вставки</h4>

<p>
Вставка и замена текста осуществляется в режиме вставки. Как сообщалось выше,
для перехода в этот режим из командного, вам надо нажать <b>i</b>. Далее,
весь напечатанный вами текст вводится в текущий буфер. Нажатие <b>Esc</b>
вернёт вас в командный режим.

<p>
Замена текста осуществляется несколькими способами. Нажатие <b>r</b> из
командного режима позволит вам заменить один символ, подсвеченный
курсором. Просто введите новый символ и он займёт место подсвеченного курсором.
Сразу же после этого вы вернётесь в командный режим. Нажатие <b>R</b>
позволяет вам заменить столько символов, сколько вы пожелаете. Чтобы выйти
из режима замещения, просто нажмите <b>Esc</b> и вы попадёте в командный режим.

<p>
Есть так же и другой способ переключения между вставкой и заменой. Нажатие
кнопки <b>Insert</b> из командного режима переведёт вас в режим вставки.
Если вы уже в режиме вставки, кнопка <b>Insert</b> работает, как переключатель
между режимом вставки и замены.

<p>
     <h3><a name="tth_sEc5.8.3">
5.8.3</a>&nbsp;&nbsp;Открытие файлов</h3>

<p>
<b>vi</b> позволяет открывать файлы как из командного режима, так и из
командной строки, указав имя файла после имени программы. Чтобы открыть файл
<tt>/etc/lilo.conf</tt>:

<p>

<table>
<tr><td>:e /etc/lilo.conf
</td></tr></table>


<p>
Если вы произвели изменения в текущем буфере и не сохранили их, <b>vi</b>
скажет вам об этом. Вы всё же можете открыть файл, без записи текущего
буфера, набрав <b>:e!</b>, пробел и имя файла, который вы хотите открыть.
Обычно предупреждения программы могут быть проигнорированы указанием
восклицательного знака после команды.

<p>
Если вы хотите перечитать текущий файл, вы можете сделать это, набрав <b>e!</b>.
Это удобно, если вы каким-то образом что-то напортили и хотите перечитать
файл.

<p>
Некоторые <b>vi</b> клоны (например, <b>vim</b>) позволяют открыть
одновременно несколько буферов. Например, чтобы открыть файл <tt>09-vi.sgml</tt>
в моём домашнем каталоге, в то время, как другой файл уже открыт, я наберу:

<p>

<table>
<tr><td>:split &nbsp;/09-vi.sgml
</td></tr></table>


<p>
Новый файл отображается в верхней половине экрана, а старый файл отображается
в нижней половине. Есть много команд для управления разделённым экраном, и
многие из них напоминают EMACS. Лучшей ссылкой по использованию этих команд будет
man страница для вашего <b>vi</b> клона.

<p>
     <h3><a name="tth_sEc5.8.4">
5.8.4</a>&nbsp;&nbsp;Сохранение файлов</h3>

<p>
Для сохранения файлов в <b>vi</b> может быть использовано несколько разных команд.
Если вы хотите сохранить текущий буфер в файл <tt>randomness</tt>, вам надо набрать:

<p>

<table>
<tr><td>:w randomness
</td></tr></table>


<p>
После того, как вы однажды сохранили файл, для повторной записи в него, вы
можете просто набрать <b>:w</b>. Все изменения сохранятся в файл. После
сохранения файла, вы попадаете в командный режим. Если вы хотите сохранить
изменения и выйти, из
<b>vi</b> (что случается довольно часто), вам надо набрать <b>:wq</b>. Это
укажет <b>vi</b> сохранить изменения и выйти.

<p>
Иногда необходимо сохранить файл, помеченный только для записи. Вы можете
сделать это, указав восклицательный знак после команды записи, вот так:

<p>

<table>
<tr><td>:w!</td></tr>
<tr><td>:wq!
</td></tr></table>


<p>
Все же может случится, что вы не сможете записать изменения, которые вы
произвели в файл (например, если файл принадлежит другому пользователю).
Если это случится, <b>vi</b> сообщит вам, что он не может записать файл.
Если вы действительно хотите изменить файл, вам придётся вернуться
и изменить его, как root.

<p>
     <h3><a name="tth_sEc5.8.5">
5.8.5</a>&nbsp;&nbsp;Выход из <b>vi</b></h3>

<p>
Один из методов выхода из <b>vi</b> это использование <b>:wq</b>, что приведёт
к сохранению текущего буфера перед выходом. Вы так же можете выйти без
охранения изменений, при помощи <b>:q</b> или <b>:q!</b>. Последний вариант
используется когда вы изменили файл, но не хотите сохранить эти изменения.

<p>
Может случиться, что произойдёт сбой при работе вашего компьютера, или
программы <b>vi</b>. Тем не менее, оба клона (и <b>elvis</b> и <b>vim</b>)
предпримут шаги по минимизированию потерь всех открытых буферов. Оба
редактора сохраняют открытые буфера во временный файл. Этот файл обычно
называется по аналогии с открытым файлом, но с точкой вначале. Это делает файл
скрытым.

<p>
Этот автоматически удаляется, как только вы нормально завершили редактирование
файла. Это значит, что если произошёл сбой, то резервный файл всё ещё будет существовать. И
если вы захотите опять редактировать файл, программа спросит вас, как поступить. В
большинстве случаев большая часть вашей не записанной работы может быть восстановлена. <b>
elvis</b> так же пошлёт вам письмо (из Graceland, что достаточно странно :) сообщающее о
существующей резервной копии.

<p>
     <h3><a name="tth_sEc5.8.6">
5.8.6</a>&nbsp;&nbsp;Настройка <b>vi</b></h3>

<p>
Выбранный вами <b>vi</b> клон может быть настроен несколькими способами.

<p>
Множество команд может быть введено в командном режиме для настройки практически всего,
что угодно. В зависимости от вашего редактора, вы можете активизировать функции,
упрощающие программирование (такие, как подсветку синтаксиса, авто-отступы, и более),
установите макрос для автоматизирования задач, активизации подстановки текста, и более.

<p>
Почти все из этих команд могут быть помещены в настроечный файл в вашем домашнем каталоге.
<b>elvis</b> ищет <tt>.exrc</tt> файл, а <b>vim</b>  ищет <tt>.vimrc</tt> файл. Большинство
конфигурационных команд, которые могут быть введены из командной строки, могут быть
размещены в настроечный файл. Включая установочную информацию, подстановку текста,
макросы, и более.

<p>
Обсуждение всех этих опций и различий между редакторами, не является целью данной книги,
так что если вы заинтересовались расширенными функциями редакторов, загляните в man
страницу или зайдите на вэб сайт предпочитаемого вами редактора. Некоторые редакторы (как
<b>vim</b>) содержат мощную справочную систему, доступную внутри редактора, по команде <b>
:help</b>. Вы так же можете заглянуть в книгу ''Изучаем Редактор vi'' Ламба и Роббинса.

<p>
Многие программы в Linux по умолчанию откроют текстовые файлы в <b>vi</b>. Например,
редактирование ваших crontab задач загрузит <b>vi</b> по
умолчанию. Если вам не нравится <b>vi</b> и хотите, чтобы другая программа запускалась по
умолчанию, всё что вам надо сделать, так это установить значение VISUAL переменной
окружения равное имени вашего любимого редактора. Для информации по установке переменных
окружения смотрите раздел&nbsp;<a href="use_1.html#variable">5.1.3</a>. Если вы хотите, чтобы ваш любимый
редактор был редактором по умолчанию при каждом входе в систему, добавьте установку VISUAL
переменной в ваш <tt>.bash_profile</tt> или <tt>.bashrc</tt> файл.

<p>
     <h3><a name="tth_sEc5.8.7">
5.8.7</a>&nbsp;&nbsp;Кнопки <b>vi</b></h3><a name="vikeys">
</a>

<p>
Этот раздел является чем то вроде быстрого справочника многих основных <b>vi</b> команд.
Некоторые из которых уже упоминались выше, а некоторые будут для вас новыми.

<p>

<p>
<a name="tth_tAb5.2">
</a>
<table>
<tr><td><b>Операция</b> </td><td><b>Кнопка</b></td></tr>
<tr><td>влево, вниз, вверх, вправо </td><td><b>h, j, k, l</b></td></tr>
<tr><td>перейти в конец строки     </td><td><b>$</b></td></tr>
<tr><td>перейти в начало строки    </td><td><b><font face="symbol">ы</font
></b></td></tr>
<tr><td>перейти в конец файла      </td><td><b>G</b></td></tr>
<tr><td>перейти в начало файла     </td><td><b>:1</b></td></tr>
<tr><td>перейти к 47-й строке      </td><td><b>:47</b>
</td></tr></table>


<center>Table 5.2: Перемещения</center>

<p>

<p>
<a name="tth_tAb5.3">
</a>
<table>
<tr><td><b>Операция</b> </td><td><b>Кнопка</b></td></tr>
<tr><td>удалить строку                         </td><td><b>dd</b></td></tr>
<tr><td>удалить пять строк                     </td><td><b>5dd</b></td></tr>
<tr><td>заменить символ                        </td><td><b>r</b></td></tr>
<tr><td>удалить символ                         </td><td><b>x</b></td></tr>
<tr><td>удалить десять символов                </td><td><b>10x</b></td></tr>
<tr><td>отменить последнее действие            </td><td><b>u</b></td></tr>
<tr><td>объединить текущую строку со следующей </td><td><b>J</b>
</td></tr></table>


<center>Table 5.3: Редактирование</center>

<p>

<p>
<a name="tth_tAb5.4">
</a>
<table>
<tr><td><b>Операция</b> </td><td><b>Кнопка</b></td></tr>
<tr><td>найти &#228;sdf" в тексте после курсора </td><td><b>/asdf</b></td></tr>
<tr><td>искать &#228;sdf"в тексте до курсора    </td><td><b>?asdf</b></td></tr>
<tr><td>повтор последнего поиска в тексте после курсора </td><td><b>/</b></td></tr>
<tr><td>повтор последнего поиска в тексте до курсора    </td><td><b>?</b>
</td></tr></table>


<center>Table 5.4: Поиск</center>

<p>

<p>
<a name="tth_tAb5.5">
</a>
<table>
<tr><td><b>Операция</b> </td><td><b>Кнопка</b></td></tr>
<tr><td>выход                                             </td><td><b>:q</b></td></tr>
<tr><td>выход без записи                                  </td><td><b>:q!</b></td></tr>
<tr><td>записать и выйти                                  </td><td><b>:wq</b></td></tr>
<tr><td>записать, без выхода                              </td><td><b>:w</b></td></tr>
<tr><td>пере-загрузить текущий файл                        </td><td><b>:e!</b></td></tr>
<tr><td>записать содержимое буфера в файл <tt>asdf</tt> </td><td><b>:w asdf</b></td></tr>
<tr><td>открыть файл <tt>hejaz</tt>                     </td><td><b>:e hejaz</b></td></tr>
<tr><td>загрузить файл <tt>asdf</tt> в буфер            </td><td><b>:r asdf</b></td></tr>
<tr><td>загрузить вывод <b>ls</b> в  буфер                </td><td><b>:r !ls</b>
</td></tr></table>


<center>Table 5.5: Сохранение и выход</center>

<p>
     <h3><a name="tth_sEc5.8.8">
5.8.8</a>&nbsp;&nbsp;Итог</h3>

<p>
Теперь у вы должны быть некоторые основные знания по стандартному текстовому редактору
Unix <b>vi</b>.   <b>vi</b> это довольно сложная программа, с множеством команд и
настроечных опций. Всё же, вы должны уметь открыть файл, перемещаться по тексту,
редактировать текст и выходить. Это всё, что вам понадобится для выполнения каждодневных
задач. По мере возникновения необходимости в более мощном редакторе, вы можете
использовать документацию <b>vi</b> для изучения его возможностей.
<hr />
<table width="100%"  CELLSPACING="1" CELLPADDING="1" >
<tr>
<td align="left"><a href="use_7.html">Предыдущий</a></td>
<td align="center"><a href="index.html">Содержание</a></td>
<td align="right"><a href="use_9.html">Следующий</a></td>
</table>
<hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 2.89.<br />On 24 Apr 2001, 16:43.</small>
</html>