<HTML>
<HEAD>
 <TITLE>Новый тип для клавиши Enter.</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

     <H2>Новый тип для клавиши Enter.</H2>

<P>
  Рассмотрим пример - для чего может понадобится новый тип.
И что нужно сделать.

<P>
  Итак. Проблема...
<BR>"По умолчанию" клавиша <B>Enter</B> относится к типу <B>ONE_LEVEL</B>, то есть выдает
всегда один и тот же код (<B>CR</B>) при любых модификаторах.
<BR>  Я же привык, что в "консольном режиме" эта же клавиша, нажатая вместе
с <B>Control</B> меняет свое значение на <B>LF</B> (во всяком случае, так во FreeBSD).

<P>
  Для того, чтобы и в XKB она вела себя так же, можно описать новый тип
(сделаем для этого файл <B>my.types</B> и не забудем "приплюсовать" его в строчку,
указывающую на файлы для <B>xkb_types</B>).

<PRE>
type "CTRL_DEPEND" {
   modifiers = Control;
   map[None] = Level1;
   map[Control] = Level2;
   level_name[level1] = "Base";
   level_name[level2] = "Control";
};
</PRE>
(В общем-то, имена уровней - <B>level_name</B> для работы XKB не нужны, но X-сервер
очень не любит "неполные" определения.)

<P>
  Cоответственно, в описании <B>xkb_symbols</B> надо изменить определение для клавиши
<B>Enter</B> (это скан-код <B>&lt;RTRN&gt;</B>).

<P>
  Сделаем файлик <B>my.symbols</B> (не забудьте "приплюсовать" его куда надо)
и поместим туда наше новое определение.

<P>
  "Классическое" определение для <B>&lt;RTRN&gt;</B> (его можно найти найти, например,
в файле <B>symbols/us</B>) выглядит как

<PRE>
key	&lt;RTRN&gt;	{ [Return] };
</PRE>

  Нам надо указать, что эта клавиша имеет тип <B>"CTRL_DEPEND"</B>, и добавить
значение для появившегося второго "уровня" - <B>Linefeed</B> .

<PRE>
key	&lt;RTRN&gt;	{ type="CTRL_DEPEND", [ Return, Linefeed ] };
</PRE>

<P>
  Осталось перегрузить конфигурацию командой <B>xkbcomp</B>. И убедиться, что
все работает.

<P>
  Надо заметить, что уже запущенные приложения (например - <B>xterm</B>) этих
изменений не почувствуют, поскольку все описания типов используются
библиотекой Xlib и загружаются при старте приложения. Поэтому запущенные
приложения не заметят, что появился новый тип.
<BR>  Но все, что запущено после пререзагрузки конфигурации, должно почувствовать
изменения.

<P>
  А теперь настало время сказать, что для данной задачи, новый тип не требуется.
<BR>  ( Я же предупреждал, что мои примеры не являются "хорошим" или "правильным"
решением :-).

<P>
  Обычно в загружаемых "конфигах" уже есть подходящий тип - <B>"PC_BREAK"</B>.
Он используется только для клавиши <B>Break</B>, но ничто не мешает "приписать"
его и клавише <B>Enter</B>.

<P>
  Поэтому достаточно составить только новое определение для скан-кода <B>&lt;RTRN&gt;</B>.

<PRE>
key	&lt;RTRN&gt;	{ type="PC_BREAK", [ Return, Linefeed ] };
</PRE>

<hr>
<p>Иван Паскаль <a href=mailto:pascal@tsu.ru> pascal@tsu.ru </a>

</BODY>
</HTML>
