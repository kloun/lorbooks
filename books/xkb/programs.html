<HTML>
<HEAD>
 <TITLE>Программы, имеющие отношение к XKB.</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

  <H2>Программы, имеющие отношение к XKB.</H2>

<UL>
	<LI><A HREF="programs.html#xkbcomp">xkbcomp</A>
	<LI><A HREF="programs.html#setxkbmap">setxkbmap</A>
	<LI><A HREF="programs.html#xmodmap">xmodmap</A>
	<LI><A HREF="programs.html#xkbwatch">xkbwatch</A>
	<LI><A HREF="programs.html#xkbvleds">xkbvleds и mxkbledpanel</A>
	<LI><A HREF="programs.html#xkbevd">xkbevd и xkbbell</A>
	<LI><A HREF="programs.html#xkbprint">xkbprint</A>
	<LI><A HREF="programs.html#editor">Программа для редактирования раскладки - xkeycaps.</A>
	<LI><A HREF="programs.html#indicators">Индикаторы-переключатели.</A>
</UL>

  <H3><A NAME="xkbcomp">xkbcomp</A></H3>

<P>
  Это самая важная программа. Во всяком случае, она отрабатывет каждый раз
при старте "иксов" для того, чтобы перевести файлы конфигурации XKB
в бинарный формат, понятный самому X-серверу. (Как понятно из названия, это -
"XKB compiler").

<P>
  Но более полезно то, что ее можно вызвать и "вручную".
При этом, она может выполнять и обратное преобразование - из бинарной формы
в "человекочитаемый" конфигурационный файл. И что самое полезное - она может
обмениваться данными (записывать и читать) непосредственно с работающим
X-сервером.

<P>
  То есть, ее можно использовать для того, чтобы в ходе работы загрузить
новую конфигурацию XKB в X-сервер, или наоборот - прочитать текущую
конфигурацию и перевести ее в "читабельный" формат.

<P>
Последнее тоже важно. Поскольку полная конфигурация складывается из
содержимого многих файлов/блоков (не забудьте, что в любом файле может
быть '<B>include</B>'), понять - что же должно получится в результате такого
"сложения" - не так-то просто. С помощью <B>xkbcomp</B> можно "вытащить" из
X-сервера "суммарную" конфигурацию (в виде полной <B>xkb_keymap</B>).

<P>
  Полную информацию о <B>xkbcomp</B> можно прочитать в соответствующем <B>man</B>'е.
<BR>  Поэтому, приведу лишь примеры - как можно "обменяться информацией"
с X-сервером. Вообще-то, если в качестве источника или приемника данных
надо указать X-сервер, это можно сделать (как сказано в <B>man X</B>) в форме
<PRE>
hostname:dispalay_number.screen_number
</PRE>
  В простейшем случае, когда X-сервер запущен на вашей же машине, причем -
только один и с одним "скрином", эта последовательность выглядит как
"<B>:0</B>".

<P>
  Таким образом, для чтения текущей конфигурации XKB можно использовать
команду
<PRE>
xkbcomp :0 outfile
</PRE>
(можно даже не указывать <B>outfile</B>, в этом случае программа сама сочинит
имя для выходного файла, типа - <B>server-0.xkb</B>).

<P>
  Обратите также внимание на ключи <B>-a</B> (all) и <B>-dflts</B> (defaults). С ними
выходная информация будет более полной.

<P>
  Соответствено, для загрузки новой конфигурации можно использовать
команду

<PRE>
xkbcomp xkbfile :0
</PRE>

<P>
  Подразумевается, что <B>xkbfile</B> в этом случае - файл типа <B>xkb_keymap</B>.
Хотя он может и не содержать непосредственно в себе все необходимые
описания (как это получается в выходном файле при чтении из X-сервера),
а только указывать с помощью <B>include</B> файлы-компоненты полной конфигурации.

<P>
  Кстати, эти файлы <B>xkbcomp</B> ищет сначала в текущей директории и, если
не находит, то в "базе данных" конфигураций (<B>X11R6/lib/X11/xkb/</B>).

<P>
  Примеры составления своих файлов конфигурации для "подсовывания"
их <B>xkbcomp</B> можно посмотреть в <A HREF="examples.html">
"Примеры изменения конфигурации XKB: Где будем экспериментировать."</A>

 <H3><A NAME="setxkbmap">setxkbmap</A></H3>

<P>
  Еще одна утилита, которая позволяет "на ходу" поменять конфигурацию XKB.
<BR>Пожалуй, главное ее преемущество перед <B>xkbcomp</B> в том, что она понимает
задание конфигурации в виде <B>rules-model-layout...</B> (<B>xkbcomp</B> этих слов
не понимает).

<P>
  С другой строны, <B>setxkbmap</B> может брать данные только из файлов
"базы данных" настроек (причем, только на той же машине, где запущен
X-сервер). То есть, если вы составите свой файл конфигурации, то прежде чем
воспользоваться <B>setxkbmap</B>, необходимо поместить этот файл в нужное место
(в соответствующую поддиректорию) "базы данных".
(Кстати, <B>setxkbmap</B> еще и не понимает входные данные в виде <B>xkb_keymap</B>,
хотя это просто "глюк" программы.)

<P>
  Кстати, если будете с ее помощью менять русскую раскладку, не забудьте,
что файл <B>ru</B> и все его "вариации" обычно содержать только "частичное"
описание клавиатуры.

<P>
  Если вы выполните команду типа
<PRE>
setxkbmap -symbols ru
</PRE>
то результат будет очень неприятным. У вас "отсохнут" все "небуквенные"
клавиши, включая Esc, BackSpace, Enter (!) и т.д.

<P>
  Поэтому, правильная команда должна выглядеть как
<PRE>
setxkbmap -symbols "en_US+ru"
</PRE>

<P>
  Самое полезное применение этой программы - "сброс" XKB в исходное состояние
после неудачных экспериментов со своими файлами конфигурации. :-)
<BR>  Если запустить ее без параметров, то она прочитает ту конфигурацию, которая
описана в <B>XF86Config</B> и загрузит ее.

<P>
  Более подробно об этой утилите можно прочитать в соответствующем man'е,
а краткую сводку ключей можно получить по команде
<PRE>
setxkbmap -?
</PRE>

  <H3><A NAME="xmodmap">xmodmap</A></H3>

<P>
  Как ни странно, но эта программа тоже может использоваться для работы с XKB.
Просто, она работает с клавиатурным модулем с помощью "старого" протокола
(core protocol). Но поскольку XKB "из соображений совместимости" этот протокол
понимает, то вполне может воспринять таблицы, загружаемые с помощью <B>xmodmap</B>.

<P>
  Естественно, используя <B>xmodmap</B>, вы лишаетесь всех дополнительных возможностей
XKB. Но для простейших исправлений раскладки клавиатуры ее вполне можно использовать.

<P>
  Единственное, что я бы не советовал - использовать широкораспростаненные файлы
для руссификации клавиатуры в формате <B>xmodmap</B> (.Xmodmap). Почему этого делать не стоит,
написано в <A HREF="problems.html">"Почему руссификация через XKB не работает"</A>.

<P>
 Подробности об этой программа читайте в соответствующем <B>man</B>'е.
(Но если вы не знаете - что такое <B>xmodmap</B>, то ... лучше и не знать :-).

  <H3><A NAME="xkbwatch">xkbwatch</A></H3>

<P>
  Эта утилитка показывает текущее состояние "виртуальных" и "реальных"
модификаторов. К сожалению, она имеет очень "скромную внешность"
(никаких подписей - только какие-то безымянные "лампочки") и, к тому же,
остутствует какое-либо описание к ней. (Похоже, авторы писали ее "только
для себя", но зачем-то засунули в дистрибутив. :-)

<P>
 На самом деле, если знать - что именно она показывает, <B>xkbwatch</B> может
оказаться весьма полезной при отладке своих файлов конфигурации.

<P>
  Итак, восполняя пробелы в описании, привожу табличку, поясняющую
значение индикаторов <B>xkbwatch</B>

<TABLE BORDER="2">
<TR><TH>base<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O
<TR><TH>latched<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O
<TR><TH>locked<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O
<TR><TH>effective<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O
<TR><TH>реальные<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O<TD>O
<TR><TH> <TD>Mod5<TD>Mod4<TD>Mod3<TD>Mod2<TD>Mod1<TD>Control<TD>Lock<TD>Shift<TD>
</TABLE>

  <H3><A NAME="xkbvleds">xkbvleds и mxkbledpanel</A></H3>

<P>
  Утилита <B>xkbvleds</B> предназначаена для отображения состояния виртуальных
индикаторов XKB (в том числе и тех, которые имеют "реальные" аналоги
в виде светодиодов на клавитатуре).

<P>
  К сожалению, она выполнена в том же аскетичном стиле (никаких подписей),
что и <B>xkbwatch</B>. И точно так же не имеет никакого описания.

<P>
  Поэтому я не буду ничего о ней рассказывать (хотя она даже имеет какие-то
ключи), а посоветую забыть о ней и, если хочется чего-то подобного,
воспользоваться другой аналогичной утилиткой - <B>mxkbledpanel</B>.

<P>
  Эта утилита имеет более "человеческое лицо". Все индикаторы на ней подписаны
(естественно - те, которые реально используются; напомню, что в XKB может
быть до 32 виртуальных индикаторов, но это не значит, что все они задействованы
в конкретной конфигурации).

<P>
  Кроме того, эта программа позволяет осуществлять
и "обратную связь", если это предусмотренно в конфигурации (подробнее -
смотрите в <A HREF="internals.html#indicators">"Немного о внутренностях XKB":"Индикаторы"</A>
и <A HREF="gram-compat.html#indicator">"Описание поведения индикатора"</A>:drivesKeyboard). То есть, "щелкая мышью" по индикатору можно
включать/выключать его и таким образом менять соответствующее состояние XKB.
(Кстати, благодаря этому, <B>mxkbledpanel</B> может служит простейшим
индикатором-переключателем "РУС/ЛАТ").

<P>
  Недостатки этой программы в том, что она во-первых требует для сборки Motif
(хотя должно хватить и lesstif'а), а во-вторых - не входит в дистрибутивы
XFree. Найти ее можно, например, на -
<A HREF="ftp://ftp.x.org/pub/unsupported/Motif/mxkbledpanel/">
ftp://ftp.x.org/pub/unsupported/Motif/mxkbledpanel/</A>

  <H3><A NAME="xkbevd">xkbevd и xkbbell</A></H3>

<P>
  Судя по названию, <B>xkbevd</B> - "XKB event daemon". Как сказано в <B>man xkbevd</B>,
"эта команда очень 'сырая'... мы предлагаем ее скорее как 'черновой прототип'
для разработчиков, а не как инструмент для 'конечных юзеров'".

<P>
  В основном она принимает <B>bell event</B>'ы и может служить "музыкальной приставкой"
(подробнее смотрите в <A HREF="internals.html#bell">
"Внутренности XKB: Расширенные возможности 'пищалки'"</A>).

<P>
  Правда сам <B>xkbevd</B> звуки не воспроизводит. В его конфигурационном файле
можно указать имя программы для воспроизведения звуков и соответствия
между "именем звука" и аудио-файлом, который надо передать в качестве
аргумента этой программе.

<P>
  А вот программа <B>xkbbell</B> служит "тестером" для "расширенных возможностей
'пищалки'". Она просто посылает запрос модулю <B>XKB</B> для воспроизведения звука.
Причем, с ее помощью можно заказать как обычный "писк" (с помощью ключа
<B>-force</B>), так и "музыкальный фрагмент", указав в качестве аргумента "имя звука".
<BR>  С помощью дополнительных ключей можно симитировать запрос от конкретного
приложения (окна).

<P>
  Как я уже сказал, <B>xkbbell</B> служит скорее "тестером", чем полезной утилитой.
Хотя ее можно использовать и в своих "скриптах", как команду для проигрывания
звуков (естественно, должна быть запущена хоть какая-нибудь XKB-совместимая
"музыкальная приставка").

<P>
  Подробности о <B>xkbevd</B> можно почитать в соответствующем <B>man</B>'е. А для
<B>xkbbell</B> никакого описания нет. Правда, можно посмотреть хотя бы список
ключей, запустив ее с ключем <B>-help</B>.

  <H3><A NAME="xkbprint">xkbprint</A></H3>

<P>
  Эта утилита генерирует картинку (в формате postscript'а) изображающую
клавиатуру. При этом она использует как описание геометрии (<B>xkb_geometry</B>),
так и "назначение" клавиш. То есть, кроме отрисовывания самой геометрии
клавиатуры, она еще и подписывает - какой символ генерируется каждой клавишей.

<P>
  Особой пользы от нее я не вижу. Разве что - проверить правильность
описания геометрии (собственно, кроме этой утилитки ее никто и не использует),
да еще увидеть на картинке расположение сразу всех символов.

<P>
  Подробности - в <B>man xkbprint</B>.

  <H3><A NAME="editor">Программа для редактирования раскладки - xkeycaps.</A></H3>
 
<P>
  Вообще-то, нормальной программы для создания/редактирования раскладок
клавиатур в формате XKB - не существует.

<P>
  Но при желании, для этой цели можно использовать "редактор xmodmap'ов" -
<A HREF="http://www.jwz.org/xkeycaps/">xkeycaps</A>.
Обратите внимание, что она позволяет на каждую клавишу
"подвешивать" до 8-и символов. Что вполне соответствует "четырем группам
по два уровня" в терминах XKB.

<P>
  И хотя она и сохраняет результат вашей работы в формате <B>xmodmap</B>,
преобразовать его в формат файла типа <B>xkb_symbols</B> достаточно просто.
Можете воспользоваться моим "скриптом" <A HREF="modmap2xkb">modmap2xkb</A>,
который делает это автоматически (конечно, программка очень "сырая".
Если у кого-то есть желание ее улучшить - welcome).

<P>
  Не могу не заметить, что <B>xkeycaps</B> в нынешнем виде - довольно плохой редактор.
И дело даже не в том, что она не работает с файлами XKB и, соответственно,
не может использоваться для редактирования <B>xkb_types, xkb_compat</B> и т.п. и,
кроме того, не использует "геометрию" из <B>xkb_geometry</B> (все "геометрии"
"зашиты" в самой программе).

<P>
  Основные ее недостатки в том, что
<UL>
<LI> нет групповых операций - перемещения символов сразу всех (или выбраных)
клавиш в другую группу
<LI> вообще нет "вырезания-вставки" даже для одной клавиши
<LI> нет возможности "подгружать" раскладки из файлов (даже в формате xmodmap).
Выбирать можно только из тех раскладок, которые "вшиты" в саму программу.
<LI> и наконец - при сохранении результата она сама сочиняет имя файла
(если вы хотите наделать несколько раскладок, вам после каждого сохранения
придется вручную переименовывать файл)
</UL>

<P>
  Короче, <B>xkeycaps</B> представляет собой скорее забавный "эмулятор клавиатуры",
чем полноценный "редактор раскладок".

  <H3><A NAME="indicators">Индикаторы-переключатели.</A></H3>

<P>
  Несмотря на то, что XKB сам может поддерживать несколько (до четырех)
различных раскладок и легко переключать их "на ходу", ему очень не хватает
подходящей программы для удобной манипуляции раскладками и отображения
текущего состояния ("лампочек" на клавиатуре явно недостаточно для индикации
состояния, если раскладок больше двух).

<P>
  Кроме того, большинство пользователей уже привыкло к
"индикаторам-переключателям" (типа <B>xrus</B>), которые позволяют переключать
раскладки не только с клавиатуры, но и "щелчком мыши" и, к тому же, отображать
"текущий язык" иконкой на дисплее.

<P>
  Что же из таких программ можно посоветовать для работы "в паре с XKB"?

<P>
  Надо заметить, что популярные "переключалки" типа <B>xruskb, xes, cyrx, kikbd</B>
(кого я еще забыл упомянуть?) для этого плохо подходят.
<BR>  Во-первых, они используют раскладки "в старом стиле", то есть не с кодами
Cyrillic, а "западноевропейскими" буквами. А это вызывает проблемы у
"правильных" программ при корректно установленной locale (подробнее об этом
в <A HREF="problems.html">"Почему руссификация через XKB не работает?"</A>).
<BR>  А во-вторых, все они не используют возможности XKB для переключения
раскладок, и "на каждое телодвижение" сами перезагружают раскладки в X-сервер.

<P>
  "Настоящими" XKB-переключателями являются -
<UL>
<LI><B>kkb</B> - <A HREF="http://www.logic.ru/peter">http://www.logic.ru/peter</A>
<LI><B>FvwmKb</B> - <A HREF="http://linuxfan.com/~sparrow/software/">
     http://linuxfan.com/~sparrow/software/</A>
<LI><B>fookb</B> - <A HREF="http://linux.piter-press.ru/fookb/">
     http://linux.piter-press.ru/fookb/</A>
<LI><B>xxkb</B> - <A HREF="http://www.tsu.ru/~pascal/other/xxkb/">
     http://www.tsu.ru/~pascal/other/xxkb/</A>
</UL>

<P>
  Не желая никого обидеть :-), все-таки выскажу некоторые замечания
относительно этих программ (возможно - несколько запоздалые).

<H4>kkb</H4>

  "Честная" Xkb-переключалка. Хотя в последних версях автор несколько
отошел от "идеи XKB" и добавил "подгрузку" раскладок в процессе работы.
Но надо заметить, что сделано это средствами XKB, то есть наиболее
оптимальным способом.

<P>
  Главный недостаток - для сборки требуется "тулкит" <B>Qt</B>.

<H4>FvwmKb</H4>

  Главное достоинство этой программы - она запоминает состояние клавиатуры
("язык") для каждого открытого приложения и автоматически переключает
его при изменении фокуса окна. Кроме этого, состояние клавиатуры отображается
на "обрамлении" окон - иконкой, цветом рамки и т.п.

<P>
  Главный недостаток - она "заточена" для работы с конкретным window
manager'ом - Fvwm-2 (хотя со временем, возможно, будут версии и для других wm).

<H4>fookb</H4>

  Очень простая и "легкая" переключалка. Основное достоинство - "легкость".
Для сборки достаточно стандартных библиотек и, кроме того, из всех
собратьев она - самая компактная.

<P>
  Недостаток - опять же - простота. :-) Все остальные программы имеют
какие-либо "фичи", недоступные <B>fookb</B>.

<H4>xxkb</H4>

  Себя сильно хвалить не буду :-).
<BR>  Замечу только, что основное достоинство как и у FvwmKb - индивидуальное
состояние для каждого окна. Но в отличии от FvwmKb - работает с любым wm.

<P>
  Недостаток - довольно "аскетичный" вид. Выбор раскладки осуществляется
просто перебором "иконок", а не с помощью "меню".

<hr>
<p>Иван Паскаль <a href=mailto:pascal@tsu.ru> pascal@tsu.ru </a>

</BODY>
</HTML>
