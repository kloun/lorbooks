<HTML>
<HEAD>
 <TITLE>Общее строение файлов конфигурации XKB.</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">


    <H2>Общее строение файлов конфигурации XKB.</H2>


<P>

  Возможны три типа файлов конфигурации
<UL>
	<LI><A HREF="gram-file.html#simple">"Простая" конфигурация</A>
	<LI><A HREF="gram-file.html#blocks">Последовательность из "простых" блоков.</A>
	<LI><A HREF="gram-file.html#complex">Последовательность из "составных" блоков.</A>
</UL>

<H3><A NAME="simple">"Простая" конфигурация</A></H3>

<P>
  Если в файле находится "простая" конфигурация, то в начале файла
должен быть заголовок
<PRE>
  [ Флаги ] ТипФайла [ Имя ]
</PRE>
после которого сразу следуют объявления (или инструкции).
  Например,
<PRE>
xkb_keyсodes

  &lt;TLDE&gt; = 49;
  &lt;AE01&gt; = 10;
.......
</PRE>

<H3><A NAME="blocks">Последовательность из "простых" блоков.</A></H3>


<P>
  Однако, чаще используется другой формат файла - последовательность
"простых" блоков. В таком файле объявления группируются в блоки,
которые ограничиваются фигурными скобками - '<B>{...}</B>' (после каждого блока
должна быть "точка с запятой" - '<B>;</B>').

<P>
  Перед каждым блоком должен быть заголовок, такой же как и в файле с
"простой" конфигурацией

<PRE>
 [ Флаги ] ТипФайла   [ Имя1 ] '{' [ Объявления ] '};'
 [ Флаги ] ТипФайла   [ Имя2 ] '{' [ Объявления ] '};'
...
</PRE>

  Например,
<PRE>
xkb_symbols "basic" {....};
xkb_symbols "us" {....};
....
</PRE>
      <H3><A NAME="file_types">Типы файлов.</A></H3>

<P>
  И в том и в другом формате используются одинаковые <B>"Типы Файлов"</B>.
Это может быть одно из пяти слов
<UL>
<LI> <B>xkb_keycodes</B> - файл (или блок), в котором числовым значения скан-кодов
даются символические имена
<LI> <B>xkb_types</B> - файл, в котором описываются возможные типы клавиш (тип
определяет - сколько различных значений может иметь одна и та же клавиша
в зависимости от состояния модификаторов)
<LI> <B>xkb_compat</B> - файл, в котором описывается "поведение" модификаторов
<LI> <B>xkb_symbols</B> - основной файл, в котором каждому скан-коду (заданному
символическим именем) назначаются все возможные значения, которые может
выдавать конкретная клавиша (другими словами - "раскладка клавиатуры").
<LI> <B>xkb_geometry</B> - описание расположения кнопок и индикаторов на клавиатуре
</UL>


<P>
  Надо отметить, что, если файл состоит из нескольких блоков, то все блоки
должны быть одного типа. Отличаются они только именем.

<P>
  Имя представляет собой произвольное слово в двойных кавычках.

<P>
  Как можно заметить, в формате заголовка только <B>"ТипФайла"</B> должен
присутствовать обязательно, а <B>"Имя"</B> может отсутствовать. Естественно,
если файл предствляет собой "простую" конфигурацию или содержит только
один блок, то именовать их необязательно. В этом случае, чтобы сослаться
в настройках X-сервера на такую конфигурацию достаточно указать имя файла.

<P>
  Но, если в файле находится несколько блоков, разумеется они должны
иметь имена, причем разные. При этом, чтобы сослаться на конкретную
конфигурацию, ее указывают в виде
<PRE>
 имя_файла(имя_блока)
</PRE>
например,
<PRE>
 us(pc104)
</PRE>

  <H3><A NAME="flags">Флаги.</A></H3>



<P>
  В каждом заголовке может быть несколько флагов
<UL>
<LI>   <B>default</B> - этот флаг имеет смысл, если файл состоит из нескольких блоков.
Он помечает один из блоков (только один !) как блок "по умолчанию". То есть,
если где-то будет указано, что конфигурацию надо брать из такого файла, но
при этом не сказано - из какого блока, то будет взят именно тот из блоков,
который помечен флагом <B>"default"</B>.
<LI>   <B>partial</B> - означает, что в этом блоке дано не полное описание
соответствующего типа, а только его часть. Например, это может быть блок
типа <B>xkb_symbols</B>, в котором описаны только "функциональные" клавиши, или
блок типа <B>xkb_geometry</B>, в котором описано только расположение индикаторов.
<LI>   <B>hidden</B> - означает, что определения из этого блока в "нормальном" состоянии
клавиатуры (когда не активен ни один из модификаторов) не видны, и проявляются
только при нажатии какого-нибудь модификатора. Например, блок типа <B>xkb_symbols</B>
в котором описаны коды которые выдает "дополнительная цифровая клавиатура"
(keypad) при нажатом <B>Num_Lock</B>.
</UL>


<P>
  Следующие флаги имеют смысл только для файлов (и блоков) типа <B>xkb_symbols</B>
и просто отмечают - какие группы клавиш описаны в этом блоке
<UL>
<LI><B>alphanumeric_keys</B> - "алфавитно-цифровые"
<LI><B>modifier_keys</B>     - модификаторы (Control, Alt, Meta и т.п.)
<LI><B>keypad_keys</B>       - клавиши "дополнительной цифровой" клавиатуры
<LI><B>function_keys</B>     - "функциональные" клавиши
<LI><B>alternate_group</B>   - "альтернативная" группа, то есть символы какого-нибудь
национального алфавита.
</UL>


<P>
  Надо заметить, что для самого X-сервера (точнее, для программы <B>xkbcomp</B>)
имеет значение только флаг <B>"default"</B>, поскольку от него может зависеть
выбор нужного блока. Остальные флаги нужны скорее юзеру, чтобы лучше
ориентироваться в куче различных блоков и файлов.


<P>
  Кстати, сводный список всех блоков конфигураций с их флагами можно найти
в файлах <B>*.dir</B> в директории <B>{XROOT}/lib/X11/xkb</B>. Названия файлов аналогичны
названиям типов конфигурации - <B>keycodes, types, symbols</B> и т.д. Флаги там
обозначаются одной буквой - первой буквой из названия соответствующего флага.

<H3><A NAME="complex">Последовательность из "составных" блоков.</A></H3>

<P>
  Наконец, рассмотрим третий тип конфигурационного файла - 
последовательность из "составных" блоков.
  Каждый такой "Составной Блок" оформляется как "простой" блок
<PRE>
 [ Флаги ] СложныйТип [ Имя ] '{' Блок { Блок } '}' ';'
</PRE>
но внутри содержит не просто объявления, а блоки "простых" типов, например
<PRE>
xkb_keymap "complete" {
	xkb_keycodes  {...};
	xkb_types     {...};
	xkb_compat    {...};
	xkb_symbols   {...};
	xkb_geometry  {...};
};
</PRE>

<P>
  Так же, как и файл с "простыми" блоками, файл с "составными" блоками
может содержать несколько таких "составных" блоков, отличающихся именами
(один из блоков может быть помечен флагом <B>"default"</B>).


<P>
  Существует три типа "составных" блоков
<UL>
<LI><B>xkb_semantics</B> - такой блок должен содержать блок <B>xkb_compat</B> и может также
иметь в себе блок <B>xkb_types</B>;
<LI><B>xkb_layout</B> - должен содержать блоки <B>xkb_keycodes</B>, <B>xkb_types</B>,
 <B>xkb_symbols</B> и может, также, иметь в себе блок <B>xkb_geometry</B>;
<LI><B>xkb_keymap</B> - наиболее полный блок, должен включать в себя все, что должны
содержать предыдущие два типа (то есть - <B>xkb_keycodes, xkb_types, xkb_compat
xkb_symbols</B>) и может включать дополнительно те компоненты, которые могут
иметь в себе два предыдущих типа.
</UL>

<hr>
<p>Иван Паскаль <a href=mailto:pascal@tsu.ru> pascal@tsu.ru </a>

</BODY>
</HTML>
