<HTML>
<HEAD>
 <TITLE>Файл типа xkb_keycodes.</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

   <H2>Файл типа xkb_keycodes.</H2>

<P>
 Эти файлы (блоки) имею очень простую грамматику. В них просто для всех
скан-кодов задаются символические имена, которые потом используются
в файлах типа <B>xkb_symbols</B> для назначения каждой "физической" клавише
всех возможных значений.

<P>
  Надо заметить, что те скан-коды, которые в них используются, имеют весьма
отдаленное отношение к "физическим" скан-кодам, которые считываются из
"железного" контроллера клавиатуры. Во-первых, X-сервер сам не считывает
скан-коды непосредственно из регистров контроллера, а берет их от
соответствующих драйверов (например, сервер Xfree86 запущенный на машине
с FreeBSD, берет все коды от драйвера "системной консоли" - syscons).

<P>
  А, кроме того, сам X-сервер переводит эти коды в свои "унифицированные"
скан-коды, которые не зависят от архитектуры ("железной" и "софтверной")
системы.

<P>
  Поэтому, при выборе подходящей таблицы <B>xkb_keycodes</B> надо ориентироваться
на тип X-сервера, который вы используете. Так, для сервера из "семейства"
XFree86, самое правильное - брать определения <B>keycodes</B>, которые
соответствуют набору скан-кодов, выдаваемых XFree86.

<P>
  В файле <B>xkb_keycodes</B> могут встречаться четыре типа объявлений.

<UL>
	<LI><A HREF="gram-keycodes.html#var">Объявление переменной.</A>
	<LI><A HREF="gram-keycodes.html#name">Объявление Имени Клавиши.</A>
	<LI><A HREF="gram-keycodes.html#alias">Объявление Алиаса Клавиши.</A>
	<LI><A HREF="gram-keycodes.html#indicator">Объявление Имени Индикатора.</A>
</UL>

  <H3><A NAME="var">Объявление Переменной.</A></H3>

<P>
  В файле <B>xkb_keycodes</B> могут быть определены две переменные - <B>minimum</B> и
<B>maximum</B>.

<P>
  Они задают минимальное и максимальное значение для скан-кодов. Естественно,
что все скан-коды, которые будут использоваться для задания символических имен
должны "вписатся" в диапазон между <B>minimum</B> и <B>maximum</B>.
  Вообще говоря, "объявление переменной" имеет вид

<PRE>
имя_переменной '=' Выражение ';'
</PRE>

  Поэтому, слева от знака '<B>=</B>' должно быть либо слово '<B>minimum</B>', либо -
'<B>maximum</B>'. А справа может быть любое арифметическое выражение (только вот -
зачем ?), которое может быть вычислено на этапе "разборки" файла и дать
в результате константу типа INTEGER. 

  <H3><A NAME="name">Объявление Имени Клавиши.</A></H3>

<P>
  Основное объявление, которое используется в файлах этого типа.
<BR>Имеет вид

<PRE>
KEYNAME '=' Выражение ';'
</PRE>

  <B>KEYNAME</B>, вообще говоря, просто некоторая строка символов (string),
допустимая в языке C. Отличается только тем, что она ограничивается
"угловыми скобками" - знаками '&lt;' и '&gt;' и должна быть не длиннее 4 символов.
<BR>  Например,
<PRE>
  &lt;AE01&gt; = ... ;
</PRE>

<P>
  <B>"Выражение"</B> в правой части объявления может быть любым арифметическим
выражением, допустимым в языке C. То есть, содержать операции '+ - / *'
и "круглые" скобки, при этом операндами могут быть числовые константы
десятичного, шестнадцатеричного и восьмеричного типов (в терминах языка C).

<P>
  Естественно, это выражение должно быть "вычисляемым" на этапе "разборки"
файла. (? наверное, в этом выражение могут использоваться ранее
определенные переменные - <B>maximum</B> и <B>minimum</B>).

  <H3><A NAME="alias">Объявление Алиаса Клавиши.</A></H3>

<P>
  Эти объявления имеют вид
<PRE>
'alias' KEYNAME '=' KEYNAME ';'
</PRE>

<P>
  Они служат просто для того, чтобы одному скан-коду дать несколько разных
имен.

 <H3><A NAME="indicator"> Объявление Имени Индикатора.</A></H3>

<P>
  Вообще-то, эти объявления не имеют никакого отношения к скан-кодам, но,
поскольку они тоже имеют непосредственное отношение к "железу", то самое
подходящее место для них в файлах этого типа.

<P>
  Заметим, что в в модуле XKB, существует 32 индикатора. Часть из них
отображается на светодиодах (LED) клавиатуры (обычно - первые три) и
являются "физическими" индикаторами. Остальные никак не отображаются
на "физической" клавиатуре, но могут изображаться специальными программами
(<B>xkbvleds, mxkbledpanel</B>). Поэтому, они называются "виртуальными индикаторами".

<P>
 Поведение этих индикаторов ("физических" и "виртуальных"), то есть -
в каком случае их включать/выключать, описываются в других файлах - <B>xkb_compat</B>.

<P>
  В файлах типа <B>xkb_keycodes</B> им только даются символические имена, которые
потом используются в файлах типа <B>xkb_compat</B> и <B>xkb_geometry</B> для указания
индикатора.

<P>
 Объявление имени индикатора имеет вид

<PRE>
'indicator' INTEGER '=' STRING ';'
</PRE>
или
<PRE>
'virtual indicator' INTEGER '=' STRING ';'
</PRE>

<P>
  Здесь, <B>INTEGER</B> - числовая константы типа INTEGER. Она просто определяет
номер индикатора. Обычно, первые три индикатора являются "физическими"
(светодиоды <B>NumLock, CapsLock</B> и <B>ScrollLock</B> на клавиатуре), остальные -
с 4 по 32, являются "виртуальными" (то есть, никак не отображаются на
"физической" клавиатуре).

<P>
  <B>STRING</B> - произвольная строка символов в "двойных кавычках".

<P>
  Замечу также, что это имя не только служит для указания конкретного
индикатора в других файлах конфигурации XKB, но и запоминается во
внутренних структурах модуля XKB и может быть потом считано оттуда
соответствующими программами (которые изображают "панель индикаторов"
или рисуют "геометрию" клавиатуры).

  <H3><A NAME="example">Пример файла типа xkb_keycodes</A></H3>

<PRE>
default xkb_keycodes "xfree86" {

    minimum= 8;
    maximum= 134;

    &lt;TLDE&gt; =  49;
    &lt;AE01&gt; =  10;
    &lt;AE02&gt; =  11;
.......

    indicator 1 = "Caps Lock";
    indicator 2 = "Num Lock";
    indicator 3 = "Scroll Lock";

    virtual indicator 4 = "Shift Lock";
    virtual indicator 5 = "Altrnate Group";

    alias &lt;ALGR&gt; = &lt;RALT&gt;;
};
</PRE>

<hr>
<p>Иван Паскаль <a href=mailto:pascal@tsu.ru> pascal@tsu.ru </a>
</BODY>
</HTML>
