<HTML>
<HEAD>
 <TITLE>Общие замечания о языке файлов конфигурации XKB</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">
   <H2>Общие замечания о языке файлов конфигурации XKB.</H2>


<P>
  Для описания конфигурации <B>XKB</B> используется язык с синтаксисом похожим
на синтаксис языка <B>C</B>.

<P>
  Поэтому, формат числовых и строковых констант, встречающихся в этих
файлах, обычно соответствут формату констант языка C.


<P>
  Так строковые константы представляют собой набор символов ограниченный
"двойными кавычками" (например - "Num Lock"). Причем, внутри строк могут
встречаться "спецсимволы", которые обозначаются так же как в языке C
(\r, \n, \t, \v, \b, \f или через восьмеричный код - \0**).


<P>
  Числовые константы могут записываться как в десятичном формате (например -
123), так и в шестнадцатеричном (0x123, 0xff) и восьмеричном (033). 


<P>
  Главное отличие от языка C в том, что во всех словах маленькие и
большие буквы НЕ различаются (case insensitive).
  То есть, например - <B>SETMODS, SetMods, setMods</B> и <B>setmods</B> означают одно
и то же.

   <H2>Объявления в файлах конфигурации, общие для всех типов файлов.</H2>


 
<P>
 Каждый файл или блок конфигурации состоит из группы объявлений
(деклараций, инструкций, определений ?).


<P>
  Какие именно объявления допустимы в конкретном файле (и как они выглядят)
зависит от "Типа Файла".

<P>
  Однако, есть некоторые слова, которые могут встречаться в файлах
(блоках) любых типов.

  <H3><A NAME="include">Инструкция include.</A></H3>



<P>
  Понятно - что она означает - включить в этот блок описания из другого
файла (блока). Причем, аргументом этой инструкции может быть не просто
имя файла и блока, а, вообще говоря, просто строка, например

<PRE>
  include "en_US(pc104)+ru"
</PRE>


<P>
  Естественно, все "слова", соединенные плюсами, должны представлять собой
имена существующих файлов и блоков в них, причем того же типа, что и блок,
в котором встретилась эта инструкция.

  <H3><A NAME="merge">Способ добавления.</A></H3>



<P>
  Перед каждым отдельным объявлением может стоять дополнительное слово,
которое определяет "способ добавления" или "замещения" (<B>merge mode</B>).


<P>
  Оно определяет - как должна поступить программа, считывающая конфигурацию
из файла, если такое объявление уже встречалось и новое объявление
"конфликтует" с предыдущим. Например, это может быть определение кодов символов
(блок типа <B>xkb_symbols</B>) для скан-кода, который уже был определен ранее или
описание "поведения" модификатора (тип - <B>xkb_compat</B>) для модификатора, который
уже описан.

  Итак, способ добавления может быть

<UL>
<LI><B>augment</B> -  в случае конфликта оставить старое определение, новое игнорировать

<LI><B>override</B> - заменить строе определение на новое

<LI><B>replace</B>  - обычно то же самое, что и <B>override</B>, но в файле
 <B>xkb_symbols</B> означает
немного другое. Поскольку, каждому скан-коду соответствует целый массив
возможных значений (какое именно выбирается - зависит от модификаторов),
различные определения одного и того же скан-кода могут описывать значения
только для части ячеек этого массива. Так вот, если новое описание определяет
только некоторые ячейки и "способ добавления" - <B>override</B>, то переписаны
будут только те ячейки, которые присутствуют в новом определении, остальные
останутся без изменений. А вот если "способ добавления" - <B>replace</B>, то все
старое описание уничтожается (включая те ячейки, которые отсутствуют в
новом описании) и заменяется на новое, даже если оно не полное.

<LI><B>alternate</B> - допустимо только для файлов типа <B>xkb_keycodes</B>, означает, что,
если новое имя конфликтует с уже существующим, то просто рассматривать его
как "alias скан-кода", то есть - просто другое имя для того же числового
значения скан-кода.
</UL>

  <H3><A NAME="replace">Еще раз об include.</A></H3>



<P>
  Кстати, возвращаясь к инструкции <B>include</B>. Если объявления из "включаемого"
файла "перекрываются" с уже имеющимися, то "по умолчанию" считается, что
они добавляются в режиме <B>override</B> (если внутри файла они не помечены
другими "способами добавления"). То же самое "умолчание" действует, если
в строке-аргументе <B>include</B> есть дополнительные файлы, через знак '+'.

<P>
  А вот если вместо плюса стоит знак '|', то это означает, что следующий
файл должен добавляться в режиме <B>augment</B> (опять же, некоторые объявления
внутри него могут иметь свои "способы добавления").


<P>
    Кроме того, "способ добавления" (кроме <B>altrenate</B>) может использоваться
вместо инструкции include. То есть, вместо

<PRE>
include "group(toggle)"
</PRE>

можно использовать, например, инструкцию

<PRE>
replace "group(toggle)"
</PRE>


<P>
  Нетрудно догадаться, что это означает, что все инструкции из файла (блока)
<B>"group(toggle)"</B> должны быть вставлены в текущий файл (как по инструкции
include), но при этом подразумевается, что у всех инструкций "способ
добавления" - <B>replace</B>.

<hr>
<p>Иван Паскаль <a href=mailto:pascal@tsu.ru> pascal@tsu.ru </a>

</BODY>
</HTML>
